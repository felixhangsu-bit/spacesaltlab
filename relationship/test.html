<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äº²å¯†å…³ç³»å¿ƒç†æµ‹è¯„ | å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --primary-light: #a5b4fc;
  --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #1e293b;
  --text-muted: #64748b;
  --border: #e2e8f0;
  --shadow: 0 4px 20px rgba(0,0,0,0.08);
  --radius: 16px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans SC', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }

/* é¡µé¢åˆ‡æ¢ */
.page { display: none; min-height: 100vh; }
.page.active { display: block; }

/* æµ‹è¯•é¡µ */
#testPage { background: var(--bg); padding: 20px; }
.test-container { max-width: 700px; margin: 0 auto; }
.test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.back-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: all 0.2s; }
.back-btn:hover { background: white; color: var(--text); }
.progress-wrap { text-align: right; }
.progress-text { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
.progress-bar { width: 180px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--gradient); border-radius: 3px; transition: width 0.3s; }

.question-card { background: var(--card); border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); }
.dim-tag { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-bottom: 16px; }
.q-num { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.q-text { font-size: 20px; font-weight: 600; line-height: 1.5; margin-bottom: 32px; }
.options { display: flex; flex-direction: column; gap: 12px; }
.opt { display: flex; align-items: center; gap: 14px; padding: 16px 20px; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
.opt:hover { border-color: var(--primary-light); background: #fafaff; }
.opt.selected { border-color: var(--primary); background: linear-gradient(135deg, #ede9fe 0%, #e0e7ff 100%); }
.opt-radio { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
.opt.selected .opt-radio { border-color: var(--primary); background: var(--primary); }
.opt.selected .opt-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
.opt-text { font-size: 15px; font-weight: 500; }
.nav-btns { display: flex; gap: 12px; margin-top: 32px; }
.nav-btn { flex: 1; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s; }
.nav-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.nav-btn.secondary:hover { border-color: var(--primary-light); }
.nav-btn.primary { background: var(--primary); border: none; color: white; }
.nav-btn.primary:hover { background: var(--primary-dark); }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }

/* ç»“æœé¡µ */
#resultPage { background: linear-gradient(180deg, #667eea 0%, #764ba2 40%, var(--bg) 40%); }
.result-container { max-width: 800px; margin: 0 auto; padding: 40px 20px 60px; }
.result-header { text-align: center; color: white; margin-bottom: 32px; padding-top: 20px; }
.result-header h1 { font-size: 26px; margin-bottom: 8px; }
.result-header p { opacity: 0.9; font-size: 14px; }

.card { background: var(--card); border-radius: var(--radius); padding: 32px; box-shadow: var(--shadow); margin-bottom: 20px; }
.card-title { font-size: 17px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
.card-title .icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
.icon-purple { background: #ede9fe; }
.icon-blue { background: #dbeafe; }
.icon-green { background: #d1fae5; }
.icon-orange { background: #ffedd5; }
.icon-red { background: #fee2e2; }
.icon-pink { background: #fce7f3; }

.type-result { text-align: center; padding-bottom: 24px; border-bottom: 1px solid var(--border); margin-bottom: 24px; }
.type-badge { display: inline-block; padding: 8px 20px; background: var(--gradient); color: white; border-radius: 20px; font-size: 13px; font-weight: 500; margin-bottom: 14px; }
.type-name { font-size: 28px; font-weight: 700; margin-bottom: 12px; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.type-desc { color: var(--text-muted); font-size: 15px; max-width: 500px; margin: 0 auto; line-height: 1.7; }

.stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
.stat-card { padding: 16px; background: #f8fafc; border-radius: 12px; text-align: center; }
.stat-card .label { font-size: 11px; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
.stat-card .value { font-size: 18px; font-weight: 700; color: var(--primary); }

.chart-wrap { max-width: 350px; margin: 0 auto; }

.dim-item { padding: 20px; border: 1px solid var(--border); border-radius: 14px; margin-bottom: 14px; }
.dim-item:last-child { margin-bottom: 0; }
.dim-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.dim-name { display: flex; align-items: center; gap: 10px; font-weight: 600; }
.dim-icon { width: 34px; height: 34px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
.dim-score { font-size: 22px; font-weight: 700; }
.dim-score span { font-size: 13px; color: var(--text-muted); font-weight: 400; }
.dim-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; margin-bottom: 12px; }
.dim-bar-fill { height: 100%; border-radius: 4px; }
.dim-level { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-bottom: 10px; }
.level-high { background: #d1fae5; color: #059669; }
.level-medium { background: #fef3c7; color: #d97706; }
.level-low { background: #fee2e2; color: #dc2626; }
.dim-desc { font-size: 14px; color: var(--text-muted); line-height: 1.7; }

.pattern-card { display: flex; gap: 16px; padding: 20px; background: linear-gradient(135deg, #ede9fe 0%, #e0e7ff 100%); border-radius: 14px; margin-bottom: 12px; }
.pattern-card:last-child { margin-bottom: 0; }
.pattern-icon { width: 50px; height: 50px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.pattern-content h4 { font-size: 15px; font-weight: 600; margin-bottom: 6px; }
.pattern-content p { font-size: 13px; color: var(--text-muted); line-height: 1.6; }

.risk-box { padding: 20px; background: linear-gradient(135deg, #fef2f2 0%, #fff7ed 100%); border-radius: 14px; border: 1px solid #fecaca; }
.risk-item { display: flex; gap: 12px; margin-bottom: 14px; }
.risk-item:last-child { margin-bottom: 0; }
.risk-dot { width: 8px; height: 8px; background: #ef4444; border-radius: 50%; margin-top: 6px; flex-shrink: 0; }
.risk-text { font-size: 14px; color: #7f1d1d; line-height: 1.6; }

.celeb-box { display: flex; gap: 20px; align-items: center; padding: 20px; background: #f8fafc; border-radius: 14px; }
.celeb-avatar { width: 70px; height: 70px; background: var(--gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0; }
.celeb-info h4 { font-size: 16px; margin-bottom: 4px; }
.celeb-info p { font-size: 13px; color: var(--text-muted); line-height: 1.5; }
.celeb-info small { display: block; margin-top: 8px; font-size: 11px; color: #9ca3af; }

.timeline { position: relative; padding-left: 28px; }
.timeline::before { content: ''; position: absolute; left: 9px; top: 6px; bottom: 6px; width: 2px; background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%); }
.timeline-step { position: relative; padding-bottom: 20px; }
.timeline-step:last-child { padding-bottom: 0; }
.timeline-step::before { content: ''; position: absolute; left: -22px; top: 4px; width: 10px; height: 10px; background: var(--primary); border-radius: 50%; border: 2px solid white; box-shadow: 0 1px 4px rgba(0,0,0,0.15); }
.timeline-step .phase { font-size: 11px; color: var(--primary); font-weight: 600; margin-bottom: 4px; }
.timeline-step h5 { font-size: 14px; font-weight: 600; margin-bottom: 6px; }
.timeline-step p { font-size: 13px; color: var(--text-muted); line-height: 1.6; }

.tip-item { display: flex; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--primary); }
.tip-item:last-child { margin-bottom: 0; }
.tip-num { width: 26px; height: 26px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; flex-shrink: 0; }
.tip-text { font-size: 14px; line-height: 1.6; }

.rel-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
.rel-card { padding: 18px; background: #f8fafc; border-radius: 12px; text-align: center; }
.rel-card .emoji { font-size: 28px; margin-bottom: 10px; }
.rel-card h5 { font-size: 14px; font-weight: 600; margin-bottom: 6px; }
.rel-card p { font-size: 12px; color: var(--text-muted); line-height: 1.5; }

.summary-box { padding: 28px; background: var(--gradient); border-radius: 16px; color: white; text-align: center; }
.summary-box h3 { font-size: 18px; margin-bottom: 14px; }
.summary-box p { font-size: 14px; line-height: 1.8; opacity: 0.95; max-width: 550px; margin: 0 auto; }

.disclaimer { padding: 18px; background: #f1f5f9; border-radius: 12px; margin-top: 20px; }
.disclaimer h5 { font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 6px; }
.disclaimer p { font-size: 11px; color: var(--text-muted); line-height: 1.6; }

.download-section { text-align: center; padding-top: 16px; }
.download-btn { display: inline-flex; align-items: center; gap: 10px; padding: 14px 28px; background: var(--gradient); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
.download-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102,126,234,0.35); }
.download-btn:disabled { opacity: 0.7; cursor: wait; }
.restart-btn { display: inline-flex; align-items: center; gap: 6px; margin-top: 14px; padding: 10px 20px; background: transparent; border: 2px solid var(--border); border-radius: 10px; font-size: 13px; color: var(--text-muted); cursor: pointer; transition: all 0.2s; }
.restart-btn:hover { border-color: var(--primary); color: var(--primary); }

/* åŠ è½½ */
.loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: all 0.3s; }
.loading.show { opacity: 1; visibility: visible; }
.loading-box { background: white; padding: 36px; border-radius: 16px; text-align: center; }
.spinner { width: 44px; height: 44px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
@keyframes spin { to { transform: rotate(360deg); } }
.loading-box p { font-size: 15px; color: var(--text); }

/* æ›´å¤šæµ‹è¯•å¼¹çª— */
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: all 0.3s; }
.modal-overlay.show { opacity: 1; visibility: visible; }
.modal-content { background: white; padding: 36px; border-radius: 20px; max-width: 400px; width: 90%; text-align: center; transform: scale(0.9); transition: transform 0.3s; }
.modal-overlay.show .modal-content { transform: scale(1); }
.modal-icon { font-size: 48px; margin-bottom: 16px; }
.modal-content h3 { font-size: 22px; font-weight: 700; margin-bottom: 12px; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.modal-content > p { color: var(--text-muted); font-size: 14px; line-height: 1.6; margin-bottom: 20px; }
.modal-tests { background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
.modal-test-item { padding: 10px; font-size: 14px; color: var(--text); border-bottom: 1px solid var(--border); }
.modal-test-item:last-child { border-bottom: none; }
.modal-tip { font-size: 13px; color: var(--primary); font-weight: 500; margin-bottom: 20px; }
.modal-buttons { display: flex; flex-direction: column; gap: 10px; }
.modal-btn { padding: 14px 24px; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; }
.modal-btn.primary { background: var(--gradient); color: white; }
.modal-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102,126,234,0.3); }
.modal-btn.secondary { background: transparent; border: 2px solid var(--border); color: var(--text-muted); }
.modal-btn.secondary:hover { border-color: var(--primary); color: var(--primary); }
.more-tests-btn { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-color: #f59e0b; color: #92400e; }
.more-tests-btn:hover { border-color: #d97706; color: #78350f; }

@media (max-width: 640px) {
  .stat-grid { grid-template-columns: repeat(2, 1fr); }
  .rel-grid { grid-template-columns: 1fr; }
  .celeb-box { flex-direction: column; text-align: center; }
  .question-card { padding: 28px 20px; }
  .q-text { font-size: 18px; }
}
</style>
</head>
<body>

<div class="loading" id="loading">
  <div class="loading-box">
    <div class="spinner"></div>
    <p>æ­£åœ¨ç”ŸæˆPDFæŠ¥å‘Š...</p>
  </div>
</div>

<!-- æµ‹è¯•é¡µ -->
<div id="testPage" class="page active">
  <div class="test-container">
    <div class="test-header">
      <button class="back-btn" onclick="exitTest()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        é€€å‡º
      </button>
      <div class="progress-wrap">
        <div class="progress-text" id="progressText">ç¬¬ 1 / 48 é¢˜</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:2%"></div></div>
      </div>
    </div>
    <div class="question-card">
      <div class="dim-tag" id="dimTag">ğŸ§­ ä¸»ä½“æ€§</div>
      <div class="q-num" id="qNum">é—®é¢˜ 1</div>
      <div class="q-text" id="qText">åŠ è½½ä¸­...</div>
      <div class="options" id="options"></div>
      <div class="nav-btns">
        <button class="nav-btn secondary" onclick="prevQ()" id="prevBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          ä¸Šä¸€é¢˜
        </button>
        <button class="nav-btn primary" onclick="nextQ()" id="nextBtn">
          ä¸‹ä¸€é¢˜
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ç»“æœé¡µ -->
<div id="resultPage" class="page">
  <div class="result-container">
    <div class="result-header">
      <h1>ğŸ§‚ æµ‹è¯„æŠ¥å‘Š</h1>
      <p>å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· äº²å¯†å…³ç³»å¿ƒç†æµ‹è¯„</p>
    </div>
    <div id="resultContent"></div>
  </div>
</div>

<script>
// é¢˜ç›®æ•°æ®
const questions = [
  "æˆ‘èƒ½å¤Ÿæ¸…æ™°è¡¨è¾¾è‡ªå·±åœ¨å…³ç³»ä¸­çš„éœ€æ±‚å’Œæƒ³æ³•",
  "å³ä½¿ä¼´ä¾£ä¸åŒæ„ï¼Œæˆ‘ä¹Ÿèƒ½åšæŒè‡ªå·±è®¤ä¸ºé‡è¦çš„äº‹",
  "æˆ‘åœ¨å…³ç³»ä¸­å¾ˆå°‘ä¸ºäº†è¿åˆå¯¹æ–¹è€Œæ”¹å˜è‡ªå·±çš„æ ¸å¿ƒä»·å€¼è§‚",
  "æˆ‘èƒ½å¤Ÿç‹¬ç«‹åšå‡ºé‡è¦å†³å®šï¼Œè€Œä¸è¿‡åº¦ä¾èµ–ä¼´ä¾£çš„è®¤å¯",
  "æˆ‘æ¸…æ¥šçŸ¥é“è‡ªå·±åœ¨å…³ç³»ä¸­æƒ³è¦ä»€ä¹ˆ",
  "å½“ä¼´ä¾£çš„æœŸæœ›ä¸æˆ‘çš„ç›®æ ‡å†²çªæ—¶ï¼Œæˆ‘èƒ½æ‰¾åˆ°å¹³è¡¡",
  "æˆ‘ä¸ä¼šå› ä¸ºå®³æ€•å¤±å»å…³ç³»è€Œæ”¾å¼ƒè‡ªå·±çš„æ¢¦æƒ³",
  "æˆ‘åœ¨å…³ç³»ä¸­ä¿æŒç€è‡ªå·±çš„å…´è¶£çˆ±å¥½å’Œç¤¾äº¤åœˆ",
  "æˆ‘èƒ½å¤Ÿåœ¨å…³ç³»ä¸­è¡¨è¾¾ä¸åŒæ„è§è€Œä¸æ„Ÿåˆ°å†…ç–š",
  "æˆ‘è®¤ä¸ºä¿æŒè‡ªæˆ‘å®Œæ•´æ€§æ¯”ç»´æŒå…³ç³»å’Œè°æ›´é‡è¦",
  "æˆ‘å¾ˆå°‘å› ä¸ºä¼´ä¾£çš„çœ‹æ³•è€Œæ€€ç–‘è‡ªå·±çš„åˆ¤æ–­",
  "æˆ‘åœ¨å…³ç³»ä¸­èƒ½å¤Ÿä¿æŒæƒ…æ„Ÿä¸Šçš„ç‹¬ç«‹æ€§",
  "æˆ‘èƒ½å¤Ÿå¯¹ä¼´ä¾£è¯´'ä¸'è€Œä¸æ„Ÿåˆ°è¿‡åº¦æ„§ç–š",
  "æˆ‘æ¸…æ¥šåœ°çŸ¥é“è‡ªå·±åœ¨å…³ç³»ä¸­èƒ½æ¥å—å’Œä¸èƒ½æ¥å—çš„è¡Œä¸º",
  "å½“è¾¹ç•Œè¢«ä¾µçŠ¯æ—¶ï¼Œæˆ‘èƒ½å¤ŸåŠæ—¶è¡¨è¾¾ä¸æ»¡",
  "æˆ‘ä¸ä¼šä¸ºäº†å–æ‚¦ä¼´ä¾£è€Œç‰ºç‰²è‡ªå·±çš„åŸºæœ¬éœ€æ±‚",
  "æˆ‘èƒ½å¤Ÿåœ¨ç»™äºˆå’Œæ¥å—ä¹‹é—´ä¿æŒå¹³è¡¡",
  "æˆ‘ä¸ä¼šè¿‡åº¦ä»‹å…¥ä¼´ä¾£çš„ä¸ªäººäº‹åŠ¡æˆ–ç©ºé—´",
  "æˆ‘å°Šé‡ä¼´ä¾£çš„éšç§ï¼Œä¹ŸæœŸæœ›å¯¹æ–¹å°Šé‡æˆ‘çš„éšç§",
  "æˆ‘èƒ½å¤ŸåŒºåˆ†è‡ªå·±çš„æƒ…ç»ªå’Œä¼´ä¾£çš„æƒ…ç»ª",
  "æˆ‘ä¸ä¼šå› ä¸ºä¼´ä¾£çš„é—®é¢˜è€Œè¿‡åº¦æ‰¿æ‹…è´£ä»»",
  "æˆ‘åœ¨å…³ç³»ä¸­æœ‰è‡ªå·±çš„ä¸ªäººç©ºé—´å’Œæ—¶é—´",
  "æˆ‘èƒ½å¤Ÿæ‹’ç»ä¸åˆç†çš„è¦æ±‚è€Œä¸æ„Ÿåˆ°å®³æ€•",
  "æˆ‘ä¸ä¼šä¸ºäº†å…³ç³»è€Œè¿‡åº¦ç‰ºç‰²è‡ªå·±çš„èº«å¿ƒå¥åº·",
  "å½“ä¸ä¼´ä¾£å‘ç”Ÿå†²çªæ—¶ï¼Œæˆ‘èƒ½å¤Ÿä¿æŒç›¸å¯¹å†·é™",
  "æˆ‘èƒ½å¤Ÿè¯†åˆ«å¹¶å‘½åè‡ªå·±åœ¨å…³ç³»ä¸­çš„æƒ…ç»ª",
  "æˆ‘ä¸ä¼šåœ¨æƒ…ç»ªæ¿€åŠ¨æ—¶åšå‡ºå†²åŠ¨çš„å†³å®šæˆ–è¡Œä¸º",
  "æˆ‘èƒ½å¤Ÿä»¥å¥åº·çš„æ–¹å¼è¡¨è¾¾è´Ÿé¢æƒ…ç»ª",
  "å½“æ„Ÿåˆ°å—ä¼¤æ—¶ï¼Œæˆ‘èƒ½å¤Ÿè‡ªæˆ‘å®‰æŠšè€Œä¸å®Œå…¨ä¾èµ–ä¼´ä¾£",
  "æˆ‘èƒ½å¤Ÿæ¥å—å…³ç³»ä¸­çš„ä¸ç¡®å®šæ€§è€Œä¸è¿‡åº¦ç„¦è™‘",
  "æˆ‘ä¸ä¼šé€šè¿‡å‹æŠ‘æˆ–å¦è®¤æ¥å¤„ç†å…³ç³»ä¸­çš„è´Ÿé¢æƒ…ç»ª",
  "æˆ‘èƒ½å¤Ÿä»å…³ç³»æŒ«æŠ˜ä¸­ç›¸å¯¹å¿«é€Ÿåœ°æ¢å¤",
  "æˆ‘åœ¨å…³ç³»ä¸­çš„æƒ…ç»ªååº”ä¸å®é™…æƒ…å†µç›¸åŒ¹é…",
  "æˆ‘èƒ½å¤Ÿåœ¨å…³ç³»ç´§å¼ æ—¶ä½¿ç”¨æœ‰æ•ˆçš„æ”¾æ¾æŠ€å·§",
  "æˆ‘ä¸ä¼šè®©è¿‡å»çš„å…³ç³»åˆ›ä¼¤è¿‡åº¦å½±å“ç°åœ¨çš„å…³ç³»",
  "æˆ‘èƒ½å¤Ÿåœ¨æƒ…ç»ªä½è½æ—¶å¯»æ±‚é€‚å½“çš„æ”¯æŒ",
  "æˆ‘ç›¸ä¿¡ä¼´ä¾£ä¼šåœ¨æˆ‘éœ€è¦æ—¶ç»™äºˆæ”¯æŒ",
  "æˆ‘ä¸ä¼šè¿‡åº¦æ‹…å¿ƒä¼´ä¾£æ˜¯å¦çœŸçš„çˆ±æˆ‘",
  "å½“ä¼´ä¾£éœ€è¦ç‹¬å¤„æ—¶ï¼Œæˆ‘ä¸ä¼šæ„Ÿåˆ°è¢«æŠ›å¼ƒ",
  "æˆ‘èƒ½å¤Ÿèˆ’é€‚åœ°ä¾èµ–ä¼´ä¾£ï¼Œä¹Ÿè®©ä¼´ä¾£ä¾èµ–æˆ‘",
  "æˆ‘ä¸ä¼šå› ä¸ºçŸ­æš‚çš„åˆ†ç¦»è€Œè¿‡åº¦ç„¦è™‘",
  "æˆ‘ç›¸ä¿¡è‡ªå·±å€¼å¾—è¢«çˆ±å’Œè¢«å–„å¾…",
  "æˆ‘ä¸ä¼šè¿‡åº¦ç›‘æ§ä¼´ä¾£çš„è¡Œä¸ºæˆ–è¡Œè¸ª",
  "å½“å…³ç³»å‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä¸ä¼šç«‹å³æƒ³åˆ°æœ€åçš„ç»“æœ",
  "æˆ‘èƒ½å¤Ÿåœ¨äº²å¯†å’Œç‹¬ç«‹ä¹‹é—´æ‰¾åˆ°èˆ’é€‚çš„å¹³è¡¡",
  "æˆ‘ä¸ä¼šå› ä¸ºå®³æ€•äº²å¯†è€Œæ¨å¼€ä¼´ä¾£",
  "æˆ‘èƒ½å¤Ÿå¦è¯šåœ°ä¸ä¼´ä¾£è®¨è®ºå…³ç³»ä¸­çš„é—®é¢˜",
  "æˆ‘ç›¸ä¿¡é€šè¿‡æ²Ÿé€šå’ŒåŠªåŠ›å¯ä»¥è§£å†³å…³ç³»ä¸­çš„å¤§å¤šæ•°é—®é¢˜"
];

const dims = [...Array(12).fill("agency"), ...Array(12).fill("boundary"), ...Array(12).fill("emotion"), ...Array(12).fill("attachment")];
const dimInfo = {
  agency: { name: "ä¸»ä½“æ€§", icon: "ğŸ§­", color: "#8b5cf6", bg: "#ede9fe" },
  boundary: { name: "è¾¹ç•Œæ„Ÿ", icon: "ğŸ›¡", color: "#3b82f6", bg: "#dbeafe" },
  emotion: { name: "æƒ…ç»ªè°ƒèŠ‚", icon: "ğŸŒŠ", color: "#10b981", bg: "#d1fae5" },
  attachment: { name: "ä¾æ‹ååº”", icon: "ğŸ”—", color: "#f59e0b", bg: "#ffedd5" }
};

const RESULT_MAP = {
  anxious_low: { name: "è½»åº¦ç„¦è™‘å‹ä¾æ‹", celeb: "ç›ä¸½è²Â·æ¢¦éœ²", celebDesc: "æƒ…æ„Ÿæ•æ„Ÿã€æ¸´æœ›è¿æ¥ï¼Œå¯¹äº²å¯†å›åº”é«˜åº¦åœ¨æ„ã€‚", desc: "ä½ å¯¹å…³ç³»è¾ƒä¸ºæ•æ„Ÿï¼Œä½†ä»ä¿æœ‰ä¸€å®šè‡ªæˆ‘ç¨³å®šèƒ½åŠ›ã€‚ä½ æ¸´æœ›äº²å¯†è¿æ¥ï¼ŒåŒæ—¶èƒ½å¤Ÿåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¿æŒæƒ…ç»ªç¨³å®šã€‚", tips: ["è§‰å¯Ÿæƒ…ç»ªå†è¡ŒåŠ¨ï¼šå½“æ„Ÿåˆ°ä¸å®‰æ—¶ï¼Œç»™è‡ªå·±å‡ åˆ†é’Ÿå†·é™æœŸï¼ŒåŒºåˆ†çœŸå®å¨èƒå’Œè¿‡åº¦æ‹…å¿§", "å‡å°‘è¿‡åº¦ç¡®è®¤ï¼šç»ƒä¹ åœ¨ä¸ç¡®å®šæ—¶ä¿æŒç¨³å®šï¼Œè€Œä¸æ˜¯åå¤å¯»æ±‚ä¼´ä¾£çš„ä¿è¯", "å»ºç«‹è‡ªæˆ‘æ”¯æŒï¼šå‘å±•ç‹¬ç«‹çš„æƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›ï¼Œå¦‚å†¥æƒ³ã€è¿åŠ¨æˆ–ä¸æœ‹å‹å€¾è¯‰"] },
  anxious_high: { name: "é«˜åº¦ç„¦è™‘å‹ä¾æ‹", celeb: "æˆ´å®‰å¨œç‹å¦ƒ", celebDesc: "é«˜åº¦æƒ…æ„ŸæŠ•å…¥ï¼Œæåº¦é‡è§†è¢«çˆ±ä¸è¢«å›åº”ã€‚", desc: "ä½ å¯¹å…³ç³»å®‰å…¨æ„Ÿéœ€æ±‚æé«˜ï¼Œå®¹æ˜“é™·å…¥æƒ…ç»ªæ‹‰æ‰¯ã€‚å…³ç³»ä¸­çš„å¾®å°æ³¢åŠ¨å¯èƒ½å¼•å‘å¼ºçƒˆçš„æƒ…ç»ªååº”ã€‚", tips: ["æš‚åœååº”ï¼šåœ¨å†²åŠ¨è¡ŒåŠ¨å‰ï¼Œç»™è‡ªå·±è®¾å®šä¸€ä¸ªç­‰å¾…æœŸï¼ˆå¦‚24å°æ—¶ï¼‰ï¼Œè®©æƒ…ç»ªè‡ªç„¶æ¶ˆé€€", "é™ä½å…³ç³»å”¯ä¸€æ€§ï¼šå‘å±•å…³ç³»ä¹‹å¤–çš„ç”Ÿæ´»é‡å¿ƒï¼Œå¦‚äº‹ä¸šã€å…´è¶£ã€å‹è°Š", "å¢å¼ºè¾¹ç•Œæ„è¯†ï¼šå­¦ä¼šåŒºåˆ†è‡ªå·±çš„æƒ…ç»ªå’Œä¼´ä¾£çš„è´£ä»»ï¼Œä¸æŠŠæ‰€æœ‰å®‰å…¨æ„Ÿå¯„æ‰˜äºä¸€äºº"] },
  avoidant_low: { name: "è½»åº¦å›é¿å‹ä¾æ‹", celeb: "å…‹æ—ç‰¹Â·ä¼Šæ–¯ç‰¹ä¼å¾·", celebDesc: "ç‹¬ç«‹ã€è‡ªæŒï¼Œå€¾å‘ä¿æŒæƒ…æ„Ÿè·ç¦»ã€‚", desc: "ä½ åå¥½ç‹¬ç«‹ï¼Œä½†ä»èƒ½åœ¨å®‰å…¨æ—¶é è¿‘å…³ç³»ã€‚ä½ é‡è§†ä¸ªäººç©ºé—´ï¼Œä½†è¿™å¹¶ä¸å¦¨ç¢ä½ å»ºç«‹æœ‰æ„ä¹‰çš„è¿æ¥ã€‚", tips: ["ç»ƒä¹ è¡¨è¾¾éœ€æ±‚ï¼šå°è¯•æ¯å¤©å‘ä¼´ä¾£è¡¨è¾¾ä¸€ä¸ªå°éœ€æ±‚æˆ–æ„Ÿå—", "åŒºåˆ†ç‹¬ç«‹ä¸ç–ç¦»ï¼šåæ€ä½ çš„è·ç¦»æ˜¯å‡ºäºå¥åº·çš„è‡ªä¸»è¿˜æ˜¯é˜²å¾¡æ€§çš„å›é¿", "å…è®¸ä¾èµ–ï¼šåœ¨å®‰å…¨çš„å…³ç³»ä¸­ç»ƒä¹ æ¥å—å¸®åŠ©å’Œæ”¯æŒ"] },
  avoidant_high: { name: "é«˜åº¦å›é¿å‹ä¾æ‹", celeb: "å²è’‚å¤«Â·ä¹”å¸ƒæ–¯", celebDesc: "é«˜åº¦ç†æ€§ï¼Œå›é¿æƒ…æ„Ÿè„†å¼±æ€§ã€‚", desc: "ä½ é€šè¿‡ç–ç¦»å…³ç³»æ¥ç»´æŒå®‰å…¨æ„Ÿã€‚äº²å¯†å¯èƒ½è®©ä½ æ„Ÿåˆ°ä¸é€‚æˆ–å—åˆ°å¨èƒï¼Œä½ å€¾å‘äºç”¨ç†æ€§å¤„ç†æƒ…æ„Ÿé—®é¢˜ã€‚", tips: ["è§‰å¯Ÿé˜²å¾¡ï¼šæ³¨æ„è‡ªå·±åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šé€€ç¼©ï¼Œè¿™äº›æ¨¡å¼å¾€å¾€ä¸æ—©æœŸç»å†æœ‰å…³", "é€æ­¥æš´éœ²æƒ…æ„Ÿï¼šä»å°çš„æƒ…æ„Ÿåˆ†äº«å¼€å§‹ï¼Œé€æ¸å¢åŠ äº²å¯†ç¨‹åº¦", "å»ºç«‹ä¿¡ä»»ï¼šé€‰æ‹©ä¸€ä¸ªå®‰å…¨çš„äººï¼Œç»ƒä¹ å±•ç¤ºè„†å¼±çš„ä¸€é¢"] },
  secure: { name: "å®‰å…¨å‹ä¾æ‹", celeb: "å·´æ‹‰å…‹Â·å¥¥å·´é©¬", celebDesc: "ç¨³å®šã€è‡ªæ´½ï¼Œèƒ½å¹³è¡¡äº²å¯†ä¸è‡ªæˆ‘ã€‚", desc: "ä½ åœ¨å…³ç³»ä¸­å…·å¤‡è¾ƒå¼ºç¨³å®šæ€§ä¸è°ƒèŠ‚èƒ½åŠ›ã€‚ä½ æ—¢èƒ½èˆ’é€‚åœ°äº²è¿‘ä»–äººï¼Œä¹Ÿèƒ½ä¿æŒå¥åº·çš„è‡ªæˆ‘è¾¹ç•Œã€‚", tips: ["ä¿æŒè§‰å¯Ÿï¼šç»§ç»­å…³æ³¨è‡ªå·±çš„æƒ…ç»ªå˜åŒ–å’Œå…³ç³»åŠ¨æ€", "æŒç»­æ²Ÿé€šï¼šä¿æŒå¼€æ”¾å’Œè¯šå®çš„æ²Ÿé€šä¹ æƒ¯", "ç¨³å®šæŠ•å…¥ï¼šåœ¨å…³ç³»ä¸­ä¿æŒä¸€è‡´çš„æƒ…æ„ŸæŠ•å…¥å’Œæ”¯æŒ"] },
  mixed_anxious: { name: "æ··åˆå‹ï¼ˆç„¦è™‘ä¸»å¯¼ï¼‰", celeb: "æ³°å‹’Â·æ–¯å¨å¤«ç‰¹", celebDesc: "æƒ…æ„Ÿç»†è…»ï¼Œå…³ç³»ä¸­æ˜“å—æ³¢åŠ¨å½±å“ã€‚", desc: "ä½ åœ¨é è¿‘ä¸é˜²å¾¡é—´æ‘‡æ‘†ã€‚ä½ æ¸´æœ›äº²å¯†ä½†åˆå®³æ€•å—ä¼¤ï¼Œè¿™ç§çŸ›ç›¾å¯èƒ½è®©ä½ åœ¨å…³ç³»ä¸­æ„Ÿåˆ°ç–²æƒ«ã€‚", tips: ["è¯†åˆ«è§¦å‘ç‚¹ï¼šäº†è§£ä»€ä¹ˆæƒ…å†µä¼šè§¦å‘ä½ çš„ç„¦è™‘æˆ–å›é¿ååº”", "æš‚åœå…³ç³»è¡ŒåŠ¨ï¼šåœ¨æƒ…ç»ªæ¿€åŠ¨æ—¶é¿å…åšé‡è¦å†³å®š", "è‡ªæˆ‘å®‰æŠšï¼šå‘å±•ç‹¬ç«‹äºä¼´ä¾£çš„æƒ…ç»ªè°ƒèŠ‚ç­–ç•¥"] },
  mixed_avoidant: { name: "æ··åˆå‹ï¼ˆå›é¿ä¸»å¯¼ï¼‰", celeb: "åŸºåŠªÂ·é‡Œç»´æ–¯", celebDesc: "æ¸©å’Œå…‹åˆ¶ï¼Œæƒ…æ„Ÿè¡¨è¾¾å†…æ•›ã€‚", desc: "ä½ æ¸´æœ›äº²å¯†åˆå®³æ€•å¤±æ§ã€‚ä½ å¯èƒ½åœ¨å…³ç³»åˆæœŸè¡¨ç°å¾—çƒ­æƒ…ï¼Œä½†éšç€äº²å¯†åŠ æ·±è€Œå¼€å§‹é€€ç¼©ã€‚", tips: ["å…è®¸è„†å¼±ï¼šæ¥å—è„†å¼±æ˜¯äº²å¯†å…³ç³»çš„å¿…è¦éƒ¨åˆ†", "åˆ†é˜¶æ®µé è¿‘ï¼šè®¾å®šå°çš„äº²å¯†ç›®æ ‡ï¼Œé€æ­¥å¢åŠ æƒ…æ„ŸæŠ•å…¥", "å¢å¼ºä¿¡ä»»ï¼šè®°å½•ä¼´ä¾£æ”¯æŒä½ çš„æ—¶åˆ»ï¼Œå»ºç«‹ä¿¡ä»»çš„è¯æ®åº“"] },
  low_attachment: { name: "ä½ä¾æ‹ååº”å‹", celeb: "æŸ¥ç†Â·èŠ’æ ¼", celebDesc: "æƒ…ç»ªç¨³å®šï¼Œå¯¹å…³ç³»æ³¢åŠ¨ä¸æ•æ„Ÿã€‚", desc: "ä½ å¯¹å…³ç³»ä¾èµ–åº¦è¾ƒä½ã€‚è¿™å¯èƒ½è¡¨ç°ä¸ºæƒ…ç»ªç¨³å®šï¼Œä½†ä¹Ÿå¯èƒ½æ„å‘³ç€ä½ ä¸ä¼´ä¾£çš„æƒ…æ„Ÿè¿æ¥ä¸å¤Ÿæ·±å…¥ã€‚", tips: ["ç†è§£æƒ…æ„Ÿéœ€æ±‚ï¼šåæ€ä½ æ˜¯çœŸçš„ä¸éœ€è¦äº²å¯†ï¼Œè¿˜æ˜¯å­¦ä¼šäº†å‹æŠ‘è¿™ç§éœ€æ±‚", "é€‚åº¦å›åº”ï¼šç»ƒä¹ å¯¹ä¼´ä¾£çš„æƒ…æ„Ÿè¡¨è¾¾ç»™äºˆæ›´å¤šå›åº”", "å¢å¼ºå…±æƒ…ï¼šå°è¯•ç†è§£ä¼´ä¾£å¯¹äº²å¯†çš„éœ€æ±‚å¯èƒ½ä¸ä½ ä¸åŒ"] },
  high_emotion: { name: "é«˜æƒ…ç»ªååº”å‹", celeb: "é˜¿é»›å°”", celebDesc: "æƒ…ç»ªæ·±åˆ»ï¼Œæƒ…æ„Ÿä½“éªŒå¼ºçƒˆã€‚", desc: "ä½ å¯¹æƒ…ç»ªå˜åŒ–é«˜åº¦æ•æ„Ÿã€‚ä½ çš„æƒ…æ„Ÿä½“éªŒä¸°å¯Œè€Œæ·±åˆ»ï¼Œä½†æœ‰æ—¶å¯èƒ½éš¾ä»¥è°ƒèŠ‚å¼ºçƒˆçš„æƒ…ç»ªæ³¢åŠ¨ã€‚", tips: ["æƒ…ç»ªåˆ†ç¦»ï¼šå­¦ä¼šåŒºåˆ†æƒ…ç»ªå’Œäº‹å®ï¼Œä¸è®©æƒ…ç»ªå®Œå…¨ä¸»å¯¼åˆ¤æ–­", "èŠ‚å¥æ”¾ç¼“ï¼šåœ¨æƒ…ç»ªé«˜æ¶¨æ—¶æœ‰æ„è¯†åœ°æ”¾æ…¢ååº”é€Ÿåº¦", "è‡ªæˆ‘è°ƒèŠ‚ï¼šå‘å±•å¤šç§æƒ…ç»ªè°ƒèŠ‚æŠ€å·§ï¼Œå¦‚æ·±å‘¼å¸ã€æ­£å¿µã€ä¹¦å†™"] },
  low_boundary: { name: "ä½è¾¹ç•Œå‹", celeb: "ç‰¹è•¾èä¿®å¥³", celebDesc: "é«˜åº¦ä»˜å‡ºï¼Œæ˜“å¿½ç•¥è‡ªæˆ‘ã€‚", desc: "ä½ å®¹æ˜“ä¸ºå…³ç³»ç‰ºç‰²è‡ªæˆ‘ã€‚ä½ å¯èƒ½è¿‡åº¦å…³æ³¨ä¼´ä¾£çš„éœ€æ±‚è€Œå¿½è§†è‡ªå·±ï¼Œå¯¼è‡´ç–²æƒ«æˆ–æ€¨æ¨ã€‚", tips: ["ç»ƒä¹ æ‹’ç»ï¼šæ¯å¤©è‡³å°‘å¯¹ä¸€ä¸ªä¸åˆç†çš„è¦æ±‚è¯´'ä¸'", "æ˜ç¡®è´£ä»»ï¼šåŒºåˆ†ä½ çš„è´£ä»»å’Œä¼´ä¾£çš„è´£ä»»", "ä¿æŠ¤ç²¾åŠ›ï¼šè®¾å®šä¸ªäººæ—¶é—´å’Œç©ºé—´ï¼Œè¿™ä¸æ˜¯è‡ªç§è€Œæ˜¯å¿…è¦çš„è‡ªæˆ‘ç…§é¡¾"] },
  high_boundary: { name: "é«˜è¾¹ç•Œå‹", celeb: "å®‰å‰ä¸½å¨œÂ·æœ±è‰", celebDesc: "è¾¹ç•Œæ¸…æ™°ï¼Œé‡è§†è‡ªæˆ‘ä¸»æƒã€‚", desc: "ä½ å¯¹è‡ªæˆ‘ç•Œé™éå¸¸æ¸…æ¥šã€‚ä½ å–„äºä¿æŠ¤è‡ªå·±ï¼Œä½†æœ‰æ—¶å¯èƒ½å› ä¸ºè¿‡äºåšå›ºçš„è¾¹ç•Œè€Œé˜»ç¢äº†äº²å¯†è¿æ¥ã€‚", tips: ["ä¿æŒæŸ”è½¯ï¼šåœ¨å®‰å…¨çš„å…³ç³»ä¸­å°è¯•é€‚åº¦æ”¾æ¾è¾¹ç•Œ", "å¢å¼ºæƒ…æ„Ÿäº¤æµï¼šç»ƒä¹ åˆ†äº«æ›´å¤šå†…å¿ƒä¸–ç•Œå’Œè„†å¼±æ—¶åˆ»", "å¹³è¡¡æ§åˆ¶ï¼šåŒºåˆ†å¥åº·çš„è¾¹ç•Œå’Œé˜²å¾¡æ€§çš„éš”ç¦»"] },
  balanced: { name: "ç»“æ„å‡è¡¡å‹", celeb: "ç±³æ­‡å°”Â·å¥¥å·´é©¬", celebDesc: "è‡ªæ´½ç¨³å¥ï¼Œæƒ…æ„Ÿä¸ç†æ€§å¹³è¡¡ã€‚", desc: "ä½ çš„å…³ç³»å¿ƒç†ç»“æ„æ•´ä½“å¹³è¡¡ã€‚ä½ åœ¨å„ä¸ªç»´åº¦éƒ½è¡¨ç°å‡ºç›¸å¯¹å¥åº·çš„æ¨¡å¼ï¼Œèƒ½å¤Ÿçµæ´»åº”å¯¹å…³ç³»ä¸­çš„æŒ‘æˆ˜ã€‚", tips: ["æŒç»­è§‰å¯Ÿï¼šä¿æŒå¯¹è‡ªå·±æƒ…ç»ªå’Œè¡Œä¸ºæ¨¡å¼çš„å…³æ³¨", "ç¨³å®šå…³ç³»æŠ•å…¥ï¼šç»§ç»­åœ¨å…³ç³»ä¸­ä¿æŒä¸€è‡´çš„ä»˜å‡ºå’Œå‚ä¸", "è‡ªæˆ‘æˆé•¿ï¼šæŠŠå…³ç³»ä½œä¸ºä¸ªäººæˆé•¿çš„å¥‘æœºï¼Œè€Œä¸ä»…ä»…æ˜¯æ»¡è¶³éœ€æ±‚çš„å·¥å…·"] }
};

let idx = 0;
let answers = Array(48).fill(null);

function render() {
  const d = dims[idx], info = dimInfo[d];
  document.getElementById('progressText').textContent = `ç¬¬ ${idx + 1} / 48 é¢˜`;
  document.getElementById('progressFill').style.width = `${((idx + 1) / 48) * 100}%`;
  document.getElementById('dimTag').innerHTML = `${info.icon} ${info.name}`;
  document.getElementById('dimTag').style.background = info.bg;
  document.getElementById('dimTag').style.color = info.color;
  document.getElementById('qNum').textContent = `é—®é¢˜ ${idx + 1}`;
  document.getElementById('qText').textContent = questions[idx];

  const opts = [{ v: 1, t: "éå¸¸ä¸ç¬¦åˆ" }, { v: 2, t: "æ¯”è¾ƒä¸ç¬¦åˆ" }, { v: 3, t: "æ¯”è¾ƒç¬¦åˆ" }, { v: 4, t: "éå¸¸ç¬¦åˆ" }];
  document.getElementById('options').innerHTML = opts.map(o => `
    <div class="opt ${answers[idx] === o.v ? 'selected' : ''}" onclick="select(${o.v})">
      <div class="opt-radio"></div>
      <span class="opt-text">${o.t}</span>
    </div>
  `).join('');

  document.getElementById('prevBtn').disabled = idx === 0;
  document.getElementById('nextBtn').innerHTML = idx === 47 ? 'æŸ¥çœ‹ç»“æœ â†’' : 'ä¸‹ä¸€é¢˜ <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
}

function select(v) { answers[idx] = v; render(); if (idx < 47) setTimeout(() => nextQ(), 250); }
function prevQ() { if (idx > 0) { idx--; render(); } }
function nextQ() {
  if (answers[idx] === null) { alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€‰é¡¹'); return; }
  if (idx < 47) { idx++; render(); } else showResult();
}
function exitTest() {
  if (confirm('ç¡®å®šé€€å‡ºï¼Ÿç­”æ¡ˆå°†ä¸ä¼šä¿å­˜ã€‚')) {
    goToHome();
  }
}

function goToHome() {
  // æ£€æŸ¥ç”¨æˆ·æ¥æº
  const userSource = sessionStorage.getItem('user_source');
  if (userSource === 'platform') {
    // åˆé›†ç”¨æˆ·è¿”å›åˆ°platform
    window.location.href = '../platform.html';
  } else {
    // å•æµ‹ç”¨æˆ·è¿”å›åˆ°æµ‹è¯•é¦–é¡µ
    window.location.href = 'index.html';
  }
}

function getHomeButtonHtml() {
  const userSource = sessionStorage.getItem('user_source');
  if (userSource === 'platform') {
    // åˆé›†ç”¨æˆ·ï¼šæ˜¾ç¤ºè¿”å›æµ‹è¯•ä¸­å¿ƒæŒ‰é’®
    return '<button class="restart-btn" onclick="goToHome()" style="margin-left:8px">è¿”å›æµ‹è¯•ä¸­å¿ƒ</button>';
  } else {
    // å•æµ‹ç”¨æˆ·ï¼šæ˜¾ç¤ºæ›´å¤šæµ‹è¯•æŒ‰é’®ï¼ˆå¼•å¯¼è´­ä¹°ï¼‰
    return '<button class="restart-btn more-tests-btn" onclick="showMoreTests()" style="margin-left:8px">æ›´å¤šæµ‹è¯•</button>';
  }
}

function showMoreTests() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `
    <div class="modal-content">
      <div class="modal-icon">ğŸ§‚</div>
      <h3>æ›´å¤šä¸“ä¸šæµ‹è¯„</h3>
      <p>è¯·åœ¨å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€è´­ä¹°å…¶ä»–æµ‹è¯•å“¦~</p>
      <div class="modal-buttons">
        <button class="modal-btn primary" onclick="closeModal()">çŸ¥é“äº†</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add('show'), 10);
}

function closeModal() {
  const modal = document.querySelector('.modal-overlay');
  if (modal) {
    modal.classList.remove('show');
    setTimeout(() => modal.remove(), 300);
  }
}

function calcScores() {
  const s = { agency: 0, boundary: 0, emotion: 0, attachment: 0 };
  answers.forEach((v, i) => s[dims[i]] += v);
  return s;
}

function getType(s) {
  if (s.attachment > 36 && s.emotion > 36) return "anxious_high";
  if (s.attachment > 32 && s.emotion > 30) return "anxious_low";
  if (s.attachment < 28 && s.boundary > 36) return "avoidant_high";
  if (s.attachment < 32 && s.boundary > 30) return "avoidant_low";
  if (s.emotion > 40) return "high_emotion";
  if (s.boundary < 28) return "low_boundary";
  if (s.boundary > 40) return "high_boundary";
  if (s.attachment < 24) return "low_attachment";
  if (s.attachment > 36 && s.boundary < 30) return "mixed_anxious";
  if (s.attachment < 30 && s.emotion < 30) return "mixed_avoidant";
  if (s.agency > 38 && s.boundary > 38 && s.emotion > 38 && s.attachment > 38) return "secure";
  return "balanced";
}

function getLevel(score) {
  if (score >= 42) return { level: "ä¼˜ç§€", cls: "level-high", pct: "å‰15%" };
  if (score >= 36) return { level: "è‰¯å¥½", cls: "level-high", pct: "å‰35%" };
  if (score >= 30) return { level: "ä¸­ç­‰", cls: "level-medium", pct: "ä¸­é—´40%" };
  if (score >= 24) return { level: "åä½", cls: "level-low", pct: "å35%" };
  return { level: "å¾…æå‡", cls: "level-low", pct: "å15%" };
}

function getDimAnalysis(dim, score) {
  const a = {
    agency: { high: "ä½ åœ¨å…³ç³»ä¸­å±•ç°å‡ºå¼ºçƒˆçš„è‡ªæˆ‘è®¤åŒæ„Ÿå’Œç‹¬ç«‹å†³ç­–èƒ½åŠ›ã€‚ä½ æ¸…æ¥šè‡ªå·±çš„ä»·å€¼è§‚å’Œéœ€æ±‚ï¼Œèƒ½å¤Ÿåœ¨ä¿æŒå…³ç³»å’Œè°çš„åŒæ—¶åšå®ˆè‡ªæˆ‘ã€‚è¿™ç§ç‰¹è´¨è®©ä½ åœ¨äº²å¯†å…³ç³»ä¸­ä¸æ˜“è¿·å¤±è‡ªæˆ‘ã€‚", medium: "ä½ åœ¨å…³ç³»ä¸­å…·æœ‰ä¸€å®šçš„è‡ªä¸»æ€§ï¼Œä½†æœ‰æ—¶å¯èƒ½ä¼šåœ¨è‡ªæˆ‘éœ€æ±‚å’Œå…³ç³»éœ€æ±‚ä¹‹é—´äº§ç”Ÿæ‘‡æ‘†ã€‚å»ºè®®åœ¨é‡è¦å†³ç­–æ—¶æ›´å¤šå€¾å¬å†…å¿ƒçš„å£°éŸ³ã€‚", low: "ä½ å¯èƒ½åœ¨å…³ç³»ä¸­è¿‡åº¦è¿åˆä¼´ä¾£ï¼Œå¿½è§†äº†è‡ªå·±çš„éœ€æ±‚å’Œæƒ³æ³•ã€‚é•¿æœŸå¦‚æ­¤å¯èƒ½å¯¼è‡´è‡ªæˆ‘ä»·å€¼æ„Ÿé™ä½ã€‚å»ºè®®å¼€å§‹ç»ƒä¹ è¡¨è¾¾è‡ªå·±çš„è§‚ç‚¹å’Œéœ€æ±‚ã€‚" },
    boundary: { high: "ä½ å…·æœ‰æ¸…æ™°çš„ä¸ªäººè¾¹ç•Œæ„è¯†ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°åŒºåˆ†è‡ªå·±å’Œä»–äººçš„è´£ä»»ä¸æƒ…ç»ªã€‚ä½ å–„äºä¿æŠ¤è‡ªå·±çš„èº«å¿ƒå¥åº·ï¼ŒåŒæ—¶å°Šé‡ä¼´ä¾£çš„ç‹¬ç«‹ç©ºé—´ã€‚è¿™æ˜¯å»ºç«‹å¥åº·å…³ç³»çš„é‡è¦åŸºç¡€ã€‚", medium: "ä½ å¯¹è¾¹ç•Œæœ‰åŸºæœ¬çš„è®¤çŸ¥ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½éš¾ä»¥åšå®ˆã€‚å»ºè®®è¯†åˆ«é‚£äº›è®©ä½ æ„Ÿåˆ°ä¸é€‚çš„æƒ…å¢ƒï¼Œå¹¶ç»ƒä¹ åœ¨è¿™äº›æƒ…å¢ƒä¸­è¡¨è¾¾è‡ªå·±çš„ç•Œé™ã€‚", low: "ä½ å¯èƒ½å­˜åœ¨è¾¹ç•Œæ¨¡ç³Šçš„é—®é¢˜ï¼Œå®¹æ˜“æ‰¿æ‹…ä¸å±äºè‡ªå·±çš„è´£ä»»æˆ–å…è®¸ä»–äººä¾µå…¥ä½ çš„ç§äººç©ºé—´ã€‚å­¦ä¼šè¯´ã€Œä¸ã€æ˜¯ä½ å½“å‰æœ€é‡è¦çš„æˆé•¿è¯¾é¢˜ã€‚" },
    emotion: { high: "ä½ å…·æœ‰å‡ºè‰²çš„æƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›ï¼Œèƒ½å¤Ÿåœ¨å…³ç³»å†²çªä¸­ä¿æŒç›¸å¯¹å†·é™ï¼Œå¹¶ä»¥å»ºè®¾æ€§çš„æ–¹å¼å¤„ç†è´Ÿé¢æƒ…ç»ªã€‚è¿™ç§èƒ½åŠ›è®©ä½ åœ¨äº²å¯†å…³ç³»ä¸­æ›´å…·ç¨³å®šæ€§å’Œå¯é æ€§ã€‚", medium: "ä½ èƒ½å¤Ÿåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ç®¡ç†è‡ªå·±çš„æƒ…ç»ªï¼Œä½†åœ¨å‹åŠ›æˆ–å†²çªåŠ å‰§æ—¶å¯èƒ½ä¼šå‡ºç°æƒ…ç»ªå¤±æ§ã€‚å»ºè®®å‘å±•æ›´å¤šçš„æƒ…ç»ªè°ƒèŠ‚ç­–ç•¥ã€‚", low: "ä½ å¯èƒ½ç»å¸¸è¢«æƒ…ç»ªæ‰€ä¸»å¯¼ï¼Œåœ¨å…³ç³»ä¸­å®¹æ˜“å‡ºç°å†²åŠ¨ååº”æˆ–æƒ…ç»ªåŒ–è¡Œä¸ºã€‚ä¼˜å…ˆå‘å±•æƒ…ç»ªè§‰å¯Ÿå’Œè‡ªæˆ‘å®‰æŠšèƒ½åŠ›å°†å¤§å¤§æ”¹å–„ä½ çš„å…³ç³»è´¨é‡ã€‚" },
    attachment: { high: "ä½ å±•ç°å‡ºå®‰å…¨å‹ä¾æ‹çš„ç‰¹å¾ï¼Œå¯¹å…³ç³»æœ‰åŸºæœ¬çš„ä¿¡ä»»æ„Ÿï¼Œèƒ½å¤Ÿèˆ’é€‚åœ°ä¸ä¼´ä¾£å»ºç«‹äº²å¯†è¿æ¥ã€‚ä½ ç›¸ä¿¡è‡ªå·±å€¼å¾—è¢«çˆ±ï¼Œä¹Ÿç›¸ä¿¡ä¼´ä¾£ä¼šåœ¨éœ€è¦æ—¶ç»™äºˆæ”¯æŒã€‚", medium: "ä½ å¯¹å…³ç³»æœ‰ä¸€å®šçš„ä¿¡ä»»ï¼Œä½†å¯èƒ½å¶å°”ä¼šå‡ºç°ä¸å®‰å…¨æ„Ÿæˆ–æ‹…å¿§ã€‚è¿™äº›æ„Ÿå—æ˜¯æ­£å¸¸çš„ï¼Œå…³é”®æ˜¯ä¸è®©å®ƒä»¬ä¸»å¯¼ä½ çš„è¡Œä¸ºæ¨¡å¼ã€‚", low: "ä½ å¯èƒ½å¯¹å…³ç³»ç¼ºä¹åŸºæœ¬çš„å®‰å…¨æ„Ÿï¼Œç»å¸¸æ‹…å¿ƒè¢«æŠ›å¼ƒæˆ–ä¸è¢«çˆ±ã€‚ç†è§£è¿™äº›æ¨¡å¼çš„æ ¹æºï¼Œå¹¶åœ¨å®‰å…¨çš„å…³ç³»ä¸­ç»ƒä¹ ä¿¡ä»»ï¼Œæ˜¯ä½ çš„æˆé•¿æ–¹å‘ã€‚" }
  };
  const k = score >= 36 ? "high" : score >= 28 ? "medium" : "low";
  return a[dim][k];
}

function getPatterns(s) {
  const p = [];
  if (s.attachment < 30 && s.emotion > 36) p.push({ icon: "ğŸŒ€", title: "ç„¦è™‘-æŠ—è®®å¾ªç¯", desc: "å½“æ„Ÿåˆ°å…³ç³»ä¸å®‰å…¨æ—¶ï¼Œä½ å¯èƒ½ä¼šé€šè¿‡æŠ—è®®è¡Œä¸ºï¼ˆå¦‚é¢‘ç¹è”ç³»ã€è´¨é—®ï¼‰æ¥æµ‹è¯•ä¼´ä¾£çš„åœ¨æ„ç¨‹åº¦ã€‚è¿™ç§æ¨¡å¼è™½ç„¶å‡ºäºå¯»æ±‚å®‰å…¨æ„Ÿçš„éœ€è¦ï¼Œä½†å¯èƒ½é€‚å¾—å…¶ååœ°æ¨è¿œä¼´ä¾£ã€‚" });
  if (s.boundary < 30 && s.agency < 30) p.push({ icon: "ğŸª", title: "è¿‡åº¦èåˆå€¾å‘", desc: "ä½ å¯èƒ½å€¾å‘äºä¸ä¼´ä¾£è¿‡åº¦èåˆï¼Œæ¨¡ç³Šè‡ªæˆ‘ä¸ä»–äººçš„ç•Œé™ã€‚åœ¨å…³ç³»ä¸­ï¼Œä½ å¯èƒ½ä¼šä¸è‡ªè§‰åœ°æ”¾å¼ƒè‡ªå·±çš„éœ€æ±‚ã€å…´è¶£ç”šè‡³èº«ä»½ï¼Œä»¥è·å¾—è¿æ¥æ„Ÿã€‚" });
  if (s.attachment > 36 && s.boundary > 36) p.push({ icon: "ğŸ°", title: "æƒ…æ„Ÿè‡ªè¶³æ¨¡å¼", desc: "ä½ åœ¨æƒ…æ„Ÿä¸Šç›¸å¯¹ç‹¬ç«‹ï¼Œèƒ½å¤Ÿè‡ªæˆ‘æ»¡è¶³å¤§éƒ¨åˆ†æƒ…æ„Ÿéœ€æ±‚ã€‚è¿™ç§æ¨¡å¼è®©ä½ åœ¨å…³ç³»ä¸­æ›´åŠ ç¨³å®šï¼Œä½†ä¹Ÿéœ€è¦æ³¨æ„ä¸è¦å› æ­¤è€Œå…³é—­ä¸ä¼´ä¾£æ·±åº¦è¿æ¥çš„å¯èƒ½æ€§ã€‚" });
  if (s.emotion < 30 && s.boundary < 30) p.push({ icon: "ğŸ­", title: "æƒ…ç»ªè”“å»¶æ¨¡å¼", desc: "ä½ å¯èƒ½å®¹æ˜“å—ä¼´ä¾£æƒ…ç»ªçš„å½±å“ï¼Œéš¾ä»¥åŒºåˆ†è‡ªå·±çš„æƒ…ç»ªå’Œå¯¹æ–¹çš„æƒ…ç»ªã€‚å½“ä¼´ä¾£ä¸å¼€å¿ƒæ—¶ï¼Œä½ ä¹Ÿä¼šæ„Ÿåˆ°ç—›è‹¦ï¼Œå³ä½¿è¿™ä¸ä½ æ— å…³ã€‚" });
  if (p.length === 0) p.push({ icon: "âš–ï¸", title: "é€‚åº”æ€§å…³ç³»æ¨¡å¼", desc: "ä½ çš„å…³ç³»æ¨¡å¼ç›¸å¯¹çµæ´»ï¼Œèƒ½å¤Ÿæ ¹æ®æƒ…å¢ƒå’Œä¼´ä¾£çš„éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚ä½ åœ¨äº²å¯†å’Œç‹¬ç«‹ä¹‹é—´å–å¾—äº†è¾ƒå¥½çš„å¹³è¡¡ï¼Œè¿™æ˜¯å¥åº·å…³ç³»çš„é‡è¦åŸºç¡€ã€‚" });
  return p;
}

function getRisks(s) {
  const r = [];
  if (s.boundary < 24) r.push("è¾¹ç•Œæ„Ÿä¸¥é‡ä¸è¶³å¯èƒ½å¯¼è‡´å…³ç³»ä¸­çš„è¿‡åº¦ä»˜å‡ºå’Œæƒ…æ„Ÿè€—ç«­ã€‚ä½ å¯èƒ½æ­£åœ¨ä»¥ç‰ºç‰²è‡ªæˆ‘çš„æ–¹å¼ç»´æŒå…³ç³»ï¼Œè¿™ç§æ¨¡å¼é•¿æœŸæ¥çœ‹æ˜¯ä¸å¯æŒç»­çš„ã€‚");
  if (s.emotion < 24) r.push("æƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›ä¸è¶³å¯èƒ½å¯¼è‡´å…³ç³»ä¸­çš„é¢‘ç¹å†²çªå’Œå†²åŠ¨è¡Œä¸ºã€‚å¼ºçƒˆçš„æƒ…ç»ªååº”å¯èƒ½è®©ä¼´ä¾£æ„Ÿåˆ°å‹åŠ›ï¼Œä¹Ÿå¯èƒ½è®©ä½ åœ¨äº‹åæ„Ÿåˆ°åæ‚”ã€‚");
  if (s.attachment < 24 && s.emotion > 36) r.push("é«˜åº¦ç„¦è™‘å‹ä¾æ‹æ¨¡å¼å¯èƒ½è®©ä½ é™·å…¥ã€Œè¶Šåœ¨æ„è¶Šç„¦è™‘ï¼Œè¶Šç„¦è™‘è¶ŠæŠ“ç´§ï¼Œè¶ŠæŠ“ç´§è¶Šæ¨å¼€ã€çš„æ¶æ€§å¾ªç¯ã€‚");
  if (s.agency < 24) r.push("è¿‡ä½çš„ä¸»ä½“æ€§å¯èƒ½å¯¼è‡´ä½ åœ¨å…³ç³»ä¸­é€æ¸å¤±å»è‡ªæˆ‘ã€‚ä½ å¯èƒ½ä¼šå‘ç°è‡ªå·±è¶Šæ¥è¶Šä¸çŸ¥é“ã€Œæˆ‘æ˜¯è°ã€ã€Œæˆ‘æƒ³è¦ä»€ä¹ˆã€ã€‚");
  return r;
}

function getGrowthPath(s) {
  const lowest = Object.entries(s).reduce((a, b) => a[1] < b[1] ? a : b)[0];
  const paths = {
    agency: [{ phase: "ç¬¬ä¸€é˜¶æ®µ", title: "è‡ªæˆ‘è§‰å¯Ÿ", desc: "å¼€å§‹å…³æ³¨è‡ªå·±çš„éœ€æ±‚ã€æ„Ÿå—å’Œæƒ³æ³•ã€‚æ¯å¤©èŠ±5åˆ†é’Ÿé—®è‡ªå·±ï¼šã€Œæˆ‘ä»Šå¤©çœŸæ­£æƒ³è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿã€" }, { phase: "ç¬¬äºŒé˜¶æ®µ", title: "å°æ­¥è¡¨è¾¾", desc: "ä»å°äº‹å¼€å§‹ç»ƒä¹ è¡¨è¾¾è‡ªå·±çš„åå¥½å’Œæ„è§ï¼Œå³ä½¿ä¸ä¼´ä¾£ä¸åŒã€‚ä¾‹å¦‚ï¼Œä¸»åŠ¨é€‰æ‹©ä»Šå¤©åƒä»€ä¹ˆã€çœ‹ä»€ä¹ˆç”µå½±ã€‚" }, { phase: "ç¬¬ä¸‰é˜¶æ®µ", title: "åšå®ˆä»·å€¼", desc: "è¯†åˆ«è‡ªå·±çš„æ ¸å¿ƒä»·å€¼è§‚ï¼Œå¹¶åœ¨å…³ç³»ä¸­åšå®ˆè¿™äº›ä¸å¯åå•†çš„åº•çº¿ã€‚å­¦ä¼šåœ¨çˆ±å¯¹æ–¹çš„åŒæ—¶ä¹Ÿçˆ±è‡ªå·±ã€‚" }],
    boundary: [{ phase: "ç¬¬ä¸€é˜¶æ®µ", title: "è¯†åˆ«è¾¹ç•Œ", desc: "è§‰å¯Ÿå“ªäº›è¡Œä¸ºè®©ä½ æ„Ÿåˆ°ä¸é€‚æˆ–è¢«ä¾µçŠ¯ã€‚è®°å½•è¿™äº›æƒ…å¢ƒï¼Œäº†è§£è‡ªå·±çš„è¾¹ç•Œåœ¨å“ªé‡Œã€‚" }, { phase: "ç¬¬äºŒé˜¶æ®µ", title: "ç»ƒä¹ è¡¨è¾¾", desc: "å­¦ä¹ ç”¨ã€Œæˆ‘ã€çš„é™ˆè¿°æ–¹å¼è¡¨è¾¾è¾¹ç•Œï¼šã€Œæˆ‘æ„Ÿåˆ°...ã€ã€Œæˆ‘éœ€è¦...ã€ã€Œæˆ‘ä¸æ¥å—...ã€" }, { phase: "ç¬¬ä¸‰é˜¶æ®µ", title: "ä¸€è‡´æ‰§è¡Œ", desc: "åœ¨è¯†åˆ«å’Œè¡¨è¾¾è¾¹ç•Œåï¼Œæœ€é‡è¦çš„æ˜¯ä¸€è‡´æ€§åœ°æ‰§è¡Œã€‚å½“è¾¹ç•Œè¢«è¯•æ¢æ—¶ï¼Œåšå®šè€Œæ¸©å’Œåœ°é‡ç”³ã€‚" }],
    emotion: [{ phase: "ç¬¬ä¸€é˜¶æ®µ", title: "æƒ…ç»ªå‘½å", desc: "å­¦ä¹ è¯†åˆ«å’Œå‘½åè‡ªå·±çš„æƒ…ç»ªã€‚ä¸æ˜¯ç®€å•çš„ã€Œå¥½ã€æˆ–ã€Œä¸å¥½ã€ï¼Œè€Œæ˜¯å…·ä½“çš„ã€Œå¤±æœ›ã€ã€Œå§”å±ˆã€ã€Œæ‹…å¿§ã€ç­‰ã€‚" }, { phase: "ç¬¬äºŒé˜¶æ®µ", title: "æš‚åœæœºåˆ¶", desc: "å½“æƒ…ç»ªå‡èµ·æ—¶ï¼Œå»ºç«‹æš‚åœæœºåˆ¶ã€‚å¯ä»¥æ˜¯æ·±å‘¼å¸ã€ç¦»å¼€ç°åœºå‡ åˆ†é’Ÿã€æˆ–è€…å‘Šè¯‰ä¼´ä¾£ã€Œæˆ‘éœ€è¦æ—¶é—´å†·é™ã€ã€‚" }, { phase: "ç¬¬ä¸‰é˜¶æ®µ", title: "è‡ªæˆ‘å®‰æŠš", desc: "å‘å±•ç‹¬ç«‹äºä¼´ä¾£çš„æƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›ã€‚å¯èƒ½æ˜¯è¿åŠ¨ã€å†™ä½œã€ä¸æœ‹å‹å€¾è¯‰ï¼Œæˆ–è€…ä¸“ä¸šçš„å¿ƒç†å’¨è¯¢ã€‚" }],
    attachment: [{ phase: "ç¬¬ä¸€é˜¶æ®µ", title: "æ¨¡å¼è§‰å¯Ÿ", desc: "äº†è§£è‡ªå·±çš„ä¾æ‹æ¨¡å¼æ˜¯å¦‚ä½•å½¢æˆçš„ï¼Œå®ƒä¸æ—©æœŸç»å†æœ‰ä»€ä¹ˆå…³ç³»ã€‚è§‰å¯Ÿæ˜¯æ”¹å˜çš„ç¬¬ä¸€æ­¥ã€‚" }, { phase: "ç¬¬äºŒé˜¶æ®µ", title: "æŒ‘æˆ˜ä¿¡å¿µ", desc: "è¯†åˆ«é‚£äº›é©±åŠ¨ä¸å®‰å…¨æ„Ÿçš„æ ¸å¿ƒä¿¡å¿µï¼ˆå¦‚ã€Œæˆ‘ä¸å€¼å¾—è¢«çˆ±ã€ï¼‰ï¼Œå¹¶å¼€å§‹ç”¨ç°å®è¯æ®æŒ‘æˆ˜å®ƒä»¬ã€‚" }, { phase: "ç¬¬ä¸‰é˜¶æ®µ", title: "å®‰å…¨å®éªŒ", desc: "åœ¨å½“å‰å…³ç³»ä¸­è¿›è¡Œã€Œå®‰å…¨å®éªŒã€ï¼šè¡¨è¾¾è„†å¼±ã€è¯·æ±‚æ”¯æŒï¼Œè§‚å¯Ÿä¼´ä¾£çš„çœŸå®ååº”ï¼Œè€Œéä½ æƒ³è±¡çš„ååº”ã€‚" }]
  };
  return paths[lowest] || paths.attachment;
}

function showResult() {
  document.getElementById('testPage').classList.remove('active');
  document.getElementById('resultPage').classList.add('active');

  const s = calcScores();
  const typeKey = getType(s);
  const result = RESULT_MAP[typeKey];
  const total = s.agency + s.boundary + s.emotion + s.attachment;
  const avg = (total / 4).toFixed(1);
  const date = new Date().toLocaleDateString('zh-CN');
  const patterns = getPatterns(s);
  const risks = getRisks(s);
  const growth = getGrowthPath(s);
  const highest = Object.entries(s).reduce((a, b) => a[1] > b[1] ? a : b)[0];
  const lowest = Object.entries(s).reduce((a, b) => a[1] < b[1] ? a : b)[0];

  const html = `
    <div class="card">
      <div class="type-result">
        <div class="type-badge">ä½ çš„ä¾æ‹ç±»å‹</div>
        <div class="type-name">${result.name}</div>
        <p class="type-desc">${result.desc}</p>
      </div>
      <div class="card-title"><span class="icon icon-purple">ğŸ“‹</span>æ ¸å¿ƒæŒ‡æ ‡æ¦‚è§ˆ</div>
      <div class="stat-grid">
        <div class="stat-card"><div class="label">ç»¼åˆå¾—åˆ†</div><div class="value">${total}/192</div></div>
        <div class="stat-card"><div class="label">å¹³å‡ç»´åº¦</div><div class="value">${avg}/48</div></div>
        <div class="stat-card"><div class="label">æœ€å¼ºç»´åº¦</div><div class="value">${dimInfo[highest].name}</div></div>
        <div class="stat-card"><div class="label">å¾…æå‡</div><div class="value">${dimInfo[lowest].name}</div></div>
      </div>
    </div>

    <div class="card">
      <div class="card-title"><span class="icon icon-blue">ğŸ“Š</span>å››ç»´åº¦åˆ†æå›¾</div>
      <div class="chart-wrap"><canvas id="radarChart"></canvas></div>
    </div>

    <div class="card">
      <div class="card-title"><span class="icon icon-green">ğŸ”¬</span>å››ç»´åº¦æ·±åº¦è§£è¯»</div>
      ${['agency', 'boundary', 'emotion', 'attachment'].map(d => {
        const info = dimInfo[d], lv = getLevel(s[d]);
        return `
          <div class="dim-item">
            <div class="dim-head">
              <div class="dim-name"><div class="dim-icon" style="background:${info.bg}">${info.icon}</div>${info.name}</div>
              <div class="dim-score">${s[d]}<span>/48</span></div>
            </div>
            <div class="dim-bar"><div class="dim-bar-fill" style="width:${(s[d]/48)*100}%;background:${info.color}"></div></div>
            <span class="dim-level ${lv.cls}">${lv.level} Â· ${lv.pct}</span>
            <p class="dim-desc">${getDimAnalysis(d, s[d])}</p>
          </div>
        `;
      }).join('')}
    </div>

    <div class="card">
      <div class="card-title"><span class="icon icon-purple">ğŸ”„</span>å…³ç³»äº’åŠ¨æ¨¡å¼</div>
      ${patterns.map(p => `
        <div class="pattern-card">
          <div class="pattern-icon">${p.icon}</div>
          <div class="pattern-content"><h4>${p.title}</h4><p>${p.desc}</p></div>
        </div>
      `).join('')}
    </div>

    ${risks.length > 0 ? `
    <div class="card">
      <div class="card-title"><span class="icon icon-red">âš ï¸</span>éœ€è¦å…³æ³¨çš„é£é™©ä¿¡å·</div>
      <div class="risk-box">${risks.map(r => `<div class="risk-item"><div class="risk-dot"></div><div class="risk-text">${r}</div></div>`).join('')}</div>
    </div>
    ` : ''}

    <div class="card">
      <div class="card-title"><span class="icon icon-orange">ğŸ‘¤</span>å¿ƒç†ç‰¹å¾å¯¹æ ‡</div>
      <div class="celeb-box">
        <div class="celeb-avatar">â­</div>
        <div class="celeb-info">
          <h4>${result.celeb}</h4>
          <p>${result.celebDesc}</p>
          <small>åäººå¯¹æ ‡ä»…ç”¨äºå¿ƒç†ç»“æ„ç‰¹å¾çš„ç›´è§‚ç†è§£ï¼Œä¸ä»£è¡¨ä½ çš„äººæ ¼ã€å‘½è¿æˆ–ç”Ÿæ´»è½¨è¿¹ã€‚</small>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title"><span class="icon icon-green">ğŸŒ±</span>ä¸ªæ€§åŒ–æˆé•¿è·¯å¾„</div>
      <div class="timeline">
        ${growth.map(g => `
          <div class="timeline-step">
            <div class="phase">${g.phase}</div>
            <h5>${g.title}</h5>
            <p>${g.desc}</p>
          </div>
        `).join('')}
      </div>
    </div>

    <div class="card">
      <div class="card-title"><span class="icon icon-pink">ğŸ’¡</span>å®è·µè¡ŒåŠ¨å»ºè®®</div>
      ${result.tips.map((t, i) => `
        <div class="tip-item">
          <div class="tip-num">${i + 1}</div>
          <div class="tip-text">${t}</div>
        </div>
      `).join('')}
    </div>

    <div class="card">
      <div class="card-title"><span class="icon icon-purple">ğŸ’•</span>å…³ç³»ç»è¥å»ºè®®</div>
      <div class="rel-grid">
        <div class="rel-card"><div class="emoji">ğŸ’¬</div><h5>æ²Ÿé€šæ–¹å¼</h5><p>${s.emotion >= 36 ? 'ä½ é€‚åˆç›´æ¥ã€å¦è¯šçš„æ²Ÿé€šæ–¹å¼ã€‚åœ¨æƒ…ç»ªç¨³å®šæ—¶ä¸»åŠ¨è¡¨è¾¾éœ€æ±‚ã€‚' : 'å»ºè®®åœ¨æ²Ÿé€šå‰å…ˆè¿›è¡Œè‡ªæˆ‘è§‰å¯Ÿï¼Œé¿å…æƒ…ç»ªåŒ–è¡¨è¾¾ã€‚ä½¿ç”¨ã€Œæˆ‘ã€é™ˆè¿°è€ŒéæŒ‡è´£ã€‚'}</p></div>
        <div class="rel-card"><div class="emoji">â°</div><h5>ç›¸å¤„èŠ‚å¥</h5><p>${s.boundary >= 36 ? 'ä½ éœ€è¦è¶³å¤Ÿçš„ä¸ªäººç©ºé—´å’Œç‹¬å¤„æ—¶é—´ã€‚ä¸ä¼´ä¾£å»ºç«‹ã€Œåœ¨ä¸€èµ·çš„ç‹¬å¤„ã€æ¨¡å¼ã€‚' : 'å°è¯•åœ¨äº²å¯†å’Œç‹¬ç«‹ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ï¼Œä¸è¦å®³æ€•è¦æ±‚å±äºè‡ªå·±çš„æ—¶é—´ã€‚'}</p></div>
        <div class="rel-card"><div class="emoji">ğŸ¯</div><h5>å†²çªå¤„ç†</h5><p>${s.emotion >= 36 && s.agency >= 36 ? 'ä½ èƒ½å¤Ÿå»ºè®¾æ€§åœ°å¤„ç†å†²çªã€‚ä¿æŒè¿™ç§èƒ½åŠ›ï¼ŒåŒæ—¶æ³¨æ„å€¾å¬ä¼´ä¾£çš„æ„Ÿå—ã€‚' : 'å†²çªæ—¶ç»™è‡ªå·±å†·é™æœŸï¼Œé¿å…åœ¨æƒ…ç»ªé«˜æ¶¨æ—¶åšå†³å®šæˆ–è¯´ä¼¤äººçš„è¯ã€‚'}</p></div>
        <div class="rel-card"><div class="emoji">ğŸŒŸ</div><h5>ä¿¡ä»»å»ºç«‹</h5><p>${s.attachment >= 36 ? 'ä½ æœ‰å»ºç«‹ä¿¡ä»»çš„åŸºç¡€èƒ½åŠ›ã€‚ç»§ç»­ä¿æŒå¼€æ”¾å’Œä¸€è‡´æ€§ï¼Œè®©ä¼´ä¾£æ„Ÿåˆ°å®‰å…¨ã€‚' : 'ä¿¡ä»»éœ€è¦æ—¶é—´å’Œä¸€è‡´æ€§ã€‚ä»å°çš„æ‰¿è¯ºå¼€å§‹ï¼Œé€æ­¥å»ºç«‹å¯¹å…³ç³»çš„ä¿¡å¿ƒã€‚'}</p></div>
      </div>
    </div>

    <div class="card">
      <div class="summary-box">
        <h3>å†™ç»™ä½ çš„è¯</h3>
        <p>äº²å¯†å…³ç³»æ˜¯æˆ‘ä»¬è®¤è¯†è‡ªå·±ã€æˆé•¿è‡ªå·±çš„ä¸€é¢é•œå­ã€‚æ— è®ºä½ ç›®å‰å¤„äºä»€ä¹ˆæ ·çš„ä¾æ‹æ¨¡å¼ï¼Œè¿™éƒ½ä¸æ˜¯å›ºå®šä¸å˜çš„æ ‡ç­¾ï¼Œè€Œæ˜¯ä¸€ä¸ªèµ·ç‚¹ã€‚æ¯ä¸€ç§æ¨¡å¼éƒ½æœ‰å…¶å­˜åœ¨çš„åŸå› å’Œä»·å€¼ï¼Œä¹Ÿéƒ½æœ‰æˆé•¿çš„ç©ºé—´ã€‚é‡è¦çš„ä¸æ˜¯æˆä¸ºã€Œå®Œç¾ã€çš„ä¼´ä¾£ï¼Œè€Œæ˜¯åœ¨å…³ç³»ä¸­ä¿æŒè§‰å¯Ÿã€çœŸè¯šå’Œæˆé•¿çš„æ„æ„¿ã€‚ä½ å€¼å¾—æ‹¥æœ‰å¥åº·ã€æ»‹å…»çš„äº²å¯†å…³ç³»ã€‚</p>
      </div>
      <div class="disclaimer">
        <h5>ä¸“ä¸šå£°æ˜</h5>
        <p>æœ¬æµ‹è¯„åŸºäºä¾æ‹ç†è®ºå’Œå…³ç³»å¿ƒç†å­¦ç ”ç©¶è®¾è®¡ï¼Œæ—¨åœ¨å¸®åŠ©ä¸ªäººè¿›è¡Œè‡ªæˆ‘æ¢ç´¢å’Œåæ€ã€‚æµ‹è¯„ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­æˆ–åŒ»å­¦å»ºè®®ã€‚å¦‚æœæ‚¨æ­£åœ¨ç»å†ä¸¥é‡çš„æƒ…ç»ªå›°æ‰°æˆ–å…³ç³»é—®é¢˜ï¼Œå»ºè®®å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢å¸ˆçš„å¸®åŠ©ã€‚</p>
      </div>
    </div>

    <div class="card download-section">
      <button class="download-btn" onclick="downloadPDF()" id="dlBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
        ä¸‹è½½PDFæŠ¥å‘Š
      </button>
      <button class="restart-btn" onclick="restart()">é‡æ–°æµ‹è¯•</button>
      ${getHomeButtonHtml()}
    </div>
  `;

  document.getElementById('resultContent').innerHTML = html;

  // ç»˜åˆ¶é›·è¾¾å›¾
  setTimeout(() => {
    new Chart(document.getElementById('radarChart'), {
      type: 'radar',
      data: {
        labels: ['ä¸»ä½“æ€§', 'è¾¹ç•Œæ„Ÿ', 'æƒ…ç»ªè°ƒèŠ‚', 'ä¾æ‹ååº”'],
        datasets: [{
          data: [s.agency, s.boundary, s.emotion, s.attachment],
          backgroundColor: 'rgba(102, 126, 234, 0.2)',
          borderColor: 'rgba(102, 126, 234, 1)',
          borderWidth: 2,
          pointBackgroundColor: 'rgba(102, 126, 234, 1)',
          pointBorderColor: '#fff'
        }]
      },
      options: {
        scales: { r: { beginAtZero: true, max: 48, ticks: { stepSize: 12 } } },
        plugins: { legend: { display: false } }
      }
    });
  }, 100);
}

function restart() { if (confirm('ç¡®å®šè¦é‡æ–°æµ‹è¯•å—ï¼Ÿ')) location.reload(); }

// PDFä¸‹è½½ - ä½¿ç”¨html2canvasæˆªå›¾æ–¹å¼ä¿ç•™ä¸­æ–‡
async function downloadPDF() {
  const btn = document.getElementById('dlBtn');
  const loading = document.getElementById('loading');
  btn.disabled = true;
  btn.innerHTML = 'ç”Ÿæˆä¸­...';
  loading.classList.add('show');

  try {
    const s = calcScores();
    const typeKey = getType(s);
    const result = RESULT_MAP[typeKey];
    const total = s.agency + s.boundary + s.emotion + s.attachment;
    const avg = (total / 4).toFixed(1);
    const date = new Date().toLocaleDateString('zh-CN');
    const highest = Object.entries(s).reduce((a, b) => a[1] > b[1] ? a : b)[0];
    const lowest = Object.entries(s).reduce((a, b) => a[1] < b[1] ? a : b)[0];

    // åˆ›å»ºPDFä¸“ç”¨å®¹å™¨
    const pdfContainer = document.createElement('div');
    pdfContainer.id = 'pdfContent';
    pdfContainer.style.cssText = 'position:absolute;left:-9999px;top:0;width:800px;background:#fff;padding:40px;font-family:"Noto Sans SC",sans-serif;';

    pdfContainer.innerHTML = `
      <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:50px 40px;margin:-40px -40px 30px -40px;text-align:center;color:#fff;">
        <div style="font-size:16px;margin-bottom:10px;opacity:0.9;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div style="font-size:32px;font-weight:700;margin-bottom:15px;">äº²å¯†å…³ç³»å¿ƒç†æµ‹è¯„æŠ¥å‘Š</div>
        <div style="font-size:14px;opacity:0.8;">æµ‹è¯„æ—¥æœŸï¼š${date}</div>
      </div>

      <div style="background:#f8fafc;border-radius:16px;padding:30px;margin-bottom:25px;">
        <div style="color:#667eea;font-size:14px;margin-bottom:8px;">ä½ çš„ä¾æ‹ç±»å‹</div>
        <div style="font-size:28px;font-weight:700;color:#1e293b;margin-bottom:12px;">${result.name}</div>
        <div style="color:#64748b;font-size:14px;line-height:1.8;">${result.desc}</div>
      </div>

      <div style="display:flex;gap:15px;margin-bottom:25px;">
        <div style="flex:1;background:#f0fdf4;border-radius:12px;padding:20px;text-align:center;">
          <div style="font-size:28px;font-weight:700;color:#22c55e;">${total}</div>
          <div style="font-size:12px;color:#64748b;">ç»¼åˆå¾—åˆ† /192</div>
        </div>
        <div style="flex:1;background:#eff6ff;border-radius:12px;padding:20px;text-align:center;">
          <div style="font-size:28px;font-weight:700;color:#3b82f6;">${avg}</div>
          <div style="font-size:12px;color:#64748b;">å¹³å‡ç»´åº¦ /48</div>
        </div>
        <div style="flex:1;background:#fef3c7;border-radius:12px;padding:20px;text-align:center;">
          <div style="font-size:18px;font-weight:700;color:#f59e0b;">${dimInfo[highest].name}</div>
          <div style="font-size:12px;color:#64748b;">æœ€å¼ºç»´åº¦</div>
        </div>
        <div style="flex:1;background:#fce7f3;border-radius:12px;padding:20px;text-align:center;">
          <div style="font-size:18px;font-weight:700;color:#ec4899;">${dimInfo[lowest].name}</div>
          <div style="font-size:12px;color:#64748b;">å¾…æå‡ç»´åº¦</div>
        </div>
      </div>

      <div style="margin-bottom:25px;">
        <div style="font-size:18px;font-weight:600;color:#1e293b;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #e2e8f0;">å››ç»´åº¦æ·±åº¦åˆ†æ</div>
        ${['agency', 'boundary', 'emotion', 'attachment'].map(d => {
          const info = dimInfo[d], lv = getLevel(s[d]), pct = Math.round(s[d]/48*100);
          return `
            <div style="background:#f8fafc;border-radius:12px;padding:20px;margin-bottom:12px;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                <div style="font-size:16px;font-weight:600;color:#1e293b;">${info.icon} ${info.name}</div>
                <div style="display:flex;align-items:center;gap:10px;">
                  <span style="background:${lv.color};color:#fff;padding:4px 12px;border-radius:12px;font-size:12px;">${lv.level}</span>
                  <span style="font-weight:700;color:#667eea;">${s[d]}/48</span>
                </div>
              </div>
              <div style="background:#e2e8f0;height:8px;border-radius:4px;margin-bottom:10px;">
                <div style="background:linear-gradient(90deg,#667eea,#764ba2);height:100%;border-radius:4px;width:${pct}%;"></div>
              </div>
              <div style="color:#64748b;font-size:13px;line-height:1.7;">${getDimAnalysis(d, s[d])}</div>
            </div>
          `;
        }).join('')}
      </div>

      <div style="margin-bottom:25px;">
        <div style="font-size:18px;font-weight:600;color:#1e293b;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #e2e8f0;">å®è·µè¡ŒåŠ¨å»ºè®®</div>
        ${result.tips.map((t, i) => `
          <div style="display:flex;gap:12px;margin-bottom:12px;">
            <div style="width:28px;height:28px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:600;flex-shrink:0;">${i+1}</div>
            <div style="color:#475569;font-size:14px;line-height:1.7;padding-top:4px;">${t}</div>
          </div>
        `).join('')}
      </div>

      <div style="background:linear-gradient(135deg,#fef3c7,#fde68a);border-radius:12px;padding:20px;margin-bottom:25px;">
        <div style="font-size:14px;font-weight:600;color:#92400e;margin-bottom:8px;">å¿ƒç†ç‰¹å¾å¯¹æ ‡</div>
        <div style="font-size:16px;font-weight:700;color:#78350f;margin-bottom:6px;">${result.celeb}</div>
        <div style="font-size:13px;color:#92400e;">${result.celebDesc}</div>
      </div>

      <div style="background:#f8fafc;border-radius:12px;padding:20px;text-align:center;color:#94a3b8;font-size:12px;">
        <div style="margin-bottom:8px;font-weight:500;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div>æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­æˆ–åŒ»å­¦å»ºè®®</div>
      </div>
    `;

    document.body.appendChild(pdfContainer);

    // ç­‰å¾…å­—ä½“åŠ è½½
    await document.fonts.ready;
    await new Promise(r => setTimeout(r, 300));

    // æˆªå›¾
    const canvas = await html2canvas(pdfContainer, {
      scale: 2,
      useCORS: true,
      backgroundColor: '#ffffff',
      logging: false
    });

    document.body.removeChild(pdfContainer);

    // ç”ŸæˆPDF
    const { jsPDF } = window.jspdf;
    const imgData = canvas.toDataURL('image/jpeg', 0.95);
    const imgW = canvas.width;
    const imgH = canvas.height;

    const pdfW = 210; // A4å®½åº¦mm
    const pdfH = 297; // A4é«˜åº¦mm
    const ratio = imgW / imgH;

    let finalW = pdfW - 20;
    let finalH = finalW / ratio;

    const pdf = new jsPDF('p', 'mm', 'a4');
    let yPos = 10;
    let remainingH = imgH;
    let srcY = 0;

    // è®¡ç®—æ¯é¡µèƒ½æ˜¾ç¤ºçš„åƒç´ é«˜åº¦
    const pagePixelH = (pdfH - 20) / finalH * imgH;

    while (remainingH > 0) {
      const sliceH = Math.min(remainingH, pagePixelH);
      const sliceCanvas = document.createElement('canvas');
      sliceCanvas.width = imgW;
      sliceCanvas.height = sliceH;
      const ctx = sliceCanvas.getContext('2d');
      ctx.drawImage(canvas, 0, srcY, imgW, sliceH, 0, 0, imgW, sliceH);

      const sliceData = sliceCanvas.toDataURL('image/jpeg', 0.95);
      const sliceRatio = imgW / sliceH;
      const sliceFinalH = finalW / sliceRatio;

      if (srcY > 0) pdf.addPage();
      pdf.addImage(sliceData, 'JPEG', 10, 10, finalW, sliceFinalH);

      srcY += sliceH;
      remainingH -= sliceH;
    }

    pdf.save(`äº²å¯†å…³ç³»å¿ƒç†æµ‹è¯„æŠ¥å‘Š_${date}.pdf`);
  } catch (e) {
    console.error(e);
    alert('PDFç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  } finally {
    btn.disabled = false;
    btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> ä¸‹è½½PDFæŠ¥å‘Š';
    loading.classList.remove('show');
  }
}

// åˆå§‹åŒ–
render();
</script>
</body>
</html>
