<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çˆ±æƒ…å¿ƒç†ç»“æ„æµ‹è¯„ | å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #ec4899;
  --primary-dark: #db2777;
  --primary-light: #f9a8d4;
  --gradient: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #1e293b;
  --text-muted: #64748b;
  --border: #e2e8f0;
  --shadow: 0 4px 20px rgba(0,0,0,0.08);
  --radius: 16px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans SC', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
.page { display: none; min-height: 100vh; }
.page.active { display: block; }
#testPage { background: var(--bg); padding: 20px; }
.test-container { max-width: 700px; margin: 0 auto; }
.test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.back-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: all 0.2s; }
.back-btn:hover { background: white; color: var(--text); }
.progress-wrap { text-align: right; }
.progress-text { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
.progress-bar { width: 180px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--gradient); border-radius: 3px; transition: width 0.3s; }
.question-card { background: var(--card); border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); }
.dim-tag { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-bottom: 16px; }
.q-num { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.q-text { font-size: 20px; font-weight: 600; line-height: 1.5; margin-bottom: 32px; }
.options { display: flex; flex-direction: column; gap: 12px; }
.opt { display: flex; align-items: center; gap: 14px; padding: 16px 20px; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
.opt:hover { border-color: var(--primary-light); background: #fdf2f8; }
.opt.selected { border-color: var(--primary); background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 100%); }
.opt-radio { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
.opt.selected .opt-radio { border-color: var(--primary); background: var(--primary); }
.opt.selected .opt-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
.opt-text { font-size: 15px; font-weight: 500; }
.nav-btns { display: flex; gap: 12px; margin-top: 32px; }
.nav-btn { flex: 1; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s; }
.nav-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.nav-btn.secondary:hover { border-color: var(--primary-light); }
.nav-btn.primary { background: var(--primary); border: none; color: white; }
.nav-btn.primary:hover { background: var(--primary-dark); }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }

#resultPage { background: linear-gradient(180deg, #ec4899 0%, #8b5cf6 40%, var(--bg) 40%); }
.result-container { max-width: 800px; margin: 0 auto; padding: 40px 20px 60px; }
.result-header { text-align: center; color: white; margin-bottom: 32px; padding-top: 20px; }
.result-header h1 { font-size: 26px; margin-bottom: 8px; }
.result-header p { opacity: 0.9; font-size: 14px; }
.card { background: var(--card); border-radius: var(--radius); padding: 32px; box-shadow: var(--shadow); margin-bottom: 20px; }
.section-title { font-size: 17px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
.section-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }

.type-card { text-align: center; padding: 24px; border-radius: 16px; background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 100%); margin-bottom: 20px; }
.type-label { font-size: 14px; color: var(--text-muted); margin-bottom: 8px; }
.type-name { font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 12px; }
.type-desc { font-size: 14px; color: var(--text-muted); line-height: 1.7; }

.chart-wrap { max-width: 350px; margin: 0 auto; }
.dim-item { padding: 16px; border: 1px solid var(--border); border-radius: 14px; margin-bottom: 12px; }
.dim-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.dim-name { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 14px; }
.dim-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
.dim-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
.dim-bar-fill { height: 100%; border-radius: 4px; }
.level-badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; }
.level-high { background: #fee2e2; color: #dc2626; }
.level-medium { background: #fef3c7; color: #d97706; }
.level-low { background: #d1fae5; color: #059669; }

.summary-text { font-size: 15px; color: var(--text-muted); line-height: 1.8; }
.tip-item { display: flex; gap: 12px; padding: 14px; background: #fdf2f8; border-radius: 10px; margin-bottom: 10px; }
.tip-num { width: 24px; height: 24px; background: var(--gradient); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; flex-shrink: 0; }
.tip-text { font-size: 14px; color: var(--text-muted); line-height: 1.6; }

.partner-card { background: #f8fafc; border-radius: 12px; padding: 16px; margin-top: 16px; }
.partner-card h4 { font-size: 14px; margin-bottom: 12px; color: var(--text); }
.partner-list { list-style: none; padding: 0; }
.partner-list li { display: flex; align-items: center; gap: 8px; padding: 8px 0; font-size: 14px; color: var(--text-muted); border-bottom: 1px solid var(--border); }
.partner-list li:last-child { border-bottom: none; }
.partner-list li::before { content: 'âœ“'; color: #10b981; font-weight: bold; }

.action-btns { display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap; }
.restart-btn { flex: 1; min-width: 140px; padding: 14px 20px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; }
.restart-btn.primary { background: var(--gradient); border: none; color: white; }
.restart-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(236,72,153,0.3); }
.restart-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.restart-btn.secondary:hover { border-color: var(--primary); }

.modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; transition: opacity 0.3s; }
.modal-overlay.show { opacity: 1; }
.modal-content { background: white; border-radius: 20px; padding: 32px; max-width: 400px; width: 90%; text-align: center; transform: scale(0.9); transition: transform 0.3s; }
.modal-overlay.show .modal-content { transform: scale(1); }
.modal-icon { font-size: 48px; margin-bottom: 16px; }
.modal-content h3 { font-size: 20px; margin-bottom: 12px; }
.modal-content p { color: var(--text-muted); font-size: 14px; margin-bottom: 20px; }
.modal-btn { width: 100%; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; margin-bottom: 10px; }
.modal-btn.primary { background: var(--gradient); border: none; color: white; }
.modal-btn.secondary { background: #f1f5f9; border: none; color: var(--text); }

.loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); display: none; align-items: center; justify-content: center; z-index: 2000; flex-direction: column; gap: 16px; }
.loading-overlay.show { display: flex; }
.loading-spinner { width: 48px; height: 48px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.celebrity-box { background: #f8fafc; border-radius: 12px; padding: 16px; margin-top: 16px; }
.celebrity-box h4 { font-size: 14px; margin-bottom: 12px; }
.celebrity-item { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; }
.celebrity-item .gender { font-size: 20px; }
.celebrity-item .info { flex: 1; }
.celebrity-item .name { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
.celebrity-item .desc { font-size: 13px; color: var(--text-muted); line-height: 1.5; }
</style>
</head>
<body>

<div id="testPage" class="page active">
  <div class="test-container">
    <div class="test-header">
      <button class="back-btn" onclick="if(confirm('ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ'))location.href='index.html'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        è¿”å›
      </button>
      <div class="progress-wrap">
        <div class="progress-text"><span id="current">1</span> / 42</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:2.4%"></div></div>
      </div>
    </div>
    <div class="question-card">
      <div class="dim-tag" id="dimTag" style="background:#fce7f3;color:#ec4899">äº²å¯†éœ€æ±‚</div>
      <div class="q-num">ç¬¬ <span id="qNum">1</span> é¢˜</div>
      <div class="q-text" id="qText"></div>
      <div class="options" id="options"></div>
      <div class="nav-btns">
        <button class="nav-btn secondary" id="prevBtn" onclick="prev()" disabled>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          ä¸Šä¸€é¢˜
        </button>
        <button class="nav-btn primary" id="nextBtn" onclick="next()" disabled>
          ä¸‹ä¸€é¢˜
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<div id="resultPage" class="page">
  <div class="result-container" id="resultContent"></div>
</div>

<div class="loading-overlay" id="loading">
  <div class="loading-spinner"></div>
  <div style="color:var(--text-muted)">æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...</div>
</div>

<script>
const questions = [
  // æ¨¡å—A - äº²å¯†éœ€æ±‚ (8é¢˜)
  { dim: 'A', text: 'å½“ä½ å’Œä¸€ä¸ªäººå»ºç«‹äº²å¯†å…³ç³»åï¼Œå¦‚æœæƒ…ç»ªäº¤æµæ˜æ˜¾å‡å°‘ï¼Œä½ ä¼šå¾ˆå¿«æ„Ÿåˆ°è¿™æ®µå…³ç³»ä¸åƒä»¥å‰é‚£æ ·çœŸå®ã€‚' },
  { dim: 'A', text: 'å¦‚æœä¸€æ®µå…³ç³»é•¿æœŸåœç•™åœ¨è¡¨é¢äº’åŠ¨ï¼Œä½ ä¼šé€æ¸æ„Ÿåˆ°ç©ºæ´æˆ–ç–ç¦»ã€‚' },
  { dim: 'A', text: 'è¢«å¯¹æ–¹ç†è§£ä½ çš„çœŸå®æƒ³æ³•å’Œæƒ…ç»ªï¼Œå¯¹ä½ æ¥è¯´éå¸¸é‡è¦ã€‚' },
  { dim: 'A', text: 'å½“é‡è¦æƒ…ç»ªæ— æ³•å’Œä¼´ä¾£åˆ†äº«æ—¶ï¼Œä½ ä¼šæ˜æ˜¾æ„Ÿåˆ°ä¸å®‰ã€‚' },
  { dim: 'A', text: 'ä½ å€¾å‘é€šè¿‡æŒç»­æƒ…ç»ªäº¤æµç¡®è®¤äº²å¯†ç¨‹åº¦ã€‚' },
  { dim: 'A', text: 'å¦‚æœæƒ…ç»ªè¡¨è¾¾è¢«å›é¿ï¼Œä½ å¾ˆéš¾é•¿æœŸé€‚åº”ã€‚' },
  { dim: 'A', text: 'èƒ½å¦æ·±å…¥äº¤æµï¼Œæ˜¯ä½ åˆ¤æ–­å…³ç³»æ˜¯å¦å€¼å¾—ç»§ç»­çš„é‡è¦æ ‡å‡†ã€‚' },
  { dim: 'A', text: 'å³ä½¿å…³ç³»è¡¨é¢ç¨³å®šï¼Œåªè¦æƒ…ç»ªè¿æ¥å˜å¼±ï¼Œä½ ä¹Ÿä¼šé‡æ–°è¯„ä¼°å…³ç³»ã€‚' },
  // æ¨¡å—B - å…³ç³»ç¡®å®šéœ€æ±‚ (8é¢˜)
  { dim: 'B', text: 'å…³ç³»èº«ä»½é•¿æœŸä¸æ˜ç¡®ä¼šè®©ä½ éš¾ä»¥æ”¾æ¾æŠ•å…¥ã€‚' },
  { dim: 'B', text: 'ç¼ºä¹æ¸…æ™°æ‰¿è¯ºæ—¶ï¼Œä½ ä¼šåå¤æ€è€ƒå…³ç³»æ˜¯å¦å®‰å…¨ã€‚' },
  { dim: 'B', text: 'ä½ å¾ˆéš¾åœ¨æš§æ˜§å…³ç³»ä¸­ä¿æŒæƒ…ç»ªç¨³å®šã€‚' },
  { dim: 'B', text: 'ä½ éœ€è¦æ˜ç¡®å®šä½æ¥ç¡®è®¤è‡ªå·±åœ¨å¯¹æ–¹å¿ƒä¸­çš„ä½ç½®ã€‚' },
  { dim: 'B', text: 'ä½ ä¼šä¸‹æ„è¯†æƒ³å°½å¿«æ¶ˆé™¤å…³ç³»çš„ä¸ç¡®å®šçŠ¶æ€ã€‚' },
  { dim: 'B', text: 'å¯¹æ–¹ä¿æŒå¼€æ”¾å…³ç³»æ€åº¦ä¼šè®©ä½ æ„Ÿåˆ°ä¸å®‰ã€‚' },
  { dim: 'B', text: 'ä½ æ›´éœ€è¦æ¸…æ™°ä¿¡å·å†å†³å®šæ˜¯å¦ç»§ç»­æŠ•å…¥ã€‚' },
  { dim: 'B', text: 'å³ä½¿äº’åŠ¨ä¸é”™ï¼Œåªè¦ç¼ºä¹ç¡®å®šæ€§ï¼Œä½ ä¹Ÿä¼šæ„Ÿåˆ°æ‚¬ç©ºã€‚' },
  // æ¨¡å—C - æƒ…æ„ŸæŠ•å…¥å¼ºåº¦ (10é¢˜)
  { dim: 'C', text: 'è¿›å…¥å…³ç³»åï¼Œä½ ä¼šè°ƒæ•´æ—¶é—´å®‰æ’æ¥é…åˆå¯¹æ–¹ã€‚' },
  { dim: 'C', text: 'ä½ çš„æƒ…ç»ªä¼šæ˜æ˜¾å—å…³ç³»è¿›å±•å½±å“ã€‚' },
  { dim: 'C', text: 'ä½ æ„¿æ„ä¸ºå…³ç³»å‹ç¼©ä¸ªäººéœ€æ±‚ã€‚' },
  { dim: 'C', text: 'å³ä½¿å›é¦ˆä¸å¯¹ç­‰ï¼Œä½ ä¹Ÿä¼šç»§ç»­æŠ•å…¥ä¸€æ®µæ—¶é—´ã€‚' },
  { dim: 'C', text: 'ä½ æ„¿æ„ä¸ºå…³ç³»æ‰¿æ‹…ä¸ç¡®å®šé£é™©ã€‚' },
  { dim: 'C', text: 'å…³ç³»å‡ºé—®é¢˜æ—¶ï¼Œä½ æ›´å…ˆè°ƒæ•´è‡ªå·±ã€‚' },
  { dim: 'C', text: 'ä½ åœ¨å…³ç³»ä¸­æŠ•å…¥äº†å¯¹æœªæ¥çš„æœŸå¾…ã€‚' },
  { dim: 'C', text: 'å…³ç³»ç»“æŸæ—¶ï¼Œä½ ä¼šæ„Ÿè§‰è‡ªå·±ä»˜å‡ºäº†å¾ˆå¤šã€‚' },
  { dim: 'C', text: 'ä½ å¾ˆéš¾è½»æ˜“ä»å·²æŠ•å…¥è¾ƒå¤šçš„å…³ç³»ä¸­æŠ½èº«ã€‚' },
  { dim: 'C', text: 'ä½ å¸¸æ‰¿æ‹…å…³ç³»ä¸­çš„ç»´ç³»è§’è‰²ã€‚' },
  // æ¨¡å—D - å®‰å…¨æ„Ÿå†…åŒ–ç¨‹åº¦ (8é¢˜) - åå‘è®¡åˆ†
  { dim: 'D', text: 'å³ä½¿ä¼´ä¾£æš‚æ—¶æ— æ³•å›åº”ï¼Œä½ ä¹Ÿèƒ½ç¨³å®šæƒ…ç»ªã€‚' },
  { dim: 'D', text: 'ç‹¬å¤„æ—¶ä½ ä¾ç„¶æ„Ÿåˆ°è‡ªæˆ‘å®Œæ•´ã€‚' },
  { dim: 'D', text: 'ä½ ä¸éœ€è¦é€šè¿‡å…³ç³»ç¡®è®¤æ¥è¯æ˜ä»·å€¼ã€‚' },
  { dim: 'D', text: 'å…³ç³»çŸ­æš‚æ³¢åŠ¨ä¸ä¼šè®©ä½ ç«‹åˆ»å¦å®šè‡ªå·±ã€‚' },
  { dim: 'D', text: 'ä½ èƒ½ç‹¬ç«‹å¤„ç†å¤§å¤šæ•°æƒ…ç»ªå›°æ‰°ã€‚' },
  { dim: 'D', text: 'å…³ç³»ä¸æ˜æœ—æ—¶ä½ ä»èƒ½ä¿æŒç”Ÿæ´»èŠ‚å¥ã€‚' },
  { dim: 'D', text: 'ä½ çš„ä»·å€¼æ„Ÿè¾ƒå°‘éšå¯¹æ–¹æ€åº¦æ³¢åŠ¨ã€‚' },
  { dim: 'D', text: 'ä½ æ›´ä»è‡ªæˆ‘è®¤å¯ä¸­è·å¾—å®‰å…¨æ„Ÿã€‚' },
  // æ¨¡å—E - æƒ…ç»ªæŠ•å°„é£é™© (8é¢˜)
  { dim: 'E', text: 'æ„Ÿåˆ°å­¤ç‹¬ä½è½æ—¶ï¼Œä½ ä¼šæ›´ä¾èµ–è¿™æ®µå…³ç³»ã€‚' },
  { dim: 'E', text: 'ä½ ä¼šæŠŠç†æƒ³å…³ç³»çŠ¶æ€æå‰æŠ•å°„åˆ°å¯¹æ–¹èº«ä¸Šã€‚' },
  { dim: 'E', text: 'ä½ ä¼šå› æƒ…ç»ªä¸åŒè€Œé‡æ–°è§£è¯»å…³ç³»ã€‚' },
  { dim: 'E', text: 'ä½ æŠŠè¿™æ®µå…³ç³»å½“ä½œé‡è¦æƒ…ç»ªæ”¯æ’‘ã€‚' },
  { dim: 'E', text: 'ç°å®ç©ºç¼ºæ—¶ä½ ä¼šæ›´ç”¨åŠ›æŠ“ä½å…³ç³»ã€‚' },
  { dim: 'E', text: 'ä½ æœ‰æ—¶å¿½ç•¥ç°å®é—®é¢˜ï¼Œåªå…³æ³¨æƒ…ç»ªå®‰æ…°ã€‚' },
  { dim: 'E', text: 'ä½ å¯¹å…³ç³»çš„æœŸå¾…éƒ¨åˆ†æ¥è‡ªæƒ³è±¡ã€‚' },
  { dim: 'E', text: 'å¤±å»è¿™æ®µå…³ç³»ä¼šè®©ä½ æ‹…å¿ƒéš¾ä»¥æ¢å¤ã€‚' }
];

const dimInfo = {
  'A': { name: 'äº²å¯†éœ€æ±‚', icon: 'ğŸ’•', bg: '#fce7f3', color: '#ec4899' },
  'B': { name: 'ç¡®å®šéœ€æ±‚', icon: 'ğŸ”’', bg: '#dbeafe', color: '#3b82f6' },
  'C': { name: 'æƒ…æ„ŸæŠ•å…¥', icon: 'ğŸ’', bg: '#fef3c7', color: '#f59e0b' },
  'D': { name: 'å®‰å…¨å†…åŒ–', icon: 'ğŸ›¡ï¸', bg: '#d1fae5', color: '#10b981' },
  'E': { name: 'æƒ…ç»ªæŠ•å°„', icon: 'ğŸŒ™', bg: '#f3e8ff', color: '#a855f7' }
};

const optionLabels = ['éå¸¸ä¸ç¬¦åˆ', 'ä¸å¤ªç¬¦åˆ', 'æœ‰äº›ç¬¦åˆ', 'éå¸¸ç¬¦åˆ'];

let idx = 0;
let answers = new Array(42).fill(null);
const dims = questions.map(q => q.dim);

function render() {
  const q = questions[idx];
  const info = dimInfo[q.dim];
  document.getElementById('dimTag').textContent = info.name;
  document.getElementById('dimTag').style.background = info.bg;
  document.getElementById('dimTag').style.color = info.color;
  document.getElementById('qNum').textContent = idx + 1;
  document.getElementById('current').textContent = idx + 1;
  document.getElementById('qText').textContent = q.text;
  document.getElementById('progressFill').style.width = ((idx + 1) / 42 * 100) + '%';

  const optDiv = document.getElementById('options');
  optDiv.innerHTML = '';
  optionLabels.forEach((label, i) => {
    const opt = document.createElement('div');
    opt.className = 'opt' + (answers[idx] === i ? ' selected' : '');
    opt.innerHTML = `<div class="opt-radio"></div><div class="opt-text">${label}</div>`;
    opt.onclick = () => selectOption(i);
    optDiv.appendChild(opt);
  });

  document.getElementById('prevBtn').disabled = idx === 0;
  document.getElementById('nextBtn').disabled = answers[idx] === null;
  document.getElementById('nextBtn').textContent = idx === 41 ? 'æŸ¥çœ‹ç»“æœ' : 'ä¸‹ä¸€é¢˜';
}

function selectOption(val) {
  answers[idx] = val;
  render();
}

function prev() { if (idx > 0) { idx--; render(); } }

function next() {
  if (answers[idx] === null) return;
  if (idx < 41) { idx++; render(); }
  else { showResult(); }
}

function getNavButtons() {
  const source = sessionStorage.getItem('user_source');
  if (source === 'platform') {
    return '<button class="restart-btn secondary" onclick="location.href=\'../platform.html\'">è¿”å›æµ‹è¯„ä¸­å¿ƒ</button>';
  } else {
    return '<button class="restart-btn secondary" onclick="showMoreTests()">æ›´å¤šæµ‹è¯•</button>';
  }
}

function showMoreTests() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `
    <div class="modal-content">
      <div class="modal-icon">ğŸ§‚</div>
      <h3>æ›´å¤šä¸“ä¸šæµ‹è¯„</h3>
      <p>è¯·åœ¨å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€è´­ä¹°å…¶ä»–æµ‹è¯•å“¦~</p>
      <div class="modal-buttons">
        <button class="modal-btn primary" onclick="closeModal()">çŸ¥é“äº†</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add('show'), 10);
}

function closeModal() {
  const modal = document.querySelector('.modal-overlay');
  if (modal) { modal.classList.remove('show'); setTimeout(() => modal.remove(), 300); }
}

function calcScores() {
  const scores = { A: 0, B: 0, C: 0, D: 0, E: 0 };
  answers.forEach((v, i) => {
    const dim = dims[i];
    if (dim === 'D') {
      // Dç»´åº¦åå‘è®¡åˆ†ï¼šé«˜åˆ†è¡¨ç¤ºå®‰å…¨æ„Ÿå†…åŒ–ç¨‹åº¦é«˜
      scores[dim] += (3 - v);
    } else {
      scores[dim] += v;
    }
  });
  return scores;
}

function getNormalized(scores) {
  return {
    A: Math.round(scores.A / 24 * 100),
    B: Math.round(scores.B / 24 * 100),
    C: Math.round(scores.C / 30 * 100),
    D: Math.round(scores.D / 24 * 100),
    E: Math.round(scores.E / 24 * 100)
  };
}

function getLoveType(norm) {
  const highIntimacy = norm.A >= 60;
  const highCertainty = norm.B >= 60;
  const highInvestment = norm.C >= 60;
  const lowSecurity = norm.D < 50;
  const highProjection = norm.E >= 60;

  if (lowSecurity && highProjection && highInvestment) {
    return {
      name: 'æƒ…æ„Ÿä¾èµ–å‹',
      desc: 'ä½ åœ¨å…³ç³»ä¸­å€¾å‘äºé«˜æŠ•å…¥ï¼Œä½†å®‰å…¨æ„Ÿä¸»è¦æ¥è‡ªå¤–éƒ¨ç¡®è®¤ã€‚å½“å…³ç³»å›åº”ä¸è¶³æ—¶ï¼Œå®¹æ˜“é™·å…¥ç„¦è™‘ã€‚ä½ éœ€è¦å­¦ä¼šå»ºç«‹å†…åœ¨çš„å®‰å…¨æ„ŸåŸºç¡€ã€‚',
      risk: 'å¯èƒ½è¿‡åº¦ä¾èµ–å…³ç³»æ¥å¡«è¡¥å†…å¿ƒç©ºç¼ºï¼Œå®¹æ˜“åœ¨å…³ç³»ä¸­æ¶ˆè€—è¿‡å¤šèƒ½é‡ã€‚',
      strength: 'çœŸè¯šæŠ•å…¥ï¼Œé‡è§†æƒ…æ„Ÿè¿æ¥ï¼Œæ„¿æ„ä¸ºå…³ç³»ä»˜å‡ºã€‚'
    };
  }
  if (highIntimacy && highCertainty && !lowSecurity) {
    return {
      name: 'ç¨³å®šè¿½æ±‚å‹',
      desc: 'ä½ å¯¹å…³ç³»æœ‰æ˜ç¡®çš„éœ€æ±‚å’Œæ ‡å‡†ï¼Œé‡è§†æƒ…ç»ªäº¤æµå’Œå…³ç³»ç¡®å®šæ€§ã€‚ä½ çš„å†…åœ¨å®‰å…¨æ„Ÿç›¸å¯¹ç¨³å®šï¼Œèƒ½å¤Ÿåœ¨å…³ç³»ä¸­ä¿æŒè‡ªæˆ‘ã€‚',
      risk: 'å¯èƒ½å¯¹å…³ç³»æœ‰è¾ƒé«˜æœŸå¾…ï¼Œéœ€è¦é¿å…è¿‡åº¦ç†æƒ³åŒ–ã€‚',
      strength: 'æ¸…æ™°çŸ¥é“è‡ªå·±è¦ä»€ä¹ˆï¼Œèƒ½å¤Ÿå»ºç«‹æ·±åº¦è¿æ¥ã€‚'
    };
  }
  if (highInvestment && !highProjection && !lowSecurity) {
    return {
      name: 'å¥åº·æŠ•å…¥å‹',
      desc: 'ä½ æ„¿æ„åœ¨å…³ç³»ä¸­æŠ•å…¥ï¼ŒåŒæ—¶ä¿æŒç€å†…åœ¨çš„å®‰å…¨æ„Ÿå’Œè‡ªæˆ‘è®¤åŒã€‚ä½ èƒ½å¤ŸåŒºåˆ†çœŸå®çš„æƒ…æ„Ÿéœ€æ±‚å’Œæƒ…ç»ªæŠ•å°„ã€‚',
      risk: 'éœ€è¦æ³¨æ„å¹³è¡¡ä»˜å‡ºä¸æ¥æ”¶ï¼Œé¿å…å•æ–¹é¢è¿‡åº¦æŠ•å…¥ã€‚',
      strength: 'æˆç†Ÿçš„å…³ç³»æ€åº¦ï¼Œèƒ½å¤Ÿå¥åº·åœ°ç»è¥äº²å¯†å…³ç³»ã€‚'
    };
  }
  return {
    name: 'æƒ…æ„Ÿæ¢ç´¢å‹',
    desc: 'ä½ åœ¨å…³ç³»ä¸­å‘ˆç°å‡ºå¤šå…ƒçš„ç‰¹è´¨ï¼Œæ­£åœ¨æ¢ç´¢é€‚åˆè‡ªå·±çš„ç›¸å¤„æ¨¡å¼ã€‚ç»§ç»­äº†è§£è‡ªå·±çš„éœ€æ±‚å’Œæ¨¡å¼ï¼Œä¼šå¸®åŠ©ä½ å»ºç«‹æ›´æ»¡æ„çš„å…³ç³»ã€‚',
    risk: 'éœ€è¦æ›´æ¸…æ™°åœ°äº†è§£è‡ªå·±çš„æ ¸å¿ƒéœ€æ±‚ï¼Œé¿å…åœ¨å…³ç³»ä¸­è¿·å¤±æ–¹å‘ã€‚',
    strength: 'ä¿æŒå¼€æ”¾å’Œæ¢ç´¢çš„æ€åº¦ï¼Œæœ‰æˆé•¿å’Œæ”¹å˜çš„æ½œåŠ›ã€‚'
  };
}

function getDimAnalysis(dim, score) {
  const analyses = {
    A: {
      high: 'ä½ å¯¹äº²å¯†å…³ç³»ä¸­çš„æƒ…ç»ªäº¤æµæœ‰å¾ˆé«˜çš„éœ€æ±‚ã€‚ä½ é‡è§†æ·±åº¦è¿æ¥ï¼Œéœ€è¦é€šè¿‡æŒç»­çš„æƒ…æ„Ÿäº’åŠ¨æ¥ç¡®è®¤å…³ç³»çš„çœŸå®æ€§ã€‚ç¼ºä¹æƒ…ç»ªäº¤æµä¼šè®©ä½ æ„Ÿåˆ°ç©ºè™šã€‚å»ºè®®æ‰¾åˆ°åŒæ ·é‡è§†æƒ…æ„Ÿè¿æ¥çš„ä¼´ä¾£ï¼ŒåŒæ—¶ä¹Ÿå­¦ä¼šåœ¨æš‚æ—¶æ— æ³•äº¤æµæ—¶è‡ªæˆ‘è°ƒèŠ‚ã€‚',
      medium: 'ä½ å¯¹æƒ…ç»ªäº¤æµæœ‰ä¸€å®šéœ€æ±‚ï¼Œä½†ä¹Ÿèƒ½å¤Ÿæ¥å—é€‚åº¦çš„ç‹¬ç«‹ç©ºé—´ã€‚ä½ èƒ½å¤Ÿåœ¨äº²å¯†å’Œè‡ªä¸»ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚ç»§ç»­ä¿æŒè¿™ç§çµæ´»æ€§ï¼ŒåŒæ—¶å…³æ³¨è‡ªå·±æ ¸å¿ƒçš„æƒ…æ„Ÿéœ€æ±‚ã€‚',
      low: 'ä½ å¯¹æƒ…ç»ªäº¤æµçš„éœ€æ±‚ç›¸å¯¹è¾ƒä½ï¼Œèƒ½å¤Ÿåœ¨å…³ç³»ä¸­ä¿æŒè¾ƒå¼ºçš„ç‹¬ç«‹æ€§ã€‚è¿™å¯èƒ½æ˜¯è‡ªè¶³çš„è¡¨ç°ï¼Œä¹Ÿå¯èƒ½éœ€è¦æ£€è§†æ˜¯å¦æœ‰æƒ…æ„Ÿå›é¿çš„å€¾å‘ã€‚'
    },
    B: {
      high: 'ä½ å¯¹å…³ç³»çš„ç¡®å®šæ€§æœ‰å¾ˆé«˜çš„éœ€æ±‚ã€‚æš§æ˜§å’Œä¸æ˜ç¡®çš„çŠ¶æ€ä¼šè®©ä½ æ„Ÿåˆ°ç„¦è™‘å’Œä¸å®‰ã€‚ä½ éœ€è¦æ¸…æ™°çš„è¾¹ç•Œå’Œæ‰¿è¯ºæ‰èƒ½å®‰å¿ƒæŠ•å…¥ã€‚å»ºè®®ä¸ä¼´ä¾£å¦è¯šæ²Ÿé€šä½ çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿå­¦ä¼šåœ¨ä¸ç¡®å®šä¸­ä¿æŒä¸€å®šçš„ç¨³å®šã€‚',
      medium: 'ä½ å¯¹å…³ç³»ç¡®å®šæ€§æœ‰åˆç†çš„æœŸå¾…ï¼Œèƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šå®¹å¿æš‚æ—¶çš„æ¨¡ç³ŠçŠ¶æ€ã€‚è¿™æ˜¯æ¯”è¾ƒå¥åº·çš„çŠ¶æ€ï¼Œç»§ç»­ä¿æŒæ¸…æ™°çš„è‡ªæˆ‘è®¤çŸ¥å’Œæ²Ÿé€šã€‚',
      low: 'ä½ å¯¹å…³ç³»ç¡®å®šæ€§çš„éœ€æ±‚è¾ƒä½ï¼Œèƒ½å¤Ÿåœ¨æ¨¡ç³ŠçŠ¶æ€ä¸­ä¿æŒç›¸å¯¹å¹³é™ã€‚è¿™å¯èƒ½ä»£è¡¨å®‰å…¨æ„Ÿè¾ƒå¼ºï¼Œä¹Ÿå¯èƒ½æ˜¯å›é¿æ‰¿è¯ºçš„è¡¨ç°ï¼Œå€¼å¾—è¿›ä¸€æ­¥åæ€ã€‚'
    },
    C: {
      high: 'ä½ åœ¨å…³ç³»ä¸­æŠ•å…¥ç¨‹åº¦å¾ˆé«˜ï¼Œæ„¿æ„ä¸ºå…³ç³»è°ƒæ•´è‡ªå·±ã€æ‰¿æ‹…é£é™©ã€‚è¿™ä»£è¡¨ä½ é‡è§†å…³ç³»ï¼Œä½†ä¹Ÿéœ€è¦æ³¨æ„ä¸è¦è¿‡åº¦ç‰ºç‰²è‡ªæˆ‘ã€‚å»ºè®®å­¦ä¼šè¯„ä¼°æŠ•å…¥ä¸å›æŠ¥çš„å¹³è¡¡ï¼Œä¿æŠ¤å¥½è‡ªå·±çš„è¾¹ç•Œã€‚',
      medium: 'ä½ åœ¨å…³ç³»ä¸­çš„æŠ•å…¥ç¨‹åº¦é€‚ä¸­ï¼Œèƒ½å¤Ÿä»˜å‡ºåŒæ—¶ä¹Ÿå…³æ³¨è‡ªå·±çš„éœ€æ±‚ã€‚è¿™æ˜¯æ¯”è¾ƒå¥åº·çš„æŠ•å…¥æ¨¡å¼ï¼Œç»§ç»­ä¿æŒè¿™ç§å¹³è¡¡ã€‚',
      low: 'ä½ åœ¨å…³ç³»ä¸­çš„æŠ•å…¥ç›¸å¯¹ä¿å®ˆï¼Œå€¾å‘äºä¿æŠ¤è‡ªå·±ã€‚è¿™å¯èƒ½æ˜¯ç†æ€§çš„è‡ªæˆ‘ä¿æŠ¤ï¼Œä¹Ÿå¯èƒ½é™åˆ¶äº†å…³ç³»çš„æ·±åº¦å‘å±•ã€‚å¯ä»¥å°è¯•åœ¨å®‰å…¨çš„å…³ç³»ä¸­é€æ­¥å¢åŠ æŠ•å…¥ã€‚'
    },
    D: {
      high: 'ä½ çš„å®‰å…¨æ„Ÿä¸»è¦æ¥è‡ªå†…åœ¨ï¼Œä¸è¿‡åº¦ä¾èµ–å…³ç³»çš„ç¡®è®¤ã€‚ä½ èƒ½å¤Ÿåœ¨ä¼´ä¾£æš‚æ—¶æ— æ³•å›åº”æ—¶ä¿æŒç¨³å®šï¼Œè¿™æ˜¯éå¸¸å¥åº·çš„çŠ¶æ€ã€‚ç»§ç»­åŸ¹å…»è¿™ç§å†…åœ¨çš„å®‰å…¨æ„ŸåŸºç¡€ã€‚',
      medium: 'ä½ çš„å®‰å…¨æ„Ÿéƒ¨åˆ†æ¥è‡ªå†…åœ¨ï¼Œéƒ¨åˆ†æ¥è‡ªå…³ç³»ã€‚åœ¨å…³ç³»ç¨³å®šæ—¶ä½ æ„Ÿåˆ°å®‰å…¨ï¼Œæ³¢åŠ¨æ—¶å¯èƒ½æœ‰äº›ä¸å®‰ã€‚ç»§ç»­åŸ¹å…»å†…åœ¨çš„è‡ªæˆ‘è®¤åŒå’Œä»·å€¼æ„Ÿã€‚',
      low: 'ä½ çš„å®‰å…¨æ„Ÿè¾ƒå¤šä¾èµ–å¤–éƒ¨å…³ç³»çš„ç¡®è®¤ã€‚å½“å…³ç³»æœ‰æ³¢åŠ¨æˆ–ä¼´ä¾£æ— æ³•åŠæ—¶å›åº”æ—¶ï¼Œä½ å¯èƒ½æ„Ÿåˆ°ç„¦è™‘ã€‚å»ºè®®é€šè¿‡è‡ªæˆ‘æˆé•¿ã€å»ºç«‹å¤šå…ƒæ”¯æŒç³»ç»Ÿæ¥å¢å¼ºå†…åœ¨å®‰å…¨æ„Ÿã€‚'
    },
    E: {
      high: 'ä½ åœ¨å…³ç³»ä¸­å­˜åœ¨è¾ƒé«˜çš„æƒ…ç»ªæŠ•å°„å€¾å‘ã€‚å¯èƒ½ä¼šæŠŠç†æƒ³çŠ¶æ€æŠ•å°„åˆ°å…³ç³»ä¸Šï¼Œåœ¨æƒ…ç»ªä½è½æ—¶è¿‡åº¦ä¾èµ–å…³ç³»ã€‚å»ºè®®å­¦ä¼šåŒºåˆ†çœŸå®çš„å…³ç³»çŠ¶å†µå’Œè‡ªå·±çš„æƒ…ç»ªæŠ•å°„ï¼Œå»ºç«‹æ›´å®¢è§‚çš„è§†è§’ã€‚',
      medium: 'ä½ æœ‰ä¸€å®šç¨‹åº¦çš„æƒ…ç»ªæŠ•å°„ï¼Œä½†æ€»ä½“ä¸Šèƒ½å¤Ÿä¿æŒç›¸å¯¹å®¢è§‚çš„è§†è§’ã€‚ç»§ç»­åŸ¹å…»è‡ªæˆ‘è§‰å¯Ÿèƒ½åŠ›ï¼Œæ³¨æ„åœ¨æƒ…ç»ªæ³¢åŠ¨æ—¶ä¿æŒç†æ€§ã€‚',
      low: 'ä½ çš„æƒ…ç»ªæŠ•å°„é£é™©è¾ƒä½ï¼Œèƒ½å¤Ÿæ¯”è¾ƒå®¢è§‚åœ°çœ‹å¾…å…³ç³»ã€‚è¿™æœ‰åŠ©äºä½ åšå‡ºæ›´ç†æ€§çš„å…³ç³»å†³ç­–ã€‚åŒæ—¶ä¹Ÿè¦æ³¨æ„ä¸è¦è¿‡åº¦ç†æ€§åŒ–ï¼Œå¿½è§†çœŸå®çš„æƒ…æ„Ÿéœ€æ±‚ã€‚'
    }
  };

  const analysis = analyses[dim];
  if (score >= 70) return analysis.high;
  if (score >= 40) return analysis.medium;
  return analysis.low;
}

function getDimLevel(score) {
  if (score >= 70) return { level: 'è¾ƒé«˜', class: 'level-high' };
  if (score >= 40) return { level: 'ä¸­ç­‰', class: 'level-medium' };
  return { level: 'è¾ƒä½', class: 'level-low' };
}

function showResult() {
  document.getElementById('testPage').classList.remove('active');
  document.getElementById('resultPage').classList.add('active');

  const scores = calcScores();
  const norm = getNormalized(scores);
  const loveType = getLoveType(norm);

  document.getElementById('resultContent').innerHTML = `
    <div class="result-header">
      <h1>çˆ±æƒ…å¿ƒç†ç»“æ„åˆ†ææŠ¥å‘Š</h1>
      <p>äº†è§£ä½ åœ¨äº²å¯†å…³ç³»ä¸­çš„æŠ•å…¥ã€ä¾èµ–ä¸æ¶ˆè€—æ¨¡å¼</p>
    </div>

    <div class="card">
      <div class="type-card">
        <div class="type-label">ä½ çš„çˆ±æƒ…å¿ƒç†ç±»å‹</div>
        <div class="type-name">${loveType.name}</div>
        <div class="type-desc">${loveType.desc}</div>
      </div>
      <div class="summary-text">
        <p><strong>ä½ çš„ä¼˜åŠ¿ï¼š</strong>${loveType.strength}</p>
        <p style="margin-top:12px"><strong>éœ€è¦æ³¨æ„ï¼š</strong>${loveType.risk}</p>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#fce7f3">ğŸ“Š</div>çˆ±æƒ…å¿ƒç†ç»“æ„é›·è¾¾å›¾</div>
      <div class="chart-wrap"><canvas id="radarChart"></canvas></div>
      <div class="summary-text" style="margin-top:20px;text-align:center;">
        äº²å¯†éœ€æ±‚ ${norm.A} Â· ç¡®å®šéœ€æ±‚ ${norm.B} Â· æƒ…æ„ŸæŠ•å…¥ ${norm.C} Â· å®‰å…¨å†…åŒ– ${norm.D} Â· æƒ…ç»ªæŠ•å°„ ${norm.E}
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#dbeafe">ğŸ“‹</div>5ç»´åº¦è¯¦ç»†è§£è¯»</div>
      ${Object.entries(dimInfo).map(([dim, info]) => {
        const score = norm[dim];
        const level = getDimLevel(score);
        return `
          <div class="dim-item">
            <div class="dim-header">
              <div class="dim-name"><div class="dim-icon" style="background:${info.bg}">${info.icon}</div>${info.name}</div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span class="level-badge ${level.class}">${level.level}</span>
                <span style="font-weight:600;color:var(--primary);">${score}</span>
              </div>
            </div>
            <div class="dim-bar"><div class="dim-bar-fill" style="width:${score}%;background:${info.color}"></div></div>
            <div style="font-size:13px;color:var(--text-muted);line-height:1.7;margin-top:8px;">${getDimAnalysis(dim, score)}</div>
          </div>
        `;
      }).join('')}
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#d1fae5">ğŸ’•</div>é€‚åˆä½ çš„ä¼´ä¾£ç‰¹è´¨</div>
      <div class="summary-text">
        åœ¨ä½ ç›®å‰çš„çˆ±æƒ…å¿ƒç†ç»“æ„ä¸‹ï¼Œä½ æ›´å®¹æ˜“åœ¨å…·å¤‡ä»¥ä¸‹ç‰¹è´¨çš„ä¼´ä¾£å…³ç³»ä¸­æ„Ÿåˆ°æ”¾æ¾ä¸å®‰å…¨ï¼š
      </div>
      <div class="partner-card">
        <h4>ç†æƒ³ä¼´ä¾£ç‰¹è´¨</h4>
        <ul class="partner-list">
          <li>æƒ…ç»ªå›åº”æ¸…æ™°ï¼Œä¸è®©ä½ åå¤çŒœæµ‹</li>
          <li>å…³ç³»èŠ‚å¥ç¨³å®šï¼Œäº’åŠ¨å¯é¢„æµ‹</li>
          <li>è¾¹ç•Œæ˜ç¡®ï¼Œä¸é€šè¿‡å†·å¤„ç†åˆ¶é€ å¼ åŠ›</li>
          <li>é¢å¯¹å†²çªæ„¿æ„æ²Ÿé€šï¼Œè€Œä¸æ˜¯å›é¿</li>
        </ul>
      </div>
      <div class="celebrity-box">
        <h4>å…³ç³»æ°”è´¨å‚è€ƒ</h4>
        <div class="celebrity-item">
          <div class="gender">ğŸ‘¨</div>
          <div class="info">
            <div class="name">ä¼‘Â·æ°å…‹æ›¼</div>
            <div class="desc">ä»–åœ¨é•¿æœŸå…³ç³»ä¸­å±•ç°å‡ºä¸€è‡´ã€ç¨³å®šã€æƒ…ç»ªæ‰¿æ¥åŠ›å¼ºçš„å…³ç³»æ°”è´¨ã€‚</div>
          </div>
        </div>
        <div class="celebrity-item">
          <div class="gender">ğŸ‘©</div>
          <div class="info">
            <div class="name">è‰¾ç›Â·æ±¤æ™®æ£®</div>
            <div class="desc">å¥¹çš„äº²å¯†è¡¨è¾¾ä»¥æƒ…ç»ªæˆç†Ÿã€æ²Ÿé€šæ¸…æ™°å’Œä½æ‹‰æ‰¯è‘—ç§°ã€‚</div>
          </div>
        </div>
      </div>
      <div class="summary-text" style="margin-top:16px;font-size:13px;">
        è¿™å¹¶ä¸æ˜¯åœ¨æš—ç¤ºä½ éœ€è¦æ‰¾åˆ°"è¿™æ ·çš„äºº"ï¼Œè€Œæ˜¯å¸®åŠ©ä½ ç†è§£ï¼šä»€ä¹ˆæ ·çš„å…³ç³»äº’åŠ¨æ–¹å¼ï¼Œå¯¹ä½ æ¥è¯´æ›´ä¸æ¶ˆè€—ã€‚
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#fef3c7">ğŸ’¡</div>å…³ç³»ç¥›é­…è¯´æ˜</div>
      <div class="summary-text">
        ä½ ä»¥ä¸ºä½ åœ¨åšçš„æ˜¯"åŠªåŠ›ç»è¥ä¸€æ®µå…³ç³»"ï¼Œå®é™…ä¸Šä½ å¯èƒ½åœ¨é€šè¿‡å…³ç³»ï¼Œè§£å†³ä¸€ä¸ªå°šæœªå®Œå…¨å†…åŒ–çš„å®‰å…¨æ„Ÿé—®é¢˜ã€‚
      </div>
      <div style="margin-top:16px;padding:16px;background:#fdf2f8;border-radius:12px;">
        <p style="font-size:14px;color:var(--text);margin-bottom:8px;font-weight:600;">æ ¸å¿ƒæ´å¯Ÿ</p>
        <p style="font-size:14px;color:var(--text-muted);line-height:1.7;">
          ä½ çš„çˆ±æƒ…æ–¹å¼æœ¬èº«ä¸æ˜¯é—®é¢˜ã€‚å½“ä½ èº«å¤„åŒ¹é…çš„å…³ç³»ç¯å¢ƒä¸­ï¼Œä½ çš„æŠ•å…¥ä¼šæˆä¸ºæ»‹å…»ï¼›åªæœ‰åœ¨ä¸åŒ¹é…çš„å…³ç³»ä¸­ï¼Œå®ƒæ‰ä¼šå˜æˆæ¶ˆè€—ã€‚
        </p>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#e0e7ff">ğŸ¯</div>å¯æ‰§è¡Œè°ƒæ•´å»ºè®®</div>
      <div class="tip-item"><div class="tip-num">1</div><div class="tip-text">åŒºåˆ†"å…³ç³»æš‚æ—¶æ¨¡ç³Š"ä¸"å…³ç³»ä¸å®‰å…¨"ï¼Œä¸è¦åœ¨æ¨¡ç³ŠæœŸè¿‡åº¦æ¶ˆè€—</div></div>
      <div class="tip-item"><div class="tip-num">2</div><div class="tip-text">æŠŠä¸€éƒ¨åˆ†å®‰å…¨æ„Ÿä»å…³ç³»ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œå»ºç«‹è‡ªæˆ‘è®¤åŒçš„å…¶ä»–æ”¯æŸ±</div></div>
      <div class="tip-item"><div class="tip-num">3</div><div class="tip-text">åœ¨æŠ•å…¥å‰è§‚å¯Ÿå¯¹æ–¹æ˜¯å¦å…·å¤‡ç¨³å®šå›åº”èƒ½åŠ›ï¼Œè€Œéåªçœ‹åˆæœŸçš„çƒ­æƒ…</div></div>
      <div class="tip-item"><div class="tip-num">4</div><div class="tip-text">å­¦ä¼šè¯†åˆ«æƒ…ç»ªæŠ•å°„ï¼šå½“ä½ å¯¹å…³ç³»çš„è§£è¯»éšæƒ…ç»ªå‰§çƒˆæ³¢åŠ¨æ—¶ï¼Œå…ˆç¨³å®šæƒ…ç»ªå†åšåˆ¤æ–­</div></div>
      <div class="tip-item"><div class="tip-num">5</div><div class="tip-text">å»ºç«‹æ”¯æŒç³»ç»Ÿï¼šä¸è¦æŠŠæ‰€æœ‰çš„æƒ…ç»ªéœ€æ±‚éƒ½æ”¾åœ¨ä¸€æ®µå…³ç³»é‡Œ</div></div>
    </div>

    <div class="action-btns">
      <button class="restart-btn primary" onclick="downloadPDF()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
        ä¸‹è½½PDFæŠ¥å‘Š
      </button>
      ${getNavButtons()}
    </div>
  `;

  // ç»˜åˆ¶é›·è¾¾å›¾
  const ctx = document.getElementById('radarChart').getContext('2d');
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['äº²å¯†éœ€æ±‚', 'ç¡®å®šéœ€æ±‚', 'æƒ…æ„ŸæŠ•å…¥', 'å®‰å…¨å†…åŒ–', 'æƒ…ç»ªæŠ•å°„'],
      datasets: [{
        label: 'å¾—åˆ†',
        data: [norm.A, norm.B, norm.C, norm.D, norm.E],
        backgroundColor: 'rgba(236, 72, 153, 0.2)',
        borderColor: '#ec4899',
        borderWidth: 2,
        pointBackgroundColor: '#ec4899'
      }]
    },
    options: {
      scales: {
        r: {
          beginAtZero: true,
          max: 100,
          ticks: { stepSize: 25 }
        }
      },
      plugins: { legend: { display: false } }
    }
  });
}

async function downloadPDF() {
  const btn = event.target.closest('button');
  const loading = document.getElementById('loading');
  btn.disabled = true;
  btn.innerHTML = 'ç”Ÿæˆä¸­...';
  loading.classList.add('show');

  try {
    const { jsPDF } = window.jspdf;
    const content = document.getElementById('resultContent');
    const canvas = await html2canvas(content, { scale: 2, useCORS: true, logging: false });
    const imgData = canvas.toDataURL('image/jpeg', 0.95);

    const pdf = new jsPDF('p', 'mm', 'a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    const imgWidth = pdfWidth - 20;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    let heightLeft = imgHeight;
    let position = 10;

    pdf.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
    heightLeft -= (pdfHeight - 20);

    while (heightLeft > 0) {
      position = heightLeft - imgHeight + 10;
      pdf.addPage();
      pdf.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
      heightLeft -= (pdfHeight - 20);
    }

    const date = new Date().toLocaleDateString('zh-CN').replace(/\//g, '-');
    pdf.save(`çˆ±æƒ…å¿ƒç†ç»“æ„æŠ¥å‘Š_${date}.pdf`);
  } catch (e) {
    console.error(e);
    alert('PDFç”Ÿæˆå¤±è´¥');
  } finally {
    btn.disabled = false;
    btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> ä¸‹è½½PDFæŠ¥å‘Š';
    loading.classList.remove('show');
  }
}

render();
</script>
</body>
</html>
