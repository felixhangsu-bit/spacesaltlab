<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çˆ±æƒ…æ·±åº¦æµ‹è¯„ | å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #ec4899;
  --primary-dark: #db2777;
  --primary-light: #f9a8d4;
  --gradient: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #1e293b;
  --text-muted: #64748b;
  --border: #e2e8f0;
  --shadow: 0 4px 20px rgba(0,0,0,0.08);
  --radius: 16px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans SC', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
.page { display: none; min-height: 100vh; }
.page.active { display: block; }
#testPage { background: var(--bg); padding: 20px; }
.test-container { max-width: 700px; margin: 0 auto; }
.test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.back-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: all 0.2s; }
.back-btn:hover { background: white; color: var(--text); }
.progress-wrap { text-align: right; }
.progress-text { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
.progress-bar { width: 180px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--gradient); border-radius: 3px; transition: width 0.3s; }
.question-card { background: var(--card); border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); }
.dim-tag { display: none; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-bottom: 16px; }
.q-num { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.q-text { font-size: 20px; font-weight: 600; line-height: 1.5; margin-bottom: 32px; }
.options { display: flex; flex-direction: column; gap: 12px; }
.opt { display: flex; align-items: center; gap: 14px; padding: 16px 20px; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
.opt:hover { border-color: var(--primary-light); background: #fdf2f8; }
.opt.selected { border-color: var(--primary); background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 100%); }
.opt-radio { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
.opt.selected .opt-radio { border-color: var(--primary); background: var(--primary); }
.opt.selected .opt-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
.opt-text { font-size: 15px; font-weight: 500; }
.nav-btns { display: flex; gap: 12px; margin-top: 32px; }
.nav-btn { flex: 1; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s; }
.nav-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.nav-btn.secondary:hover { border-color: var(--primary-light); }
.nav-btn.primary { background: var(--primary); border: none; color: white; }
.nav-btn.primary:hover { background: var(--primary-dark); }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }

#resultPage { background: linear-gradient(180deg, #ec4899 0%, #8b5cf6 40%, var(--bg) 40%); }
.result-container { max-width: 800px; margin: 0 auto; padding: 40px 20px 60px; }
.result-header { text-align: center; color: white; margin-bottom: 32px; padding-top: 20px; }
.result-header h1 { font-size: 26px; margin-bottom: 8px; }
.result-header p { opacity: 0.9; font-size: 14px; }
.card { background: var(--card); border-radius: var(--radius); padding: 32px; box-shadow: var(--shadow); margin-bottom: 20px; }
.section-title { font-size: 17px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
.section-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }

.score-hero { text-align: center; padding: 32px; border-radius: 20px; background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 100%); margin-bottom: 24px; }
.score-label { font-size: 14px; color: var(--text-muted); margin-bottom: 8px; }
.score-number { font-size: 72px; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; line-height: 1; }
.score-suffix { font-size: 24px; color: var(--primary); margin-left: 4px; }
.score-title { font-size: 22px; font-weight: 600; color: var(--primary); margin: 16px 0 8px; }
.score-desc { font-size: 14px; color: var(--text-muted); line-height: 1.7; }

.type-card { text-align: center; padding: 24px; border-radius: 16px; background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 100%); margin-bottom: 20px; }
.type-label { font-size: 14px; color: var(--text-muted); margin-bottom: 8px; }
.type-name { font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 12px; }
.type-desc { font-size: 14px; color: var(--text-muted); line-height: 1.7; }

.chart-wrap { max-width: 350px; margin: 0 auto; }
.dim-item { padding: 16px; border: 1px solid var(--border); border-radius: 14px; margin-bottom: 12px; }
.dim-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.dim-name { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 14px; }
.dim-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
.dim-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
.dim-bar-fill { height: 100%; border-radius: 4px; }
.level-badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; }
.level-high { background: #fce7f3; color: #ec4899; }
.level-medium { background: #fef3c7; color: #d97706; }
.level-low { background: #dbeafe; color: #3b82f6; }

.summary-text { font-size: 15px; color: var(--text-muted); line-height: 1.8; }
.highlight-box { margin-top: 16px; padding: 16px; background: #fdf2f8; border-radius: 12px; }
.highlight-box p { font-size: 14px; color: var(--text-muted); line-height: 1.7; }
.highlight-box strong { color: var(--text); }

.tip-item { display: flex; gap: 12px; padding: 14px; background: #fdf2f8; border-radius: 10px; margin-bottom: 10px; }
.tip-num { width: 24px; height: 24px; background: var(--gradient); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; flex-shrink: 0; }
.tip-text { font-size: 14px; color: var(--text-muted); line-height: 1.6; }

.trait-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 16px; }
.trait-item { padding: 14px; background: #f8fafc; border-radius: 10px; text-align: center; }
.trait-icon { font-size: 24px; margin-bottom: 6px; }
.trait-label { font-size: 13px; color: var(--text-muted); margin-bottom: 4px; }
.trait-value { font-size: 16px; font-weight: 600; color: var(--text); }

.love-meter { margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #fff5f7 0%, #faf5ff 100%); border-radius: 16px; }
.meter-bar { height: 20px; background: #e2e8f0; border-radius: 10px; overflow: hidden; position: relative; }
.meter-fill { height: 100%; background: var(--gradient); border-radius: 10px; transition: width 1s ease-out; }
.meter-labels { display: flex; justify-content: space-between; margin-top: 8px; font-size: 12px; color: var(--text-muted); }

.partner-card { background: #f8fafc; border-radius: 12px; padding: 16px; margin-top: 16px; }
.partner-card h4 { font-size: 14px; margin-bottom: 12px; color: var(--text); }
.partner-list { list-style: none; padding: 0; }
.partner-list li { display: flex; align-items: center; gap: 8px; padding: 8px 0; font-size: 14px; color: var(--text-muted); border-bottom: 1px solid var(--border); }
.partner-list li:last-child { border-bottom: none; }
.partner-list li::before { content: 'ğŸ’•'; font-size: 12px; }

.action-btns { display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap; }
.restart-btn { flex: 1; min-width: 140px; padding: 14px 20px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; }
.restart-btn.primary { background: var(--gradient); border: none; color: white; }
.restart-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(236,72,153,0.3); }
.restart-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.restart-btn.secondary:hover { border-color: var(--primary); }

.celebrity-box { background: #f8fafc; border-radius: 12px; padding: 16px; margin-top: 16px; }
.celebrity-box h4 { font-size: 14px; margin-bottom: 12px; }
.celebrity-item { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; }
.celebrity-item .gender { font-size: 20px; }
.celebrity-item .info { flex: 1; }
.celebrity-item .name { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
.celebrity-item .desc { font-size: 13px; color: var(--text-muted); line-height: 1.5; }

.modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; transition: opacity 0.3s; }
.modal-overlay.show { opacity: 1; }
.modal-content { background: white; border-radius: 20px; padding: 32px; max-width: 400px; width: 90%; text-align: center; transform: scale(0.9); transition: transform 0.3s; }
.modal-overlay.show .modal-content { transform: scale(1); }
.modal-icon { font-size: 48px; margin-bottom: 16px; }
.modal-content h3 { font-size: 20px; margin-bottom: 12px; }
.modal-content p { color: var(--text-muted); font-size: 14px; margin-bottom: 20px; }
.modal-btn { width: 100%; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; margin-bottom: 10px; }
.modal-btn.primary { background: var(--gradient); border: none; color: white; }
.modal-btn.secondary { background: #f1f5f9; border: none; color: var(--text); }

.loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); display: none; align-items: center; justify-content: center; z-index: 2000; flex-direction: column; gap: 16px; }
.loading-overlay.show { display: flex; }
.loading-spinner { width: 48px; height: 48px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.insight-card { background: linear-gradient(135deg, #fef3c7 0%, #fce7f3 100%); border-radius: 12px; padding: 16px; margin-top: 16px; }
.insight-card h4 { font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
.insight-card p { font-size: 14px; color: var(--text-muted); line-height: 1.7; }
</style>
</head>
<body>

<div id="testPage" class="page active">
  <div class="test-container">
    <div class="test-header">
      <button class="back-btn" onclick="if(confirm('ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ'))location.href='index.html'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        è¿”å›
      </button>
      <div class="progress-wrap">
        <div class="progress-text"><span id="current">1</span> / 42</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:2.4%"></div></div>
      </div>
    </div>
    <div class="question-card">
      <div class="dim-tag" id="dimTag">ç»´åº¦</div>
      <div class="q-num">ç¬¬ <span id="qNum">1</span> é¢˜</div>
      <div class="q-text" id="qText"></div>
      <div class="options" id="options"></div>
      <div class="nav-btns">
        <button class="nav-btn secondary" id="prevBtn" onclick="prev()" disabled>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          ä¸Šä¸€é¢˜
        </button>
        <button class="nav-btn primary" id="nextBtn" onclick="next()" disabled>
          ä¸‹ä¸€é¢˜
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<div id="resultPage" class="page">
  <div class="result-container" id="resultContent"></div>
</div>

<div class="loading-overlay" id="loading">
  <div class="loading-spinner"></div>
  <div style="color:var(--text-muted)">æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...</div>
</div>

<script>
const questions = [
  // ç»´åº¦A - æƒ…æ„Ÿä¾æ‹åº¦ (7é¢˜): å¯¹TAçš„æƒ…æ„Ÿä¾èµ–ã€æƒ³å¿µã€ç‰µæŒ‚ç¨‹åº¦
  { dim: 'A', text: 'å½“ä½ ä¸€æ•´å¤©æ²¡æœ‰å’ŒTAè”ç³»æ—¶ï¼Œä½ ä¼šä¸è‡ªè§‰åœ°æƒ³èµ·TAåœ¨åšä»€ä¹ˆã€‚' },
  { dim: 'A', text: 'çœ‹åˆ°æœ‰è¶£çš„äº‹ç‰©æˆ–ç¾ä¸½çš„é£æ™¯ï¼Œä½ ç¬¬ä¸€ååº”å°±æ˜¯æƒ³å’ŒTAåˆ†äº«ã€‚' },
  { dim: 'A', text: 'ç¡å‰å¦‚æœæ²¡æœ‰å’ŒTAè¯´æ™šå®‰ï¼Œä½ ä¼šè§‰å¾—è¿™ä¸€å¤©å¥½åƒå°‘äº†ç‚¹ä»€ä¹ˆã€‚' },
  { dim: 'A', text: 'å½“TAå¿ƒæƒ…ä¸å¥½æ—¶ï¼Œä½ ä¹Ÿä¼šè·Ÿç€æ„Ÿåˆ°éš¾è¿‡æˆ–æ‹…å¿ƒã€‚' },
  { dim: 'A', text: 'å³ä½¿å¾ˆå¿™ï¼Œä½ ä¹Ÿä¼šæŠ½æ—¶é—´ç»™TAå‘æ¶ˆæ¯æˆ–æ‰“ç”µè¯ã€‚' },
  { dim: 'A', text: 'TAçš„ä¸€ä¸ªå¾®ç¬‘æˆ–ä¸€å¥æš–å¿ƒçš„è¯ï¼Œå°±èƒ½è®©ä½ å¼€å¿ƒä¸€æ•´å¤©ã€‚' },
  { dim: 'A', text: 'ä½ ç»å¸¸ä¼šå›å¿†èµ·å’ŒTAåœ¨ä¸€èµ·çš„ç¾å¥½æ—¶åˆ»ã€‚' },

  // ç»´åº¦B - å æœ‰æ¬² (7é¢˜): å¸Œæœ›TAä¸“å±äºè‡ªå·±çš„ç¨‹åº¦
  { dim: 'B', text: 'ä½ å¸Œæœ›è‡ªå·±æ˜¯TAå¿ƒä¸­æœ€ç‰¹åˆ«ã€æœ€é‡è¦çš„äººã€‚' },
  { dim: 'B', text: 'å½“TAåœ¨ç¤¾äº¤åª’ä½“ä¸Šå’Œåˆ«äººäº’åŠ¨é¢‘ç¹æ—¶ï¼Œä½ ä¼šæ¯”è¾ƒåœ¨æ„ã€‚' },
  { dim: 'B', text: 'ä½ å¸Œæœ›TAçš„æœ‹å‹åœˆã€ä¸ªæ€§ç­¾åç­‰èƒ½ä½“ç°å‡ºä½ ä»¬çš„å…³ç³»ã€‚' },
  { dim: 'B', text: 'ä½ ä¼šè®°ä½TAæåˆ°è¿‡çš„æ¯ä¸€ä¸ªå¼‚æ€§æœ‹å‹çš„åå­—ã€‚' },
  { dim: 'B', text: 'å¦‚æœTAé€ç»™åˆ«äººå’Œé€ç»™ä½ ä¸€æ ·çš„ç¤¼ç‰©ï¼Œä½ ä¼šæœ‰ç‚¹ä»‹æ„ã€‚' },
  { dim: 'B', text: 'ä½ å¸Œæœ›TAåœ¨é‡è¦çš„æ—¥å­ï¼ˆç”Ÿæ—¥ã€èŠ‚æ—¥ï¼‰éƒ½èƒ½é™ªåœ¨ä½ èº«è¾¹ã€‚' },
  { dim: 'B', text: 'ä½ ä¼šå¸Œæœ›TAåœ¨åšé‡è¦å†³å®šæ—¶ç¬¬ä¸€ä¸ªæƒ³åˆ°å’Œä½ å•†é‡ã€‚' },

  // ç»´åº¦C - å«‰å¦’æ•æ„Ÿåº¦ (7é¢˜): å¯¹æ½œåœ¨ç«äº‰è€…çš„æ•æ„Ÿç¨‹åº¦
  { dim: 'C', text: 'å½“TAå¤¸èµå…¶ä»–å¼‚æ€§çš„ä¼˜ç‚¹æ—¶ï¼Œä½ å†…å¿ƒä¼šæœ‰ä¸€ç‚¹é…¸é…¸çš„æ„Ÿè§‰ã€‚' },
  { dim: 'C', text: 'çœ‹åˆ°TAå’Œå¼‚æ€§æœ‹å‹å•ç‹¬åˆç…§ï¼Œä½ ä¼šæƒ³çŸ¥é“å¯¹æ–¹æ˜¯è°ã€‚' },
  { dim: 'C', text: 'å¦‚æœTAçš„å‰ä»»çªç„¶è”ç³»TAï¼Œä½ ä¼šå¸Œæœ›TAå‘Šè¯‰ä½ èŠäº†ä»€ä¹ˆã€‚' },
  { dim: 'C', text: 'å½“æœ‰äººå¯¹TAè¡¨ç°å‡ºå¥½æ„Ÿæ—¶ï¼Œä½ ä¼šæ›´æƒ³åœ¨TAèº«è¾¹åˆ·å­˜åœ¨æ„Ÿã€‚' },
  { dim: 'C', text: 'ä½ ä¼šç•™æ„TAå’Œå¼‚æ€§äº’åŠ¨æ—¶çš„è¡¨æƒ…å’Œè¯­æ°”ã€‚' },
  { dim: 'C', text: 'å¦‚æœTAç»å¸¸æèµ·æŸä¸ªå¼‚æ€§åŒäº‹æˆ–æœ‹å‹ï¼Œä½ ä¼šè®°åœ¨å¿ƒé‡Œã€‚' },
  { dim: 'C', text: 'ä½ å¸Œæœ›è‡ªå·±åœ¨TAå¿ƒä¸­æ˜¯æ— å¯æ›¿ä»£çš„å­˜åœ¨ã€‚' },

  // ç»´åº¦D - ä»˜å‡ºæ„æ„¿ (7é¢˜): æ„¿æ„ä¸ºå¯¹æ–¹ç‰ºç‰²å’Œä»˜å‡ºçš„ç¨‹åº¦
  { dim: 'D', text: 'ä¸ºäº†TAï¼Œä½ æ„¿æ„æ”¹å˜è‡ªå·±çš„ä¸€äº›ç”Ÿæ´»ä¹ æƒ¯ã€‚' },
  { dim: 'D', text: 'å³ä½¿è‡ªå·±å¾ˆç´¯ï¼Œåªè¦TAéœ€è¦ä½ ï¼Œä½ è¿˜æ˜¯ä¼šèµ¶è¿‡å»ã€‚' },
  { dim: 'D', text: 'ä½ æ„¿æ„æŠŠè‡ªå·±æœ€å–œæ¬¢çš„ä¸œè¥¿é€ç»™TAã€‚' },
  { dim: 'D', text: 'å¦‚æœTAçš„å·¥ä½œæœºä¼šåœ¨å¦ä¸€ä¸ªåŸå¸‚ï¼Œä½ æ„¿æ„è€ƒè™‘ä¸€èµ·æ¬è¿‡å»ã€‚' },
  { dim: 'D', text: 'ä½ ä¼šä¸»åŠ¨è®°ä½TAå–œæ¬¢çš„ä¸œè¥¿ï¼Œåœ¨ç‰¹åˆ«çš„æ—¥å­ç»™TAæƒŠå–œã€‚' },
  { dim: 'D', text: 'å½“TAé‡åˆ°å›°éš¾æ—¶ï¼Œä½ ä¼šæŠŠTAçš„é—®é¢˜å½“æˆè‡ªå·±çš„é—®é¢˜å»è§£å†³ã€‚' },
  { dim: 'D', text: 'ä½ æ„¿æ„ä¸ºäº†ä¸¤ä¸ªäººçš„æœªæ¥ï¼Œç°åœ¨å¤šåƒä¸€äº›è‹¦ã€‚' },

  // ç»´åº¦E - æœªæ¥æ‰¿è¯ºæ„æ„¿ (7é¢˜): æƒ³è¦é•¿æœŸåœ¨ä¸€èµ·çš„æ„æ„¿å¼ºåº¦
  { dim: 'E', text: 'ä½ ç»å¸¸ä¼šæƒ³è±¡å’ŒTAä¸€èµ·ç”Ÿæ´»çš„æœªæ¥ç”»é¢ã€‚' },
  { dim: 'E', text: 'å½“ä½ åšé•¿æœŸè§„åˆ’æ—¶ï¼ˆå¦‚èŒä¸šã€ä¹°æˆ¿ï¼‰ï¼Œä¼šæŠŠTAè€ƒè™‘è¿›å»ã€‚' },
  { dim: 'E', text: 'ä½ å¸Œæœ›æœªæ¥çš„é‡è¦äººç”ŸèŠ‚ç‚¹éƒ½æœ‰TAçš„å‚ä¸ã€‚' },
  { dim: 'E', text: 'ä½ æ„¿æ„å‘å®¶äººå’Œæœ‹å‹æ­£å¼ä»‹ç»TAã€‚' },
  { dim: 'E', text: 'å³ä½¿é‡åˆ°ä¸€äº›çŸ›ç›¾å’Œåˆ†æ­§ï¼Œä½ ä¹Ÿæƒ³å’ŒTAä¸€èµ·è§£å†³è€Œä¸æ˜¯æ”¾å¼ƒã€‚' },
  { dim: 'E', text: 'ä½ è§‰å¾—TAå°±æ˜¯é‚£ä¸ªå¯ä»¥é™ªä½ èµ°å®Œä¸€ç”Ÿçš„äººã€‚' },
  { dim: 'E', text: 'ä½ ä¼šæœŸå¾…å’ŒTAä¸€èµ·åˆ›é€ å±äºä½ ä»¬çš„æ•…äº‹å’Œå›å¿†ã€‚' },

  // ç»´åº¦F - ä¸“ä¸€ç¨‹åº¦ (7é¢˜): å¯¹å½“å‰æ„Ÿæƒ…çš„ä¸“æ³¨åº¦ï¼ˆé«˜åˆ†=æ›´ä¸“ä¸€ï¼‰
  { dim: 'F', text: 'è‡ªä»å¿ƒé‡Œæœ‰äº†TAï¼Œä½ å¯¹å…¶ä»–å¼‚æ€§çš„å…´è¶£æ˜æ˜¾é™ä½äº†ã€‚' },
  { dim: 'F', text: 'å³ä½¿æœ‰æ¡ä»¶æ›´å¥½çš„äººè¿½æ±‚ä½ ï¼Œä½ ä¹Ÿä¸ä¼šåŠ¨å¿ƒã€‚' },
  { dim: 'F', text: 'ä½ è§‰å¾—TAèº«ä¸Šæœ‰ä¸€ç§å…¶ä»–äººéƒ½æ²¡æœ‰çš„ç‰¹åˆ«å¸å¼•åŠ›ã€‚' },
  { dim: 'F', text: 'å½“æœ‹å‹é—®ä½ ç†æƒ³å‹æ—¶ï¼Œä½ è„‘æµ·ä¸­æµ®ç°çš„å°±æ˜¯TAçš„æ ·å­ã€‚' },
  { dim: 'F', text: 'åœ¨äººç¾¤ä¸­ï¼Œä½ çš„ç›®å…‰æ€»æ˜¯ä¼šä¸è‡ªè§‰åœ°å¯»æ‰¾TAã€‚' },
  { dim: 'F', text: 'ä½ è®¤ä¸ºæ‰¾åˆ°çœŸçˆ±æ¯”æ‰¾åˆ°å„æ–¹é¢æ¡ä»¶éƒ½å¥½çš„äººæ›´é‡è¦ã€‚' },
  { dim: 'F', text: 'ä½ ç›¸ä¿¡TAå°±æ˜¯å‘½è¿å®‰æ’ç»™ä½ çš„é‚£ä¸ªäººã€‚' }
];

const dimInfo = {
  'A': { name: 'æƒ…æ„Ÿä¾æ‹', icon: 'ğŸ’•', bg: '#fce7f3', color: '#ec4899', desc: 'å¯¹TAçš„æƒ³å¿µä¸ç‰µæŒ‚' },
  'B': { name: 'ä¸“å±æ¸´æœ›', icon: 'ğŸ‘‘', bg: '#e0e7ff', color: '#6366f1', desc: 'å¸Œæœ›æˆä¸ºTAçš„å”¯ä¸€' },
  'C': { name: 'å®ˆæŠ¤æœ¬èƒ½', icon: 'ğŸ›¡ï¸', bg: '#fef3c7', color: '#f59e0b', desc: 'å¯¹æ„Ÿæƒ…çš„ä¿æŠ¤æ„è¯†' },
  'D': { name: 'ä»˜å‡ºçƒ­å¿±', icon: 'ğŸ', bg: '#d1fae5', color: '#10b981', desc: 'ä¸ºTAå¥‰çŒ®çš„æ„æ„¿' },
  'E': { name: 'æœªæ¥æ†§æ†¬', icon: 'ğŸŒŸ', bg: '#dbeafe', color: '#3b82f6', desc: 'å…±åŒæœªæ¥çš„æœŸç›¼' },
  'F': { name: 'ä¸“ä¸€æ·±åº¦', icon: 'ğŸ’', bg: '#f3e8ff', color: '#a855f7', desc: 'å¿ƒæ— æ—éª›çš„ç¨‹åº¦' }
};

const optionLabels = ['ä¸å¤ªç¬¦åˆ', 'æœ‰ç‚¹ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'éå¸¸ç¬¦åˆ'];

let idx = 0;
let answers = new Array(42).fill(null);

function render() {
  const q = questions[idx];
  const info = dimInfo[q.dim];
  document.getElementById('qNum').textContent = idx + 1;
  document.getElementById('current').textContent = idx + 1;
  document.getElementById('qText').textContent = q.text;
  document.getElementById('progressFill').style.width = ((idx + 1) / 42 * 100) + '%';

  const optDiv = document.getElementById('options');
  optDiv.innerHTML = '';
  optionLabels.forEach((label, i) => {
    const opt = document.createElement('div');
    opt.className = 'opt' + (answers[idx] === i ? ' selected' : '');
    opt.innerHTML = `<div class="opt-radio"></div><div class="opt-text">${label}</div>`;
    opt.onclick = () => selectOption(i);
    optDiv.appendChild(opt);
  });

  document.getElementById('prevBtn').disabled = idx === 0;
  document.getElementById('nextBtn').disabled = answers[idx] === null;
  document.getElementById('nextBtn').innerHTML = idx === 41 ? 'æŸ¥çœ‹ç»“æœ <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>' : 'ä¸‹ä¸€é¢˜ <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
}

function selectOption(val) {
  answers[idx] = val;
  render();
}

function prev() { if (idx > 0) { idx--; render(); } }

function next() {
  if (answers[idx] === null) return;
  if (idx < 41) { idx++; render(); }
  else { showResult(); }
}

function getNavButtons() {
  const source = sessionStorage.getItem('user_source');
  if (source === 'platform') {
    return '<button class="restart-btn secondary" onclick="location.href=\'../platform.html\'">è¿”å›æµ‹è¯„ä¸­å¿ƒ</button>';
  } else {
    return '<button class="restart-btn secondary" onclick="showMoreTests()">æ›´å¤šæµ‹è¯•</button>';
  }
}

function showMoreTests() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `
    <div class="modal-content">
      <div class="modal-icon">ğŸ§‚</div>
      <h3>æ›´å¤šä¸“ä¸šæµ‹è¯„</h3>
      <p>è¯·åœ¨å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€è´­ä¹°å…¶ä»–æµ‹è¯•å“¦~</p>
      <div class="modal-buttons">
        <button class="modal-btn primary" onclick="closeModal()">çŸ¥é“äº†</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add('show'), 10);
}

function closeModal() {
  const modal = document.querySelector('.modal-overlay');
  if (modal) { modal.classList.remove('show'); setTimeout(() => modal.remove(), 300); }
}

function calcScores() {
  const scores = { A: 0, B: 0, C: 0, D: 0, E: 0, F: 0 };
  const counts = { A: 0, B: 0, C: 0, D: 0, E: 0, F: 0 };

  questions.forEach((q, i) => {
    if (answers[i] !== null) {
      scores[q.dim] += answers[i];
      counts[q.dim]++;
    }
  });

  return scores;
}

function getNormalized(scores) {
  // æ¯ä¸ªç»´åº¦7é¢˜ï¼Œæ¯é¢˜0-3åˆ†ï¼Œæ»¡åˆ†21åˆ†
  return {
    A: Math.round(scores.A / 21 * 100),
    B: Math.round(scores.B / 21 * 100),
    C: Math.round(scores.C / 21 * 100),
    D: Math.round(scores.D / 21 * 100),
    E: Math.round(scores.E / 21 * 100),
    F: Math.round(scores.F / 21 * 100)
  };
}

function getTotalLoveScore(norm) {
  // ç»¼åˆçˆ±æƒ…æŒ‡æ•°ï¼šå„ç»´åº¦åŠ æƒå¹³å‡
  const weights = { A: 0.20, B: 0.15, C: 0.10, D: 0.20, E: 0.20, F: 0.15 };
  let total = 0;
  Object.keys(weights).forEach(dim => {
    total += norm[dim] * weights[dim];
  });
  return Math.round(total);
}

function getLoveLevel(score) {
  if (score >= 90) return { level: 'æ·±å…¥éª¨é«“çš„çˆ±', icon: 'ğŸ’–', desc: 'ä½ çš„çˆ±æƒ…å·²ç»èå…¥ç”Ÿå‘½ï¼ŒTAæ˜¯ä½ ç”Ÿæ´»ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†' };
  if (score >= 80) return { level: 'åˆ»éª¨é“­å¿ƒçš„çˆ±', icon: 'ğŸ’', desc: 'ä½ å¯¹TAæœ‰ç€å¼ºçƒˆè€Œæ·±æ²‰çš„æ„Ÿæƒ…ï¼Œæ„¿æ„ä¸ºè¿™ä»½çˆ±å…¨åŠ›ä»¥èµ´' };
  if (score >= 70) return { level: 'çœŸæŒšçƒ­çƒˆçš„çˆ±', icon: 'ğŸ’—', desc: 'ä½ å¯¹TAçš„æ„Ÿæƒ…çœŸè¯šè€Œçƒ­çƒˆï¼Œè¿™ä»½çˆ±æ„æ­£åœ¨èŒå£®æˆé•¿' };
  if (score >= 60) return { level: 'æ¸©æš–ç»µé•¿çš„çˆ±', icon: 'ğŸ’“', desc: 'ä½ å¯¹TAæœ‰ç€ç¨³å®šè€Œæ¸©æš–çš„æ„Ÿæƒ…ï¼Œåƒé˜³å…‰ä¸€æ ·æŒç»­æ¸©æš–' };
  if (score >= 50) return { level: 'èŒèŠ½ä¸­çš„çˆ±', icon: 'ğŸ’•', desc: 'ä½ å¯¹TAçš„æ„Ÿæƒ…æ­£åœ¨ç”Ÿæ ¹å‘èŠ½ï¼Œè¿˜æœ‰å¾ˆå¤§çš„å‘å±•ç©ºé—´' };
  if (score >= 40) return { level: 'æ·¡æ·¡çš„å–œæ¬¢', icon: 'ğŸ’«', desc: 'ä½ å¯¹TAæœ‰å¥½æ„Ÿï¼Œä½†æ„Ÿæƒ…è¿˜å¤„äºæ¢ç´¢é˜¶æ®µ' };
  return { level: 'åˆè¯†çš„å¿ƒåŠ¨', icon: 'âœ¨', desc: 'ä½ å¯¹TAæœ‰ä¸€äº›å¥½å¥‡å’Œæ¬£èµï¼Œæ„Ÿæƒ…æ‰åˆšåˆšå¼€å§‹èŒå‘' };
}

function getLoveType(norm, totalScore) {
  const high = (v) => v >= 70;
  const veryHigh = (v) => v >= 85;
  const moderate = (v) => v >= 50 && v < 70;

  // æ ¹æ®å„ç»´åº¦ç»„åˆåˆ¤æ–­çˆ±æƒ…ç±»å‹
  if (veryHigh(norm.A) && veryHigh(norm.D) && veryHigh(norm.E)) {
    return {
      name: 'å…¨å¿ƒå…¨æ„å‹',
      emoji: 'ğŸ’–',
      desc: 'ä½ æ˜¯ä¸€ä¸ªå…¨èº«å¿ƒæŠ•å…¥çˆ±æƒ…çš„äººã€‚ä½ å¯¹TAçš„çˆ±ä½“ç°åœ¨ç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ï¼šæ— æ—¶æ— åˆ»çš„ç‰µæŒ‚ã€æ¯«æ— ä¿ç•™çš„ä»˜å‡ºã€ä»¥åŠå¯¹æœªæ¥çš„ç¾å¥½æ†§æ†¬ã€‚ä½ çš„çˆ±æƒ…è§‚çº¯ç²¹è€Œçƒ­çƒˆï¼Œç›¸ä¿¡çˆ±å°±è¦çˆ±å¾—å½»åº•ã€‚',
      traits: ['æ·±æƒ…ä¸“æ³¨', 'æ— ç§å¥‰çŒ®', 'æœªæ¥å¯¼å‘', 'æƒ…æ„Ÿä¸°å¯Œ'],
      strength: 'ä½ çš„çœŸè¯šå’ŒæŠ•å…¥ä¼šè®©å¯¹æ–¹æ„Ÿå—åˆ°è¢«çè§†ï¼Œä½ ä»¬çš„æ„Ÿæƒ…åŸºç¡€éå¸¸åšå®ã€‚',
      expression: 'ä½ ä¼šé€šè¿‡å®é™…è¡ŒåŠ¨è¡¨è¾¾çˆ±æ„ï¼Œç…§é¡¾TAçš„ç”Ÿæ´»èµ·å±…ï¼Œè®°ä½TAçš„æ¯ä¸€ä¸ªå–œå¥½ã€‚'
    };
  }

  if (high(norm.B) && high(norm.C) && high(norm.F)) {
    return {
      name: 'ç‹¬å æ·±æƒ…å‹',
      emoji: 'ğŸ‘‘',
      desc: 'ä½ å¯¹çˆ±æƒ…æœ‰ç€å¼ºçƒˆçš„ç‹¬å æ„è¯†ï¼Œå¸Œæœ›æˆä¸ºTAç”Ÿå‘½ä¸­æœ€ç‰¹åˆ«çš„å­˜åœ¨ã€‚è¿™ä¸æ˜¯è‡ªç§ï¼Œè€Œæ˜¯æºäºä½ å¯¹è¿™ä»½æ„Ÿæƒ…çš„é‡è§†å’Œçæƒœã€‚ä½ ç›¸ä¿¡çœŸæ­£çš„çˆ±æƒ…åº”è¯¥æ˜¯ä¸“ä¸€ä¸”æ·±åˆ»çš„ã€‚',
      traits: ['ä¸“ä¸€å¿ è¯š', 'é‡è§†æ‰¿è¯º', 'æ„Ÿæƒ…ä¸“æ³¨', 'å®ˆæŠ¤æ„è¯†å¼º'],
      strength: 'ä½ çš„ä¸“ä¸€å’Œå¿ è¯šæ˜¯æ„Ÿæƒ…ä¸­æœ€å®è´µçš„å“è´¨ï¼Œèƒ½ç»™å¯¹æ–¹å¼ºçƒˆçš„å®‰å…¨æ„Ÿã€‚',
      expression: 'ä½ å–œæ¬¢é€šè¿‡ä»ªå¼æ„Ÿå’Œä¸“å±æ—¶åˆ»æ¥è¡¨è¾¾çˆ±æ„ï¼Œè®©TAçŸ¥é“è‡ªå·±çš„ç‹¬ç‰¹åœ°ä½ã€‚'
    };
  }

  if (high(norm.D) && high(norm.E) && moderate(norm.B)) {
    return {
      name: 'æ¸©æŸ”å®ˆæŠ¤å‹',
      emoji: 'ğŸŒ¸',
      desc: 'ä½ çš„çˆ±æ˜¯æ¸©æŸ”è€ŒæŒä¹…çš„ï¼Œåƒæ˜¥é£ç»†é›¨èˆ¬æ¶¦ç‰©æ— å£°ã€‚ä½ æ„¿æ„ä¸ºTAé»˜é»˜ä»˜å‡ºï¼Œä¸æ±‚å›æŠ¥ï¼Œåªå¸Œæœ›çœ‹åˆ°TAå¹¸ç¦çš„ç¬‘å®¹ã€‚ä½ ç›¸ä¿¡çˆ±æƒ…éœ€è¦ç”¨å¿ƒç»è¥ï¼Œè€Œä¸æ˜¯è½°è½°çƒˆçƒˆã€‚',
      traits: ['ä½“è´´å…¥å¾®', 'è€å¿ƒåŒ…å®¹', 'ç»†æ°´é•¿æµ', 'é»˜é»˜ä»˜å‡º'],
      strength: 'ä½ çš„æ¸©æŸ”å’Œè€å¿ƒèƒ½è®©æ„Ÿæƒ…æŒä¹…ç¨³å®šï¼Œæ˜¯å€¼å¾—ä¿¡èµ–çš„ä¼´ä¾£ã€‚',
      expression: 'ä½ ä¼šåœ¨æ—¥å¸¸å°äº‹ä¸­è¡¨è¾¾çˆ±æ„ï¼Œä¸€æ¯çƒ­èŒ¶ã€ä¸€æ¡é—®å€™ï¼Œéƒ½æ˜¯ä½ çš„çˆ±è¯­ã€‚'
    };
  }

  if (high(norm.A) && high(norm.F) && moderate(norm.C)) {
    return {
      name: 'æµªæ¼«ç—´æƒ…å‹',
      emoji: 'ğŸŒ¹',
      desc: 'ä½ æ˜¯ä¸€ä¸ªæµªæ¼«çš„çµé­‚ï¼Œç›¸ä¿¡çˆ±æƒ…æ˜¯ä¸–é—´æœ€ç¾å¥½çš„äº‹ç‰©ã€‚ä½ å¯¹TAçš„çˆ±å……æ»¡è¯—æ„å’Œæµªæ¼«ï¼Œåœ¨ä½ çœ¼ä¸­TAæœ‰ç€ç‹¬ä¸€æ— äºŒçš„å…‰èŠ’ã€‚ä½ äº«å—æ‹çˆ±çš„æ¯ä¸€ä¸ªç”œèœœç¬é—´ã€‚',
      traits: ['æµªæ¼«å¤šæƒ…', 'æ„Ÿæ€§ç»†è…»', 'è¿½æ±‚ç¾å¥½', 'æƒ…æ„Ÿä¸°å¯Œ'],
      strength: 'ä½ çš„æµªæ¼«å’Œçƒ­æƒ…èƒ½è®©æ„Ÿæƒ…å……æ»¡è‰²å½©ï¼Œç”Ÿæ´»å› ä½ è€Œç²¾å½©ã€‚',
      expression: 'ä½ å–„äºç”¨æ–‡å­—ã€ç¤¼ç‰©ã€æƒŠå–œæ¥è¡¨è¾¾çˆ±æ„ï¼Œæ¯ä¸ªçºªå¿µæ—¥éƒ½ç²¾å¿ƒå‡†å¤‡ã€‚'
    };
  }

  if (high(norm.E) && high(norm.D) && moderate(norm.A)) {
    return {
      name: 'æˆç†Ÿç¨³é‡å‹',
      emoji: 'ğŸ ',
      desc: 'ä½ å¯¹çˆ±æƒ…æœ‰ç€æˆç†Ÿçš„ç†è§£ï¼ŒçŸ¥é“çœŸæ­£çš„çˆ±æƒ…éœ€è¦è´£ä»»å’Œæ‰¿è¯ºã€‚ä½ ä¸ä»…äº«å—å½“ä¸‹çš„ç”œèœœï¼Œæ›´ç€çœ¼äºæœªæ¥çš„å…±åŒç”Ÿæ´»ã€‚ä½ æ˜¯ä¸€ä¸ªå¯é çš„ä¼´ä¾£ï¼Œå€¼å¾—æ‰˜ä»˜ç»ˆèº«ã€‚',
      traits: ['æœ‰è´£ä»»å¿ƒ', 'ç›®æ ‡æ˜ç¡®', 'è¡ŒåŠ¨æ´¾', 'è¸å®å¯é '],
      strength: 'ä½ çš„æˆç†Ÿå’Œç¨³é‡èƒ½ç»™å¯¹æ–¹è¶³å¤Ÿçš„å®‰å…¨æ„Ÿï¼Œè®©TAæ— åé¡¾ä¹‹å¿§ã€‚',
      expression: 'ä½ é€šè¿‡è§„åˆ’æœªæ¥ã€è§£å†³å®é™…é—®é¢˜æ¥è¡¨è¾¾çˆ±æ„ï¼Œè¡ŒåŠ¨èƒœäºç”œè¨€èœœè¯­ã€‚'
    };
  }

  if (high(norm.A) && high(norm.C) && moderate(norm.F)) {
    return {
      name: 'çƒ­æƒ…ç‚½çƒˆå‹',
      emoji: 'ğŸ”¥',
      desc: 'ä½ çš„çˆ±æƒ…çƒ­çƒˆè€Œå¼ºçƒˆï¼Œåƒä¸€å›¢ç‡ƒçƒ§çš„ç«ç„°ã€‚ä½ å¯¹TAæœ‰ç€å¼ºçƒˆçš„æƒ…æ„Ÿä¾æ‹ï¼Œä¸å…è®¸ä»»ä½•äººå¨èƒä½ ä»¬çš„æ„Ÿæƒ…ã€‚è¿™ä»½ç‚½çƒ­æºäºä½ å¯¹è¿™æ®µå…³ç³»çš„é«˜åº¦é‡è§†ã€‚',
      traits: ['çƒ­æƒ…å¦‚ç«', 'æ„Ÿæƒ…å¼ºçƒˆ', 'ç›´æ¥å¦ç‡', 'æœ‰è¡ŒåŠ¨åŠ›'],
      strength: 'ä½ çš„çƒ­æƒ…å’Œä¸»åŠ¨ä¼šè®©æ„Ÿæƒ…ä¿æŒæ´»åŠ›ï¼Œæ°¸è¿œä¸ä¼šå¹³æ·¡æ— è¶£ã€‚',
      expression: 'ä½ ä¼šç›´æ¥è¡¨è¾¾çˆ±æ„ï¼Œå¤§å£°è¯´å‡º"æˆ‘çˆ±ä½ "ï¼Œè®©TAæ—¶åˆ»æ„Ÿå—ä½ çš„çƒ­æƒ…ã€‚'
    };
  }

  if (moderate(norm.A) && moderate(norm.D) && moderate(norm.E) && moderate(norm.F)) {
    return {
      name: 'å‡è¡¡ç†æ€§å‹',
      emoji: 'âš–ï¸',
      desc: 'ä½ åœ¨çˆ±æƒ…ä¸­ä¿æŒç€è‰¯å¥½çš„å¹³è¡¡ï¼Œæ—¢æœ‰æ„Ÿæ€§çš„æµªæ¼«ï¼Œä¹Ÿæœ‰ç†æ€§çš„æ€è€ƒã€‚ä½ æ‡‚å¾—çˆ±è‡ªå·±çš„åŒæ—¶ä¹Ÿçˆ±å¯¹æ–¹ï¼Œåœ¨æ„Ÿæƒ…ä¸­ä¿æŒç‹¬ç«‹è€Œä¸å¤±æ¸©åº¦ã€‚',
      traits: ['ç†æ€§æµªæ¼«', 'ç‹¬ç«‹è‡ªä¸»', 'æ‡‚å¾—å¹³è¡¡', 'æƒ…å•†é«˜'],
      strength: 'ä½ çš„å¹³è¡¡æ„Ÿè®©æ„Ÿæƒ…å¥åº·æŒä¹…ï¼Œä¸ä¼šè¿‡åº¦ä¾èµ–ä¹Ÿä¸ä¼šè¿‡äºç–ç¦»ã€‚',
      expression: 'ä½ ä¼šæ ¹æ®å¯¹æ–¹çš„éœ€æ±‚è°ƒæ•´è¡¨è¾¾æ–¹å¼ï¼Œæ˜¯ä¸€ä¸ªè´´å¿ƒçš„ä¼´ä¾£ã€‚'
    };
  }

  if (high(norm.F) && high(norm.E)) {
    return {
      name: 'çµé­‚ä¼´ä¾£å‹',
      emoji: 'ğŸ¦‹',
      desc: 'ä½ ç›¸ä¿¡TAå°±æ˜¯å‘½è¿å®‰æ’ç»™ä½ çš„é‚£ä¸ªäººï¼Œæ˜¯ä½ çš„çµé­‚ä¼´ä¾£ã€‚ä½ ä»¬ä¹‹é—´æœ‰ç€è¶…è¶Šè¨€è¯­çš„é»˜å¥‘å’Œè¿æ¥ï¼Œä½ å¯¹æœªæ¥å……æ»¡æœŸå¾…ï¼Œç›¸ä¿¡ä½ ä»¬èƒ½æºæ‰‹èµ°è¿‡äººç”Ÿçš„æ¯ä¸€ä¸ªé˜¶æ®µã€‚',
      traits: ['ç›¸ä¿¡ç¼˜åˆ†', 'ç²¾ç¥å…±é¸£', 'æœªæ¥å¯¼å‘', 'æ·±åº¦è¿æ¥'],
      strength: 'ä½ å¯¹çµé­‚ä¼´ä¾£çš„åšä¿¡ä¼šè®©ä½ ä»¬çš„æ„Ÿæƒ…æœ‰ç€ç²¾ç¥å±‚é¢çš„æ·±åº¦è¿æ¥ã€‚',
      expression: 'ä½ è¿½æ±‚å¿ƒçµçš„äº¤æµå’Œå…±é¸£ï¼Œå–œæ¬¢åˆ†äº«å†…å¿ƒä¸–ç•Œå’Œäººç”Ÿæ„Ÿæ‚Ÿã€‚'
    };
  }

  if (high(norm.D) && moderate(norm.A)) {
    return {
      name: 'æ— ç§å¥‰çŒ®å‹',
      emoji: 'ğŸ',
      desc: 'ä½ çš„çˆ±æ˜¯æ— ç§çš„ï¼Œæ€»æ˜¯æŠŠTAçš„éœ€æ±‚æ”¾åœ¨è‡ªå·±ä¹‹å‰ã€‚ä½ åœ¨ä»˜å‡ºä¸­è·å¾—å¿«ä¹ï¼Œçœ‹åˆ°TAå¹¸ç¦å°±æ˜¯ä½ æœ€å¤§çš„æ»¡è¶³ã€‚è¿™ç§çˆ±æºäºä½ å†…å¿ƒçš„å–„è‰¯å’Œå¯¹TAçš„çè§†ã€‚',
      traits: ['ä¹äºå¥‰çŒ®', 'ä½“è´´å‘¨åˆ°', 'ä¸æ±‚å›æŠ¥', 'æ¸©æš–å–„è‰¯'],
      strength: 'ä½ çš„æ— ç§å¥‰çŒ®ä¼šè®©å¯¹æ–¹æ„Ÿå—åˆ°çœŸæ­£è¢«çˆ±çš„æ¸©æš–ã€‚',
      expression: 'ä½ é€šè¿‡ç…§é¡¾å’Œå¸®åŠ©æ¥è¡¨è¾¾çˆ±æ„ï¼Œæ°¸è¿œæŠŠTAçš„éœ€æ±‚æ”¾åœ¨é¦–ä½ã€‚'
    };
  }

  // é»˜è®¤ç±»å‹
  return {
    name: 'çœŸè¯šæ¢ç´¢å‹',
    emoji: 'ğŸŒ±',
    desc: 'ä½ æ­£åœ¨ç”¨å¿ƒæ„Ÿå—å’Œæ¢ç´¢è¿™ä»½æ„Ÿæƒ…ï¼Œå¯¹TAçš„çˆ±è¿˜åœ¨ä¸æ–­åŠ æ·±å’Œæˆé•¿ã€‚æ¯ä¸€ä»½çœŸæŒšçš„æ„Ÿæƒ…éƒ½éœ€è¦æ—¶é—´æ¥åŸ¹è‚²ï¼Œä½ æ­£èµ°åœ¨çˆ±çš„æ—…ç¨‹ä¸Šã€‚',
    traits: ['çœŸè¯šç”¨å¿ƒ', 'å¼€æ”¾æˆé•¿', 'æ…¢æ…¢äº†è§£', 'æ½œåŠ›æ— é™'],
    strength: 'ä½ çš„çœŸè¯šå’Œå¼€æ”¾ä¼šè®©æ„Ÿæƒ…è‡ªç„¶è€Œç„¶åœ°å‘å±•ï¼Œå€¼å¾—æœŸå¾…ã€‚',
    expression: 'ä½ åœ¨æ…¢æ…¢å­¦ä¹ å¦‚ä½•è¡¨è¾¾çˆ±æ„ï¼Œæ¯ä¸€æ¬¡å°è¯•éƒ½æ˜¯æˆé•¿ã€‚'
  };
}

function getDimAnalysis(dim, score) {
  const analyses = {
    A: {
      high: 'ä½ å¯¹TAæœ‰ç€æ·±æ·±çš„æƒ…æ„Ÿä¾æ‹ï¼ŒTAå·²ç»æˆä¸ºä½ ç”Ÿæ´»ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚æ¯ä¸€å¤©çš„æƒ³å¿µã€æ¯ä¸€åˆ»çš„ç‰µæŒ‚ï¼Œéƒ½è¯æ˜ç€ä½ ç”¨å¿ƒåœ¨çˆ±ã€‚è¿™ç§æ·±åº¦çš„æƒ…æ„Ÿè¿æ¥æ˜¯çˆ±æƒ…æœ€ç¾å¥½çš„éƒ¨åˆ†ï¼Œçæƒœè¿™ç§å¿ƒå¿ƒç›¸å°çš„æ„Ÿè§‰ã€‚',
      medium: 'ä½ å¯¹TAæœ‰ç¨³å®šè€Œæ¸©æš–çš„æ„Ÿæƒ…ï¼Œä¼šåœ¨åˆé€‚çš„æ—¶å€™æƒ³èµ·TAï¼Œä½†ä¹Ÿèƒ½ä¿æŒè‡ªå·±çš„ç”Ÿæ´»èŠ‚å¥ã€‚è¿™æ˜¯ä¸€ç§å¥åº·çš„ä¾æ‹æ¨¡å¼ï¼Œæ—¢æœ‰äº²å¯†çš„è¿æ¥ï¼Œåˆæœ‰ç‹¬ç«‹çš„ç©ºé—´ã€‚',
      low: 'ä½ å¯¹TAçš„æ„Ÿæƒ…è¡¨è¾¾ç›¸å¯¹å«è“„å†…æ•›ï¼Œä¹Ÿè®¸ä½ æ›´ä¹ æƒ¯æŠŠçˆ±æ”¾åœ¨å¿ƒé‡Œã€‚æ¯ä¸ªäººè¡¨è¾¾çˆ±çš„æ–¹å¼ä¸åŒï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œä½ å¯èƒ½ä¼šé€æ¸æ•å¼€å¿ƒæ‰‰ï¼Œè®©è¿™ä»½æ„Ÿæƒ…æ›´åŠ æ·±åšã€‚'
    },
    B: {
      high: 'ä½ å¸Œæœ›æˆä¸ºTAç”Ÿå‘½ä¸­æœ€é‡è¦çš„äººï¼Œè¿™ä»½ä¸“å±æ¸´æœ›ä½“ç°äº†ä½ å¯¹è¿™æ®µæ„Ÿæƒ…çš„é‡è§†ã€‚ä½ æ„¿æ„ç”¨å¿ƒç»è¥å±äºä½ ä»¬çš„å°ä¸–ç•Œï¼Œå¸Œæœ›å»ºç«‹ç‹¬ç‰¹è€Œæ·±åˆ»çš„è¿æ¥ã€‚è¿™æ˜¯çˆ±æƒ…ä¸­æœ€çè´µçš„æœŸç›¼ã€‚',
      medium: 'ä½ å¯¹TAæœ‰ä¸€å®šçš„ä¸“å±æœŸå¾…ï¼Œå¸Œæœ›åœ¨TAå¿ƒä¸­å æœ‰ç‰¹åˆ«çš„ä½ç½®ã€‚åŒæ—¶ä½ ä¹Ÿå°Šé‡å½¼æ­¤çš„ä¸ªäººç©ºé—´ï¼Œæ‡‚å¾—çˆ±æƒ…éœ€è¦ä¿¡ä»»å’Œè‡ªç”±ç›¸è¾…ç›¸æˆã€‚',
      low: 'ä½ å¯¹äºæ„Ÿæƒ…ä¸­çš„ä¸“å±æ€§è¦æ±‚ä¸é«˜ï¼Œæ›´çœ‹é‡å½¼æ­¤çš„ç†è§£å’Œä¿¡ä»»ã€‚ä½ ç›¸ä¿¡çœŸæ­£çš„çˆ±æƒ…ä¸éœ€è¦ç”¨å æœ‰æ¥è¯æ˜ï¼Œè¿™æ˜¯ä¸€ç§è±è¾¾çš„çˆ±æƒ…è§‚ã€‚'
    },
    C: {
      high: 'ä½ å¯¹è¿™ä»½æ„Ÿæƒ…æœ‰ç€å¼ºçƒˆçš„ä¿æŠ¤æ„è¯†ï¼Œä¼šæœ¬èƒ½åœ°å…³æ³¨å¯èƒ½å½±å“ä½ ä»¬å…³ç³»çš„å› ç´ ã€‚è¿™ç§å®ˆæŠ¤æœ¬èƒ½æºäºä½ å¯¹TAçš„æ·±çˆ±ï¼Œè¯´æ˜è¿™æ®µæ„Ÿæƒ…å¯¹ä½ æ¥è¯´éå¸¸é‡è¦ï¼Œä½ ä¸æ„¿æ„å¤±å»ã€‚',
      medium: 'ä½ å¯¹æ„Ÿæƒ…ä¿æŒé€‚åº¦çš„è­¦è§‰ï¼Œä¼šå…³æ³¨ä¸€äº›ä¿¡å·ä½†ä¸ä¼šè¿‡åº¦ç´§å¼ ã€‚ä½ æ‡‚å¾—ä¿¡ä»»æ˜¯çˆ±æƒ…çš„åŸºç¡€ï¼ŒåŒæ—¶ä¹Ÿä¼šä¿æŠ¤å¥½è¿™ä»½çè´µçš„æ„Ÿæƒ…ã€‚',
      low: 'ä½ å¯¹è¿™æ®µæ„Ÿæƒ…éå¸¸æœ‰ä¿¡å¿ƒï¼Œç›¸ä¿¡ä½ ä»¬ä¹‹é—´çš„ä¿¡ä»»æ˜¯åšä¸å¯æ‘§çš„ã€‚è¿™ç§å®‰å…¨æ„Ÿè®©ä½ ä»¬çš„å…³ç³»æ›´åŠ è½»æ¾è‡ªåœ¨ï¼Œæ˜¯æ„Ÿæƒ…æˆç†Ÿçš„è¡¨ç°ã€‚'
    },
    D: {
      high: 'ä½ æ„¿æ„ä¸ºTAä»˜å‡ºä¸€åˆ‡ï¼ŒæŠŠTAçš„å¹¸ç¦å½“ä½œè‡ªå·±çš„è´£ä»»ã€‚ä½ çš„çˆ±æ˜¯æ— ç§çš„ã€æ˜¯ä¸»åŠ¨çš„ã€æ˜¯ä¸è®¡å›æŠ¥çš„ã€‚è¿™ç§ä»˜å‡ºçš„çƒ­å¿±æ˜¯æœ€æ·±æ²‰çš„çˆ±çš„è¡¨è¾¾ï¼Œè®©TAæ„Ÿå—åˆ°è¢«å…¨å¿ƒå…¨æ„åœ°çæƒœã€‚',
      medium: 'ä½ æ„¿æ„ä¸ºTAä»˜å‡ºï¼ŒåŒæ—¶ä¹Ÿæ‡‚å¾—ç…§é¡¾å¥½è‡ªå·±ã€‚ä½ ç›¸ä¿¡å¥åº·çš„çˆ±æƒ…æ˜¯ç›¸äº’ä»˜å‡ºã€å…±åŒæˆé•¿çš„ï¼Œè¿™æ˜¯ä¸€ç§æˆç†Ÿçš„çˆ±æƒ…æ€åº¦ã€‚',
      low: 'ä½ åœ¨ä»˜å‡ºæ–¹é¢ç›¸å¯¹è°¨æ…ï¼Œå–œæ¬¢å…ˆè§‚å¯Ÿå†è¡ŒåŠ¨ã€‚è¿™ä¸æ˜¯ä¸çˆ±ï¼Œè€Œæ˜¯ä½ ä¹ æƒ¯ç”¨æ›´ç†æ€§çš„æ–¹å¼ç»è¥æ„Ÿæƒ…ã€‚éšç€æ„Ÿæƒ…åŠ æ·±ï¼Œä½ ä¼šæ‰¾åˆ°é€‚åˆè‡ªå·±çš„ä»˜å‡ºæ–¹å¼ã€‚'
    },
    E: {
      high: 'ä½ å·²ç»å¼€å§‹æ†§æ†¬å’ŒTAå…±åŒçš„æœªæ¥ï¼Œæ— è®ºæ˜¯æ—¥å¸¸ç”Ÿæ´»è¿˜æ˜¯äººç”Ÿå¤§äº‹ï¼Œä½ éƒ½å¸Œæœ›æœ‰TAçš„å‚ä¸ã€‚è¿™ç§å¯¹æœªæ¥çš„æ‰¿è¯ºæ˜¯çˆ±æƒ…æœ€æœ‰åŠ›çš„è¯æ˜ï¼Œè¯´æ˜ä½ å·²ç»å‡†å¤‡å¥½å’ŒTAæºæ‰‹èµ°è¿‡æ¼«é•¿å²æœˆã€‚',
      medium: 'ä½ å¯¹å’ŒTAçš„æœªæ¥æœ‰ç¾å¥½çš„æœŸå¾…ï¼ŒåŒæ—¶ä¹Ÿåœ¨ç”¨å¿ƒç»è¥å½“ä¸‹ã€‚ä½ ç›¸ä¿¡å¥½çš„æœªæ¥æ˜¯ç”±æ¯ä¸€ä¸ªç”¨å¿ƒçš„ç°åœ¨ç´¯ç§¯è€Œæˆçš„ï¼Œè¿™æ˜¯åŠ¡å®è€Œæ¸©æš–çš„çˆ±ã€‚',
      low: 'ä½ æ›´ä¸“æ³¨äºäº«å—å½“ä¸‹çš„æ„Ÿæƒ…ï¼Œå¯¹äºé¥è¿œçš„æœªæ¥è¿˜æ²¡æœ‰å¤ªå¤šè§„åˆ’ã€‚æ¯æ®µæ„Ÿæƒ…éƒ½æœ‰è‡ªå·±çš„èŠ‚å¥ï¼Œä¹Ÿè®¸éšç€ä½ ä»¬çš„æ•…äº‹ç»§ç»­ï¼Œæœªæ¥çš„å›¾æ™¯ä¼šé€æ¸æ¸…æ™°ã€‚'
    },
    F: {
      high: 'è‡ªä»é‡è§TAï¼Œä½ çš„ä¸–ç•Œé‡Œå°±åªæœ‰TAä¸€ä¸ªäººã€‚è¿™ç§ä¸“ä¸€æ˜¯æœ€çº¯ç²¹çš„çˆ±çš„ä½“ç°ï¼Œè¯´æ˜TAåœ¨ä½ å¿ƒä¸­çœŸçš„æ— å¯æ›¿ä»£ã€‚ä½ çš„çœ¼é‡Œåªæœ‰TAï¼Œè¿™æ˜¯å¤šä¹ˆçè´µçš„æ·±æƒ…ã€‚',
      medium: 'ä½ å¯¹TAå¾ˆä¸“å¿ƒï¼Œè™½ç„¶å¶å°”ä¹Ÿä¼šæ¬£èµå…¶ä»–äººçš„ä¼˜ç‚¹ï¼Œä½†å¿ƒé‡Œæœ€é‡è¦çš„ä½ç½®ä¸€ç›´æ˜¯TAçš„ã€‚è¿™æ˜¯å¥åº·è€ŒçœŸå®çš„çŠ¶æ€ï¼Œçˆ±ä¸å¿…ä¸ä¸–éš”ç»ã€‚',
      low: 'ä½ å¯¹æ„Ÿæƒ…ä¿æŒå¼€æ”¾çš„æ€åº¦ï¼Œå¯èƒ½è¿˜åœ¨ç¡®è®¤è‡ªå·±çš„å¿ƒæ„ã€‚ç»™è‡ªå·±ä¸€äº›æ—¶é—´ï¼Œå½“ä½ é‡åˆ°é‚£ä¸ªè®©ä½ å¿ƒæ— æ—éª›çš„äººï¼Œä½ ä¼šçŸ¥é“çš„ã€‚'
    }
  };

  const analysis = analyses[dim];
  if (score >= 70) return analysis.high;
  if (score >= 40) return analysis.medium;
  return analysis.low;
}

function getDimLevel(score) {
  if (score >= 70) return { level: 'æµ“çƒˆ', class: 'level-high' };
  if (score >= 40) return { level: 'æ¸©å’Œ', class: 'level-medium' };
  return { level: 'å«è“„', class: 'level-low' };
}

function getAdvice(norm, loveType, totalScore) {
  const tips = [];

  if (totalScore >= 80) {
    tips.push('ä½ çš„çˆ±å¦‚æ­¤æ·±æ²‰ï¼Œè®°å¾—ä¹Ÿè¦ç…§é¡¾å¥½è‡ªå·±çš„æ„Ÿå—ï¼Œå¥åº·çš„çˆ±æƒ…æ˜¯ç›¸äº’æ»‹å…»çš„');
    tips.push('å¯ä»¥å’ŒTAåˆ†äº«ä½ å¯¹è¿™æ®µæ„Ÿæƒ…çš„çè§†ï¼Œè®©TAçŸ¥é“è‡ªå·±æœ‰å¤šå¹¸ç¦');
    tips.push('ä¿æŒè¿™ä»½çƒ­æƒ…çš„åŒæ—¶ï¼Œä¹Ÿç»™å½¼æ­¤ç•™ä¸€äº›ä¸ªäººæˆé•¿çš„ç©ºé—´');
  } else if (totalScore >= 60) {
    tips.push('ä½ ä»¬çš„æ„Ÿæƒ…æ­£åœ¨ç¨³æ­¥å‘å±•ï¼Œç»§ç»­ç”¨å¿ƒç»è¥è¿™ä»½ç¾å¥½');
    tips.push('å°è¯•åˆ›é€ æ›´å¤šå…±åŒçš„å›å¿†ï¼Œè®©æ„Ÿæƒ…åœ¨ç‚¹æ»´ä¸­åŠ æ·±');
    tips.push('å­¦ä¼šæ›´ç›´æ¥åœ°è¡¨è¾¾çˆ±æ„ï¼Œè®©TAæ„Ÿå—åˆ°ä½ çš„å¿ƒæ„');
  } else {
    tips.push('æ„Ÿæƒ…éœ€è¦æ—¶é—´åŸ¹è‚²ï¼Œä¸å¿…ç€æ€¥ï¼Œæ…¢æ…¢æ„Ÿå—å½¼æ­¤');
    tips.push('å¤šåˆ›é€ ä¸€äº›ç›¸å¤„çš„æœºä¼šï¼Œåœ¨äº’åŠ¨ä¸­äº†è§£å¯¹æ–¹');
    tips.push('æ•å¼€å¿ƒæ‰‰ï¼Œè®©è‡ªå·±æ›´æŠ•å…¥åœ°å»æ„Ÿå—è¿™ä»½æ„Ÿæƒ…');
  }

  if (norm.A < 50) {
    tips.push('å¯ä»¥æ›´é¢‘ç¹åœ°è”ç³»TAï¼Œåˆ†äº«ä½ çš„æ—¥å¸¸ï¼Œå¢åŠ æƒ…æ„Ÿè¿æ¥');
  }
  if (norm.D < 50) {
    tips.push('å°è¯•ä¸»åŠ¨ä¸ºTAåšä¸€äº›äº‹æƒ…ï¼Œä»˜å‡ºæœ¬èº«ä¹Ÿæ˜¯ä¸€ç§å¹¸ç¦');
  }
  if (norm.E < 50) {
    tips.push('å’ŒTAèŠèŠå¯¹æœªæ¥çš„æƒ³æ³•ï¼Œå…±åŒçš„ç›®æ ‡ä¼šè®©æ„Ÿæƒ…æ›´æœ‰æ–¹å‘');
  }

  return tips.slice(0, 5);
}

function getCompatibleTraits(loveType, norm) {
  const traits = [];

  if (norm.A >= 70) {
    traits.push('å–„äºæƒ…æ„Ÿå›åº”ï¼Œèƒ½æ•æ„Ÿåœ°å¯Ÿè§‰ä½ çš„éœ€æ±‚');
    traits.push('å–œæ¬¢è¡¨è¾¾çˆ±æ„ï¼Œè®©ä½ æ—¶åˆ»æ„Ÿå—è¢«çˆ±');
  }
  if (norm.B >= 70) {
    traits.push('ä¸“ä¸€å¿ è¯šï¼Œè®©ä½ æœ‰è¶³å¤Ÿçš„å®‰å…¨æ„Ÿ');
    traits.push('é‡è§†æ‰¿è¯ºï¼Œæ„¿æ„ä¸ºä½ ä»¬çš„æœªæ¥è´Ÿè´£');
  }
  if (norm.D >= 70) {
    traits.push('æ‡‚å¾—æ¥å—çˆ±ï¼Œèƒ½æ¬£èµä½ çš„ä»˜å‡º');
    traits.push('ä¹Ÿæ„¿æ„ä¸ºä½ ä»˜å‡ºï¼Œè®©çˆ±åŒå‘æµåŠ¨');
  }
  if (norm.E >= 70) {
    traits.push('æœ‰å…±åŒçš„æœªæ¥è§„åˆ’å’Œäººç”Ÿç›®æ ‡');
    traits.push('æ„¿æ„ä¸€èµ·é¢å¯¹ç”Ÿæ´»çš„æŒ‘æˆ˜');
  }
  if (norm.F >= 70) {
    traits.push('åŒæ ·ä¸“ä¸€æ·±æƒ…ï¼Œçœ¼é‡Œå¿ƒé‡Œéƒ½æ˜¯ä½ ');
  }

  if (traits.length < 4) {
    traits.push('ç†è§£ä½ çš„çˆ±æƒ…è§‚ï¼Œèƒ½ä¸ä½ äº§ç”Ÿå…±é¸£');
    traits.push('æ„¿æ„å’Œä½ ä¸€èµ·æˆé•¿ï¼Œå…±åŒç»è¥æ„Ÿæƒ…');
    traits.push('æ€§æ ¼äº’è¡¥ï¼Œèƒ½ç»™ä½ å¸¦æ¥æ–°çš„è§†è§’');
  }

  return traits.slice(0, 5);
}

function getPartnerArchetype(norm, loveType) {
  // ç†æƒ³ä¼´ä¾£æ„å‹åˆ†æ
  const avgScore = (norm.A + norm.B + norm.C + norm.D + norm.E + norm.F) / 6;

  // å¹´é¾„åå¥½åˆ†æ
  let agePreference = '';
  if (norm.D >= 70 && norm.E >= 70) {
    agePreference = { type: 'å¹´ä¸Šä¼´ä¾£', icon: 'ğŸ‘”', desc: 'ä½ å€¾å‘äºè¢«ç…§é¡¾å’Œä¿æŠ¤ï¼Œæˆç†Ÿç¨³é‡çš„å¹´ä¸Šä¼´ä¾£èƒ½ç»™ä½ å®‰å…¨æ„Ÿå’Œæ–¹å‘æ„Ÿã€‚TAçš„äººç”Ÿé˜…å†å’Œæƒ…æ„Ÿç¨³å®šæ€§ä¼šè®©ä½ æ„Ÿåˆ°å®‰å¿ƒã€‚' };
  } else if (norm.A >= 70 && norm.B >= 70 && norm.C < 60) {
    agePreference = { type: 'åŒé¾„ä¼´ä¾£', icon: 'ğŸ¤', desc: 'ä½ æœŸå¾…ä¸€æ®µå¹³ç­‰äº’åŠ©çš„å…³ç³»ï¼ŒåŒé¾„ä¼´ä¾£èƒ½ä¸ä½ æœ‰æ›´å¤šå…±åŒè¯é¢˜å’Œæˆé•¿ç»å†ï¼Œä½ ä»¬å¯ä»¥ä¸€èµ·é¢å¯¹äººç”Ÿçš„å„ä¸ªé˜¶æ®µã€‚' };
  } else if (norm.D >= 70 && norm.B < 60) {
    agePreference = { type: 'å¹´ä¸‹ä¼´ä¾£', icon: 'ğŸŒ±', desc: 'ä½ æœ‰å¼ºçƒˆçš„ç…§é¡¾æ¬²å’Œä»˜å‡ºæ„æ„¿ï¼Œå¹´ä¸‹ä¼´ä¾£èƒ½è®©ä½ å‘æŒ¥ä¿æŠ¤è€…çš„è§’è‰²ï¼Œåœ¨ä»˜å‡ºä¸­è·å¾—æ»¡è¶³æ„Ÿã€‚' };
  } else {
    agePreference = { type: 'å¹´é¾„ä¸æ˜¯å…³é”®', icon: 'ğŸ’«', desc: 'å¯¹ä½ è€Œè¨€ï¼Œå¹´é¾„å·®è·ä¸æ˜¯é€‰æ‹©ä¼´ä¾£çš„å…³é”®å› ç´ ï¼Œå¿ƒçµå¥‘åˆå’Œç›¸äº’ç†è§£æ‰æ˜¯æœ€é‡è¦çš„ã€‚' };
  }

  // ç†æƒ³ä¼´ä¾£æ„å‹
  let archetype = '';
  if (norm.A >= 75 && norm.F >= 75) {
    archetype = { type: 'çµé­‚å…±é¸£å‹', icon: 'ğŸ¦‹', desc: 'ä½ çš„ç†æƒ³ä¼´ä¾£æ˜¯èƒ½ä¸ä½ å¿ƒçµç›¸é€šçš„äººã€‚TAä¸éœ€è¦æ—¶åˆ»é™ªä¼´ï¼Œä½†æ¯æ¬¡äº¤æµéƒ½èƒ½è§¦åŠçµé­‚æ·±å¤„ã€‚ä½ ä»¬ä¹‹é—´æœ‰ç€æ— éœ€è¨€è¯­çš„é»˜å¥‘ã€‚', traits: ['æ·±åº¦æ€è€ƒè€…', 'æƒ…æ„Ÿä¸°å¯Œ', 'é‡è§†ç²¾ç¥è¿æ¥', 'ç‹¬ç«‹è€Œæ·±æƒ…'] };
  } else if (norm.D >= 75 && norm.E >= 75) {
    archetype = { type: 'äººç”Ÿä¼´ä¾£å‹', icon: 'ğŸ ', desc: 'ä½ çš„ç†æƒ³ä¼´ä¾£æ˜¯èƒ½ä¸ä½ å…±å»ºæœªæ¥çš„äººã€‚TAè¦æœ‰è´£ä»»å¿ƒã€æœ‰æ‹…å½“ï¼Œæ„¿æ„å’Œä½ ä¸€èµ·è§„åˆ’ç”Ÿæ´»ã€é¢å¯¹æŒ‘æˆ˜ã€æºæ‰‹å‰è¡Œã€‚', traits: ['æœ‰è´£ä»»å¿ƒ', 'ç›®æ ‡æ˜ç¡®', 'è¸å®å¯é ', 'é‡è§†æ‰¿è¯º'] };
  } else if (norm.B >= 75 && norm.C >= 70) {
    archetype = { type: 'ç‹¬å æŒšçˆ±å‹', icon: 'ğŸ‘‘', desc: 'ä½ çš„ç†æƒ³ä¼´ä¾£æ˜¯åªå±äºä½ çš„äººã€‚TAä¸“ä¸€å¿ è¯šï¼Œçœ¼é‡Œåªæœ‰ä½ ï¼Œèƒ½ç»™ä½ ç»å¯¹çš„å®‰å…¨æ„Ÿå’Œå½’å±æ„Ÿã€‚ä½ ä»¬çš„çˆ±æ˜¯æ’ä»–ä¸”æ·±åˆ»çš„ã€‚', traits: ['ä¸“ä¸€å¿ è¯š', 'é‡è§†è¾¹ç•Œ', 'ç»™äºˆå®‰å…¨æ„Ÿ', 'æ·±åº¦æŠ•å…¥'] };
  } else if (norm.A >= 70 && norm.D >= 70) {
    archetype = { type: 'æ¸©æš–æ¸¯æ¹¾å‹', icon: 'ğŸŒ…', desc: 'ä½ çš„ç†æƒ³ä¼´ä¾£æ˜¯ä½ çš„æƒ…æ„Ÿé¿é£æ¸¯ã€‚TAæ¸©æŸ”ä½“è´´ï¼Œå–„è§£äººæ„ï¼Œèƒ½åœ¨ä½ ç–²æƒ«æ—¶ç»™ä½ ä¾é ï¼Œåœ¨ä½ è„†å¼±æ—¶ç»™ä½ åŠ›é‡ã€‚', traits: ['æ¸©æŸ”ä½“è´´', 'å–„äºå€¾å¬', 'æƒ…ç»ªç¨³å®š', 'åŒ…å®¹ç†è§£'] };
  } else if (norm.E >= 70 && norm.F >= 70) {
    archetype = { type: 'å‘½å®šä¹‹äººå‹', icon: 'âœ¨', desc: 'ä½ çš„ç†æƒ³ä¼´ä¾£æ˜¯é‚£ä¸ª"å¯¹çš„äºº"ã€‚TAä¸€å‡ºç°ä½ å°±çŸ¥é“æ˜¯TAï¼Œä½ ä»¬ä¹‹é—´æœ‰ç€å‘½ä¸­æ³¨å®šçš„ç¼˜åˆ†æ„Ÿï¼Œæ„¿æ„ä¸ºå½¼æ­¤ä»˜å‡ºä¸€åˆ‡ã€‚', traits: ['ç›¸ä¿¡ç¼˜åˆ†', 'å…¨å¿ƒæŠ•å…¥', 'ç›´è§‰æ•é”', 'æµªæ¼«çƒ­çƒˆ'] };
  } else {
    archetype = { type: 'æˆé•¿ä¼™ä¼´å‹', icon: 'ğŸŒ±', desc: 'ä½ çš„ç†æƒ³ä¼´ä¾£æ˜¯èƒ½ä¸ä½ å…±åŒæˆé•¿çš„äººã€‚TAä¸å¿…å®Œç¾ï¼Œä½†è¦æ„¿æ„å’Œä½ ä¸€èµ·è¿›æ­¥ã€ä¸€èµ·æ¢ç´¢ã€ä¸€èµ·å˜æˆæ›´å¥½çš„äººã€‚', traits: ['å¼€æ”¾å¿ƒæ€', 'æ„¿æ„æˆé•¿', 'ç›¸äº’æ”¯æŒ', 'åŒ…å®¹å·®å¼‚'] };
  }

  return { agePreference, archetype };
}

function showResult() {
  document.getElementById('testPage').classList.remove('active');
  document.getElementById('resultPage').classList.add('active');

  const scores = calcScores();
  const norm = getNormalized(scores);
  const totalScore = getTotalLoveScore(norm);
  const loveLevel = getLoveLevel(totalScore);
  const loveType = getLoveType(norm, totalScore);
  const advice = getAdvice(norm, loveType, totalScore);
  const compatibleTraits = getCompatibleTraits(loveType, norm);
  const partnerArchetype = getPartnerArchetype(norm, loveType);

  document.getElementById('resultContent').innerHTML = `
    <div class="result-header">
      <h1>çˆ±æƒ…æ·±åº¦æµ‹è¯„æŠ¥å‘Š</h1>
      <p>ç”¨æ•°æ®è§£è¯»ä½ å¿ƒä¸­çš„é‚£ä»½çˆ±</p>
    </div>

    <div class="card">
      <div class="score-hero">
        <div class="score-label">ä½ çš„çˆ±æƒ…æŒ‡æ•°</div>
        <div><span class="score-number">${totalScore}</span><span class="score-suffix">åˆ†</span></div>
        <div class="score-title">${loveLevel.icon} ${loveLevel.level}</div>
        <div class="score-desc">${loveLevel.desc}</div>
      </div>

      <div class="love-meter">
        <div class="meter-bar">
          <div class="meter-fill" style="width: ${totalScore}%"></div>
        </div>
        <div class="meter-labels">
          <span>åˆè¯†å¿ƒåŠ¨</span>
          <span>å–œæ¬¢</span>
          <span>çˆ±</span>
          <span>æ·±çˆ±</span>
          <span>æŒšçˆ±</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="type-card">
        <div class="type-label">ä½ çš„çˆ±æƒ…ç±»å‹</div>
        <div class="type-name">${loveType.emoji} ${loveType.name}</div>
        <div class="type-desc">${loveType.desc}</div>
      </div>

      <div class="trait-grid">
        ${loveType.traits.map(t => `
          <div class="trait-item">
            <div class="trait-value">${t}</div>
          </div>
        `).join('')}
      </div>

      <div class="highlight-box">
        <p><strong>ä½ çš„çˆ±æƒ…ä¼˜åŠ¿ï¼š</strong>${loveType.strength}</p>
      </div>
      <div class="highlight-box" style="background: #f0fdf4;">
        <p><strong>ä½ çš„çˆ±æƒ…è¡¨è¾¾ï¼š</strong>${loveType.expression}</p>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#fce7f3">ğŸ“Š</div>çˆ±æƒ…å…­ç»´é›·è¾¾å›¾</div>
      <div class="chart-wrap"><canvas id="radarChart"></canvas></div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#dbeafe">ğŸ’•</div>å…­å¤§ç»´åº¦æ·±åº¦è§£è¯»</div>
      ${Object.entries(dimInfo).map(([dim, info]) => {
        const score = norm[dim];
        const level = getDimLevel(score);
        return `
          <div class="dim-item">
            <div class="dim-header">
              <div class="dim-name"><div class="dim-icon" style="background:${info.bg}">${info.icon}</div>${info.name}</div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span class="level-badge ${level.class}">${level.level}</span>
                <span style="font-weight:600;color:${info.color};">${score}</span>
              </div>
            </div>
            <div class="dim-bar"><div class="dim-bar-fill" style="width:${score}%;background:${info.color}"></div></div>
            <div style="font-size:13px;color:var(--text-muted);line-height:1.7;margin-top:12px;">${getDimAnalysis(dim, score)}</div>
          </div>
        `;
      }).join('')}
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#d1fae5">ğŸ’‘</div>æœ€å¥‘åˆä½ çš„ä¼´ä¾£ç‰¹è´¨</div>
      <div class="summary-text">
        æ ¹æ®ä½ çš„çˆ±æƒ…é£æ ¼åˆ†æï¼Œä»¥ä¸‹ç±»å‹çš„ä¼´ä¾£ä¼šè®©ä½ ä»¬çš„æ„Ÿæƒ…æ›´åŠ å’Œè°ç¾æ»¡ï¼š
      </div>
      <div class="partner-card">
        <h4>ç†æƒ³ä¼´ä¾£ç‰¹è´¨</h4>
        <ul class="partner-list">
          ${compatibleTraits.map(t => `<li>${t}</li>`).join('')}
        </ul>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#f3e8ff">ğŸ’˜</div>ä¼´ä¾£å¥‘åˆæ·±åº¦åˆ†æ</div>

      <div class="type-card" style="background: linear-gradient(135deg, #fef3c7 0%, #fce7f3 100%); margin-bottom: 16px;">
        <div class="type-label">ä½ å€¾å‘çš„ä¼´ä¾£å¹´é¾„</div>
        <div class="type-name">${partnerArchetype.agePreference.icon} ${partnerArchetype.agePreference.type}</div>
        <div class="type-desc">${partnerArchetype.agePreference.desc}</div>
      </div>

      <div class="type-card" style="background: linear-gradient(135deg, #dbeafe 0%, #f3e8ff 100%);">
        <div class="type-label">ä½ çš„ç†æƒ³ä¼´ä¾£æ„å‹</div>
        <div class="type-name">${partnerArchetype.archetype.icon} ${partnerArchetype.archetype.type}</div>
        <div class="type-desc">${partnerArchetype.archetype.desc}</div>
      </div>

      <div class="trait-grid" style="margin-top: 16px;">
        ${partnerArchetype.archetype.traits.map(t => `
          <div class="trait-item" style="background: linear-gradient(135deg, #fff5f7 0%, #faf5ff 100%);">
            <div class="trait-value" style="color: #ec4899;">ğŸ’• ${t}</div>
          </div>
        `).join('')}
      </div>

      <div class="insight-card" style="background: linear-gradient(135deg, #fce7f3 0%, #e0e7ff 100%); margin-top: 16px;">
        <h4>ğŸ”® ä¼´ä¾£åŒ¹é…æ´å¯Ÿ</h4>
        <p>åŸºäºä½ çš„çˆ±æƒ…æ¨¡å¼åˆ†æï¼Œ${partnerArchetype.agePreference.type === 'å¹´é¾„ä¸æ˜¯å…³é”®' ? 'å¹´é¾„å¯¹ä½ æ¥è¯´ä¸æ˜¯æ‹©å¶çš„å…³é”®å› ç´ ï¼Œä½ æ›´çœ‹é‡å†…åœ¨çš„å¥‘åˆåº¦ã€‚' : `ä½ æ›´å®¹æ˜“è¢«${partnerArchetype.agePreference.type}å¸å¼•ï¼Œè¿™ä¸ä½ åœ¨æ„Ÿæƒ…ä¸­çš„è§’è‰²å®šä½æœ‰å…³ã€‚`}ä½ çš„ç†æƒ³ä¼´ä¾£æ˜¯${partnerArchetype.archetype.type}ï¼ŒTAèƒ½æ»¡è¶³ä½ å†…å¿ƒæ·±å¤„å¯¹äº²å¯†å…³ç³»çš„æ ¸å¿ƒéœ€æ±‚ï¼Œè®©ä½ åœ¨çˆ±æƒ…ä¸­è·å¾—çœŸæ­£çš„æ»¡è¶³æ„Ÿå’Œå¹¸ç¦æ„Ÿã€‚</p>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#fef3c7">âœ¨</div>è®©çˆ±æƒ…æ›´ç¾å¥½çš„å»ºè®®</div>
      ${advice.map((tip, i) => `
        <div class="tip-item">
          <div class="tip-num">${i + 1}</div>
          <div class="tip-text">${tip}</div>
        </div>
      `).join('')}

      <div class="insight-card">
        <h4>ğŸ’¡ çˆ±çš„çœŸè°›</h4>
        <p>çˆ±æƒ…æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„çˆ±çš„æ–¹å¼ã€‚æ— è®ºä½ çš„å¾—åˆ†é«˜ä½ï¼Œåªè¦æ˜¯çœŸå¿ƒçš„ä»˜å‡ºï¼Œéƒ½æ˜¯æœ€çè´µçš„ç¤¼ç‰©ã€‚ç»§ç»­ç”¨å¿ƒå»çˆ±ï¼Œç”¨å¿ƒè¢«çˆ±ï¼Œè®©è¿™ä»½æ„Ÿæƒ…æˆä¸ºä½ ç”Ÿå‘½ä¸­æœ€ç¾çš„é£æ™¯ã€‚</p>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#e0e7ff">ğŸŒˆ</div>çˆ±æƒ…èƒ½é‡åˆ†å¸ƒ</div>
      <div class="summary-text" style="text-align:center;margin-bottom:16px;">
        ä½ çš„çˆ±æƒ…èƒ½é‡é›†ä¸­ä½“ç°åœ¨ä»¥ä¸‹æ–¹é¢
      </div>
      <div class="trait-grid">
        <div class="trait-item">
          <div class="trait-icon">ğŸ’•</div>
          <div class="trait-label">æƒ…æ„Ÿä¾æ‹</div>
          <div class="trait-value">${norm.A}%</div>
        </div>
        <div class="trait-item">
          <div class="trait-icon">ğŸ‘‘</div>
          <div class="trait-label">ä¸“å±æ¸´æœ›</div>
          <div class="trait-value">${norm.B}%</div>
        </div>
        <div class="trait-item">
          <div class="trait-icon">ğŸ›¡ï¸</div>
          <div class="trait-label">å®ˆæŠ¤æœ¬èƒ½</div>
          <div class="trait-value">${norm.C}%</div>
        </div>
        <div class="trait-item">
          <div class="trait-icon">ğŸ</div>
          <div class="trait-label">ä»˜å‡ºçƒ­å¿±</div>
          <div class="trait-value">${norm.D}%</div>
        </div>
        <div class="trait-item">
          <div class="trait-icon">ğŸŒŸ</div>
          <div class="trait-label">æœªæ¥æ†§æ†¬</div>
          <div class="trait-value">${norm.E}%</div>
        </div>
        <div class="trait-item">
          <div class="trait-icon">ğŸ’</div>
          <div class="trait-label">ä¸“ä¸€æ·±åº¦</div>
          <div class="trait-value">${norm.F}%</div>
        </div>
      </div>
    </div>

    <div class="action-btns">
      <button class="restart-btn primary" onclick="downloadPDF()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
        ä¸‹è½½PDFæŠ¥å‘Š
      </button>
      ${getNavButtons()}
    </div>
  `;

  // ç»˜åˆ¶é›·è¾¾å›¾
  const ctx = document.getElementById('radarChart').getContext('2d');
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['æƒ…æ„Ÿä¾æ‹', 'ä¸“å±æ¸´æœ›', 'å®ˆæŠ¤æœ¬èƒ½', 'ä»˜å‡ºçƒ­å¿±', 'æœªæ¥æ†§æ†¬', 'ä¸“ä¸€æ·±åº¦'],
      datasets: [{
        label: 'å¾—åˆ†',
        data: [norm.A, norm.B, norm.C, norm.D, norm.E, norm.F],
        backgroundColor: 'rgba(236, 72, 153, 0.2)',
        borderColor: '#ec4899',
        borderWidth: 2,
        pointBackgroundColor: '#ec4899'
      }]
    },
    options: {
      scales: {
        r: {
          beginAtZero: true,
          max: 100,
          ticks: { stepSize: 25 }
        }
      },
      plugins: { legend: { display: false } }
    }
  });
}

async function downloadPDF() {
  const btn = event.target.closest('button');
  const loading = document.getElementById('loading');
  btn.disabled = true;
  btn.innerHTML = 'ç”Ÿæˆä¸­...';
  loading.classList.add('show');

  try {
    const { jsPDF } = window.jspdf;
    const content = document.getElementById('resultContent');

    await new Promise(r => setTimeout(r, 500));

    const canvas = await html2canvas(content, {
      scale: 2,
      useCORS: true,
      logging: false,
      backgroundColor: '#f8fafc',
      height: content.scrollHeight,
      windowHeight: content.scrollHeight
    });
    const imgData = canvas.toDataURL('image/jpeg', 0.95);

    const pdf = new jsPDF('p', 'mm', 'a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    const imgWidth = pdfWidth - 20;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    let heightLeft = imgHeight;
    let position = 10;

    pdf.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
    heightLeft -= (pdfHeight - 20);

    while (heightLeft > 0) {
      position = heightLeft - imgHeight + 10;
      pdf.addPage();
      pdf.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
      heightLeft -= (pdfHeight - 20);
    }

    const date = new Date().toLocaleDateString('zh-CN').replace(/\//g, '-');
    pdf.save(`çˆ±æƒ…æ·±åº¦æµ‹è¯„æŠ¥å‘Š_${date}.pdf`);
  } catch (e) {
    console.error(e);
    alert('PDFç”Ÿæˆå¤±è´¥');
  } finally {
    btn.disabled = false;
    btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> ä¸‹è½½PDFæŠ¥å‘Š';
    loading.classList.remove('show');
  }
}

render();
</script>
</body>
</html>
