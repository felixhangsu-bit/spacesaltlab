<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„ | å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root { --primary: #6366f1; --primary-dark: #4f46e5; --primary-light: #a5b4fc; --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --text-muted: #64748b; --border: #e2e8f0; --shadow: 0 4px 20px rgba(0,0,0,0.08); --radius: 16px; }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans SC', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
.page { display: none; min-height: 100vh; }
.page.active { display: block; }
#testPage { background: var(--bg); padding: 20px; }
.test-container { max-width: 700px; margin: 0 auto; }
.test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.back-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: all 0.2s; }
.back-btn:hover { background: white; color: var(--text); }
.progress-wrap { text-align: right; }
.progress-text { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
.progress-bar { width: 180px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--gradient); border-radius: 3px; transition: width 0.3s; }
.question-card { background: var(--card); border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); }
.dim-tag { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-bottom: 16px; }
.q-num { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.q-text { font-size: 20px; font-weight: 600; line-height: 1.5; margin-bottom: 32px; }
.options { display: flex; flex-direction: column; gap: 12px; }
.opt { display: flex; align-items: center; gap: 14px; padding: 16px 20px; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
.opt:hover { border-color: var(--primary-light); background: #fafaff; }
.opt.selected { border-color: var(--primary); background: linear-gradient(135deg, #ede9fe 0%, #e0e7ff 100%); }
.opt-radio { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
.opt.selected .opt-radio { border-color: var(--primary); background: var(--primary); }
.opt.selected .opt-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
.opt-text { font-size: 15px; }
.nav-btns { display: flex; justify-content: space-between; margin-top: 28px; }
.nav-btn { padding: 12px 28px; border-radius: 10px; font-size: 15px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
.nav-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.nav-btn.secondary:hover { border-color: var(--primary); color: var(--primary); }
.nav-btn.primary { background: var(--primary); border: none; color: white; }
.nav-btn.primary:hover { background: var(--primary-dark); }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
#resultPage { background: linear-gradient(180deg, #667eea 0%, #764ba2 40%, var(--bg) 40%); }
.result-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
.result-header { text-align: center; color: white; padding: 20px 0 60px; }
.result-header h1 { font-size: 28px; margin-bottom: 8px; }
.card { background: var(--card); border-radius: var(--radius); padding: 32px; box-shadow: var(--shadow); margin-bottom: 20px; }
.section-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 16px; }
.section-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
.resilience-score { font-size: 64px; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
.resilience-level { text-align: center; padding: 8px 24px; background: var(--gradient); color: white; border-radius: 20px; display: inline-block; margin: 16px auto; font-weight: 600; }
.stress-indicator { background: linear-gradient(135deg, #fef2f2 0%, #fff7ed 100%); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
.stress-bar { height: 12px; background: #e2e8f0; border-radius: 6px; overflow: hidden; margin: 16px 0; }
.stress-fill { height: 100%; border-radius: 6px; transition: width 0.5s; }
.stat-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-top: 20px; }
.stat-card { padding: 16px 12px; background: #f8fafc; border-radius: 12px; text-align: center; }
.stat-value { font-size: 22px; font-weight: 700; color: var(--primary); }
.stat-label { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
.dim-item { margin-bottom: 20px; }
.dim-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.dim-name { display: flex; align-items: center; gap: 8px; font-weight: 500; }
.dim-icon { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
.dim-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; margin-bottom: 12px; }
.dim-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
.level-badge { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; }
.level-high { background: #d1fae5; color: #059669; }
.level-medium { background: #fef3c7; color: #d97706; }
.level-low { background: #fee2e2; color: #dc2626; }
.coping-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 16px; }
.coping-card { padding: 20px; border-radius: 14px; }
.coping-card.positive { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); }
.coping-card.negative { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); }
.coping-title { font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
.coping-list { font-size: 13px; color: var(--text-muted); line-height: 1.8; }
.tip-item { display: flex; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--primary); }
.tip-num { width: 26px; height: 26px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; flex-shrink: 0; }
.tip-text { font-size: 14px; color: var(--text-muted); line-height: 1.6; }
.warning-box { background: linear-gradient(135deg, #fef2f2 0%, #fff7ed 100%); border: 1px solid #fecaca; border-radius: 14px; padding: 20px; margin-top: 20px; }
.warning-title { font-weight: 600; color: #dc2626; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
.download-section { text-align: center; padding: 32px; }
.download-btn { display: inline-flex; align-items: center; gap: 10px; padding: 14px 28px; background: var(--gradient); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
.restart-btn { display: inline-flex; align-items: center; gap: 6px; margin-top: 14px; padding: 10px 20px; background: transparent; border: 2px solid var(--border); border-radius: 10px; font-size: 13px; color: var(--text-muted); cursor: pointer; }
.loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: all 0.3s; }
.loading.show { opacity: 1; visibility: visible; }
.loading-box { background: white; padding: 36px; border-radius: 16px; text-align: center; }
.spinner { width: 44px; height: 44px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
@keyframes spin { to { transform: rotate(360deg); } }
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: all 0.3s; }
.modal-overlay.show { opacity: 1; visibility: visible; }
.modal-content { background: white; padding: 36px; border-radius: 20px; max-width: 400px; width: 90%; text-align: center; transform: scale(0.9); transition: transform 0.3s; }
.modal-overlay.show .modal-content { transform: scale(1); }
.modal-icon { font-size: 48px; margin-bottom: 16px; }
.modal-content h3 { font-size: 22px; font-weight: 700; margin-bottom: 12px; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.modal-tests { background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
.modal-test-item { padding: 10px; font-size: 14px; color: var(--text); border-bottom: 1px solid var(--border); }
.modal-test-item:last-child { border-bottom: none; }
.modal-buttons { display: flex; flex-direction: column; gap: 10px; }
.modal-btn { padding: 14px 24px; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; border: none; }
.modal-btn.primary { background: var(--gradient); color: white; }
.modal-btn.secondary { background: transparent; border: 2px solid var(--border); color: var(--text-muted); }
.more-tests-btn { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-color: #f59e0b; color: #92400e; }
.chart-container { max-width: 350px; margin: 20px auto; }
@media (max-width: 640px) { .stat-grid { grid-template-columns: repeat(3, 1fr); } .coping-grid { grid-template-columns: 1fr; } .question-card { padding: 28px 20px; } }
</style>
</head>
<body>
<div id="testPage" class="page active">
  <div class="test-container">
    <div class="test-header">
      <button class="back-btn" onclick="exitTest()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>é€€å‡ºæµ‹è¯•</button>
      <div class="progress-wrap">
        <div class="progress-text"><span id="current">1</span> / 35</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      </div>
    </div>
    <div class="question-card">
      <div class="dim-tag" id="dimTag">å‹åŠ›æ„ŸçŸ¥</div>
      <div class="q-num">é—®é¢˜ <span id="qNum">1</span></div>
      <div class="q-text" id="qText"></div>
      <div class="options" id="options"></div>
      <div class="nav-btns">
        <button class="nav-btn secondary" id="prevBtn" onclick="prevQ()">ä¸Šä¸€é¢˜</button>
        <button class="nav-btn primary" id="nextBtn" onclick="nextQ()">ä¸‹ä¸€é¢˜</button>
      </div>
    </div>
  </div>
</div>

<div id="resultPage" class="page">
  <div class="result-container">
    <div class="result-header"><h1>ğŸŒ¿ å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„æŠ¥å‘Š</h1><p>å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</p></div>
    <div id="resultContent"></div>
  </div>
</div>

<div class="loading" id="loading"><div class="loading-box"><div class="spinner"></div><p>æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...</p></div></div>

<script>
// 35é“å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„é¢˜ç›®
const questions = [
  // å‹åŠ›æ„ŸçŸ¥ Stress (7é¢˜) - åå‘è®¡åˆ†
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°æ— æ³•æ§åˆ¶ç”Ÿæ´»ä¸­é‡è¦äº‹æƒ…çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['ä»ä¸', 'å¶å°”', 'æœ‰æ—¶', 'ç»å¸¸', 'æ€»æ˜¯'], reverse: true },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ å¯¹å¤„ç†ä¸ªäººé—®é¢˜æ„Ÿåˆ°æœ‰ä¿¡å¿ƒçš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['æ€»æ˜¯', 'ç»å¸¸', 'æœ‰æ—¶', 'å¶å°”', 'ä»ä¸'], reverse: false },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°äº‹æƒ…è¿›å±•é¡ºåˆ©çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['æ€»æ˜¯', 'ç»å¸¸', 'æœ‰æ—¶', 'å¶å°”', 'ä»ä¸'], reverse: false },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°å›°éš¾å †ç§¯å¦‚å±±ã€æ— æ³•å…‹æœçš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['ä»ä¸', 'å¶å°”', 'æœ‰æ—¶', 'ç»å¸¸', 'æ€»æ˜¯'], reverse: true },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ èƒ½å¤ŸæˆåŠŸåº”å¯¹æ—¥å¸¸çƒ¦æ¼çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['æ€»æ˜¯', 'ç»å¸¸', 'æœ‰æ—¶', 'å¶å°”', 'ä»ä¸'], reverse: false },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°ç´§å¼ å’Œå‹åŠ›çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['ä»ä¸', 'å¶å°”', 'æœ‰æ—¶', 'ç»å¸¸', 'æ€»æ˜¯'], reverse: true },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°èƒ½å¤ŸæŒæ§è‡ªå·±ç”Ÿæ´»çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['æ€»æ˜¯', 'ç»å¸¸', 'æœ‰æ—¶', 'å¶å°”', 'ä»ä¸'], reverse: false },

  // æƒ…ç»ªéŸ§æ€§ Emotional (7é¢˜)
  { dim: 'emotional', text: 'é‡åˆ°æŒ«æŠ˜åï¼Œæˆ‘é€šå¸¸èƒ½è¾ƒå¿«æ¢å¤æƒ…ç»ª', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'é¢å¯¹å›°éš¾æ—¶ï¼Œæˆ‘èƒ½ä¿æŒç§¯æä¹è§‚çš„æ€åº¦', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'å½“æ„Ÿåˆ°æ²®ä¸§æ—¶ï¼Œæˆ‘æœ‰æœ‰æ•ˆçš„æ–¹æ³•è®©è‡ªå·±æŒ¯ä½œ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'æˆ‘èƒ½å¤Ÿæ¥å—ç”Ÿæ´»ä¸­çš„ä¸ç¡®å®šæ€§', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'ç»å†å¤±è´¥åï¼Œæˆ‘ä»ç„¶ç›¸ä¿¡è‡ªå·±èƒ½å¤ŸæˆåŠŸ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'æˆ‘èƒ½å¤Ÿä»å›°éš¾ç»å†ä¸­æ‰¾åˆ°ç§¯æçš„æ„ä¹‰', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'é¢å¯¹å‹åŠ›æ—¶ï¼Œæˆ‘å¾ˆå°‘æ„Ÿåˆ°å®Œå…¨å´©æºƒ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },

  // è®¤çŸ¥çµæ´» Cognitive (7é¢˜)
  { dim: 'cognitive', text: 'å½“ä¸€ç§æ–¹æ³•ä¸å¥æ•ˆæ—¶ï¼Œæˆ‘ä¼šå°è¯•å…¶ä»–æ–¹æ³•', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'æˆ‘èƒ½å¤Ÿä»ä¸åŒè§’åº¦çœ‹å¾…é—®é¢˜', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'é¢å¯¹å˜åŒ–ï¼Œæˆ‘èƒ½å¤Ÿè°ƒæ•´è‡ªå·±çš„è®¡åˆ’å’Œé¢„æœŸ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'æˆ‘ç›¸ä¿¡å¤§å¤šæ•°é—®é¢˜éƒ½æœ‰è§£å†³åŠæ³•', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'æˆ‘èƒ½å¤ŸåŒºåˆ†å¯æ§å’Œä¸å¯æ§çš„äº‹æƒ…', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'é‡åˆ°å›°å¢ƒæ—¶ï¼Œæˆ‘ä¼šæ€è€ƒå¯ä»¥å­¦åˆ°ä»€ä¹ˆ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'æˆ‘ä¸ä¼šè¿‡åº¦çº ç»“äºå·²ç»å‘ç”Ÿçš„äº‹æƒ…', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },

  // ç¤¾ä¼šæ”¯æŒ Social (7é¢˜)
  { dim: 'social', text: 'å½“æˆ‘éœ€è¦å¸®åŠ©æ—¶ï¼Œæœ‰äººå¯ä»¥ä¾é ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'æˆ‘æœ‰å¯ä»¥å€¾è¯‰çƒ¦æ¼çš„äº²å¯†æœ‹å‹æˆ–å®¶äºº', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'æˆ‘æ„Ÿåˆ°è¢«å‘¨å›´çš„äººå…³å¿ƒå’Œæ”¯æŒ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'é‡åˆ°å›°éš¾æ—¶ï¼Œæˆ‘æ„¿æ„å¯»æ±‚ä»–äººçš„å¸®åŠ©', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'æˆ‘æœ‰å½’å±æ„Ÿè¾ƒå¼ºçš„ç¤¾ç¾¤æˆ–å›¢ä½“', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'æˆ‘çš„äººé™…å…³ç³»èƒ½å¤Ÿç»™æˆ‘åŠ›é‡å’Œæ”¯æŒ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'åœ¨æˆ‘ç”Ÿæ´»ä¸­ï¼Œæœ‰äººçœŸæ­£ç†è§£æˆ‘', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },

  // è‡ªæˆ‘æ•ˆèƒ½ Efficacy (7é¢˜)
  { dim: 'efficacy', text: 'æˆ‘ç›¸ä¿¡è‡ªå·±æœ‰èƒ½åŠ›åº”å¯¹ç”Ÿæ´»ä¸­çš„æŒ‘æˆ˜', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'é¢å¯¹å›°éš¾ä»»åŠ¡æ—¶ï¼Œæˆ‘ç›¸ä¿¡è‡ªå·±èƒ½å¤Ÿå®Œæˆ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'è¿‡å»çš„æˆåŠŸç»å†è®©æˆ‘å¯¹æœªæ¥æœ‰ä¿¡å¿ƒ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'æˆ‘çŸ¥é“è‡ªå·±çš„ä¼˜åŠ¿å’Œèƒ½åŠ›æ‰€åœ¨', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'å³ä½¿æƒ…å†µå›°éš¾ï¼Œæˆ‘ä¹Ÿç›¸ä¿¡è‡ªå·±èƒ½æ‰¾åˆ°å‡ºè·¯', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'æˆ‘ç›¸ä¿¡åŠªåŠ›ä¼šå¸¦æ¥ç§¯æçš„ç»“æœ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'æˆ‘æœ‰æ˜ç¡®çš„ç›®æ ‡å’Œå®ç°ç›®æ ‡çš„è®¡åˆ’', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] }
];

const dimInfo = {
  'stress': { name: 'å‹åŠ›æ°´å¹³', icon: 'ğŸ”¥', bg: '#fee2e2', color: '#ef4444' },
  'emotional': { name: 'æƒ…ç»ªéŸ§æ€§', icon: 'ğŸ’ª', bg: '#d1fae5', color: '#10b981' },
  'cognitive': { name: 'è®¤çŸ¥çµæ´»', icon: 'ğŸ§ ', bg: '#dbeafe', color: '#3b82f6' },
  'social': { name: 'ç¤¾ä¼šæ”¯æŒ', icon: 'ğŸ¤', bg: '#fef3c7', color: '#f59e0b' },
  'efficacy': { name: 'è‡ªæˆ‘æ•ˆèƒ½', icon: 'â­', bg: '#fce7f3', color: '#ec4899' }
};

const RESILIENCE_LEVELS = [
  { min: 100, level: 'é«˜éŸ§æ€§', color: '#059669', desc: 'ä½ å…·æœ‰å¾ˆå¼ºçš„å¿ƒç†éŸ§æ€§ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåº”å¯¹å‹åŠ›å’Œé€†å¢ƒã€‚ä½ æœ‰è‰¯å¥½çš„æƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›ã€çµæ´»çš„æ€ç»´æ–¹å¼å’Œå……è¶³çš„ç¤¾ä¼šæ”¯æŒã€‚ç»§ç»­ä¿æŒï¼' },
  { min: 80, level: 'è‰¯å¥½éŸ§æ€§', color: '#3b82f6', desc: 'ä½ çš„å¿ƒç†éŸ§æ€§å¤„äºè‰¯å¥½æ°´å¹³ï¼Œå¤§å¤šæ•°æ—¶å€™èƒ½å¤Ÿæœ‰æ•ˆåº”å¯¹å‹åŠ›ã€‚é€šè¿‡æŒç»­ç»ƒä¹ ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥æå‡æŠ—å‹èƒ½åŠ›ã€‚' },
  { min: 60, level: 'ä¸­ç­‰éŸ§æ€§', color: '#f59e0b', desc: 'ä½ çš„å¿ƒç†éŸ§æ€§å¤„äºä¸­ç­‰æ°´å¹³ï¼Œåœ¨æŸäº›å‹åŠ›æƒ…å¢ƒä¸‹å¯èƒ½ä¼šæ„Ÿåˆ°åƒåŠ›ã€‚å»ºè®®æœ‰é’ˆå¯¹æ€§åœ°æå‡è–„å¼±ç¯èŠ‚ã€‚' },
  { min: 0, level: 'å¾…æå‡', color: '#ef4444', desc: 'ä½ çš„å¿ƒç†éŸ§æ€§æœ‰è¾ƒå¤§æå‡ç©ºé—´ã€‚å»ºè®®ä»å»ºç«‹ç¤¾ä¼šæ”¯æŒç½‘ç»œã€å­¦ä¹ æƒ…ç»ªè°ƒèŠ‚æŠ€å·§å¼€å§‹ï¼Œé€æ­¥æå‡æŠ—å‹èƒ½åŠ›ã€‚' }
];

let idx = 0;
let answers = new Array(35).fill(null);
const dims = questions.map(q => q.dim);

function render() {
  const q = questions[idx];
  const info = dimInfo[q.dim];
  document.getElementById('current').textContent = idx + 1;
  document.getElementById('qNum').textContent = idx + 1;
  document.getElementById('progressFill').style.width = ((idx + 1) / 35 * 100) + '%';
  document.getElementById('dimTag').textContent = info.name;
  document.getElementById('dimTag').style.background = info.bg;
  document.getElementById('dimTag').style.color = info.color;
  document.getElementById('qText').textContent = q.text;

  let optHtml = '';
  q.options.forEach((opt, i) => {
    const selected = answers[idx] === i ? 'selected' : '';
    optHtml += `<div class="opt ${selected}" onclick="select(${i})"><div class="opt-radio"></div><div class="opt-text">${opt}</div></div>`;
  });
  document.getElementById('options').innerHTML = optHtml;
  document.getElementById('prevBtn').disabled = idx === 0;
  document.getElementById('nextBtn').textContent = idx === 34 ? 'æŸ¥çœ‹ç»“æœ' : 'ä¸‹ä¸€é¢˜';
}

function select(v) { answers[idx] = v; render(); if (idx < 34) setTimeout(() => nextQ(), 250); }
function prevQ() { if (idx > 0) { idx--; render(); } }
function nextQ() {
  if (answers[idx] === null) { alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€‰é¡¹'); return; }
  if (idx < 34) { idx++; render(); } else showResult();
}

function exitTest() { if (confirm('ç¡®å®šé€€å‡ºï¼Ÿç­”æ¡ˆå°†ä¸ä¼šä¿å­˜ã€‚')) { goToHome(); } }
function goToHome() {
  const userSource = sessionStorage.getItem('user_source');
  if (userSource === 'platform') { window.location.href = '../platform.html'; }
  else { window.location.href = 'index.html'; }
}
function getHomeButtonHtml() {
  const userSource = sessionStorage.getItem('user_source');
  if (userSource === 'platform') { return '<button class="restart-btn" onclick="goToHome()" style="margin-left:8px">è¿”å›æµ‹è¯•ä¸­å¿ƒ</button>'; }
  else { return '<button class="restart-btn more-tests-btn" onclick="showMoreTests()" style="margin-left:8px">æ›´å¤šæµ‹è¯•</button>'; }
}
function showMoreTests() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `<div class="modal-content"><div class="modal-icon">ğŸ§‚</div><h3>è§£é”æ›´å¤šä¸“ä¸šæµ‹è¯„</h3><p>å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€æä¾›å¤šç§å¿ƒç†æµ‹è¯„å·¥å…·ï¼š</p><div class="modal-tests"><div class="modal-test-item">ğŸ’• äº²å¯†å…³ç³»å¿ƒç†æµ‹è¯„</div><div class="modal-test-item">ğŸ’¼ èŒä¸šæ€§æ ¼æµ‹è¯„</div><div class="modal-test-item">ğŸ§  æƒ…ç»ªæ™ºåŠ›æµ‹è¯„</div></div><p style="color:var(--primary);font-size:13px;margin-bottom:20px;">è´­ä¹°æµ‹è¯„åˆé›†ï¼Œè§£é”å…¨éƒ¨æµ‹è¯„å†…å®¹</p><div class="modal-buttons"><button class="modal-btn primary" onclick="contactAdvisor()">è”ç³»é¡¾é—®å’¨è¯¢</button><button class="modal-btn secondary" onclick="closeModal()">æš‚ä¸éœ€è¦</button></div></div>`;
  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add('show'), 10);
}
function contactAdvisor() { alert('è¯·æ·»åŠ é¡¾é—®å¾®ä¿¡å’¨è¯¢è´­ä¹°åˆé›†'); closeModal(); }
function closeModal() { const modal = document.querySelector('.modal-overlay'); if (modal) { modal.classList.remove('show'); setTimeout(() => modal.remove(), 300); } }

function calcScores() {
  const scores = { stress: 0, emotional: 0, cognitive: 0, social: 0, efficacy: 0 };
  answers.forEach((v, i) => {
    const q = questions[i];
    if (q.dim === 'stress') {
      // å‹åŠ›é¢˜ç›®ç‰¹æ®Šå¤„ç†
      scores.stress += v; // é«˜åˆ†=é«˜å‹åŠ›
    } else {
      scores[q.dim] += (4 - v); // å…¶ä»–ç»´åº¦ï¼š0=éå¸¸ç¬¦åˆ=4åˆ†
    }
  });
  return scores;
}

function getLevel(score, max) {
  const pct = score / max;
  if (pct >= 0.7) return { level: 'ä¼˜ç§€', color: '#059669', class: 'level-high' };
  if (pct >= 0.5) return { level: 'è‰¯å¥½', color: '#d97706', class: 'level-medium' };
  return { level: 'å¾…æå‡', color: '#dc2626', class: 'level-low' };
}

function getStressLevel(score) {
  if (score <= 7) return { level: 'ä½å‹åŠ›', color: '#10b981', desc: 'ä½ ç›®å‰çš„å‹åŠ›æ°´å¹³è¾ƒä½ï¼Œç”Ÿæ´»çŠ¶æ€è‰¯å¥½ã€‚' };
  if (score <= 14) return { level: 'ä¸­ç­‰å‹åŠ›', color: '#f59e0b', desc: 'ä½ æ­£åœ¨ç»å†ä¸€å®šç¨‹åº¦çš„å‹åŠ›ï¼Œæ³¨æ„é€‚æ—¶æ”¾æ¾ã€‚' };
  if (score <= 21) return { level: 'è¾ƒé«˜å‹åŠ›', color: '#f97316', desc: 'ä½ ç›®å‰å‹åŠ›è¾ƒå¤§ï¼Œå»ºè®®é‡‡å–æªæ–½ç¼“è§£å‹åŠ›ã€‚' };
  return { level: 'é«˜å‹åŠ›', color: '#ef4444', desc: 'ä½ æ­£åœ¨ç»å†è¾ƒå¤§çš„å‹åŠ›ï¼Œå¼ºçƒˆå»ºè®®å¯»æ±‚æ”¯æŒå’Œå¸®åŠ©ã€‚' };
}

function getResilienceLevel(total) {
  for (const l of RESILIENCE_LEVELS) { if (total >= l.min) return l; }
  return RESILIENCE_LEVELS[RESILIENCE_LEVELS.length - 1];
}

function showResult() {
  document.getElementById('testPage').classList.remove('active');
  document.getElementById('resultPage').classList.add('active');

  const scores = calcScores();
  const resilienceTotal = scores.emotional + scores.cognitive + scores.social + scores.efficacy;
  const stressLevel = getStressLevel(scores.stress);
  const resilienceLevel = getResilienceLevel(resilienceTotal);

  const html = `
    <div class="stress-indicator">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div style="font-size:14px;color:var(--text-muted);margin-bottom:4px;">å½“å‰å‹åŠ›æ°´å¹³</div>
          <div style="font-size:24px;font-weight:700;color:${stressLevel.color};">${stressLevel.level}</div>
        </div>
        <div style="font-size:36px;font-weight:700;color:${stressLevel.color};">${scores.stress}/28</div>
      </div>
      <div class="stress-bar"><div class="stress-fill" style="width:${(scores.stress/28)*100}%;background:linear-gradient(90deg, #10b981, #f59e0b, #ef4444);"></div></div>
      <div style="font-size:14px;color:var(--text-muted);">${stressLevel.desc}</div>
    </div>

    <div class="card" style="text-align:center;">
      <div style="font-size:14px;color:var(--text-muted);margin-bottom:8px;">å¿ƒç†éŸ§æ€§æŒ‡æ•°</div>
      <div class="resilience-score">${resilienceTotal}</div>
      <div class="resilience-level" style="background:${resilienceLevel.color};">${resilienceLevel.level}</div>
      <div style="color:var(--text-muted);font-size:14px;line-height:1.8;margin-top:16px;">${resilienceLevel.desc}</div>
      <div class="stat-grid">
        <div class="stat-card"><div class="stat-value">${scores.emotional}</div><div class="stat-label">æƒ…ç»ªéŸ§æ€§</div></div>
        <div class="stat-card"><div class="stat-value">${scores.cognitive}</div><div class="stat-label">è®¤çŸ¥çµæ´»</div></div>
        <div class="stat-card"><div class="stat-value">${scores.social}</div><div class="stat-label">ç¤¾ä¼šæ”¯æŒ</div></div>
        <div class="stat-card"><div class="stat-value">${scores.efficacy}</div><div class="stat-label">è‡ªæˆ‘æ•ˆèƒ½</div></div>
        <div class="stat-card"><div class="stat-value">${resilienceTotal}</div><div class="stat-label">éŸ§æ€§æ€»åˆ†</div></div>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#dbeafe">ğŸ“Š</div>éŸ§æ€§ç»´åº¦åˆ†æ</div>
      <div class="chart-container"><canvas id="radarChart"></canvas></div>
      ${['emotional', 'cognitive', 'social', 'efficacy'].map(d => {
        const info = dimInfo[d];
        const score = scores[d];
        const lv = getLevel(score, 28);
        return `
          <div class="dim-item">
            <div class="dim-header">
              <div class="dim-name"><div class="dim-icon" style="background:${info.bg}">${info.icon}</div>${info.name}</div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span class="level-badge ${lv.class}">${lv.level}</span>
                <span style="font-weight:600;color:var(--primary);">${score}/28</span>
              </div>
            </div>
            <div class="dim-bar"><div class="dim-bar-fill" style="width:${(score/28)*100}%;background:${info.color}"></div></div>
          </div>
        `;
      }).join('')}
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#d1fae5">ğŸ’¡</div>å‹åŠ›ç®¡ç†å»ºè®®</div>
      <div class="tip-item"><div class="tip-num">1</div><div class="tip-text">æ¯å¤©è¿›è¡Œ15-20åˆ†é’Ÿçš„æ”¾æ¾æ´»åŠ¨ï¼Œå¦‚æ·±å‘¼å¸ã€å†¥æƒ³æˆ–è½»åº¦è¿åŠ¨</div></div>
      <div class="tip-item"><div class="tip-num">2</div><div class="tip-text">ä¿æŒè§„å¾‹çš„ä½œæ¯æ—¶é—´ï¼Œç¡®ä¿æ¯æ™š7-8å°æ—¶çš„ä¼˜è´¨ç¡çœ </div></div>
      <div class="tip-item"><div class="tip-num">3</div><div class="tip-text">å»ºç«‹æ¸…æ™°çš„å·¥ä½œä¸ç”Ÿæ´»è¾¹ç•Œï¼Œå­¦ä¼šè¯´"ä¸"</div></div>
      <div class="tip-item"><div class="tip-num">4</div><div class="tip-text">åŸ¹å…»è‡³å°‘ä¸€é¡¹èƒ½è®©ä½ æ„Ÿåˆ°æ”¾æ¾å’Œæ„‰æ‚¦çš„çˆ±å¥½</div></div>
      <div class="tip-item"><div class="tip-num">5</div><div class="tip-text">å®šæœŸä¸ä¿¡ä»»çš„äººåˆ†äº«æ„Ÿå—ï¼Œä¸è¦ç‹¬è‡ªæ‰¿æ‹…æ‰€æœ‰å‹åŠ›</div></div>
    </div>

    ${scores.stress > 21 ? `
    <div class="warning-box">
      <div class="warning-title">âš ï¸ é‡è¦æç¤º</div>
      <div style="font-size:14px;color:var(--text-muted);line-height:1.7;">
        ä½ å½“å‰çš„å‹åŠ›æ°´å¹³è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¼šå½±å“ä½ çš„èº«å¿ƒå¥åº·ã€‚å»ºè®®ä½ ï¼š
        <br>â€¢ ä¼˜å…ˆå¤„ç†æœ€ç´§æ€¥çš„å‹åŠ›æº
        <br>â€¢ ä¸»åŠ¨å¯»æ±‚å®¶äººã€æœ‹å‹æˆ–ä¸“ä¸šäººå£«çš„æ”¯æŒ
        <br>â€¢ å¦‚æœæŒç»­æ„Ÿåˆ°éš¾ä»¥æ‰¿å—ï¼Œè¯·è€ƒè™‘å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢
      </div>
    </div>
    ` : ''}

    <div class="card download-section">
      <button class="download-btn" onclick="downloadPDF()" id="dlBtn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>ä¸‹è½½PDFæŠ¥å‘Š</button>
      <button class="restart-btn" onclick="restart()">é‡æ–°æµ‹è¯•</button>
      ${getHomeButtonHtml()}
    </div>
  `;

  document.getElementById('resultContent').innerHTML = html;

  setTimeout(() => {
    new Chart(document.getElementById('radarChart'), {
      type: 'radar',
      data: {
        labels: ['æƒ…ç»ªéŸ§æ€§', 'è®¤çŸ¥çµæ´»', 'ç¤¾ä¼šæ”¯æŒ', 'è‡ªæˆ‘æ•ˆèƒ½'],
        datasets: [{ data: [scores.emotional, scores.cognitive, scores.social, scores.efficacy], backgroundColor: 'rgba(102, 126, 234, 0.2)', borderColor: 'rgba(102, 126, 234, 1)', borderWidth: 2, pointBackgroundColor: 'rgba(102, 126, 234, 1)' }]
      },
      options: { scales: { r: { beginAtZero: true, max: 28, ticks: { stepSize: 7 } } }, plugins: { legend: { display: false } } }
    });
  }, 100);
}

function restart() { if (confirm('ç¡®å®šè¦é‡æ–°æµ‹è¯•å—ï¼Ÿ')) location.reload(); }

async function downloadPDF() {
  const btn = document.getElementById('dlBtn');
  const loading = document.getElementById('loading');
  btn.disabled = true; btn.innerHTML = 'ç”Ÿæˆä¸­...'; loading.classList.add('show');
  try {
    const scores = calcScores();
    const resilienceTotal = scores.emotional + scores.cognitive + scores.social + scores.efficacy;
    const stressLevel = getStressLevel(scores.stress);
    const resilienceLevel = getResilienceLevel(resilienceTotal);
    const date = new Date().toLocaleDateString('zh-CN');

    const pdfContainer = document.createElement('div');
    pdfContainer.style.cssText = 'position:absolute;left:-9999px;top:0;width:800px;background:#fff;padding:40px;font-family:"Noto Sans SC",sans-serif;';
    pdfContainer.innerHTML = `
      <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:50px 40px;margin:-40px -40px 30px -40px;text-align:center;color:#fff;">
        <div style="font-size:16px;margin-bottom:10px;opacity:0.9;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div style="font-size:32px;font-weight:700;margin-bottom:15px;">å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„æŠ¥å‘Š</div>
        <div style="font-size:14px;opacity:0.8;">æµ‹è¯„æ—¥æœŸï¼š${date}</div>
      </div>
      <div style="display:flex;gap:20px;margin-bottom:25px;">
        <div style="flex:1;background:linear-gradient(135deg,#fef2f2,#fff7ed);border-radius:16px;padding:24px;text-align:center;">
          <div style="font-size:14px;color:#64748b;margin-bottom:8px;">å‹åŠ›æ°´å¹³</div>
          <div style="font-size:36px;font-weight:700;color:${stressLevel.color};">${scores.stress}/28</div>
          <div style="font-size:16px;font-weight:600;color:${stressLevel.color};">${stressLevel.level}</div>
        </div>
        <div style="flex:1;background:#f8fafc;border-radius:16px;padding:24px;text-align:center;">
          <div style="font-size:14px;color:#64748b;margin-bottom:8px;">éŸ§æ€§æŒ‡æ•°</div>
          <div style="font-size:36px;font-weight:700;color:${resilienceLevel.color};">${resilienceTotal}/112</div>
          <div style="font-size:16px;font-weight:600;color:${resilienceLevel.color};">${resilienceLevel.level}</div>
        </div>
      </div>
      <div style="display:flex;gap:12px;margin-bottom:25px;">
        ${['emotional', 'cognitive', 'social', 'efficacy'].map(d => `<div style="flex:1;background:#f8fafc;border-radius:12px;padding:16px;text-align:center;"><div style="font-size:24px;font-weight:700;color:#667eea;">${scores[d]}</div><div style="font-size:11px;color:#64748b;">${dimInfo[d].name}</div></div>`).join('')}
      </div>
      <div style="background:#f8fafc;border-radius:12px;padding:20px;text-align:center;color:#94a3b8;font-size:12px;">
        <div style="margin-bottom:8px;font-weight:500;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div>æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­</div>
      </div>
    `;
    document.body.appendChild(pdfContainer);
    await document.fonts.ready;
    await new Promise(r => setTimeout(r, 300));
    const canvas = await html2canvas(pdfContainer, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
    document.body.removeChild(pdfContainer);
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    const imgData = canvas.toDataURL('image/jpeg', 0.95);
    const pdfW = 210, finalW = pdfW - 20;
    const ratio = canvas.width / canvas.height;
    const finalH = finalW / ratio;
    pdf.addImage(imgData, 'JPEG', 10, 10, finalW, finalH);
    pdf.save(`å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„æŠ¥å‘Š_${date}.pdf`);
  } catch (e) { console.error(e); alert('PDFç”Ÿæˆå¤±è´¥'); }
  finally { btn.disabled = false; btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> ä¸‹è½½PDFæŠ¥å‘Š'; loading.classList.remove('show'); }
}

render();
</script>
</body>
</html>
