<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„ | å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root { --primary: #6366f1; --primary-dark: #4f46e5; --primary-light: #a5b4fc; --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --text-muted: #64748b; --border: #e2e8f0; --shadow: 0 4px 20px rgba(0,0,0,0.08); --radius: 16px; }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans SC', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
.page { display: none; min-height: 100vh; }
.page.active { display: block; }
#testPage { background: var(--bg); padding: 20px; }
.test-container { max-width: 700px; margin: 0 auto; }
.test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.back-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: all 0.2s; }
.back-btn:hover { background: white; color: var(--text); }
.progress-wrap { text-align: right; }
.progress-text { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
.progress-bar { width: 180px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--gradient); border-radius: 3px; transition: width 0.3s; }
.question-card { background: var(--card); border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); }
.dim-tag { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-bottom: 16px; }
.q-num { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.q-text { font-size: 20px; font-weight: 600; line-height: 1.5; margin-bottom: 32px; }
.options { display: flex; flex-direction: column; gap: 12px; }
.opt { display: flex; align-items: center; gap: 14px; padding: 16px 20px; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
.opt:hover { border-color: var(--primary-light); background: #fafaff; }
.opt.selected { border-color: var(--primary); background: linear-gradient(135deg, #ede9fe 0%, #e0e7ff 100%); }
.opt-radio { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
.opt.selected .opt-radio { border-color: var(--primary); background: var(--primary); }
.opt.selected .opt-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
.opt-text { font-size: 15px; }
.nav-btns { display: flex; justify-content: space-between; margin-top: 28px; }
.nav-btn { padding: 12px 28px; border-radius: 10px; font-size: 15px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
.nav-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.nav-btn.secondary:hover { border-color: var(--primary); color: var(--primary); }
.nav-btn.primary { background: var(--primary); border: none; color: white; }
.nav-btn.primary:hover { background: var(--primary-dark); }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
#resultPage { background: linear-gradient(180deg, #667eea 0%, #764ba2 40%, var(--bg) 40%); }
.result-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
.result-header { text-align: center; color: white; padding: 20px 0 60px; }
.result-header h1 { font-size: 28px; margin-bottom: 8px; }
.card { background: var(--card); border-radius: var(--radius); padding: 32px; box-shadow: var(--shadow); margin-bottom: 20px; }
.section-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 16px; }
.section-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
.resilience-score { font-size: 64px; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
.resilience-level { text-align: center; padding: 8px 24px; background: var(--gradient); color: white; border-radius: 20px; display: inline-block; margin: 16px auto; font-weight: 600; }
.stress-indicator { background: linear-gradient(135deg, #fef2f2 0%, #fff7ed 100%); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
.stress-bar { height: 12px; background: #e2e8f0; border-radius: 6px; overflow: hidden; margin: 16px 0; }
.stress-fill { height: 100%; border-radius: 6px; transition: width 0.5s; }
.stat-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-top: 20px; }
.stat-card { padding: 16px 12px; background: #f8fafc; border-radius: 12px; text-align: center; }
.stat-value { font-size: 22px; font-weight: 700; color: var(--primary); }
.stat-label { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
.dim-item { margin-bottom: 20px; }
.dim-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.dim-name { display: flex; align-items: center; gap: 8px; font-weight: 500; }
.dim-icon { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
.dim-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; margin-bottom: 12px; }
.dim-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
.level-badge { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; }
.level-high { background: #d1fae5; color: #059669; }
.level-medium { background: #fef3c7; color: #d97706; }
.level-low { background: #fee2e2; color: #dc2626; }
.coping-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 16px; }
.coping-card { padding: 20px; border-radius: 14px; }
.coping-card.positive { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); }
.coping-card.negative { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); }
.coping-title { font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
.coping-list { font-size: 13px; color: var(--text-muted); line-height: 1.8; }
.tip-item { display: flex; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--primary); }
.tip-num { width: 26px; height: 26px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; flex-shrink: 0; }
.tip-text { font-size: 14px; color: var(--text-muted); line-height: 1.6; }
.warning-box { background: linear-gradient(135deg, #fef2f2 0%, #fff7ed 100%); border: 1px solid #fecaca; border-radius: 14px; padding: 20px; margin-top: 20px; }
.warning-title { font-weight: 600; color: #dc2626; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
.download-section { text-align: center; padding: 32px; }
.download-btn { display: inline-flex; align-items: center; gap: 10px; padding: 14px 28px; background: var(--gradient); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
.restart-btn { display: inline-flex; align-items: center; gap: 6px; margin-top: 14px; padding: 10px 20px; background: transparent; border: 2px solid var(--border); border-radius: 10px; font-size: 13px; color: var(--text-muted); cursor: pointer; }
.loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: all 0.3s; }
.loading.show { opacity: 1; visibility: visible; }
.loading-box { background: white; padding: 36px; border-radius: 16px; text-align: center; }
.spinner { width: 44px; height: 44px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
@keyframes spin { to { transform: rotate(360deg); } }
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: all 0.3s; }
.modal-overlay.show { opacity: 1; visibility: visible; }
.modal-content { background: white; padding: 36px; border-radius: 20px; max-width: 400px; width: 90%; text-align: center; transform: scale(0.9); transition: transform 0.3s; }
.modal-overlay.show .modal-content { transform: scale(1); }
.modal-icon { font-size: 48px; margin-bottom: 16px; }
.modal-content h3 { font-size: 22px; font-weight: 700; margin-bottom: 12px; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.modal-tests { background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
.modal-test-item { padding: 10px; font-size: 14px; color: var(--text); border-bottom: 1px solid var(--border); }
.modal-test-item:last-child { border-bottom: none; }
.modal-buttons { display: flex; flex-direction: column; gap: 10px; }
.modal-btn { padding: 14px 24px; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; border: none; }
.modal-btn.primary { background: var(--gradient); color: white; }
.modal-btn.secondary { background: transparent; border: 2px solid var(--border); color: var(--text-muted); }
.more-tests-btn { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-color: #f59e0b; color: #92400e; }
.chart-container { max-width: 350px; margin: 20px auto; }
@media (max-width: 640px) { .stat-grid { grid-template-columns: repeat(3, 1fr); } .coping-grid { grid-template-columns: 1fr; } .question-card { padding: 28px 20px; } }
</style>
</head>
<body>
<div id="testPage" class="page active">
  <div class="test-container">
    <div class="test-header">
      <button class="back-btn" onclick="exitTest()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>é€€å‡ºæµ‹è¯•</button>
      <div class="progress-wrap">
        <div class="progress-text"><span id="current">1</span> / 35</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      </div>
    </div>
    <div class="question-card">
      <div class="dim-tag" id="dimTag" style="display:none">å‹åŠ›æ„ŸçŸ¥</div>
      <div class="q-num">é—®é¢˜ <span id="qNum">1</span></div>
      <div class="q-text" id="qText"></div>
      <div class="options" id="options"></div>
      <div class="nav-btns">
        <button class="nav-btn secondary" id="prevBtn" onclick="prevQ()">ä¸Šä¸€é¢˜</button>
        <button class="nav-btn primary" id="nextBtn" onclick="nextQ()">ä¸‹ä¸€é¢˜</button>
      </div>
    </div>
  </div>
</div>

<div id="resultPage" class="page">
  <div class="result-container">
    <div class="result-header"><h1>ğŸŒ¿ å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„æŠ¥å‘Š</h1><p>å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</p></div>
    <div id="resultContent"></div>
  </div>
</div>

<div class="loading" id="loading"><div class="loading-box"><div class="spinner"></div><p>æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...</p></div></div>

<script>
// 35é“å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„é¢˜ç›®
const questions = [
  // å‹åŠ›æ„ŸçŸ¥ Stress (7é¢˜) - åå‘è®¡åˆ†
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°æ— æ³•æ§åˆ¶ç”Ÿæ´»ä¸­é‡è¦äº‹æƒ…çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['ä»ä¸', 'å¶å°”', 'æœ‰æ—¶', 'ç»å¸¸', 'æ€»æ˜¯'], reverse: true },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ å¯¹å¤„ç†ä¸ªäººé—®é¢˜æ„Ÿåˆ°æœ‰ä¿¡å¿ƒçš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['æ€»æ˜¯', 'ç»å¸¸', 'æœ‰æ—¶', 'å¶å°”', 'ä»ä¸'], reverse: false },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°äº‹æƒ…è¿›å±•é¡ºåˆ©çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['æ€»æ˜¯', 'ç»å¸¸', 'æœ‰æ—¶', 'å¶å°”', 'ä»ä¸'], reverse: false },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°å›°éš¾å †ç§¯å¦‚å±±ã€æ— æ³•å…‹æœçš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['ä»ä¸', 'å¶å°”', 'æœ‰æ—¶', 'ç»å¸¸', 'æ€»æ˜¯'], reverse: true },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ èƒ½å¤ŸæˆåŠŸåº”å¯¹æ—¥å¸¸çƒ¦æ¼çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['æ€»æ˜¯', 'ç»å¸¸', 'æœ‰æ—¶', 'å¶å°”', 'ä»ä¸'], reverse: false },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°ç´§å¼ å’Œå‹åŠ›çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['ä»ä¸', 'å¶å°”', 'æœ‰æ—¶', 'ç»å¸¸', 'æ€»æ˜¯'], reverse: true },
  { dim: 'stress', text: 'æœ€è¿‘ä¸€ä¸ªæœˆï¼Œä½ æ„Ÿåˆ°èƒ½å¤ŸæŒæ§è‡ªå·±ç”Ÿæ´»çš„é¢‘ç‡æ˜¯ï¼Ÿ', options: ['æ€»æ˜¯', 'ç»å¸¸', 'æœ‰æ—¶', 'å¶å°”', 'ä»ä¸'], reverse: false },

  // æƒ…ç»ªéŸ§æ€§ Emotional (7é¢˜)
  { dim: 'emotional', text: 'é‡åˆ°æŒ«æŠ˜åï¼Œæˆ‘é€šå¸¸èƒ½è¾ƒå¿«æ¢å¤æƒ…ç»ª', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'é¢å¯¹å›°éš¾æ—¶ï¼Œæˆ‘èƒ½ä¿æŒç§¯æä¹è§‚çš„æ€åº¦', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'å½“æ„Ÿåˆ°æ²®ä¸§æ—¶ï¼Œæˆ‘æœ‰æœ‰æ•ˆçš„æ–¹æ³•è®©è‡ªå·±æŒ¯ä½œ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'æˆ‘èƒ½å¤Ÿæ¥å—ç”Ÿæ´»ä¸­çš„ä¸ç¡®å®šæ€§', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'ç»å†å¤±è´¥åï¼Œæˆ‘ä»ç„¶ç›¸ä¿¡è‡ªå·±èƒ½å¤ŸæˆåŠŸ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'æˆ‘èƒ½å¤Ÿä»å›°éš¾ç»å†ä¸­æ‰¾åˆ°ç§¯æçš„æ„ä¹‰', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'emotional', text: 'é¢å¯¹å‹åŠ›æ—¶ï¼Œæˆ‘å¾ˆå°‘æ„Ÿåˆ°å®Œå…¨å´©æºƒ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },

  // è®¤çŸ¥çµæ´» Cognitive (7é¢˜)
  { dim: 'cognitive', text: 'å½“ä¸€ç§æ–¹æ³•ä¸å¥æ•ˆæ—¶ï¼Œæˆ‘ä¼šå°è¯•å…¶ä»–æ–¹æ³•', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'æˆ‘èƒ½å¤Ÿä»ä¸åŒè§’åº¦çœ‹å¾…é—®é¢˜', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'é¢å¯¹å˜åŒ–ï¼Œæˆ‘èƒ½å¤Ÿè°ƒæ•´è‡ªå·±çš„è®¡åˆ’å’Œé¢„æœŸ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'æˆ‘ç›¸ä¿¡å¤§å¤šæ•°é—®é¢˜éƒ½æœ‰è§£å†³åŠæ³•', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'æˆ‘èƒ½å¤ŸåŒºåˆ†å¯æ§å’Œä¸å¯æ§çš„äº‹æƒ…', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'é‡åˆ°å›°å¢ƒæ—¶ï¼Œæˆ‘ä¼šæ€è€ƒå¯ä»¥å­¦åˆ°ä»€ä¹ˆ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'cognitive', text: 'æˆ‘ä¸ä¼šè¿‡åº¦çº ç»“äºå·²ç»å‘ç”Ÿçš„äº‹æƒ…', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },

  // ç¤¾ä¼šæ”¯æŒ Social (7é¢˜)
  { dim: 'social', text: 'å½“æˆ‘éœ€è¦å¸®åŠ©æ—¶ï¼Œæœ‰äººå¯ä»¥ä¾é ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'æˆ‘æœ‰å¯ä»¥å€¾è¯‰çƒ¦æ¼çš„äº²å¯†æœ‹å‹æˆ–å®¶äºº', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'æˆ‘æ„Ÿåˆ°è¢«å‘¨å›´çš„äººå…³å¿ƒå’Œæ”¯æŒ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'é‡åˆ°å›°éš¾æ—¶ï¼Œæˆ‘æ„¿æ„å¯»æ±‚ä»–äººçš„å¸®åŠ©', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'æˆ‘æœ‰å½’å±æ„Ÿè¾ƒå¼ºçš„ç¤¾ç¾¤æˆ–å›¢ä½“', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'æˆ‘çš„äººé™…å…³ç³»èƒ½å¤Ÿç»™æˆ‘åŠ›é‡å’Œæ”¯æŒ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'social', text: 'åœ¨æˆ‘ç”Ÿæ´»ä¸­ï¼Œæœ‰äººçœŸæ­£ç†è§£æˆ‘', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },

  // è‡ªæˆ‘æ•ˆèƒ½ Efficacy (7é¢˜)
  { dim: 'efficacy', text: 'æˆ‘ç›¸ä¿¡è‡ªå·±æœ‰èƒ½åŠ›åº”å¯¹ç”Ÿæ´»ä¸­çš„æŒ‘æˆ˜', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'é¢å¯¹å›°éš¾ä»»åŠ¡æ—¶ï¼Œæˆ‘ç›¸ä¿¡è‡ªå·±èƒ½å¤Ÿå®Œæˆ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'è¿‡å»çš„æˆåŠŸç»å†è®©æˆ‘å¯¹æœªæ¥æœ‰ä¿¡å¿ƒ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'æˆ‘çŸ¥é“è‡ªå·±çš„ä¼˜åŠ¿å’Œèƒ½åŠ›æ‰€åœ¨', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'å³ä½¿æƒ…å†µå›°éš¾ï¼Œæˆ‘ä¹Ÿç›¸ä¿¡è‡ªå·±èƒ½æ‰¾åˆ°å‡ºè·¯', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'æˆ‘ç›¸ä¿¡åŠªåŠ›ä¼šå¸¦æ¥ç§¯æçš„ç»“æœ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'efficacy', text: 'æˆ‘æœ‰æ˜ç¡®çš„ç›®æ ‡å’Œå®ç°ç›®æ ‡çš„è®¡åˆ’', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] }
];

const dimInfo = {
  'stress': { name: 'å‹åŠ›æ°´å¹³', icon: 'ğŸ”¥', bg: '#fee2e2', color: '#ef4444' },
  'emotional': { name: 'æƒ…ç»ªéŸ§æ€§', icon: 'ğŸ’ª', bg: '#d1fae5', color: '#10b981' },
  'cognitive': { name: 'è®¤çŸ¥çµæ´»', icon: 'ğŸ§ ', bg: '#dbeafe', color: '#3b82f6' },
  'social': { name: 'ç¤¾ä¼šæ”¯æŒ', icon: 'ğŸ¤', bg: '#fef3c7', color: '#f59e0b' },
  'efficacy': { name: 'è‡ªæˆ‘æ•ˆèƒ½', icon: 'â­', bg: '#fce7f3', color: '#ec4899' }
};

const RESILIENCE_LEVELS = [
  { min: 100, level: 'é«˜éŸ§æ€§', color: '#059669', desc: 'ä½ å…·æœ‰éå¸¸å¼ºå¤§çš„å¿ƒç†éŸ§æ€§ï¼Œå°±åƒä¸€æ£µæ·±æ·±æ‰æ ¹çš„å¤§æ ‘ï¼Œæ— è®ºé£é›¨å¤šä¹ˆçŒ›çƒˆï¼Œéƒ½èƒ½å±¹ç«‹ä¸å€’å¹¶ç»§ç»­ç”Ÿé•¿ã€‚ä½ åœ¨æƒ…ç»ªéŸ§æ€§ã€è®¤çŸ¥çµæ´»æ€§ã€ç¤¾ä¼šæ”¯æŒå’Œè‡ªæˆ‘æ•ˆèƒ½å››ä¸ªç»´åº¦ä¸Šéƒ½è¡¨ç°å‡ºè‰²ã€‚é¢å¯¹å‹åŠ›å’Œé€†å¢ƒï¼Œä½ ä¸ä»…èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ï¼Œè¿˜èƒ½ä»å›°éš¾ç»å†ä¸­å­¦ä¹ å’Œæˆé•¿ã€‚ä½ æ‹¥æœ‰ä¸°å¯Œçš„åº”å¯¹ç­–ç•¥åº“ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸åŒæƒ…å¢ƒçµæ´»è°ƒæ•´ã€‚ä½ çš„ç¤¾ä¼šæ”¯æŒç½‘ç»œä¸ºä½ æä¾›äº†åšå®çš„åç›¾ï¼Œè€Œä½ å¯¹è‡ªå·±èƒ½åŠ›çš„ä¿¡å¿ƒè®©ä½ æ•¢äºç›´é¢æŒ‘æˆ˜ã€‚ä½ çš„é«˜éŸ§æ€§æ˜¯ä½ åœ¨ç”Ÿæ´»å’Œå·¥ä½œä¸­å–å¾—æˆåŠŸçš„é‡è¦èµ„äº§ï¼Œç»§ç»­ä¿æŒå¹¶å¸®åŠ©èº«è¾¹çš„äººä¹Ÿå»ºç«‹éŸ§æ€§å§ã€‚' },
  { min: 80, level: 'è‰¯å¥½éŸ§æ€§', color: '#3b82f6', desc: 'ä½ çš„å¿ƒç†éŸ§æ€§å¤„äºè‰¯å¥½æ°´å¹³ï¼Œå…·å¤‡äº†åº”å¯¹å¤§å¤šæ•°ç”Ÿæ´»å‹åŠ›å’ŒæŒ‘æˆ˜çš„èƒ½åŠ›ã€‚ä½ èƒ½å¤Ÿåœ¨é¢å¯¹å›°éš¾æ—¶ä¿æŒç›¸å¯¹ç§¯æçš„å¿ƒæ€ï¼Œè™½ç„¶å¯èƒ½ä¼šç»å†ä¸€äº›æƒ…ç»ªæ³¢åŠ¨ï¼Œä½†æ€»ä½“èƒ½å¤Ÿè¾ƒå¿«æ¢å¤ã€‚ä½ æœ‰ä¸€å®šçš„ç¤¾ä¼šæ”¯æŒç½‘ç»œï¼ŒçŸ¥é“åœ¨éœ€è¦æ—¶å¯ä»¥å‘è°æ±‚åŠ©ã€‚ä½ çš„æ€ç»´å…·æœ‰ä¸€å®šçš„çµæ´»æ€§ï¼Œèƒ½å¤Ÿä»ä¸åŒè§’åº¦çœ‹å¾…é—®é¢˜ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ å¯¹è‡ªå·±è§£å†³é—®é¢˜çš„èƒ½åŠ›æœ‰ä¿¡å¿ƒã€‚ç»§ç»­åŸ¹å…»ä½ çš„éŸ§æ€§èµ„æºï¼Œç‰¹åˆ«æ˜¯æ³¨æ„ç»´æŠ¤å’Œæ‹“å±•ä½ çš„ç¤¾ä¼šæ”¯æŒç½‘ç»œï¼Œè¿™å°†å¸®åŠ©ä½ åœ¨é¢å¯¹æ›´å¤§çš„æŒ‘æˆ˜æ—¶æ›´åŠ ä»å®¹ã€‚' },
  { min: 60, level: 'ä¸­ç­‰éŸ§æ€§', color: '#f59e0b', desc: 'ä½ çš„å¿ƒç†éŸ§æ€§å¤„äºä¸­ç­‰æ°´å¹³ï¼Œåœ¨æ—¥å¸¸ç”Ÿæ´»å‹åŠ›ä¸‹åŸºæœ¬èƒ½å¤Ÿåº”å¯¹ï¼Œä½†åœ¨é¢å¯¹é‡å¤§æŒ‘æˆ˜æˆ–å¤šé‡å‹åŠ›å åŠ æ—¶å¯èƒ½ä¼šæ„Ÿåˆ°åƒåŠ›ã€‚ä½ å¯èƒ½åœ¨æŸäº›éŸ§æ€§ç»´åº¦ä¸Šè¡¨ç°è¾ƒå¥½ï¼Œä½†åœ¨å…¶ä»–æ–¹é¢è¿˜æœ‰æå‡ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€å®šçš„æƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›ï¼Œä½†ç¤¾ä¼šæ”¯æŒç½‘ç»œä¸å¤Ÿå¼ºå¤§ï¼›æˆ–è€…ä½ çš„æ€ç»´è¾ƒä¸ºçµæ´»ï¼Œä½†åœ¨è‡ªä¿¡å¿ƒæ–¹é¢è¿˜éœ€åŠ å¼ºã€‚å»ºè®®ä½ åˆ†æè‡ªå·±çš„éŸ§æ€§çŸ­æ¿ï¼Œæœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œæå‡ã€‚å¯ä»¥ä»å»ºç«‹æ›´å¹¿æ³›çš„ç¤¾ä¼šæ”¯æŒç½‘ç»œã€å­¦ä¹ æ›´å¤šæƒ…ç»ªè°ƒèŠ‚æŠ€å·§ã€åŸ¹å…»æˆé•¿å‹æ€ç»´ç­‰æ–¹é¢å…¥æ‰‹ã€‚' },
  { min: 0, level: 'å¾…æå‡', color: '#ef4444', desc: 'ä½ ç›®å‰çš„å¿ƒç†éŸ§æ€§æ°´å¹³è¿˜æœ‰è¾ƒå¤§çš„æå‡ç©ºé—´ï¼Œåœ¨é¢å¯¹å‹åŠ›å’Œé€†å¢ƒæ—¶å¯èƒ½ä¼šæ„Ÿåˆ°æ¯”è¾ƒè‰°éš¾ã€‚ä½ å¯èƒ½ç»å¸¸æ„Ÿåˆ°è¢«å‹åŠ›æ·¹æ²¡ï¼Œéš¾ä»¥ä»è´Ÿé¢æƒ…ç»ªä¸­æ¢å¤ï¼Œæˆ–è€…å¯¹è‡ªå·±åº”å¯¹å›°éš¾çš„èƒ½åŠ›ç¼ºä¹ä¿¡å¿ƒã€‚ç¤¾ä¼šæ”¯æŒå¯èƒ½ä¹Ÿæ˜¯ä½ éœ€è¦åŠ å¼ºçš„æ–¹é¢ã€‚ä¸è¿‡ï¼Œè¯·ä¸è¦æ°”é¦â€”â€”å¿ƒç†éŸ§æ€§ä¸æ˜¯ä¸€ç§å›ºå®šçš„ç‰¹è´¨ï¼Œè€Œæ˜¯å¯ä»¥é€šè¿‡å­¦ä¹ å’Œç»ƒä¹ æ¥åŸ¹å…»çš„èƒ½åŠ›ã€‚å»ºè®®ä½ ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å¼€å§‹ï¼šé¦–å…ˆï¼Œå»ºç«‹æˆ–åŠ å¼ºä½ çš„ç¤¾ä¼šæ”¯æŒç½‘ç»œï¼Œæ‰¾åˆ°å¯ä»¥ä¿¡èµ–å’Œå€¾è¯‰çš„äººï¼›å…¶æ¬¡ï¼Œå­¦ä¹ åŸºæœ¬çš„æƒ…ç»ªè°ƒèŠ‚æŠ€å·§ï¼Œå¦‚æ·±å‘¼å¸å’Œæ­£å¿µå†¥æƒ³ï¼›ç¬¬ä¸‰ï¼Œä»å°äº‹å¼€å§‹å»ºç«‹è‡ªä¿¡ï¼Œè®°å½•å¹¶åº†ç¥æ¯ä¸€ä¸ªå°æˆåŠŸã€‚å¦‚æœæ„Ÿåˆ°å‹åŠ›è¿‡å¤§ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢å¸ˆçš„å¸®åŠ©ã€‚' }
];

let idx = 0;
let answers = new Array(35).fill(null);
const dims = questions.map(q => q.dim);

function render() {
  const q = questions[idx];
  const info = dimInfo[q.dim];
  document.getElementById('current').textContent = idx + 1;
  document.getElementById('qNum').textContent = idx + 1;
  document.getElementById('progressFill').style.width = ((idx + 1) / 35 * 100) + '%';
  document.getElementById('dimTag').textContent = info.name;
  document.getElementById('dimTag').style.background = info.bg;
  document.getElementById('dimTag').style.color = info.color;
  document.getElementById('qText').textContent = q.text;

  let optHtml = '';
  q.options.forEach((opt, i) => {
    const selected = answers[idx] === i ? 'selected' : '';
    optHtml += `<div class="opt ${selected}" onclick="select(${i})"><div class="opt-radio"></div><div class="opt-text">${opt}</div></div>`;
  });
  document.getElementById('options').innerHTML = optHtml;
  document.getElementById('prevBtn').disabled = idx === 0;
  document.getElementById('nextBtn').textContent = idx === 34 ? 'æŸ¥çœ‹ç»“æœ' : 'ä¸‹ä¸€é¢˜';
}

function select(v) { answers[idx] = v; render(); if (idx < 34) setTimeout(() => nextQ(), 250); }
function prevQ() { if (idx > 0) { idx--; render(); } }
function nextQ() {
  if (answers[idx] === null) { alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€‰é¡¹'); return; }
  if (idx < 34) { idx++; render(); } else showResult();
}

function exitTest() { if (confirm('ç¡®å®šé€€å‡ºï¼Ÿç­”æ¡ˆå°†ä¸ä¼šä¿å­˜ã€‚')) { goToHome(); } }
function goToHome() {
  const userSource = sessionStorage.getItem('user_source');
  if (userSource === 'platform') { window.location.href = '../platform.html'; }
  else { window.location.href = 'index.html'; }
}
function getHomeButtonHtml() {
  const userSource = sessionStorage.getItem('user_source');
  if (userSource === 'platform') { return '<button class="restart-btn" onclick="goToHome()" style="margin-left:8px">è¿”å›æµ‹è¯•ä¸­å¿ƒ</button>'; }
  else { return '<button class="restart-btn more-tests-btn" onclick="showMoreTests()" style="margin-left:8px">æ›´å¤šæµ‹è¯•</button>'; }
}
function showMoreTests() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `<div class="modal-content"><div class="modal-icon">ğŸ§‚</div><h3>æ›´å¤šä¸“ä¸šæµ‹è¯„</h3><p>è¯·åœ¨å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€è´­ä¹°å…¶ä»–æµ‹è¯•å“¦~</p><div class="modal-buttons"><button class="modal-btn primary" onclick="closeModal()">çŸ¥é“äº†</button></div></div>`;
  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add('show'), 10);
}
function closeModal() { const modal = document.querySelector('.modal-overlay'); if (modal) { modal.classList.remove('show'); setTimeout(() => modal.remove(), 300); } }

function calcScores() {
  const scores = { stress: 0, emotional: 0, cognitive: 0, social: 0, efficacy: 0 };
  answers.forEach((v, i) => {
    const q = questions[i];
    if (q.dim === 'stress') {
      // å‹åŠ›é¢˜ç›®ç‰¹æ®Šå¤„ç†
      scores.stress += v; // é«˜åˆ†=é«˜å‹åŠ›
    } else {
      scores[q.dim] += (4 - v); // å…¶ä»–ç»´åº¦ï¼š0=éå¸¸ç¬¦åˆ=4åˆ†
    }
  });
  return scores;
}

function getLevel(score, max) {
  const pct = score / max;
  if (pct >= 0.7) return { level: 'ä¼˜ç§€', color: '#059669', class: 'level-high' };
  if (pct >= 0.5) return { level: 'è‰¯å¥½', color: '#d97706', class: 'level-medium' };
  return { level: 'å¾…æå‡', color: '#dc2626', class: 'level-low' };
}

function getStressLevel(score) {
  if (score <= 7) return { level: 'ä½å‹åŠ›', color: '#10b981', desc: 'ä½ ç›®å‰çš„å‹åŠ›æ°´å¹³è¾ƒä½ï¼Œå¤„äºå¥åº·å’Œå¯æŒç»­çš„çŠ¶æ€ã€‚ä½ ä¼¼ä¹å·²ç»æ‰¾åˆ°äº†å·¥ä½œã€ç”Ÿæ´»å’Œä¼‘æ¯ä¹‹é—´çš„å¹³è¡¡ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†æ—¥å¸¸çš„æŒ‘æˆ˜å’Œè¦æ±‚ã€‚ä½å‹åŠ›çŠ¶æ€æœ‰åˆ©äºä½ çš„èº«å¿ƒå¥åº·ã€åˆ›é€ åŠ›å’Œäººé™…å…³ç³»ã€‚ç»§ç»­ä¿æŒè¿™ç§å¹³è¡¡ï¼ŒåŒæ—¶ä¹Ÿè¦æ³¨æ„ä¸è¦è¿‡åº¦å›é¿æœ‰ç›Šçš„å‹åŠ›å’ŒæŒ‘æˆ˜ï¼Œå› ä¸ºé€‚åº¦çš„å‹åŠ›å¯ä»¥ä¿ƒè¿›æˆé•¿å’Œè¿›æ­¥ã€‚' };
  if (score <= 14) return { level: 'ä¸­ç­‰å‹åŠ›', color: '#f59e0b', desc: 'ä½ æ­£åœ¨ç»å†ä¸­ç­‰ç¨‹åº¦çš„å‹åŠ›ï¼Œè¿™æ˜¯å¤§å¤šæ•°äººåœ¨ç°ä»£ç”Ÿæ´»ä¸­çš„å¸¸è§çŠ¶æ€ã€‚ä½ å¯èƒ½æ„Ÿåˆ°æœ‰äº›å¿™ç¢Œæˆ–æœ‰ä¸€å®šçš„å·¥ä½œå’Œç”Ÿæ´»å‹åŠ›ï¼Œä½†æ€»ä½“ä¸Šè¿˜åœ¨å¯æ§èŒƒå›´å†…ã€‚è¿™ä¸ªæ°´å¹³çš„å‹åŠ›å¦‚æœæŒç»­æ—¶é—´ä¸é•¿ï¼Œé€šå¸¸ä¸ä¼šå¯¹å¥åº·é€ æˆä¸¥é‡å½±å“ï¼Œä½†å¦‚æœé•¿æœŸå¤„äºè¿™ç§çŠ¶æ€ï¼Œå¯èƒ½ä¼šé€æ¸æ¶ˆè€—ä½ çš„ç²¾åŠ›å‚¨å¤‡ã€‚å»ºè®®ä½ å®šæœŸç»™è‡ªå·±å®‰æ’æ”¾æ¾å’Œæ¢å¤çš„æ—¶é—´ï¼Œç¡®ä¿å……è¶³çš„ç¡çœ ï¼Œå¹¶æ³¨æ„åŸ¹å…»æœ‰æ•ˆçš„å‹åŠ›ç®¡ç†ä¹ æƒ¯ã€‚' };
  if (score <= 21) return { level: 'è¾ƒé«˜å‹åŠ›', color: '#f97316', desc: 'ä½ ç›®å‰æ­£åœ¨ç»å†è¾ƒé«˜æ°´å¹³çš„å‹åŠ›ï¼Œè¿™å¯èƒ½å·²ç»å¼€å§‹å½±å“ä½ çš„æ—¥å¸¸ç”Ÿæ´»è´¨é‡å’Œèº«å¿ƒå¥åº·ã€‚ä½ å¯èƒ½ä¼šæ„Ÿåˆ°ç»å¸¸ç–²æƒ«ã€ç¡çœ è´¨é‡ä¸‹é™ã€æ³¨æ„åŠ›éš¾ä»¥é›†ä¸­ï¼Œæˆ–è€…å‡ºç°ä¸€äº›èº«ä½“ç—‡çŠ¶å¦‚å¤´ç—›ã€è‚Œè‚‰ç´§å¼ ç­‰ã€‚é•¿æœŸå¤„äºè¿™ç§å‹åŠ›æ°´å¹³å¯èƒ½ä¼šå¢åŠ ç„¦è™‘ã€æŠ‘éƒå’Œå„ç§å¥åº·é—®é¢˜çš„é£é™©ã€‚å¼ºçƒˆå»ºè®®ä½ è®¤çœŸå®¡è§†å½“å‰çš„ç”Ÿæ´»çŠ¶å†µï¼Œæ‰¾å‡ºä¸»è¦çš„å‹åŠ›æºï¼Œå¹¶é‡‡å–ç§¯æçš„æªæ–½æ¥ç¼“è§£å‹åŠ›ï¼Œå¦‚è°ƒæ•´å·¥ä½œèŠ‚å¥ã€å¢åŠ è¿åŠ¨ã€å¯»æ±‚ç¤¾ä¼šæ”¯æŒç­‰ã€‚' };
  return { level: 'é«˜å‹åŠ›', color: '#ef4444', desc: 'ä½ ç›®å‰æ­£åœ¨ç»å†éå¸¸é«˜çš„å‹åŠ›æ°´å¹³ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦è®¤çœŸå¯¹å¾…çš„è­¦ç¤ºä¿¡å·ã€‚é«˜å‹åŠ›çŠ¶æ€ä¼šå¯¹ä½ çš„èº«å¿ƒå¥åº·äº§ç”Ÿæ˜¾è‘—çš„è´Ÿé¢å½±å“ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå…ç–«åŠ›ä¸‹é™ã€å¿ƒè¡€ç®¡é£é™©å¢åŠ ã€æƒ…ç»ªé—®é¢˜ã€è®¤çŸ¥åŠŸèƒ½ä¸‹é™ç­‰ã€‚ä½ å¯èƒ½æ„Ÿåˆ°ä¸å ªé‡è´Ÿã€éš¾ä»¥åº”å¯¹ï¼Œç”šè‡³å¯èƒ½å‡ºç°èº«ä½“å¥åº·é—®é¢˜ã€‚è¯·ä¼˜å…ˆç…§é¡¾å¥½è‡ªå·±çš„å¥åº·ï¼šè¯†åˆ«å¹¶å°½å¯èƒ½å‡å°‘ä¸»è¦å‹åŠ›æºï¼Œä¸»åŠ¨å¯»æ±‚å®¶äººã€æœ‹å‹æˆ–ä¸“ä¸šäººå£«çš„æ”¯æŒå’Œå¸®åŠ©ï¼Œç¡®ä¿åŸºæœ¬çš„è‡ªæˆ‘ç…§é¡¾ï¼ˆç¡çœ ã€é¥®é£Ÿã€è¿åŠ¨ï¼‰ã€‚å¦‚æœæ„Ÿåˆ°éš¾ä»¥ç‹¬è‡ªåº”å¯¹ï¼Œè¯·è®¤çœŸè€ƒè™‘å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢å¸ˆæˆ–åŒ»ç”Ÿçš„å¸®åŠ©ã€‚' };
}

function getResilienceLevel(total) {
  for (const l of RESILIENCE_LEVELS) { if (total >= l.min) return l; }
  return RESILIENCE_LEVELS[RESILIENCE_LEVELS.length - 1];
}

function getDimAnalysis(dim, score) {
  const analyses = {
    emotional: {
      high: 'ä½ çš„æƒ…ç»ªéŸ§æ€§éå¸¸å‡ºè‰²ï¼Œè¿™æ„å‘³ç€ä½ åœ¨é¢å¯¹æŒ«æŠ˜ã€å¤±è´¥æˆ–è´Ÿé¢äº‹ä»¶æ—¶ï¼Œèƒ½å¤Ÿè¾ƒå¿«åœ°ä»è´Ÿé¢æƒ…ç»ªä¸­æ¢å¤è¿‡æ¥ã€‚ä½ ä¸ä¼šè®©ä¸€æ¬¡å¤±è´¥å®šä¹‰ä½ çš„ä»·å€¼ï¼Œè€Œæ˜¯èƒ½å¤Ÿä¿æŒç§¯æçš„è§†è§’ï¼Œç›¸ä¿¡å›°éš¾åªæ˜¯æš‚æ—¶çš„ã€‚ä½ å–„äºè°ƒèŠ‚è‡ªå·±çš„æƒ…ç»ªï¼Œå³ä½¿åœ¨å‹åŠ›ä¸‹ä¹Ÿèƒ½ä¿æŒç›¸å¯¹çš„æƒ…ç»ªç¨³å®šã€‚ä½ å¯èƒ½å·²ç»å‘å±•å‡ºäº†æœ‰æ•ˆçš„æƒ…ç»ªç®¡ç†ç­–ç•¥ï¼Œæ¯”å¦‚ç§¯æçš„è‡ªæˆ‘å¯¹è¯ã€è¿åŠ¨ã€æˆ–å¯»æ±‚ç¤¾ä¼šæ”¯æŒã€‚è¿™ç§æƒ…ç»ªéŸ§æ€§æ˜¯ä½ åº”å¯¹ç”Ÿæ´»æŒ‘æˆ˜çš„é‡è¦èµ„äº§ã€‚',
      medium: 'ä½ çš„æƒ…ç»ªéŸ§æ€§å¤„äºä¸­ç­‰æ°´å¹³ã€‚åœ¨é¢å¯¹ä¸€èˆ¬çš„æŒ«æŠ˜æ—¶ï¼Œä½ é€šå¸¸èƒ½å¤Ÿé€æ¸æ¢å¤ï¼Œä½†å¯èƒ½éœ€è¦æ¯”è¾ƒé•¿çš„æ—¶é—´ã€‚å½“é­é‡é‡å¤§æ‰“å‡»æˆ–å¤šé‡å‹åŠ›å åŠ æ—¶ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°æƒ…ç»ªéš¾ä»¥æ§åˆ¶ï¼Œéœ€è¦è¾ƒé•¿æ—¶é—´æ‰èƒ½é‡æ–°æŒ¯ä½œã€‚å»ºè®®ä½ æœ‰æ„è¯†åœ°åŸ¹å…»æƒ…ç»ªè°ƒèŠ‚æŠ€å·§ï¼šå­¦ä¹ è¯†åˆ«è‡ªå·±çš„æƒ…ç»ªè§¦å‘ç‚¹ï¼Œå»ºç«‹å¥åº·çš„æƒ…ç»ªå®£æ³„æ–¹å¼ï¼Œç»ƒä¹ ç”¨ç§¯æçš„è§†è§’é‡æ–°è§£è¯»è´Ÿé¢äº‹ä»¶ã€‚åŒæ—¶ï¼Œè®°ä½ä»è¿‡å»æˆåŠŸå…‹æœå›°éš¾çš„ç»å†ä¸­æ±²å–åŠ›é‡ã€‚',
      low: 'ä½ çš„æƒ…ç»ªéŸ§æ€§ç›®å‰è¿˜æ¯”è¾ƒè–„å¼±ï¼Œåœ¨é¢å¯¹æŒ«æŠ˜æ—¶å¯èƒ½ä¼šæ„Ÿåˆ°éå¸¸æ²®ä¸§ï¼Œä¸”éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½æ¢å¤ã€‚è´Ÿé¢æƒ…ç»ªå¯èƒ½ä¼šæŒç»­å›°æ‰°ä½ ï¼Œå½±å“ä½ çš„æ—¥å¸¸ç”Ÿæ´»å’Œå†³ç­–ã€‚ä½ å¯èƒ½å€¾å‘äºç¾éš¾åŒ–æ€ç»´ï¼Œå°†ä¸€æ¬¡å¤±è´¥æ³›åŒ–ä¸ºå¯¹è‡ªå·±èƒ½åŠ›çš„å…¨é¢å¦å®šã€‚å»ºè®®ä½ ä»åŸºç¡€å¼€å§‹åŸ¹å…»æƒ…ç»ªéŸ§æ€§ï¼šé¦–å…ˆå­¦ä¼šæ¥çº³è´Ÿé¢æƒ…ç»ªçš„å­˜åœ¨ï¼Œè€Œä¸æ˜¯å‹æŠ‘æˆ–é€ƒé¿ï¼›å…¶æ¬¡ç»ƒä¹ ç”¨æ›´å¹³è¡¡çš„è§†è§’çœ‹å¾…äº‹æƒ…ï¼ŒåŒºåˆ†äº‹å®å’Œè§£è¯»ï¼›æœ€åï¼Œå»ºç«‹ä¸€äº›ç®€å•çš„æƒ…ç»ªè°ƒèŠ‚ä¹ æƒ¯ï¼Œå¦‚æ·±å‘¼å¸ã€è¿åŠ¨æˆ–å†™æ—¥è®°ã€‚'
    },
    cognitive: {
      high: 'ä½ å±•ç°å‡ºå¾ˆå¼ºçš„è®¤çŸ¥çµæ´»æ€§ï¼Œè¿™æ˜¯å¿ƒç†éŸ§æ€§çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚ä½ å–„äºä»ä¸åŒè§’åº¦çœ‹å¾…é—®é¢˜ï¼Œä¸ä¼šè¢«å•ä¸€çš„æ€ç»´æ¨¡å¼æ‰€å±€é™ã€‚å½“ä¸€ç§æ–¹æ³•ä¸å¥æ•ˆæ—¶ï¼Œä½ èƒ½å¤Ÿçµæ´»åœ°å°è¯•å…¶ä»–é€”å¾„ï¼Œè€Œä¸æ˜¯å›ºæ‰§åœ°åšæŒæ— æ•ˆçš„ç­–ç•¥ã€‚ä½ èƒ½å¤ŸåŒºåˆ†å¯æ§å’Œä¸å¯æ§çš„äº‹æƒ…ï¼Œå°†ç²¾åŠ›é›†ä¸­åœ¨è‡ªå·±èƒ½å¤Ÿå½±å“çš„é¢†åŸŸã€‚ä½ ç›¸ä¿¡å¤§å¤šæ•°é—®é¢˜éƒ½æœ‰è§£å†³æ–¹æ¡ˆï¼Œè¿™ç§æˆé•¿å‹æ€ç»´è®©ä½ åœ¨å›°å¢ƒä¸­ä¹Ÿèƒ½çœ‹åˆ°å¸Œæœ›å’Œæœºä¼šã€‚',
      medium: 'ä½ çš„è®¤çŸ¥çµæ´»æ€§å¤„äºä¸­ç­‰æ°´å¹³ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ èƒ½å¤Ÿæ¯”è¾ƒç†æ€§åœ°åˆ†æé—®é¢˜ï¼Œä½†æœ‰æ—¶å¯èƒ½ä¼šé™·å…¥å›ºå®šçš„æ€ç»´æ¨¡å¼ä¸­ã€‚å½“é¢å¯¹å¤æ‚æˆ–æ–°é¢–çš„æŒ‘æˆ˜æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ‰èƒ½è·³å‡ºåŸæœ‰çš„æ€ç»´æ¡†æ¶ï¼Œæ‰¾åˆ°æ–°çš„è§£å†³æ–¹æ¡ˆã€‚å»ºè®®ä½ æœ‰æ„è¯†åœ°åŸ¹å…»å¤šè§’åº¦æ€ç»´çš„ä¹ æƒ¯ï¼šåœ¨åšå†³å®šä¹‹å‰ï¼Œå°è¯•åˆ—å‡ºè‡³å°‘ä¸‰ç§ä¸åŒçš„æ–¹æ¡ˆï¼›é‡åˆ°å›°éš¾æ—¶ï¼Œé—®è‡ªå·±"è¿˜æœ‰ä»€ä¹ˆå…¶ä»–å¯èƒ½æ€§ï¼Ÿ"ï¼›å­¦ä¹ åŒºåˆ†äº‹å®å’Œå‡è®¾ï¼ŒæŒ‘æˆ˜è‡ªå·±å¯èƒ½å­˜åœ¨çš„æ€ç»´åè§ã€‚',
      low: 'ä½ çš„è®¤çŸ¥çµæ´»æ€§ç›®å‰è¿˜æœ‰è¾ƒå¤§çš„æå‡ç©ºé—´ã€‚ä½ å¯èƒ½å€¾å‘äºç”¨å›ºå®šçš„æ–¹å¼çœ‹å¾…é—®é¢˜ï¼Œå³ä½¿è¿™ç§æ–¹å¼å·²ç»ä¸å†æœ‰æ•ˆï¼Œä¹Ÿéš¾ä»¥æ”¹å˜ã€‚å½“é‡åˆ°æ„æ–™ä¹‹å¤–çš„æƒ…å†µæ—¶ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°è¿·èŒ«å’Œæ— æ‰€é€‚ä»ã€‚ä½ å¯èƒ½ç»å¸¸é™·å…¥"éé»‘å³ç™½"çš„æ€ç»´ï¼Œéš¾ä»¥çœ‹åˆ°ä¸­é—´åœ°å¸¦æˆ–å…¶ä»–å¯èƒ½æ€§ã€‚å»ºè®®ä½ ä»å°äº‹å¼€å§‹ç»ƒä¹ è®¤çŸ¥çµæ´»æ€§ï¼šæ¯å¤©å°è¯•ä¸€ä»¶æ–°äº‹ç‰©ï¼Œå“ªæ€•å¾ˆå°ï¼›é‡åˆ°é—®é¢˜æ—¶å¼ºè¿«è‡ªå·±æƒ³å‡ºä¸‰ç§ä»¥ä¸Šçš„è§£å†³æ–¹æ¡ˆï¼›é˜…è¯»ä¸è‡ªå·±è§‚ç‚¹ä¸åŒçš„æ–‡ç« æˆ–ä¹¦ç±ï¼Œæ‰©å±•æ€ç»´è¾¹ç•Œã€‚'
    },
    social: {
      high: 'ä½ æ‹¥æœ‰å¼ºå¤§çš„ç¤¾ä¼šæ”¯æŒç½‘ç»œï¼Œè¿™æ˜¯å¿ƒç†éŸ§æ€§çš„é‡è¦ä¿æŠ¤å› ç´ ã€‚ä½ æœ‰å¯ä»¥ä¿¡èµ–å’Œå€¾è¯‰çš„äº²å¯†å…³ç³»ï¼ŒçŸ¥é“åœ¨éœ€è¦æ—¶å¯ä»¥å‘è°æ±‚åŠ©ã€‚ä½ æ„Ÿåˆ°è¢«å…³å¿ƒã€è¢«ç†è§£ã€è¢«æ”¯æŒï¼Œè¿™ç§å½’å±æ„Ÿç»™ä½ æä¾›äº†æƒ…æ„Ÿä¸Šçš„å®‰å…¨åŸºåœ°ã€‚ä½ ä¹Ÿæ„¿æ„ä¸»åŠ¨å¯»æ±‚å¸®åŠ©ï¼Œä¸ä¼šå› ä¸ºé¢å­æˆ–æ‹…å¿ƒéº»çƒ¦ä»–äººè€Œç‹¬è‡ªæ‰¿å—æ‰€æœ‰å‹åŠ›ã€‚è‰¯å¥½çš„ç¤¾ä¼šæ”¯æŒä¸ä»…èƒ½å¸®åŠ©ä½ åº”å¯¹å½“å‰çš„å‹åŠ›ï¼Œè¿˜èƒ½å¢å¼ºä½ é¢å¯¹æœªæ¥æŒ‘æˆ˜çš„ä¿¡å¿ƒã€‚',
      medium: 'ä½ æ‹¥æœ‰ä¸€å®šç¨‹åº¦çš„ç¤¾ä¼šæ”¯æŒï¼Œæœ‰ä¸€äº›å¯ä»¥ä¾é çš„äº²å‹å…³ç³»ï¼Œä½†æ”¯æŒç½‘ç»œå¯èƒ½è¿˜ä¸å¤Ÿå¹¿æ³›æˆ–æ·±åšã€‚ä½ å¯èƒ½æœ‰æ—¶ä¼šæ„Ÿåˆ°å­¤ç‹¬æˆ–ä¸è¢«ç†è§£ï¼Œæˆ–è€…åœ¨éœ€è¦å¸®åŠ©æ—¶çŠ¹è±«æ˜¯å¦åº”è¯¥å¼€å£ã€‚ä½ çš„ç¤¾ä¼šæ”¯æŒå¯èƒ½åœ¨æŸäº›æ–¹é¢è¾ƒå¼ºï¼ˆæ¯”å¦‚å®é™…å¸®åŠ©ï¼‰ï¼Œä½†åœ¨å…¶ä»–æ–¹é¢è¾ƒå¼±ï¼ˆæ¯”å¦‚æƒ…æ„Ÿæ”¯æŒï¼‰ã€‚å»ºè®®ä½ æœ‰æ„è¯†åœ°åŸ¹å…»å’Œç»´æŠ¤ä½ çš„äººé™…å…³ç³»ï¼šå®šæœŸä¸äº²å‹ä¿æŒè”ç³»ï¼Œä¸ä»…åœ¨éœ€è¦å¸®åŠ©æ—¶æ‰è”ç³»ï¼›å­¦ä¼šè¡¨è¾¾è‡ªå·±çš„éœ€æ±‚å’Œæ„Ÿå—ï¼›è€ƒè™‘åŠ å…¥ä¸€äº›å…´è¶£å›¢ä½“æˆ–ç¤¾åŒºç»„ç»‡ï¼Œæ‰©å¤§ç¤¾äº¤åœˆã€‚',
      low: 'ä½ çš„ç¤¾ä¼šæ”¯æŒç›®å‰æ¯”è¾ƒè–„å¼±ï¼Œè¿™å¯èƒ½æ˜¯ä½ éŸ§æ€§å‘å±•çš„ä¸€ä¸ªé‡è¦ç“¶é¢ˆã€‚ä½ å¯èƒ½ç¼ºä¹å¯ä»¥ä¿¡èµ–å’Œå€¾è¯‰çš„äº²å¯†å…³ç³»ï¼Œåœ¨å›°éš¾æ—¶æ„Ÿåˆ°å­¤ç«‹æ— æ´ã€‚ä½ å¯èƒ½ä¸ä¹ æƒ¯æˆ–ä¸æ„¿æ„å‘ä»–äººæ±‚åŠ©ï¼Œå€¾å‘äºç‹¬è‡ªæ‰¿æ‹…æ‰€æœ‰å‹åŠ›ã€‚ç¼ºä¹ç¤¾ä¼šæ”¯æŒä¼šè®©ä½ åœ¨é¢å¯¹æŒ‘æˆ˜æ—¶æ›´åŠ è„†å¼±ã€‚å»ºè®®ä½ å°†å»ºç«‹ç¤¾ä¼šæ”¯æŒç½‘ç»œä½œä¸ºä¼˜å…ˆäº‹é¡¹ï¼šä»èº«è¾¹ç°æœ‰çš„å…³ç³»å¼€å§‹ï¼Œå°è¯•åŠ æ·±ä¸€ä¸¤æ®µå…³ç³»çš„äº²å¯†åº¦ï¼›å­¦ä¼šå‘ä»–äººæ•å¼€å¿ƒæ‰‰ï¼Œåˆ†äº«ä½ çš„æ„Ÿå—å’Œéœ€æ±‚ï¼›è€ƒè™‘åŠ å…¥ä¸€äº›å›¢ä½“æ´»åŠ¨ï¼Œè®¤è¯†æ–°æœ‹å‹ï¼›å¦‚æœæ„Ÿåˆ°éå¸¸å­¤ç‹¬ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä¸“ä¸šçš„å¿ƒç†å’¨è¯¢ã€‚'
    },
    efficacy: {
      high: 'ä½ æ‹¥æœ‰å¾ˆå¼ºçš„è‡ªæˆ‘æ•ˆèƒ½æ„Ÿï¼Œå¯¹è‡ªå·±åº”å¯¹æŒ‘æˆ˜çš„èƒ½åŠ›å……æ»¡ä¿¡å¿ƒã€‚ä½ ç›¸ä¿¡é€šè¿‡è‡ªå·±çš„åŠªåŠ›å¯ä»¥æ”¹å˜ç°çŠ¶ï¼Œé¢å¯¹å›°éš¾æ—¶ä¸ä¼šè½»æ˜“æ”¾å¼ƒã€‚ä½ è¿‡å»çš„æˆåŠŸç»éªŒå¼ºåŒ–äº†ä½ çš„è‡ªä¿¡ï¼Œè®©ä½ ç›¸ä¿¡è‡ªå·±æœ‰èƒ½åŠ›å…‹æœæœªæ¥çš„éšœç¢ã€‚ä½ çŸ¥é“è‡ªå·±çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å‘æŒ¥è¿™äº›ä¼˜åŠ¿ã€‚è¿™ç§è‡ªæˆ‘æ•ˆèƒ½æ„Ÿæ˜¯æ¨åŠ¨ä½ è¡ŒåŠ¨å’ŒåšæŒçš„é‡è¦åŠ¨åŠ›ï¼Œè®©ä½ æ•¢äºè®¾å®šæœ‰æŒ‘æˆ˜æ€§çš„ç›®æ ‡å¹¶ä¸ºä¹‹åŠªåŠ›ã€‚',
      medium: 'ä½ çš„è‡ªæˆ‘æ•ˆèƒ½æ„Ÿå¤„äºä¸­ç­‰æ°´å¹³ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¯¹è‡ªå·±çš„èƒ½åŠ›æœ‰ä¸€å®šä¿¡å¿ƒï¼Œä½†åœ¨é¢å¯¹æ–°çš„æˆ–å›°éš¾çš„æŒ‘æˆ˜æ—¶å¯èƒ½ä¼šåŠ¨æ‘‡ã€‚ä½ å¯èƒ½æœ‰æ—¶ä¼šæ€€ç–‘è‡ªå·±æ˜¯å¦çœŸçš„èƒ½å¤ŸæˆåŠŸï¼Œè¿™ç§ä¸ç¡®å®šæ„Ÿå¯èƒ½ä¼šå½±å“ä½ çš„åŠ¨åŠ›å’Œè¡¨ç°ã€‚å»ºè®®ä½ é€šè¿‡ä»¥ä¸‹æ–¹å¼å¢å¼ºè‡ªæˆ‘æ•ˆèƒ½ï¼šå›é¡¾å¹¶è®°å½•ä½ è¿‡å»æˆåŠŸåº”å¯¹æŒ‘æˆ˜çš„ç»å†ï¼›å°†å¤§ç›®æ ‡åˆ†è§£ä¸ºå°æ­¥éª¤ï¼Œé€šè¿‡å®Œæˆå°ç›®æ ‡ç§¯ç´¯æˆåŠŸä½“éªŒï¼›å‘ä¸ä½ æƒ…å†µç›¸ä¼¼ä¸”æˆåŠŸçš„äººå­¦ä¹ ï¼›æ³¨æ„ä½ çš„è‡ªæˆ‘å¯¹è¯ï¼Œç”¨æ›´ç§¯æã€æ›´é¼“åŠ±çš„æ–¹å¼ä¸è‡ªå·±å¯¹è¯ã€‚',
      low: 'ä½ çš„è‡ªæˆ‘æ•ˆèƒ½æ„Ÿç›®å‰æ¯”è¾ƒä½ï¼Œå¯èƒ½ç»å¸¸æ€€ç–‘è‡ªå·±æ˜¯å¦æœ‰èƒ½åŠ›åº”å¯¹ç”Ÿæ´»ä¸­çš„æŒ‘æˆ˜ã€‚é¢å¯¹å›°éš¾æ—¶ï¼Œä½ å¯èƒ½å€¾å‘äºè®¤ä¸ºè‡ªå·±åšä¸åˆ°ï¼Œä»è€Œæ”¾å¼ƒå°è¯•æˆ–åœ¨é‡åˆ°ç¬¬ä¸€ä¸ªéšœç¢æ—¶å°±é€€ç¼©ã€‚ä½ å¯èƒ½å¯¹è‡ªå·±è¿‡äºè‹›åˆ»ï¼Œå®¹æ˜“å¿½è§†è‡ªå·±çš„æˆå°±è€Œæ”¾å¤§å¤±è´¥ã€‚è¿™ç§ä½è‡ªæˆ‘æ•ˆèƒ½æ„Ÿä¼šå½¢æˆæ¶æ€§å¾ªç¯ï¼šå› ä¸ºä¸ç›¸ä¿¡è‡ªå·±èƒ½æˆåŠŸï¼Œæ‰€ä»¥ä¸æ•¢å°è¯•æˆ–ä¸å¤ŸåŠªåŠ›ï¼Œç»“æœç¡®å®å¤±è´¥äº†ï¼Œè¿›ä¸€æ­¥å°è¯äº†"æˆ‘ä¸è¡Œ"çš„ä¿¡å¿µã€‚æ‰“ç ´è¿™ä¸ªå¾ªç¯éœ€è¦ä»å°äº‹åšèµ·ï¼šè®¾å®šä¸€ä¸ªéå¸¸å°çš„ã€å‡ ä¹è‚¯å®šèƒ½å®Œæˆçš„ç›®æ ‡ï¼Œå®Œæˆåè®¤çœŸåº†ç¥è¿™ä¸ªæˆåŠŸï¼›è®°å½•æ¯ä¸€ä¸ªå°æˆå°±ï¼Œæ— è®ºå¤šä¹ˆå¾®å°ï¼›å°è¯•ç”¨"æˆ‘æ­£åœ¨å­¦ä¹ "ä»£æ›¿"æˆ‘ä¸ä¼š"çš„æ€ç»´æ–¹å¼ã€‚'
    }
  };
  const pct = score / 28;
  if (pct >= 0.7) return analyses[dim].high;
  if (pct >= 0.5) return analyses[dim].medium;
  return analyses[dim].low;
}

function showResult() {
  document.getElementById('testPage').classList.remove('active');
  document.getElementById('resultPage').classList.add('active');

  const scores = calcScores();
  const resilienceTotal = scores.emotional + scores.cognitive + scores.social + scores.efficacy;
  const stressLevel = getStressLevel(scores.stress);
  const resilienceLevel = getResilienceLevel(resilienceTotal);

  const html = `
    <div class="stress-indicator">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div style="font-size:14px;color:var(--text-muted);margin-bottom:4px;">å½“å‰å‹åŠ›æ°´å¹³</div>
          <div style="font-size:24px;font-weight:700;color:${stressLevel.color};">${stressLevel.level}</div>
        </div>
        <div style="font-size:36px;font-weight:700;color:${stressLevel.color};">${scores.stress}/28</div>
      </div>
      <div class="stress-bar"><div class="stress-fill" style="width:${(scores.stress/28)*100}%;background:linear-gradient(90deg, #10b981, #f59e0b, #ef4444);"></div></div>
      <div style="font-size:14px;color:var(--text-muted);">${stressLevel.desc}</div>
    </div>

    <div class="card" style="text-align:center;">
      <div style="font-size:14px;color:var(--text-muted);margin-bottom:8px;">å¿ƒç†éŸ§æ€§æŒ‡æ•°</div>
      <div class="resilience-score">${resilienceTotal}</div>
      <div class="resilience-level" style="background:${resilienceLevel.color};">${resilienceLevel.level}</div>
      <div style="color:var(--text-muted);font-size:14px;line-height:1.8;margin-top:16px;">${resilienceLevel.desc}</div>
      <div class="stat-grid">
        <div class="stat-card"><div class="stat-value">${scores.emotional}</div><div class="stat-label">æƒ…ç»ªéŸ§æ€§</div></div>
        <div class="stat-card"><div class="stat-value">${scores.cognitive}</div><div class="stat-label">è®¤çŸ¥çµæ´»</div></div>
        <div class="stat-card"><div class="stat-value">${scores.social}</div><div class="stat-label">ç¤¾ä¼šæ”¯æŒ</div></div>
        <div class="stat-card"><div class="stat-value">${scores.efficacy}</div><div class="stat-label">è‡ªæˆ‘æ•ˆèƒ½</div></div>
        <div class="stat-card"><div class="stat-value">${resilienceTotal}</div><div class="stat-label">éŸ§æ€§æ€»åˆ†</div></div>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#dbeafe">ğŸ“Š</div>éŸ§æ€§ç»´åº¦åˆ†æ</div>
      <div class="chart-container"><canvas id="radarChart"></canvas></div>
      ${['emotional', 'cognitive', 'social', 'efficacy'].map(d => {
        const info = dimInfo[d];
        const score = scores[d];
        const lv = getLevel(score, 28);
        return `
          <div class="dim-item">
            <div class="dim-header">
              <div class="dim-name"><div class="dim-icon" style="background:${info.bg}">${info.icon}</div>${info.name}</div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span class="level-badge ${lv.class}">${lv.level}</span>
                <span style="font-weight:600;color:var(--primary);">${score}/28</span>
              </div>
            </div>
            <div class="dim-bar"><div class="dim-bar-fill" style="width:${(score/28)*100}%;background:${info.color}"></div></div>
            <div style="font-size:14px;color:var(--text-muted);line-height:1.7;margin-top:8px;padding:12px;background:#f8fafc;border-radius:8px;">${getDimAnalysis(d, score)}</div>
          </div>
        `;
      }).join('')}
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#d1fae5">ğŸ’¡</div>å‹åŠ›ç®¡ç†å»ºè®®</div>
      <div class="tip-item"><div class="tip-num">1</div><div class="tip-text">æ¯å¤©è¿›è¡Œ15-20åˆ†é’Ÿçš„æ”¾æ¾æ´»åŠ¨ï¼Œå¦‚æ·±å‘¼å¸ã€å†¥æƒ³æˆ–è½»åº¦è¿åŠ¨</div></div>
      <div class="tip-item"><div class="tip-num">2</div><div class="tip-text">ä¿æŒè§„å¾‹çš„ä½œæ¯æ—¶é—´ï¼Œç¡®ä¿æ¯æ™š7-8å°æ—¶çš„ä¼˜è´¨ç¡çœ </div></div>
      <div class="tip-item"><div class="tip-num">3</div><div class="tip-text">å»ºç«‹æ¸…æ™°çš„å·¥ä½œä¸ç”Ÿæ´»è¾¹ç•Œï¼Œå­¦ä¼šè¯´"ä¸"</div></div>
      <div class="tip-item"><div class="tip-num">4</div><div class="tip-text">åŸ¹å…»è‡³å°‘ä¸€é¡¹èƒ½è®©ä½ æ„Ÿåˆ°æ”¾æ¾å’Œæ„‰æ‚¦çš„çˆ±å¥½</div></div>
      <div class="tip-item"><div class="tip-num">5</div><div class="tip-text">å®šæœŸä¸ä¿¡ä»»çš„äººåˆ†äº«æ„Ÿå—ï¼Œä¸è¦ç‹¬è‡ªæ‰¿æ‹…æ‰€æœ‰å‹åŠ›</div></div>
    </div>

    ${scores.stress > 21 ? `
    <div class="warning-box">
      <div class="warning-title">âš ï¸ é‡è¦æç¤º</div>
      <div style="font-size:14px;color:var(--text-muted);line-height:1.7;">
        ä½ å½“å‰çš„å‹åŠ›æ°´å¹³è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¼šå½±å“ä½ çš„èº«å¿ƒå¥åº·ã€‚å»ºè®®ä½ ï¼š
        <br>â€¢ ä¼˜å…ˆå¤„ç†æœ€ç´§æ€¥çš„å‹åŠ›æº
        <br>â€¢ ä¸»åŠ¨å¯»æ±‚å®¶äººã€æœ‹å‹æˆ–ä¸“ä¸šäººå£«çš„æ”¯æŒ
        <br>â€¢ å¦‚æœæŒç»­æ„Ÿåˆ°éš¾ä»¥æ‰¿å—ï¼Œè¯·è€ƒè™‘å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢
      </div>
    </div>
    ` : ''}

    <div class="card download-section">
      <button class="download-btn" onclick="downloadPDF()" id="dlBtn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>ä¸‹è½½PDFæŠ¥å‘Š</button>
      <button class="restart-btn" onclick="restart()">é‡æ–°æµ‹è¯•</button>
      ${getHomeButtonHtml()}
    </div>
  `;

  document.getElementById('resultContent').innerHTML = html;

  setTimeout(() => {
    new Chart(document.getElementById('radarChart'), {
      type: 'radar',
      data: {
        labels: ['æƒ…ç»ªéŸ§æ€§', 'è®¤çŸ¥çµæ´»', 'ç¤¾ä¼šæ”¯æŒ', 'è‡ªæˆ‘æ•ˆèƒ½'],
        datasets: [{ data: [scores.emotional, scores.cognitive, scores.social, scores.efficacy], backgroundColor: 'rgba(102, 126, 234, 0.2)', borderColor: 'rgba(102, 126, 234, 1)', borderWidth: 2, pointBackgroundColor: 'rgba(102, 126, 234, 1)' }]
      },
      options: { scales: { r: { beginAtZero: true, max: 28, ticks: { stepSize: 7 } } }, plugins: { legend: { display: false } } }
    });
  }, 100);
}

function restart() { if (confirm('ç¡®å®šè¦é‡æ–°æµ‹è¯•å—ï¼Ÿ')) location.reload(); }

async function downloadPDF() {
  const btn = document.getElementById('dlBtn');
  const loading = document.getElementById('loading');
  btn.disabled = true; btn.innerHTML = 'ç”Ÿæˆä¸­...'; loading.classList.add('show');
  try {
    const scores = calcScores();
    const resilienceTotal = scores.emotional + scores.cognitive + scores.social + scores.efficacy;
    const stressLevel = getStressLevel(scores.stress);
    const resilienceLevel = getResilienceLevel(resilienceTotal);
    const date = new Date().toLocaleDateString('zh-CN');

    const pdfContainer = document.createElement('div');
    pdfContainer.style.cssText = 'position:absolute;left:-9999px;top:0;width:800px;background:#fff;padding:40px;font-family:"Noto Sans SC",sans-serif;';
    pdfContainer.innerHTML = `
      <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:50px 40px;margin:-40px -40px 30px -40px;text-align:center;color:#fff;">
        <div style="font-size:16px;margin-bottom:10px;opacity:0.9;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div style="font-size:32px;font-weight:700;margin-bottom:15px;">å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„æŠ¥å‘Š</div>
        <div style="font-size:14px;opacity:0.8;">æµ‹è¯„æ—¥æœŸï¼š${date}</div>
      </div>
      <div style="display:flex;gap:20px;margin-bottom:25px;">
        <div style="flex:1;background:linear-gradient(135deg,#fef2f2,#fff7ed);border-radius:16px;padding:24px;text-align:center;">
          <div style="font-size:14px;color:#64748b;margin-bottom:8px;">å‹åŠ›æ°´å¹³</div>
          <div style="font-size:36px;font-weight:700;color:${stressLevel.color};">${scores.stress}/28</div>
          <div style="font-size:16px;font-weight:600;color:${stressLevel.color};">${stressLevel.level}</div>
        </div>
        <div style="flex:1;background:#f8fafc;border-radius:16px;padding:24px;text-align:center;">
          <div style="font-size:14px;color:#64748b;margin-bottom:8px;">éŸ§æ€§æŒ‡æ•°</div>
          <div style="font-size:36px;font-weight:700;color:${resilienceLevel.color};">${resilienceTotal}/112</div>
          <div style="font-size:16px;font-weight:600;color:${resilienceLevel.color};">${resilienceLevel.level}</div>
        </div>
      </div>
      <div style="display:flex;gap:12px;margin-bottom:25px;">
        ${['emotional', 'cognitive', 'social', 'efficacy'].map(d => `<div style="flex:1;background:#f8fafc;border-radius:12px;padding:16px;text-align:center;"><div style="font-size:24px;font-weight:700;color:#667eea;">${scores[d]}</div><div style="font-size:11px;color:#64748b;">${dimInfo[d].name}</div></div>`).join('')}
      </div>
      <div style="background:#f8fafc;border-radius:12px;padding:20px;text-align:center;color:#94a3b8;font-size:12px;">
        <div style="margin-bottom:8px;font-weight:500;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div>æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­</div>
      </div>
    `;
    document.body.appendChild(pdfContainer);
    await document.fonts.ready;
    await new Promise(r => setTimeout(r, 300));
    const canvas = await html2canvas(pdfContainer, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
    document.body.removeChild(pdfContainer);
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    const imgData = canvas.toDataURL('image/jpeg', 0.95);
    const pdfW = 210, finalW = pdfW - 20;
    const ratio = canvas.width / canvas.height;
    const finalH = finalW / ratio;
    pdf.addImage(imgData, 'JPEG', 10, 10, finalW, finalH);
    pdf.save(`å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„æŠ¥å‘Š_${date}.pdf`);
  } catch (e) { console.error(e); alert('PDFç”Ÿæˆå¤±è´¥'); }
  finally { btn.disabled = false; btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> ä¸‹è½½PDFæŠ¥å‘Š'; loading.classList.remove('show'); }
}

render();
</script>
</body>
</html>
