<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¬²æœ›æ¯”é‡æµ‹è¯• | å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root {
  --primary: #8b5cf6;
  --primary-dark: #7c3aed;
  --primary-light: #a78bfa;
  --gradient: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #1e293b;
  --text-muted: #64748b;
  --border: #e2e8f0;
  --shadow: 0 4px 20px rgba(0,0,0,0.08);
  --radius: 16px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans SC', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
.page { display: none; min-height: 100vh; }
.page.active { display: block; }

/* æµ‹è¯•é¡µ */
#testPage { background: var(--bg); padding: 20px; }
.test-container { max-width: 700px; margin: 0 auto; }
.test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.back-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: all 0.2s; }
.back-btn:hover { background: white; color: var(--text); }
.progress-wrap { text-align: right; }
.progress-text { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
.progress-bar { width: 180px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--gradient); border-radius: 3px; transition: width 0.3s; }
.question-card { background: var(--card); border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); }
.q-num { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.q-text { font-size: 20px; font-weight: 600; line-height: 1.5; margin-bottom: 32px; }
.options { display: flex; flex-direction: column; gap: 12px; }
.opt { display: flex; align-items: center; gap: 14px; padding: 16px 20px; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
.opt:hover { border-color: var(--primary-light); background: #faf5ff; }
.opt.selected { border-color: var(--primary); background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); }
.opt-radio { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
.opt.selected .opt-radio { border-color: var(--primary); background: var(--primary); }
.opt.selected .opt-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
.opt-text { font-size: 15px; font-weight: 500; }
.nav-btns { display: flex; gap: 12px; margin-top: 32px; }
.nav-btn { flex: 1; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s; }
.nav-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.nav-btn.secondary:hover { border-color: var(--primary-light); }
.nav-btn.primary { background: var(--gradient); border: none; color: white; }
.nav-btn.primary:hover { opacity: 0.9; }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }

/* ç»“æœé¡µ */
#resultPage { background: #f8fafc; }
.result-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
.result-header { text-align: center; margin-bottom: 40px; }
.result-logo { font-size: 64px; margin-bottom: 16px; }
.result-title { font-size: 28px; font-weight: 700; color: var(--text); margin-bottom: 8px; }
.result-subtitle { color: var(--text-muted); font-size: 15px; }
.card { background: #fff; border-radius: 20px; padding: 32px; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
.section-title { display: flex; align-items: center; gap: 12px; font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--text); }
.section-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }

/* ç±»å‹å¡ç‰‡ */
.type-main { padding: 24px; background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); border-radius: 16px; margin-bottom: 20px; text-align: center; }
.type-icon { font-size: 56px; margin-bottom: 12px; }
.type-name { font-size: 24px; font-weight: 700; color: #5b21b6; margin-bottom: 8px; }
.type-subtitle { font-size: 14px; color: #7c3aed; margin-bottom: 16px; }
.type-desc { font-size: 14px; color: #4c1d95; line-height: 1.7; text-align: left; }

/* é›·è¾¾å›¾ */
.chart-container { height: 320px; margin: 20px 0; }

/* ç»´åº¦åˆ†æ */
.dim-item { padding: 20px; background: #f8fafc; border-radius: 12px; margin-bottom: 12px; }
.dim-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.dim-name { display: flex; align-items: center; gap: 10px; font-weight: 600; }
.dim-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
.dim-bar { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
.dim-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
.dim-level { font-size: 13px; padding: 4px 12px; border-radius: 12px; }

/* å†²çªåˆ†æ */
.conflict-box { padding: 20px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 12px; margin-top: 20px; }
.conflict-title { font-weight: 600; color: #92400e; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.conflict-content { font-size: 14px; color: #78350f; line-height: 1.7; }

/* è¢«å‹æŠ‘æ¬²æœ› */
.suppressed-box { padding: 20px; background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); border-radius: 12px; margin-top: 20px; }
.suppressed-title { font-weight: 600; color: #3730a3; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.suppressed-content { font-size: 14px; color: #312e81; line-height: 1.7; }

/* å»ºè®® */
.tip-item { display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid #f1f5f9; }
.tip-item:last-child { border-bottom: none; }
.tip-num { width: 28px; height: 28px; background: var(--gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 14px; font-weight: 600; flex-shrink: 0; }
.tip-text { font-size: 14px; color: var(--text-muted); line-height: 1.6; }

/* é£é™©æé†’ */
.risk-box { padding: 20px; background: #fef2f2; border: 1px solid #fecaca; border-radius: 12px; margin-top: 20px; }
.risk-title { font-weight: 600; color: #991b1b; margin-bottom: 8px; }
.risk-content { font-size: 14px; color: #7f1d1d; line-height: 1.6; }

/* æŒ‰é’® */
.action-buttons { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 32px; }
.action-btn { flex: 1; min-width: 140px; padding: 16px 24px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
.action-btn.primary { background: var(--gradient); border: none; color: #fff; }
.action-btn.secondary { background: #fff; border: 2px solid var(--border); color: var(--text); }
.restart-btn { background: #fff; border: 2px solid var(--border); color: var(--text); padding: 16px 24px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; }

/* å¼¹çª— */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s; }
.modal-overlay.show { opacity: 1; visibility: visible; }
.modal-content { background: #fff; border-radius: 24px; padding: 40px; max-width: 400px; text-align: center; }
.modal-icon { font-size: 48px; margin-bottom: 16px; }
.modal-content h3 { font-size: 20px; margin-bottom: 12px; }
.modal-content p { color: var(--text-muted); margin-bottom: 24px; }
.modal-btn { padding: 14px 32px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; }
.modal-btn.primary { background: var(--gradient); border: none; color: #fff; }

/* loading */
.loading-overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s; }
.loading-overlay.show { opacity: 1; visibility: visible; }
.loading-spinner { width: 48px; height: 48px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

@media (max-width: 640px) {
  .action-buttons { flex-direction: column; }
}
</style>
</head>
<body>

<div id="testPage" class="page active">
  <div class="test-container">
    <div class="test-header">
      <button class="back-btn" onclick="if(confirm('ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ'))location.href='index.html'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        è¿”å›
      </button>
      <div class="progress-wrap">
        <div class="progress-text"><span id="current">1</span> / 36</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:2.78%"></div></div>
      </div>
    </div>
    <div class="question-card">
      <div class="q-num">ç¬¬ <span id="qNum">1</span> é¢˜</div>
      <div class="q-text" id="questionText"></div>
      <div class="options" id="optionsContainer"></div>
      <div class="nav-btns">
        <button class="nav-btn secondary" id="prevBtn" onclick="prev()" disabled>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          ä¸Šä¸€é¢˜
        </button>
        <button class="nav-btn primary" id="nextBtn" onclick="next()" disabled>
          ä¸‹ä¸€é¢˜
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<div id="resultPage" class="page">
  <div class="result-container" id="resultContent"></div>
</div>

<div class="loading-overlay" id="loading">
  <div class="loading-spinner"></div>
  <p style="margin-top:16px;color:var(--text-muted)">æ­£åœ¨ç”ŸæˆPDFæŠ¥å‘Š...</p>
</div>

<script>
const questions = [
  // æƒ…æ„Ÿè¿æ¥ (6é¢˜)
  { q: "å½“ä½ æ„Ÿåˆ°å­¤ç‹¬æ—¶ï¼Œæœ€æ¸´æœ›çš„æ˜¯ä»€ä¹ˆï¼Ÿ", dim: "emotion", options: [
    { text: "æœ‰äººçœŸæ­£æ‡‚æˆ‘åœ¨æƒ³ä»€ä¹ˆ", score: 4 },
    { text: "æœ‰äººé™ªåœ¨èº«è¾¹å°±å¥½", score: 3 },
    { text: "è‡ªå·±å¾…ç€å…¶å®ä¹Ÿè¿˜å¥½", score: 1 },
    { text: "å¿™èµ·æ¥å°±ä¸å­¤ç‹¬äº†", score: 2 }
  ]},
  { q: "åœ¨é‡è¦å†³å®šä¸Šï¼Œä½ æ›´çœ‹é‡ä»€ä¹ˆï¼Ÿ", dim: "emotion", options: [
    { text: "å®¶äººæˆ–ä¼´ä¾£çš„æ„Ÿå—", score: 4 },
    { text: "å¯¹æˆ‘é‡è¦çš„äººæ€ä¹ˆçœ‹", score: 3 },
    { text: "æˆ‘è‡ªå·±è§‰å¾—å¯¹å°±è¡Œ", score: 1 },
    { text: "å“ªä¸ªé€‰æ‹©æ”¶ç›Šæ›´å¤§", score: 2 }
  ]},
  { q: "å¦‚æœè¦åœ¨äº‹ä¸šæˆåŠŸå’Œç¾æ»¡æ„Ÿæƒ…ä¹‹é—´é€‰ï¼Œä½ ä¼šï¼Ÿ", dim: "emotion", options: [
    { text: "æ¯«ä¸çŠ¹è±«é€‰æ„Ÿæƒ…", score: 4 },
    { text: "å€¾å‘äºæ„Ÿæƒ…ï¼Œä½†ä¼šçº ç»“", score: 3 },
    { text: "å¯èƒ½é€‰äº‹ä¸šï¼Œä½†ä¸ç¡®å®š", score: 2 },
    { text: "å½“ç„¶æ˜¯äº‹ä¸šæ›´é‡è¦", score: 1 }
  ]},
  { q: "ä½ è®¤ä¸ºä»€ä¹ˆæœ€èƒ½ç»™ä½ æŒç»­çš„æ»¡è¶³æ„Ÿï¼Ÿ", dim: "emotion", options: [
    { text: "ä¸é‡è¦çš„äººåˆ†äº«ç”Ÿæ´»ç‚¹æ»´", score: 4 },
    { text: "æ‹¥æœ‰ç¨³å®šä¿¡ä»»çš„å…³ç³»ç½‘ç»œ", score: 3 },
    { text: "çœ‹åˆ°è‡ªå·±ä¸æ–­æˆé•¿è¿›æ­¥", score: 2 },
    { text: "æŒæ§è‡ªå·±çš„äººç”Ÿæ–¹å‘", score: 1 }
  ]},
  { q: "åœ¨ä¸€æ®µå…³ç³»ä¸­ï¼Œä½ æœ€æ— æ³•å¿å—çš„æ˜¯ï¼Ÿ", dim: "emotion", options: [
    { text: "è¢«å¿½è§†æˆ–ä¸è¢«ç†è§£", score: 4 },
    { text: "å¯¹æ–¹ä¸å¤Ÿå¦è¯š", score: 3 },
    { text: "å¯¹æ–¹é™åˆ¶æˆ‘çš„è‡ªç”±", score: 1 },
    { text: "å¯¹æ–¹æ²¡æœ‰ä¸Šè¿›å¿ƒ", score: 2 }
  ]},
  { q: "æƒ³è±¡ä½ è€äº†ä»¥åï¼Œæœ€é‡è¦çš„æ˜¯ï¼Ÿ", dim: "emotion", options: [
    { text: "æœ‰æ·±çˆ±çš„äººé™ªä¼´", score: 4 },
    { text: "å„¿å­™æ»¡å ‚å…¶ä¹èè", score: 3 },
    { text: "å›é¡¾ä¸€ç”Ÿæ— æ‚”çš„æˆå°±", score: 2 },
    { text: "èº«ä½“å¥åº·ç»æµè‡ªç”±", score: 1 }
  ]},

  // å®‰å…¨æ„Ÿ (6é¢˜)
  { q: "é¢å¯¹æœªçŸ¥çš„å˜åŒ–ï¼Œä½ é€šå¸¸çš„ååº”æ˜¯ï¼Ÿ", dim: "security", options: [
    { text: "å°½é‡è§„é¿ï¼Œç¨³å®šæœ€é‡è¦", score: 4 },
    { text: "åšå¥½å……åˆ†å‡†å¤‡å†è¡ŒåŠ¨", score: 3 },
    { text: "æœ‰äº›æ‹…å¿ƒä½†è¿˜æ˜¯ä¼šå°è¯•", score: 2 },
    { text: "å…´å¥‹ï¼Œå˜åŒ–æ„å‘³ç€æœºä¼š", score: 1 }
  ]},
  { q: "ä½ çš„å­˜æ¬¾ä¹ æƒ¯æ˜¯æ€æ ·çš„ï¼Ÿ", dim: "security", options: [
    { text: "å¿…é¡»æœ‰è¶³å¤Ÿçš„åº”æ€¥å‚¨å¤‡", score: 4 },
    { text: "æœ‰è®¡åˆ’åœ°å­˜é’±", score: 3 },
    { text: "æœ‰ä½™é’±æ‰å­˜ï¼Œä¸å¼ºæ±‚", score: 2 },
    { text: "æ´»åœ¨å½“ä¸‹ï¼Œå­˜é’±ä¸æ˜¯é‡ç‚¹", score: 1 }
  ]},
  { q: "ä½ å¯¹ç¨³å®šå·¥ä½œçš„çœ‹æ³•æ˜¯ï¼Ÿ", dim: "security", options: [
    { text: "éå¸¸å‘å¾€ï¼Œç¨³å®šæœ€é‡è¦", score: 4 },
    { text: "æœ‰å¸å¼•åŠ›ï¼Œä½†ä¸æ˜¯å”¯ä¸€é€‰æ‹©", score: 3 },
    { text: "è¿˜å¥½ï¼Œçœ‹å…·ä½“æƒ…å†µ", score: 2 },
    { text: "å¤ªæ— èŠäº†ï¼Œä¸é€‚åˆæˆ‘", score: 1 }
  ]},
  { q: "ä½ å¯¹ä¹°æˆ¿ä¹°è½¦çš„æ€åº¦æ˜¯ï¼Ÿ", dim: "security", options: [
    { text: "å¿…é¡»æœ‰ï¼Œè¿™æ˜¯å®‰å…¨æ„Ÿçš„æ¥æº", score: 4 },
    { text: "åº”è¯¥æœ‰ï¼Œä½†é‡åŠ›è€Œè¡Œ", score: 3 },
    { text: "å¯æœ‰å¯æ— ï¼Œç§Ÿæˆ¿ä¹ŸæŒºå¥½", score: 2 },
    { text: "ä¸æƒ³è¢«æˆ¿è´·è½¦è´·æŸç¼š", score: 1 }
  ]},
  { q: "å½“æ—¢å®šè®¡åˆ’è¢«æ‰“ä¹±æ—¶ï¼Œä½ çš„ååº”æ˜¯ï¼Ÿ", dim: "security", options: [
    { text: "æ„Ÿåˆ°ç„¦è™‘ï¼Œç«‹åˆ»åˆ¶å®šæ–°è®¡åˆ’", score: 4 },
    { text: "æœ‰äº›å›°æ‰°ï¼Œä½†èƒ½è°ƒæ•´é€‚åº”", score: 3 },
    { text: "æ— æ‰€è°“ï¼Œè§æœºè¡Œäº‹", score: 2 },
    { text: "åè€Œè§‰å¾—æœ‰è¶£ï¼Œå–œæ¬¢æ„å¤–", score: 1 }
  ]},
  { q: "é¢å¯¹ä¸€ä¸ªé«˜é£é™©é«˜å›æŠ¥çš„æœºä¼šï¼Œä½ ä¼šï¼Ÿ", dim: "security", options: [
    { text: "æœæ–­æ‹’ç»ï¼Œä¸å†’è¿™ä¸ªé™©", score: 4 },
    { text: "ä»”ç»†è¯„ä¼°é£é™©å†å†³å®š", score: 3 },
    { text: "æœ‰äº›å¿ƒåŠ¨ï¼Œå¯èƒ½ä¼šå°è¯•", score: 2 },
    { text: "è¿™ç§æœºä¼šæ€èƒ½é”™è¿‡", score: 1 }
  ]},

  // ç‰©è´¨é‡‘é’± (6é¢˜)
  { q: "ä½ è®¤ä¸ºé‡‘é’±å¯¹ä½ æ„å‘³ç€ä»€ä¹ˆï¼Ÿ", dim: "money", options: [
    { text: "æ˜¯è¡¡é‡æˆåŠŸçš„é‡è¦æ ‡å‡†", score: 4 },
    { text: "æ˜¯å®ç°ç›®æ ‡çš„é‡è¦å·¥å…·", score: 3 },
    { text: "å¤Ÿç”¨å°±è¡Œï¼Œä¸æ˜¯æœ€é‡è¦çš„", score: 2 },
    { text: "èº«å¤–ä¹‹ç‰©ï¼Œä¸å¿…å¤ªåœ¨æ„", score: 1 }
  ]},
  { q: "å¦‚æœä¸­äº†ä¸€å¤§ç¬”é’±ï¼Œä½ é¦–å…ˆä¼šï¼Ÿ", dim: "money", options: [
    { text: "æŠ•èµ„ç†è´¢ï¼Œè®©é’±ç”Ÿé’±", score: 4 },
    { text: "æ”¹å–„ç”Ÿæ´»å“è´¨", score: 3 },
    { text: "å®ç°ä¸€ä¸ªæ¢¦æƒ³", score: 2 },
    { text: "åˆ†äº«ç»™é‡è¦çš„äºº", score: 1 }
  ]},
  { q: "ä½ å¯¹åç‰Œå¥¢ä¾ˆå“çš„æ€åº¦æ˜¯ï¼Ÿ", dim: "money", options: [
    { text: "å–œæ¬¢ï¼Œå“è´¨å’Œèº«ä»½çš„è±¡å¾", score: 4 },
    { text: "å¶å°”ä¹°ï¼Œå¥–åŠ±è‡ªå·±", score: 3 },
    { text: "ä¸å¤ªåœ¨æ„å“ç‰Œ", score: 2 },
    { text: "è§‰å¾—æ²¡å¿…è¦ï¼Œæ€§ä»·æ¯”æ›´é‡è¦", score: 1 }
  ]},
  { q: "é€‰æ‹©å·¥ä½œæ—¶ï¼Œè–ªèµ„çš„é‡è¦æ€§ï¼Ÿ", dim: "money", options: [
    { text: "æœ€é‡è¦ï¼Œå…¶ä»–éƒ½å¯ä»¥å¦¥å", score: 4 },
    { text: "å¾ˆé‡è¦ï¼Œä½†ä¸æ˜¯å”¯ä¸€å› ç´ ", score: 3 },
    { text: "è¦å¤Ÿç”Ÿæ´»ï¼Œä½†æ›´çœ‹é‡å…¶ä»–", score: 2 },
    { text: "ä¸æ˜¯æœ€é‡è¦çš„ï¼Œçƒ­çˆ±æ›´é‡è¦", score: 1 }
  ]},
  { q: "ä½ ä¼šå› ä¸ºä»€ä¹ˆè€Œæ„Ÿåˆ°ç‰¹åˆ«æœ‰æˆå°±æ„Ÿï¼Ÿ", dim: "money", options: [
    { text: "æ”¶å…¥åˆå¢åŠ äº†", score: 4 },
    { text: "ä¹°åˆ°äº†æƒ³è¦çš„ä¸œè¥¿", score: 3 },
    { text: "å®Œæˆäº†æœ‰æŒ‘æˆ˜çš„ä»»åŠ¡", score: 2 },
    { text: "å¸®åŠ©åˆ°äº†åˆ«äºº", score: 1 }
  ]},
  { q: "ä½ å’Œæœ‹å‹èšä¼šæ—¶ï¼ŒAAè¿˜æ˜¯è¯·å®¢ï¼Ÿ", dim: "money", options: [
    { text: "è°æœ‰é’±è°è¯·ï¼Œæˆ‘æ„¿æ„è¯·", score: 4 },
    { text: "è½®æµè¯·æ¯”è¾ƒåˆé€‚", score: 3 },
    { text: "AAæœ€å…¬å¹³", score: 2 },
    { text: "ä¸å¤ªåœ¨æ„è¿™äº›", score: 1 }
  ]},

  // æˆå°±è®¤å¯ (6é¢˜)
  { q: "ä½ åšä¸€ä»¶äº‹çš„åŠ¨åŠ›ä¸»è¦æ¥è‡ªï¼Ÿ", dim: "achievement", options: [
    { text: "è¢«äººè®¤å¯å’Œèµèµ", score: 4 },
    { text: "è¯æ˜è‡ªå·±çš„èƒ½åŠ›", score: 3 },
    { text: "å®Œæˆä»»åŠ¡çš„æ»¡è¶³æ„Ÿ", score: 2 },
    { text: "çº¯ç²¹å› ä¸ºå–œæ¬¢", score: 1 }
  ]},
  { q: "å½“ä½ å–å¾—æˆå°±æ—¶ï¼Œä½ æœ€æƒ³ï¼Ÿ", dim: "achievement", options: [
    { text: "è®©æ‰€æœ‰äººéƒ½çŸ¥é“", score: 4 },
    { text: "å’Œäº²è¿‘çš„äººåˆ†äº«", score: 3 },
    { text: "è‡ªå·±é»˜é»˜å¼€å¿ƒ", score: 2 },
    { text: "é©¬ä¸Šå¼€å§‹ä¸‹ä¸€ä¸ªç›®æ ‡", score: 1 }
  ]},
  { q: "ä½ å¯¹å‡ºäººå¤´åœ°çš„çœ‹æ³•æ˜¯ï¼Ÿ", dim: "achievement", options: [
    { text: "è¿™æ˜¯æˆ‘çš„äººç”Ÿç›®æ ‡", score: 4 },
    { text: "å¦‚æœèƒ½åšåˆ°å½“ç„¶å¥½", score: 3 },
    { text: "é¡ºå…¶è‡ªç„¶å°±å¥½", score: 2 },
    { text: "å¹³å‡¡ä¹ŸæŒºå¥½", score: 1 }
  ]},
  { q: "åœ¨ç¤¾äº¤åª’ä½“ä¸Šçœ‹åˆ°ä»–äººçš„æˆå°±å±•ç¤ºï¼Œä½ ä¼šï¼Ÿ", dim: "achievement", options: [
    { text: "æ„Ÿåˆ°å‹åŠ›ï¼Œæƒ³è¦æ›´åŠªåŠ›", score: 4 },
    { text: "æ—¢ç¾¡æ…•åˆæ¿€åŠ±è‡ªå·±", score: 3 },
    { text: "çœ‹çœ‹å°±è¿‡ï¼Œä¸å¤ªå—å½±å“", score: 2 },
    { text: "è§‰å¾—å±•ç¤ºæˆå°±æœ‰ç‚¹æ²¡å¿…è¦", score: 1 }
  ]},
  { q: "ä½ æ›´å¸Œæœ›è¢«äººè®°ä½ä¸ºï¼Ÿ", dim: "achievement", options: [
    { text: "æŸä¸ªé¢†åŸŸçš„æˆåŠŸäººå£«", score: 4 },
    { text: "æœ‰èƒ½åŠ›ä¸”å¯é çš„äºº", score: 3 },
    { text: "å–„è‰¯æœ‰è¶£çš„äºº", score: 2 },
    { text: "çœŸå®åšè‡ªå·±çš„äºº", score: 1 }
  ]},
  { q: "é¢å¯¹å¤±è´¥ï¼Œä½ æœ€æ‹…å¿ƒçš„æ˜¯ï¼Ÿ", dim: "achievement", options: [
    { text: "åˆ«äººæ€ä¹ˆçœ‹æˆ‘", score: 4 },
    { text: "æµªè´¹äº†æ—¶é—´å’Œæœºä¼š", score: 3 },
    { text: "éœ€è¦é‡æ–°å¼€å§‹", score: 2 },
    { text: "æ²¡ä»€ä¹ˆï¼Œå¤±è´¥å¾ˆæ­£å¸¸", score: 1 }
  ]},

  // è‡ªç”±ç‹¬ç«‹ (6é¢˜)
  { q: "ä½ æœ€ç†æƒ³çš„å·¥ä½œçŠ¶æ€æ˜¯ï¼Ÿ", dim: "freedom", options: [
    { text: "å®Œå…¨è‡ªç”±å®‰æ’æ—¶é—´åœ°ç‚¹", score: 4 },
    { text: "å¼¹æ€§å·¥ä½œï¼Œæœ‰ä¸€å®šè‡ªç”±åº¦", score: 3 },
    { text: "æœ‰è§„å¾‹çš„ä¸Šä¸‹ç­ä¹Ÿä¸é”™", score: 2 },
    { text: "åªè¦æœ‰äººå¸¦å°±è¡Œ", score: 1 }
  ]},
  { q: "ä½ å¯¹åº”è¯¥åšçš„äº‹çš„æ€åº¦æ˜¯ï¼Ÿ", dim: "freedom", options: [
    { text: "å¾ˆåæ„Ÿè¢«è¦æ±‚åšä»€ä¹ˆ", score: 4 },
    { text: "ç†è§£ä½†å¸Œæœ›æœ‰é€‰æ‹©æƒ", score: 3 },
    { text: "ç¤¾ä¼šè§„èŒƒè¿˜æ˜¯è¦éµå®ˆ", score: 2 },
    { text: "åšåº”è¯¥åšçš„äº‹å¾ˆæ­£å¸¸", score: 1 }
  ]},
  { q: "åœ¨äººé™…å…³ç³»ä¸­ï¼Œä½ æ›´çœ‹é‡ï¼Ÿ", dim: "freedom", options: [
    { text: "å¯¹æ–¹ä¸å¹²æ¶‰æˆ‘çš„ç”Ÿæ´»", score: 4 },
    { text: "å½¼æ­¤æœ‰ç‹¬ç«‹ç©ºé—´", score: 3 },
    { text: "ç›¸äº’æ”¯æŒå’Œé™ªä¼´", score: 2 },
    { text: "èå…¥å½¼æ­¤çš„ç”Ÿæ´»", score: 1 }
  ]},
  { q: "å¦‚æœæœ‰äººæ€»æƒ³å¸®ä½ åšå†³å®šï¼Œä½ ä¼šï¼Ÿ", dim: "freedom", options: [
    { text: "éå¸¸åæ„Ÿï¼Œè¿™æ˜¯æˆ‘çš„äº‹", score: 4 },
    { text: "å§”å©‰æ‹’ç»ï¼ŒåšæŒå·±è§", score: 3 },
    { text: "çœ‹æƒ…å†µï¼Œæœ‰æ—¶ä¼šå‚è€ƒ", score: 2 },
    { text: "å¦‚æœæ˜¯ä¸ºæˆ‘å¥½å¯ä»¥æ¥å—", score: 1 }
  ]},
  { q: "ä½ å¯¹æ¼‚æ³Šç”Ÿæ´»çš„çœ‹æ³•æ˜¯ï¼Ÿ", dim: "freedom", options: [
    { text: "å‘å¾€ï¼Œè‡ªç”±æœ€é‡è¦", score: 4 },
    { text: "å¹´è½»æ—¶å¯ä»¥ä½“éªŒ", score: 3 },
    { text: "å¶å°”æ—…è¡Œå°±å¥½", score: 2 },
    { text: "å¤ªä¸ç¨³å®šï¼Œä¸é€‚åˆæˆ‘", score: 1 }
  ]},
  { q: "ä½ æœ€å®³æ€•çš„æ˜¯ï¼Ÿ", dim: "freedom", options: [
    { text: "è¢«å›°åœ¨ä¸€æˆä¸å˜çš„ç”Ÿæ´»é‡Œ", score: 4 },
    { text: "å¤±å»é€‰æ‹©çš„æƒåˆ©", score: 3 },
    { text: "å¤±å»é‡è¦çš„äºº", score: 1 },
    { text: "ç»æµä¸Šçš„ä¸å®‰å…¨", score: 2 }
  ]},

  // è¢«æ¸´æœ› (6é¢˜)
  { q: "ä½ æœ€äº«å—çš„æ„Ÿè§‰æ˜¯ï¼Ÿ", dim: "desired", options: [
    { text: "è¢«äººè¿½æ±‚ã€è¢«éœ€è¦", score: 4 },
    { text: "è¢«äººå´‡æ‹œå’Œæ¬£èµ", score: 3 },
    { text: "è¢«äººä¿¡ä»»å’Œä¾é ", score: 2 },
    { text: "ç‹¬ç«‹å®Œæˆäº‹æƒ…çš„æˆå°±æ„Ÿ", score: 1 }
  ]},
  { q: "åœ¨ç¤¾äº¤åœºåˆä¸­ï¼Œä½ æ›´å¸Œæœ›ï¼Ÿ", dim: "desired", options: [
    { text: "æˆä¸ºå…¨åœºç„¦ç‚¹", score: 4 },
    { text: "å—åˆ°å…³æ³¨å’Œæ¬¢è¿", score: 3 },
    { text: "è‡ªç„¶èå…¥å°±å¥½", score: 2 },
    { text: "ä¿æŒä½è°ƒ", score: 1 }
  ]},
  { q: "ä½ å¯¹è‡ªå·±å¤–åœ¨å½¢è±¡çš„æ€åº¦ï¼Ÿ", dim: "desired", options: [
    { text: "éå¸¸é‡è§†ï¼ŒèŠ±å¾ˆå¤šå¿ƒæ€", score: 4 },
    { text: "æ³¨æ„å½¢è±¡ï¼Œä½†ä¸è¿‡åº¦", score: 3 },
    { text: "èˆ’é€‚å°±å¥½", score: 2 },
    { text: "ä¸å¤ªåœ¨æ„å¤–è¡¨", score: 1 }
  ]},
  { q: "å½“ä½ å–œæ¬¢çš„äººä¸»åŠ¨è”ç³»ä½ ï¼Œä½ ä¼šï¼Ÿ", dim: "desired", options: [
    { text: "è¶…çº§å¼€å¿ƒï¼Œè¿™æ„Ÿè§‰å¤ªå¥½äº†", score: 4 },
    { text: "å¼€å¿ƒï¼Œæ„Ÿè§‰è¢«é‡è§†", score: 3 },
    { text: "æ­£å¸¸å›åº”", score: 2 },
    { text: "åè€Œæœ‰ç‚¹å‹åŠ›", score: 1 }
  ]},
  { q: "ä½ å¸Œæœ›åœ¨ä¼´ä¾£çœ¼ä¸­æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ", dim: "desired", options: [
    { text: "æ— å¯æ›¿ä»£ã€è®©äººç€è¿·çš„", score: 4 },
    { text: "æœ‰é­…åŠ›ã€å€¼å¾—çˆ±çš„", score: 3 },
    { text: "å¯é ã€å€¼å¾—ä¿¡èµ–çš„", score: 2 },
    { text: "çœŸå®çš„è‡ªå·±å°±å¥½", score: 1 }
  ]},
  { q: "å¦‚æœå‘ç°æœ‰äººæš—æ‹ä½ ï¼Œä½ ä¼šï¼Ÿ", dim: "desired", options: [
    { text: "å¾ˆäº«å—è¿™ç§æ„Ÿè§‰", score: 4 },
    { text: "æœ‰ç‚¹å¾—æ„ï¼Œä½†ä¿æŒè·ç¦»", score: 3 },
    { text: "æœ‰ç‚¹å›°æ‰°ï¼Œä¸çŸ¥æ€ä¹ˆå¤„ç†", score: 2 },
    { text: "å°½å¿«è¯´æ¸…æ¥šï¼Œé¿å…è¯¯ä¼š", score: 1 }
  ]}
];

const dimensions = {
  emotion: { name: "æƒ…æ„Ÿè¿æ¥", icon: "ğŸ’•", color: "#ec4899", bg: "#fce7f3" },
  security: { name: "å®‰å…¨æ„Ÿ", icon: "ğŸ›¡ï¸", color: "#3b82f6", bg: "#dbeafe" },
  money: { name: "ç‰©è´¨é‡‘é’±", icon: "ğŸ’°", color: "#f59e0b", bg: "#fef3c7" },
  achievement: { name: "æˆå°±è®¤å¯", icon: "ğŸ†", color: "#10b981", bg: "#d1fae5" },
  freedom: { name: "è‡ªç”±ç‹¬ç«‹", icon: "ğŸ¦…", color: "#8b5cf6", bg: "#ede9fe" },
  desired: { name: "è¢«æ¸´æœ›", icon: "âœ¨", color: "#f43f5e", bg: "#ffe4e6" }
};

const desireTypes = {
  security_driven: {
    name: "å®‰å…¨é©±åŠ¨å‹",
    icon: "ğŸ ",
    subtitle: "ç¨³å®šæ˜¯æˆ‘çš„åº•å±‚éœ€æ±‚",
    desc: "ä½ çš„è¡Œä¸ºé€‰æ‹©ä¸»è¦ç”±å®‰å…¨æ„Ÿé©±åŠ¨ã€‚ä½ é‡è§†ç¨³å®šã€å¯é¢„æµ‹çš„ç”Ÿæ´»ï¼Œå€¾å‘äºè§„é¿é£é™©ã€‚è¿™ä¸æ˜¯èƒ†å°ï¼Œè€Œæ˜¯ä½ å¯¹ç”Ÿæ´»æœ‰ç€åŠ¡å®çš„è€ƒé‡ã€‚ä½ ä¼šä¸ºæœªæ¥åšå‘¨å¯†çš„è®¡åˆ’å’Œå‡†å¤‡ï¼Œè¿™è®©ä½ åœ¨å¾ˆå¤šæ–¹é¢éƒ½å¾ˆå¯é ã€‚å»ºè®®åœ¨ä¿æŒå®‰å…¨æ„Ÿçš„åŒæ—¶ï¼Œä¹Ÿç»™è‡ªå·±ä¸€äº›å°è¯•æ–°äº‹ç‰©çš„ç©ºé—´ã€‚"
  },
  emotion_driven: {
    name: "æƒ…æ„Ÿä¼˜å…ˆå‹",
    icon: "ğŸ’—",
    subtitle: "çˆ±ä¸è¿æ¥æ˜¯æˆ‘çš„æ ¸å¿ƒåŠ¨åŠ›",
    desc: "ä½ çš„é€‰æ‹©ä¸»è¦å—æƒ…æ„Ÿéœ€æ±‚é©±åŠ¨ã€‚äººé™…å…³ç³»ã€è¢«çˆ±è¢«ç†è§£çš„æ„Ÿè§‰å¯¹ä½ éå¸¸é‡è¦ã€‚ä½ å¯èƒ½ä¼šä¸ºäº†ç»´æŠ¤é‡è¦çš„å…³ç³»è€Œåšå‡ºå¾ˆå¤šå¦¥åï¼Œè¿™ä½“ç°äº†ä½ å¯¹æ„Ÿæƒ…çš„é‡è§†ã€‚ä½†ä¹Ÿè¦æ³¨æ„ä¸è¦åœ¨å…³ç³»ä¸­å¤±å»è‡ªæˆ‘ï¼Œå¥åº·çš„çˆ±åº”è¯¥æ˜¯ç›¸äº’æ»‹å…»çš„ã€‚"
  },
  achievement_driven: {
    name: "æˆå°±è¡¥å¿å‹",
    icon: "ğŸ¯",
    subtitle: "è¯æ˜è‡ªå·±æ˜¯æˆ‘çš„å†…åœ¨åŠ¨åŠ›",
    desc: "ä½ çš„è¡Œä¸ºå¾ˆå¤§ç¨‹åº¦ä¸Šå—æˆå°±æ¬²æœ›é©±åŠ¨ã€‚ä½ æ¸´æœ›è¢«è®¤å¯ã€è¢«çœ‹è§ï¼Œæƒ³è¦è¯æ˜è‡ªå·±çš„ä»·å€¼ã€‚è¿™ç§é©±åŠ¨åŠ›å¯ä»¥è®©ä½ éå¸¸åŠªåŠ›å’Œä¸Šè¿›ã€‚ä½†è¦è§‰å¯Ÿè¿™ç§æ¸´æœ›çš„æ¥æºâ€”â€”æ˜¯å‘è‡ªå†…å¿ƒçš„çƒ­çˆ±ï¼Œè¿˜æ˜¯åœ¨å¼¥è¡¥æŸç§ç¼ºå¤±ï¼ŸçœŸæ­£çš„æˆå°±æ„Ÿåº”è¯¥æ¥è‡ªäºè¿‡ç¨‹æœ¬èº«ã€‚"
  },
  desire_split: {
    name: "æ¬²æœ›åˆ†è£‚å‹",
    icon: "ğŸ­",
    subtitle: "æˆ‘å†…å¿ƒæœ‰å¤šç§åŠ›é‡åœ¨æ‹‰æ‰¯",
    desc: "ä½ çš„æ¬²æœ›ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œå¤šç§éœ€æ±‚çš„å¼ºåº¦ç›¸è¿‘ï¼Œå¯èƒ½ç»å¸¸æ„Ÿåˆ°å†…å¿ƒçš„æ‹‰æ‰¯å’ŒçŸ›ç›¾ã€‚æ¯”å¦‚æ—¢æƒ³è¦è‡ªç”±åˆæ¸´æœ›ç¨³å®šï¼Œæ—¢æƒ³è¢«çˆ±åˆå®³æ€•å¤±å»ç‹¬ç«‹ã€‚è¿™ç§çŠ¶æ€å¹¶ä¸æ˜¯é—®é¢˜ï¼Œè€Œæ˜¯å†…å¿ƒä¸°å¯Œçš„è¡¨ç°ã€‚å…³é”®æ˜¯è§‰å¯Ÿè¿™äº›å†²çªï¼Œåœ¨ä¸åŒé˜¶æ®µæœ‰æ„è¯†åœ°åšå‡ºé€‰æ‹©ã€‚"
  }
};

let idx = 0;
let answers = new Array(36).fill(null);

function render() {
  const q = questions[idx];

  document.getElementById('qNum').textContent = idx + 1;
  document.getElementById('current').textContent = idx + 1;
  document.getElementById('progressFill').style.width = `${((idx + 1) / questions.length) * 100}%`;
  document.getElementById('questionText').textContent = q.q;

  const container = document.getElementById('optionsContainer');
  container.innerHTML = q.options.map((opt, i) => `
    <div class="opt ${answers[idx] === i ? 'selected' : ''}" onclick="select(${i})">
      <div class="opt-radio"></div>
      <div class="opt-text">${opt.text}</div>
    </div>
  `).join('');

  document.getElementById('prevBtn').disabled = idx === 0;
  document.getElementById('nextBtn').innerHTML = idx === questions.length - 1 ?
    'æŸ¥çœ‹ç»“æœ <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>' :
    'ä¸‹ä¸€é¢˜ <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
  document.getElementById('nextBtn').disabled = answers[idx] === null;
}

function select(i) {
  answers[idx] = i;
  render();
}

function prev() {
  if (idx > 0) { idx--; render(); }
}

function next() {
  if (answers[idx] === null) return;
  if (idx < questions.length - 1) { idx++; render(); }
  else { showResult(); }
}

function calcScores() {
  const scores = { emotion: 0, security: 0, money: 0, achievement: 0, freedom: 0, desired: 0 };
  answers.forEach((ansIdx, qIdx) => {
    if (ansIdx === null) return;
    const q = questions[qIdx];
    scores[q.dim] += q.options[ansIdx].score;
  });
  return scores;
}

function getDesireType(scores) {
  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  const highest = sorted[0];
  const second = sorted[1];

  // æ£€æŸ¥æ˜¯å¦åˆ†è£‚å‹
  const range = sorted[0][1] - sorted[sorted.length - 1][1];
  if (range < 8) return "desire_split";

  // æ ¹æ®ä¸»å¯¼æ¬²æœ›åˆ¤æ–­ç±»å‹
  if (highest[0] === "security") return "security_driven";
  if (highest[0] === "emotion") return "emotion_driven";
  if (highest[0] === "achievement" || highest[0] === "desired") return "achievement_driven";
  if (highest[0] === "money") return highest[1] - second[1] > 4 ? "achievement_driven" : "security_driven";
  if (highest[0] === "freedom") return second[0] === "emotion" ? "emotion_driven" : "desire_split";

  return "desire_split";
}

function getSuppressedDesire(scores) {
  const sorted = Object.entries(scores).sort((a, b) => a[1] - b[1]);
  const lowest = sorted[0];
  const dimInfo = dimensions[lowest[0]];

  const interpretations = {
    emotion: "ä½ å¯èƒ½åœ¨æœ‰æ„æ— æ„åœ°å›é¿æƒ…æ„Ÿéœ€æ±‚ï¼Œè§‰å¾—ã€Œä¸éœ€è¦åˆ«äººã€æˆ–è€…ã€Œé è‡ªå·±å°±å¥½ã€ã€‚è¿™å¯èƒ½æ˜¯ä¸€ç§è‡ªæˆ‘ä¿æŠ¤ï¼Œä½†è¿‡åº¦å‹æŠ‘æƒ…æ„Ÿè¿æ¥çš„éœ€æ±‚å¯èƒ½ä¼šå¯¼è‡´å†…å¿ƒçš„å­¤ç‹¬æ„Ÿã€‚è¯•ç€å…è®¸è‡ªå·±æœ‰è¢«çˆ±çš„éœ€è¦ã€‚",
    security: "ä½ ä¼¼ä¹åœ¨å‹æŠ‘å¯¹å®‰å…¨æ„Ÿçš„éœ€æ±‚ï¼Œå¯èƒ½è§‰å¾—ã€Œè¿½æ±‚ç¨³å®šæ˜¯æ²¡å‡ºæ¯ã€æˆ–è€…ã€Œè¦æ•¢äºå†’é™©ã€ã€‚é€‚åº¦çš„å†’é™©ç²¾ç¥æ˜¯å¥½çš„ï¼Œä½†å¦‚æœæ€»æ˜¯å¿½è§†å®‰å…¨æ„Ÿçš„éœ€æ±‚ï¼Œå¯èƒ½ä¼šè®©è‡ªå·±å¤„äºæŒç»­çš„ç„¦è™‘ä¸­ã€‚",
    money: "ä½ å¯èƒ½åœ¨å‹æŠ‘å¯¹ç‰©è´¨çš„éœ€æ±‚ï¼Œè§‰å¾—ã€Œè°ˆé’±ä¿—æ°”ã€æˆ–è€…ã€Œç²¾ç¥æ›´é‡è¦ã€ã€‚é‡‘é’±æœ¬èº«æ˜¯ä¸­æ€§çš„å·¥å…·ï¼Œé€‚å½“é‡è§†ç‰©è´¨åŸºç¡€å¹¶ä¸å¯è€»ï¼Œå®ƒæ˜¯å®ç°å¾ˆå¤šäººç”Ÿç›®æ ‡çš„å¿…è¦æ¡ä»¶ã€‚",
    achievement: "ä½ å¯èƒ½åœ¨å‹æŠ‘å¯¹æˆå°±å’Œè®¤å¯çš„æ¸´æœ›ï¼Œå¯èƒ½è§‰å¾—ã€Œå‡ºé£å¤´ä¸å¥½ã€æˆ–è€…ã€Œå¹³å‡¡å°±æ˜¯ç¦ã€ã€‚ä½†æ¯ä¸ªäººéƒ½æœ‰è¢«çœ‹è§ã€è¢«è®¤å¯çš„éœ€æ±‚ï¼Œå…è®¸è‡ªå·±è¿½æ±‚å“è¶Šå¹¶ä¸æ˜¯è™šè£ã€‚",
    freedom: "ä½ å¯èƒ½åœ¨å‹æŠ‘å¯¹è‡ªç”±çš„æ¸´æœ›ï¼Œè§‰å¾—ã€Œè´£ä»»æ›´é‡è¦ã€æˆ–è€…ã€Œä¸èƒ½å¤ªè‡ªæˆ‘ã€ã€‚é€‚åº¦çš„è´£ä»»æ„Ÿæ˜¯å¥½çš„ï¼Œä½†å¦‚æœæ€»æ˜¯å§”å±ˆè‡ªå·±çš„è‡ªç”±æ„å¿—ï¼Œå¯èƒ½ä¼šç§¯ç´¯æ€¨æ°”å’Œå€¦æ€ ã€‚",
    desired: "ä½ å¯èƒ½åœ¨å‹æŠ‘è¢«æ¸´æœ›ã€è¢«è¿½æ±‚çš„éœ€æ±‚ï¼Œè§‰å¾—ã€Œä¸åº”è¯¥åœ¨æ„è¿™äº›ã€æˆ–è€…ã€Œè¿™æ ·å¤ªè‚¤æµ…ã€ã€‚ä½†è¢«æ¬£èµã€è¢«éœ€è¦æ˜¯äººçš„æ­£å¸¸éœ€æ±‚ï¼Œå…è®¸è‡ªå·±äº«å—è¢«å–œçˆ±çš„æ„Ÿè§‰ã€‚"
  };

  return { dim: lowest[0], info: dimInfo, interpretation: interpretations[lowest[0]] };
}

function getConflict(scores) {
  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  const conflicts = [
    { pair: ["security", "freedom"], desc: "ä½ å†…å¿ƒå­˜åœ¨ã€Œå®‰å…¨vsè‡ªç”±ã€çš„å†²çªã€‚ä¸€æ–¹é¢æ¸´æœ›ç¨³å®šå¯æ§çš„ç”Ÿæ´»ï¼Œå¦ä¸€æ–¹é¢åˆå‘å¾€è‡ªç”±ä¸å—çº¦æŸã€‚è¿™ç§å†²çªå¯èƒ½è®©ä½ åœ¨åšé‡å¤§å†³å®šæ—¶åå¤çŠ¹è±«ã€‚å»ºè®®è®¤æ¸…å½“å‰äººç”Ÿé˜¶æ®µçš„ä¼˜å…ˆçº§ï¼Œå…è®¸è‡ªå·±åœ¨ä¸åŒæ—¶æœŸä¾§é‡ä¸åŒçš„éœ€æ±‚ã€‚" },
    { pair: ["emotion", "freedom"], desc: "ä½ å†…å¿ƒå­˜åœ¨ã€Œäº²å¯†vsç‹¬ç«‹ã€çš„å†²çªã€‚ä¸€æ–¹é¢æ¸´æœ›æ·±åº¦çš„æƒ…æ„Ÿè¿æ¥ï¼Œå¦ä¸€æ–¹é¢åˆå®³æ€•å¤±å»è‡ªæˆ‘ç©ºé—´ã€‚è¿™å¯èƒ½å½±å“ä½ çš„äº²å¯†å…³ç³»ã€‚å¥åº·çš„å…³ç³»åº”è¯¥æ˜¯ã€Œä¸¤ä¸ªç‹¬ç«‹çš„äººé€‰æ‹©åœ¨ä¸€èµ·ã€ï¼Œè€Œä¸æ˜¯ç›¸äº’èåˆæˆ–æ§åˆ¶ã€‚" },
    { pair: ["achievement", "emotion"], desc: "ä½ å†…å¿ƒå­˜åœ¨ã€Œäº‹ä¸švsæ„Ÿæƒ…ã€çš„å†²çªã€‚å¯èƒ½ç»å¸¸åœ¨å·¥ä½œå’Œé‡è¦å…³ç³»ä¹‹é—´åšè‰°éš¾çš„é€‰æ‹©ã€‚è¿™ä¸¤è€…å¹¶éå¿…é¡»å¯¹ç«‹ï¼Œå…³é”®æ˜¯æ‰¾åˆ°å¹³è¡¡ç‚¹ï¼Œä»¥åŠå’Œé‡è¦çš„äººæ²Ÿé€šä½ çš„éœ€æ±‚å’Œå›°å¢ƒã€‚" },
    { pair: ["money", "emotion"], desc: "ä½ å†…å¿ƒå­˜åœ¨ã€Œç‰©è´¨vsæ„Ÿæƒ…ã€çš„å†²çªã€‚å¯èƒ½ä¼šçº ç»“äºç°å®è€ƒé‡å’Œæƒ…æ„Ÿéœ€æ±‚ä¹‹é—´ã€‚é‡‘é’±å’Œæ„Ÿæƒ…éƒ½æ˜¯äººç”Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸å¿…éæ­¤å³å½¼ï¼Œå…³é”®æ˜¯æ‰¾åˆ°ä¸¤è€…çš„å¥åº·å¹³è¡¡ã€‚" }
  ];

  for (const c of conflicts) {
    const idx1 = sorted.findIndex(s => s[0] === c.pair[0]);
    const idx2 = sorted.findIndex(s => s[0] === c.pair[1]);
    if (Math.abs(idx1 - idx2) <= 2 && sorted[idx1][1] >= 15 && sorted[idx2][1] >= 15) {
      return c;
    }
  }
  return null;
}

function getRisk(scores, type) {
  const risks = {
    security_driven: "è¿‡åº¦è¿½æ±‚å®‰å…¨å¯èƒ½è®©ä½ é”™è¿‡ä¸€äº›å€¼å¾—å°è¯•çš„æœºä¼šï¼Œä¹Ÿå¯èƒ½åœ¨å…³ç³»ä¸­è¿‡äºä¿å®ˆã€‚æé†’è‡ªå·±ï¼šç»å¯¹çš„å®‰å…¨æ˜¯ä¸å­˜åœ¨çš„ï¼Œé€‚åº¦çš„ä¸ç¡®å®šæ€§æ˜¯ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ã€‚",
    emotion_driven: "è¿‡åº¦ä»¥æ„Ÿæƒ…ä¸ºé‡å¿ƒå¯èƒ½å¯¼è‡´åœ¨å…³ç³»ä¸­å¤±å»è¾¹ç•Œï¼Œæˆ–è€…å› ä¸ºå®³æ€•å¤±å»è€Œè¿‡åº¦ä»˜å‡ºã€‚æé†’è‡ªå·±ï¼šå¥åº·çš„çˆ±éœ€è¦ä»¥çˆ±è‡ªå·±ä¸ºåŸºç¡€ï¼Œä½ çš„ä»·å€¼ä¸ç”±ä»–äººçš„çˆ±æ¥å®šä¹‰ã€‚",
    achievement_driven: "è¿‡åº¦è¿½æ±‚æˆå°±å’Œè®¤å¯å¯èƒ½è®©ä½ å¿½è§†ç”Ÿæ´»çš„å…¶ä»–é¢å‘ï¼Œæˆ–è€…åœ¨æ²¡æœ‰å¤–ç•Œè‚¯å®šæ—¶æ„Ÿåˆ°ç©ºè™šã€‚æé†’è‡ªå·±ï¼šä½ æœ¬èº«å°±æ˜¯æœ‰ä»·å€¼çš„ï¼Œä¸éœ€è¦é€šè¿‡æˆå°±æ¥è¯æ˜ã€‚",
    desire_split: "å†…å¿ƒçš„å¤šé‡æ¬²æœ›æ‹‰æ‰¯å¯èƒ½å¯¼è‡´å†³ç­–å›°éš¾å’ŒæŒç»­çš„å†…è€—ã€‚æé†’è‡ªå·±ï¼šä¸å¿…è¿½æ±‚å®Œç¾å¹³è¡¡ï¼Œåœ¨äººç”Ÿçš„ä¸åŒé˜¶æ®µå¯ä»¥æœ‰ä¸åŒçš„ä¾§é‡ï¼Œå…³é”®æ˜¯åšå‡ºé€‰æ‹©åå…¨æƒ…æŠ•å…¥ã€‚"
  };
  return risks[type];
}

function goToHome() { window.location.href = '../platform.html'; }

function getHomeButtonHtml() {
  const userSource = sessionStorage.getItem('user_source');
  if (userSource === 'platform') {
    return '<button class="restart-btn" onclick="goToHome()" style="margin-left:8px">è¿”å›æµ‹è¯•ä¸­å¿ƒ</button>';
  } else {
    return '<button class="restart-btn more-tests-btn" onclick="showMoreTests()" style="margin-left:8px">æ›´å¤šæµ‹è¯•</button>';
  }
}

function showMoreTests() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `<div class="modal-content"><div class="modal-icon">ğŸ§‚</div><h3>æ›´å¤šä¸“ä¸šæµ‹è¯„</h3><p>è¯·åœ¨å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€è´­ä¹°å…¶ä»–æµ‹è¯•å“¦~</p><div class="modal-buttons"><button class="modal-btn primary" onclick="closeModal()">çŸ¥é“äº†</button></div></div>`;
  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add('show'), 10);
}

function closeModal() {
  const modal = document.querySelector('.modal-overlay');
  if (modal) { modal.classList.remove('show'); setTimeout(() => modal.remove(), 300); }
}

function showResult() {
  document.getElementById('testPage').classList.remove('active');
  document.getElementById('resultPage').classList.add('active');

  const scores = calcScores();
  const typeKey = getDesireType(scores);
  const type = desireTypes[typeKey];
  const suppressed = getSuppressedDesire(scores);
  const conflict = getConflict(scores);
  const risk = getRisk(scores, typeKey);

  const maxScore = 24;
  const sortedDims = Object.entries(scores).sort((a, b) => b[1] - a[1]);

  document.getElementById('resultContent').innerHTML = `
    <div class="result-header">
      <div class="result-logo">${type.icon}</div>
      <h1 class="result-title">${type.name}</h1>
      <p class="result-subtitle">${type.subtitle}</p>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#ede9fe">ğŸ¯</div>æ ¸å¿ƒç±»å‹è§£è¯»</div>
      <div class="type-main">
        <div class="type-icon">${type.icon}</div>
        <div class="type-name">${type.name}</div>
        <div class="type-subtitle">${type.subtitle}</div>
        <div class="type-desc">${type.desc}</div>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#dbeafe">ğŸ“Š</div>æ¬²æœ›ç»“æ„é›·è¾¾å›¾</div>
      <div class="chart-container">
        <canvas id="radarChart"></canvas>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#fef3c7">ğŸ“ˆ</div>å„ç»´åº¦è¯¦ç»†åˆ†æ</div>
      ${sortedDims.map(([dim, score], i) => {
        const info = dimensions[dim];
        const pct = (score / maxScore) * 100;
        const level = pct >= 70 ? 'ä¸»å¯¼' : pct >= 50 ? 'ä¸­ç­‰' : 'è¾ƒä½';
        const levelColor = pct >= 70 ? '#059669' : pct >= 50 ? '#d97706' : '#6b7280';
        const levelBg = pct >= 70 ? '#d1fae5' : pct >= 50 ? '#fef3c7' : '#f3f4f6';
        return `
          <div class="dim-item">
            <div class="dim-header">
              <div class="dim-name"><div class="dim-icon" style="background:${info.bg}">${info.icon}</div>${info.name}</div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span class="dim-level" style="background:${levelBg};color:${levelColor}">${level}</span>
                <span style="font-weight:600;color:var(--primary);">${score}/${maxScore}</span>
              </div>
            </div>
            <div class="dim-bar"><div class="dim-bar-fill" style="width:${pct}%;background:${info.color}"></div></div>
          </div>
        `;
      }).join('')}

      <div class="suppressed-box">
        <div class="suppressed-title">ğŸ”® è¢«å‹æŠ‘çš„æ¬²æœ›ï¼š${suppressed.info.icon} ${suppressed.info.name}</div>
        <div class="suppressed-content">${suppressed.interpretation}</div>
      </div>

      ${conflict ? `
        <div class="conflict-box">
          <div class="conflict-title">âš”ï¸ æ¬²æœ›å†²çªç»“æ„</div>
          <div class="conflict-content">${conflict.desc}</div>
        </div>
      ` : ''}
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#d1fae5">ğŸ’¡</div>ä½æ¶ˆè€—ç”Ÿæ´»å»ºè®®</div>
      <div class="tip-item"><div class="tip-num">1</div><div class="tip-text">è¯†åˆ«ä½ çš„ä¸»å¯¼æ¬²æœ›ï¼Œåœ¨ç”Ÿæ´»ä¸­ä¼˜å…ˆæ»¡è¶³å®ƒï¼Œå‡å°‘å†…è€—</div></div>
      <div class="tip-item"><div class="tip-num">2</div><div class="tip-text">è§‰å¯Ÿè¢«å‹æŠ‘çš„æ¬²æœ›ï¼Œç»™å®ƒä¸€äº›åˆç†çš„å‡ºå£å’Œè¡¨è¾¾ç©ºé—´</div></div>
      <div class="tip-item"><div class="tip-num">3</div><div class="tip-text">åœ¨å†²çªçš„æ¬²æœ›ä¹‹é—´ï¼Œæ¥å—ä¸å¯èƒ½ä¸¤å…¨ï¼Œåšå‡ºæ¸…é†’çš„å–èˆ</div></div>
      <div class="tip-item"><div class="tip-num">4</div><div class="tip-text">å®šæœŸæ£€è§†è‡ªå·±çš„é€‰æ‹©æ˜¯å¦ç¬¦åˆå†…å¿ƒçœŸå®çš„é©±åŠ¨åŠ›</div></div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#fee2e2">âš ï¸</div>é£é™©æé†’</div>
      <div class="risk-box">
        <div class="risk-content">${risk}</div>
      </div>
    </div>

    <div class="card" style="text-align:center;background:linear-gradient(135deg,#ede9fe 0%,#ddd6fe 100%)">
      <p style="font-size:15px;color:#5b21b6;line-height:1.8">
        æ¬²æœ›æœ¬èº«æ²¡æœ‰å¯¹é”™<br>
        å®ƒåªæ˜¯åœ¨å‘Šè¯‰ä½ ï¼Œä½ çœŸæ­£åœ¨ä¹ä»€ä¹ˆ<br>
        çœ‹è§å®ƒï¼Œç†è§£å®ƒï¼Œç„¶ååšå‡ºæ¸…é†’çš„é€‰æ‹©
      </p>
    </div>

    <div class="action-buttons">
      <button class="action-btn primary" onclick="downloadPDF()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
        ä¸‹è½½PDFæŠ¥å‘Š
      </button>
      <button class="restart-btn" onclick="location.reload()">é‡æ–°æµ‹è¯•</button>
      ${getHomeButtonHtml()}
    </div>

    <div style="text-align:center;margin-top:32px;padding-top:24px;border-top:1px solid var(--border)">
      <p style="font-size:12px;color:var(--text-muted)">Â© 2025 å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· æµ‹è¯„ç»“æœä»…ä¾›å‚è€ƒ</p>
    </div>
  `;

  // ç»˜åˆ¶é›·è¾¾å›¾
  setTimeout(() => {
    const ctx = document.getElementById('radarChart').getContext('2d');
    new Chart(ctx, {
      type: 'radar',
      data: {
        labels: Object.values(dimensions).map(d => d.name),
        datasets: [{
          label: 'æ¬²æœ›å¼ºåº¦',
          data: Object.keys(dimensions).map(k => scores[k]),
          backgroundColor: 'rgba(139, 92, 246, 0.2)',
          borderColor: '#8b5cf6',
          borderWidth: 2,
          pointBackgroundColor: '#8b5cf6'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          r: {
            beginAtZero: true,
            max: 24,
            ticks: { stepSize: 6 }
          }
        },
        plugins: { legend: { display: false } }
      }
    });
  }, 100);
}

async function downloadPDF() {
  const btn = document.querySelector('.action-btn.primary');
  const loading = document.getElementById('loading');
  btn.disabled = true;
  btn.innerHTML = 'ç”Ÿæˆä¸­...';
  loading.classList.add('show');

  try {
    const scores = calcScores();
    const typeKey = getDesireType(scores);
    const type = desireTypes[typeKey];
    const suppressed = getSuppressedDesire(scores);
    const conflict = getConflict(scores);
    const risk = getRisk(scores, typeKey);
    const maxScore = 24;
    const sortedDims = Object.entries(scores).sort((a, b) => b[1] - a[1]);
    const date = new Date().toLocaleDateString('zh-CN');

    const pdfContainer = document.createElement('div');
    pdfContainer.style.cssText = 'position:absolute;left:-9999px;top:0;width:800px;background:#fff;padding:40px;font-family:"Noto Sans SC",sans-serif;';
    pdfContainer.innerHTML = `
      <div style="background:linear-gradient(135deg,#8b5cf6 0%,#6366f1 100%);padding:50px 40px;margin:-40px -40px 30px -40px;text-align:center;color:#fff;">
        <div style="font-size:16px;margin-bottom:10px;opacity:0.9;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div style="font-size:32px;font-weight:700;margin-bottom:15px;">æ¬²æœ›æ¯”é‡æµ‹è¯•æŠ¥å‘Š</div>
        <div style="font-size:14px;opacity:0.8;">æµ‹è¯„æ—¥æœŸï¼š${date}</div>
      </div>

      <div style="background:linear-gradient(135deg,#ede9fe 0%,#ddd6fe 100%);border-radius:16px;padding:24px;margin-bottom:25px;text-align:center;">
        <div style="font-size:48px;margin-bottom:12px;">${type.icon}</div>
        <div style="font-size:24px;font-weight:700;color:#5b21b6;margin-bottom:8px;">${type.name}</div>
        <div style="font-size:14px;color:#7c3aed;margin-bottom:16px;">${type.subtitle}</div>
        <div style="font-size:13px;color:#4c1d95;line-height:1.8;text-align:left;">${type.desc}</div>
      </div>

      <div style="margin-bottom:25px;">
        <div style="font-size:18px;font-weight:600;color:#1e293b;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #e2e8f0;">å…­ç»´åº¦æ¬²æœ›åˆ†æ</div>
        ${sortedDims.map(([dim, score]) => {
          const info = dimensions[dim];
          const pct = (score / maxScore) * 100;
          const level = pct >= 70 ? 'ä¸»å¯¼' : pct >= 50 ? 'ä¸­ç­‰' : 'å¹³å’Œ';
          const levelColor = pct >= 70 ? '#059669' : pct >= 50 ? '#d97706' : '#6366f1';
          return `
            <div style="background:#f8fafc;border-radius:12px;padding:20px;margin-bottom:12px;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                <div style="font-size:16px;font-weight:600;color:#1e293b;">${info.icon} ${info.name}</div>
                <div style="display:flex;align-items:center;gap:10px;">
                  <span style="background:${levelColor};color:#fff;padding:4px 12px;border-radius:12px;font-size:12px;">${level}</span>
                  <span style="font-weight:700;color:#8b5cf6;">${score}/${maxScore}</span>
                </div>
              </div>
              <div style="background:#e2e8f0;height:8px;border-radius:4px;">
                <div style="background:${info.color};height:100%;border-radius:4px;width:${pct}%;"></div>
              </div>
            </div>
          `;
        }).join('')}
      </div>

      <div style="background:linear-gradient(135deg,#e0e7ff 0%,#c7d2fe 100%);border-radius:12px;padding:20px;margin-bottom:25px;">
        <div style="font-size:14px;font-weight:600;color:#3730a3;margin-bottom:8px;">ğŸ”® è¢«å‹æŠ‘çš„æ¬²æœ›ï¼š${suppressed.info.icon} ${suppressed.info.name}</div>
        <div style="font-size:13px;color:#312e81;line-height:1.7;">${suppressed.interpretation}</div>
      </div>

      ${conflict ? `
      <div style="background:linear-gradient(135deg,#fef3c7 0%,#fde68a 100%);border-radius:12px;padding:20px;margin-bottom:25px;">
        <div style="font-size:14px;font-weight:600;color:#92400e;margin-bottom:8px;">âš”ï¸ æ¬²æœ›å†²çªç»“æ„</div>
        <div style="font-size:13px;color:#78350f;line-height:1.7;">${conflict.desc}</div>
      </div>
      ` : ''}

      <div style="margin-bottom:25px;">
        <div style="font-size:18px;font-weight:600;color:#1e293b;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #e2e8f0;">ä½æ¶ˆè€—ç”Ÿæ´»å»ºè®®</div>
        ${['è¯†åˆ«ä½ çš„ä¸»å¯¼æ¬²æœ›ï¼Œåœ¨ç”Ÿæ´»ä¸­ä¼˜å…ˆæ»¡è¶³å®ƒï¼Œå‡å°‘å†…è€—', 'è§‰å¯Ÿè¢«å‹æŠ‘çš„æ¬²æœ›ï¼Œç»™å®ƒä¸€äº›åˆç†çš„å‡ºå£å’Œè¡¨è¾¾ç©ºé—´', 'åœ¨å†²çªçš„æ¬²æœ›ä¹‹é—´ï¼Œæ¥å—ä¸å¯èƒ½ä¸¤å…¨ï¼Œåšå‡ºæ¸…é†’çš„å–èˆ', 'å®šæœŸæ£€è§†è‡ªå·±çš„é€‰æ‹©æ˜¯å¦ç¬¦åˆå†…å¿ƒçœŸå®çš„é©±åŠ¨åŠ›'].map((t, i) => `
          <div style="display:flex;gap:12px;margin-bottom:12px;">
            <div style="width:28px;height:28px;background:linear-gradient(135deg,#8b5cf6,#6366f1);border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:600;flex-shrink:0;">${i+1}</div>
            <div style="color:#475569;font-size:14px;line-height:1.7;padding-top:4px;">${t}</div>
          </div>
        `).join('')}
      </div>

      <div style="background:#fef2f2;border:1px solid #fecaca;border-radius:12px;padding:20px;margin-bottom:25px;">
        <div style="font-size:14px;font-weight:600;color:#991b1b;margin-bottom:8px;">âš ï¸ é£é™©æé†’</div>
        <div style="font-size:13px;color:#7f1d1d;line-height:1.7;">${risk}</div>
      </div>

      <div style="background:linear-gradient(135deg,#ede9fe 0%,#ddd6fe 100%);border-radius:16px;padding:24px;margin-bottom:25px;text-align:center;">
        <div style="font-size:15px;color:#5b21b6;line-height:1.8;">
          æ¬²æœ›æœ¬èº«æ²¡æœ‰å¯¹é”™<br>
          å®ƒåªæ˜¯åœ¨å‘Šè¯‰ä½ ï¼Œä½ çœŸæ­£åœ¨ä¹ä»€ä¹ˆ<br>
          çœ‹è§å®ƒï¼Œç†è§£å®ƒï¼Œç„¶ååšå‡ºæ¸…é†’çš„é€‰æ‹©
        </div>
      </div>

      <div style="background:#f8fafc;border-radius:12px;padding:20px;text-align:center;color:#94a3b8;font-size:12px;">
        <div style="margin-bottom:8px;font-weight:500;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div>æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å†…å¿ƒçš„é©±åŠ¨åŠ›å’Œéœ€æ±‚ç»“æ„</div>
      </div>
    `;

    document.body.appendChild(pdfContainer);
    await document.fonts.ready;
    await new Promise(r => setTimeout(r, 500));

    const canvas = await html2canvas(pdfContainer, { scale: 2, useCORS: true, backgroundColor: '#ffffff', height: pdfContainer.scrollHeight, windowHeight: pdfContainer.scrollHeight });
    document.body.removeChild(pdfContainer);

    const { jsPDF } = window.jspdf;
    const imgData = canvas.toDataURL('image/jpeg', 0.95);
    const imgW = canvas.width;
    const imgH = canvas.height;
    const pdfW = 210, pdfH = 297;
    let finalW = pdfW - 20;
    let finalH = finalW / (imgW / imgH);
    const pdf = new jsPDF('p', 'mm', 'a4');
    let remainingH = imgH;
    let srcY = 0;
    const pagePixelH = (pdfH - 20) / finalH * imgH;

    while (remainingH > 0) {
      const sliceH = Math.min(remainingH, pagePixelH);
      const sliceCanvas = document.createElement('canvas');
      sliceCanvas.width = imgW;
      sliceCanvas.height = sliceH;
      const ctx = sliceCanvas.getContext('2d');
      ctx.drawImage(canvas, 0, srcY, imgW, sliceH, 0, 0, imgW, sliceH);
      const sliceData = sliceCanvas.toDataURL('image/jpeg', 0.95);
      const sliceFinalH = finalW / (imgW / sliceH);
      if (srcY > 0) pdf.addPage();
      pdf.addImage(sliceData, 'JPEG', 10, 10, finalW, sliceFinalH);
      srcY += sliceH;
      remainingH -= sliceH;
    }

    pdf.save(`æ¬²æœ›æ¯”é‡æµ‹è¯•æŠ¥å‘Š_${date.replace(/\//g, '-')}.pdf`);
  } catch (e) { console.error(e); alert('PDFç”Ÿæˆå¤±è´¥'); }
  finally {
    btn.disabled = false;
    btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> ä¸‹è½½PDFæŠ¥å‘Š';
    loading.classList.remove('show');
  }
}

render();
</script>
</body>
</html>
