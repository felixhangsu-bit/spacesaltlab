<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æƒ…ç»ªæ™ºåŠ›æµ‹è¯„ | å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root { --primary: #6366f1; --primary-dark: #4f46e5; --primary-light: #a5b4fc; --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --text-muted: #64748b; --border: #e2e8f0; --shadow: 0 4px 20px rgba(0,0,0,0.08); --radius: 16px; }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans SC', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
.page { display: none; min-height: 100vh; }
.page.active { display: block; }
#testPage { background: var(--bg); padding: 20px; }
.test-container { max-width: 700px; margin: 0 auto; }
.test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.back-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: all 0.2s; }
.back-btn:hover { background: white; color: var(--text); }
.progress-wrap { text-align: right; }
.progress-text { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
.progress-bar { width: 180px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--gradient); border-radius: 3px; transition: width 0.3s; }
.question-card { background: var(--card); border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); }
.dim-tag { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-bottom: 16px; }
.q-num { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.q-text { font-size: 20px; font-weight: 600; line-height: 1.5; margin-bottom: 32px; }
.options { display: flex; flex-direction: column; gap: 12px; }
.opt { display: flex; align-items: center; gap: 14px; padding: 16px 20px; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
.opt:hover { border-color: var(--primary-light); background: #fafaff; }
.opt.selected { border-color: var(--primary); background: linear-gradient(135deg, #ede9fe 0%, #e0e7ff 100%); }
.opt-radio { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
.opt.selected .opt-radio { border-color: var(--primary); background: var(--primary); }
.opt.selected .opt-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
.opt-text { font-size: 15px; }
.nav-btns { display: flex; justify-content: space-between; margin-top: 28px; }
.nav-btn { padding: 12px 28px; border-radius: 10px; font-size: 15px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
.nav-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.nav-btn.secondary:hover { border-color: var(--primary); color: var(--primary); }
.nav-btn.primary { background: var(--primary); border: none; color: white; }
.nav-btn.primary:hover { background: var(--primary-dark); }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
#resultPage { background: linear-gradient(180deg, #667eea 0%, #764ba2 40%, var(--bg) 40%); }
.result-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
.result-header { text-align: center; color: white; padding: 20px 0 60px; }
.result-header h1 { font-size: 28px; margin-bottom: 8px; }
.result-header p { opacity: 0.9; }
.card { background: var(--card); border-radius: var(--radius); padding: 32px; box-shadow: var(--shadow); margin-bottom: 20px; }
.section-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 16px; }
.section-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
.eq-score { font-size: 64px; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
.eq-level { text-align: center; padding: 8px 24px; background: var(--gradient); color: white; border-radius: 20px; display: inline-block; margin: 16px auto; font-weight: 600; }
.eq-desc { text-align: center; color: var(--text-muted); font-size: 15px; line-height: 1.8; }
.stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-top: 20px; }
.stat-card { padding: 16px; background: #f8fafc; border-radius: 12px; text-align: center; }
.stat-value { font-size: 24px; font-weight: 700; color: var(--primary); }
.stat-label { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
.dim-item { margin-bottom: 20px; }
.dim-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.dim-name { display: flex; align-items: center; gap: 8px; font-weight: 500; }
.dim-icon { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
.dim-score { font-weight: 600; color: var(--primary); }
.dim-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; margin-bottom: 12px; }
.dim-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
.level-badge { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; }
.level-high { background: #d1fae5; color: #059669; }
.level-medium { background: #fef3c7; color: #d97706; }
.level-low { background: #fee2e2; color: #dc2626; }
.dim-analysis { font-size: 14px; color: var(--text-muted); line-height: 1.7; margin-top: 8px; padding: 12px; background: #f8fafc; border-radius: 8px; }
.tip-item { display: flex; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--primary); }
.tip-num { width: 26px; height: 26px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; flex-shrink: 0; }
.tip-text { font-size: 14px; color: var(--text-muted); line-height: 1.6; }
.download-section { text-align: center; padding: 32px; }
.download-btn { display: inline-flex; align-items: center; gap: 10px; padding: 14px 28px; background: var(--gradient); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
.download-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102,126,234,0.35); }
.restart-btn { display: inline-flex; align-items: center; gap: 6px; margin-top: 14px; padding: 10px 20px; background: transparent; border: 2px solid var(--border); border-radius: 10px; font-size: 13px; color: var(--text-muted); cursor: pointer; transition: all 0.2s; }
.restart-btn:hover { border-color: var(--primary); color: var(--primary); }
.loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: all 0.3s; }
.loading.show { opacity: 1; visibility: visible; }
.loading-box { background: white; padding: 36px; border-radius: 16px; text-align: center; }
.spinner { width: 44px; height: 44px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
@keyframes spin { to { transform: rotate(360deg); } }
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: all 0.3s; }
.modal-overlay.show { opacity: 1; visibility: visible; }
.modal-content { background: white; padding: 36px; border-radius: 20px; max-width: 400px; width: 90%; text-align: center; transform: scale(0.9); transition: transform 0.3s; }
.modal-overlay.show .modal-content { transform: scale(1); }
.modal-icon { font-size: 48px; margin-bottom: 16px; }
.modal-content h3 { font-size: 22px; font-weight: 700; margin-bottom: 12px; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.modal-content > p { color: var(--text-muted); font-size: 14px; line-height: 1.6; margin-bottom: 20px; }
.modal-tests { background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
.modal-test-item { padding: 10px; font-size: 14px; color: var(--text); border-bottom: 1px solid var(--border); }
.modal-test-item:last-child { border-bottom: none; }
.modal-tip { font-size: 13px; color: var(--primary); font-weight: 500; margin-bottom: 20px; }
.modal-buttons { display: flex; flex-direction: column; gap: 10px; }
.modal-btn { padding: 14px 24px; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; }
.modal-btn.primary { background: var(--gradient); color: white; }
.modal-btn.secondary { background: transparent; border: 2px solid var(--border); color: var(--text-muted); }
.more-tests-btn { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-color: #f59e0b; color: #92400e; }
.chart-container { max-width: 350px; margin: 20px auto; }
@media (max-width: 640px) { .stat-grid { grid-template-columns: repeat(2, 1fr); } .question-card { padding: 28px 20px; } .q-text { font-size: 18px; } }
</style>
</head>
<body>
<div id="testPage" class="page active">
  <div class="test-container">
    <div class="test-header">
      <button class="back-btn" onclick="exitTest()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>é€€å‡ºæµ‹è¯•</button>
      <div class="progress-wrap">
        <div class="progress-text"><span id="current">1</span> / 40</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      </div>
    </div>
    <div class="question-card">
      <div class="dim-tag" id="dimTag">æƒ…ç»ªæ„ŸçŸ¥</div>
      <div class="q-num">é—®é¢˜ <span id="qNum">1</span></div>
      <div class="q-text" id="qText"></div>
      <div class="options" id="options"></div>
      <div class="nav-btns">
        <button class="nav-btn secondary" id="prevBtn" onclick="prevQ()">ä¸Šä¸€é¢˜</button>
        <button class="nav-btn primary" id="nextBtn" onclick="nextQ()">ä¸‹ä¸€é¢˜</button>
      </div>
    </div>
  </div>
</div>

<div id="resultPage" class="page">
  <div class="result-container">
    <div class="result-header"><h1>ğŸ§  æƒ…ç»ªæ™ºåŠ›æµ‹è¯„æŠ¥å‘Š</h1><p>å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</p></div>
    <div id="resultContent"></div>
  </div>
</div>

<div class="loading" id="loading"><div class="loading-box"><div class="spinner"></div><p>æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...</p></div></div>

<script>
// 40é“æƒ…ç»ªæ™ºåŠ›æµ‹è¯„é¢˜ç›®ï¼ˆåŸºäºMayer-Saloveyæ¨¡å‹ï¼‰
const questions = [
  // æƒ…ç»ªæ„ŸçŸ¥ Perceiving (10é¢˜)
  { dim: 'perceive', text: 'ä¸äººäº¤è°ˆæ—¶ï¼Œæˆ‘èƒ½å¤Ÿé€šè¿‡å¯¹æ–¹çš„é¢éƒ¨è¡¨æƒ…åˆ¤æ–­ä»–ä»¬çš„çœŸå®æ„Ÿå—', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'perceive', text: 'æˆ‘èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«è‡ªå·±å½“å‰çš„æƒ…ç»ªçŠ¶æ€', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'perceive', text: 'æˆ‘èƒ½ä»ä»–äººçš„è¯­æ°”ä¸­å¯Ÿè§‰åˆ°ä»–ä»¬éšè—çš„æƒ…ç»ª', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'perceive', text: 'çœ‹åˆ°ä¸€å¹…è‰ºæœ¯ä½œå“æ—¶ï¼Œæˆ‘èƒ½æ„Ÿå—åˆ°å…¶ä¸­è•´å«çš„æƒ…æ„Ÿ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'perceive', text: 'æˆ‘èƒ½é€šè¿‡ä»–äººçš„è‚¢ä½“è¯­è¨€åˆ¤æ–­ä»–ä»¬çš„æƒ…ç»ª', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'perceive', text: 'å½“æˆ‘æ„Ÿåˆ°ä¸èˆ’æœæ—¶ï¼Œæˆ‘èƒ½å‡†ç¡®è¯´å‡ºæ˜¯ä»€ä¹ˆæƒ…ç»ª', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'perceive', text: 'æˆ‘èƒ½å¯Ÿè§‰åˆ°ç¯å¢ƒä¸­çš„æƒ…ç»ªæ°›å›´å˜åŒ–', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'perceive', text: 'å¬éŸ³ä¹æ—¶ï¼Œæˆ‘èƒ½æ„Ÿå—åˆ°éŸ³ä¹æ‰€è¡¨è¾¾çš„æƒ…æ„Ÿ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'perceive', text: 'æˆ‘èƒ½åˆ†è¾¨å‡ºçœŸè¯šçš„å¾®ç¬‘å’Œç¤¼è²Œæ€§çš„å¾®ç¬‘', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'perceive', text: 'æˆ‘å¾ˆå®¹æ˜“è¢«ä»–äººçš„æƒ…ç»ªæ‰€æ„ŸæŸ“', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },

  // æƒ…ç»ªè¿ç”¨ Facilitating (10é¢˜)
  { dim: 'facilitate', text: 'æˆ‘ä¼šåˆ©ç”¨ç§¯æçš„å¿ƒæƒ…æ¥æ¿€å‘åˆ›é€ åŠ›', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'facilitate', text: 'å½“éœ€è¦åšé‡è¦å†³å®šæ—¶ï¼Œæˆ‘ä¼šè€ƒè™‘è‡ªå·±çš„æ„Ÿå—', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'facilitate', text: 'æˆ‘èƒ½åˆ©ç”¨æƒ…ç»ªæ¥å¸®åŠ©è‡ªå·±é›†ä¸­æ³¨æ„åŠ›', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'facilitate', text: 'å¿ƒæƒ…å¥½çš„æ—¶å€™ï¼Œæˆ‘çš„é—®é¢˜è§£å†³èƒ½åŠ›ä¼šæ›´å¼º', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'facilitate', text: 'æˆ‘ä¼šæ ¹æ®ä»»åŠ¡æ€§è´¨è°ƒæ•´è‡ªå·±çš„æƒ…ç»ªçŠ¶æ€', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'facilitate', text: 'æƒ…ç»ªä¼šå½±å“æˆ‘çœ‹å¾…é—®é¢˜çš„è§’åº¦', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'facilitate', text: 'æˆ‘èƒ½å°†è´Ÿé¢æƒ…ç»ªè½¬åŒ–ä¸ºå·¥ä½œçš„åŠ¨åŠ›', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'facilitate', text: 'åœ¨éœ€è¦åŒç†å¿ƒçš„æƒ…å†µä¸‹ï¼Œæˆ‘èƒ½è°ƒåŠ¨ç›¸åº”çš„æƒ…æ„Ÿ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'facilitate', text: 'æˆ‘ä¼šåˆ©ç”¨æƒ…ç»ªæ¥å¢å¼ºè®°å¿†åŠ›', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'facilitate', text: 'æˆ‘èƒ½é€šè¿‡æƒ³è±¡æ¥æ¿€å‘ç‰¹å®šçš„æƒ…ç»ª', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },

  // æƒ…ç»ªç†è§£ Understanding (10é¢˜)
  { dim: 'understand', text: 'æˆ‘äº†è§£ä¸åŒæƒ…ç»ªä¹‹é—´çš„å…³ç³»å’Œå˜åŒ–è§„å¾‹', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'understand', text: 'æˆ‘èƒ½ç†è§£ä¸ºä»€ä¹ˆæŸäº›æƒ…å†µä¼šå¼•å‘ç‰¹å®šçš„æƒ…ç»ªååº”', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'understand', text: 'æˆ‘èƒ½é¢„æµ‹æŸä¸ªäº‹ä»¶å¯èƒ½å¼•èµ·çš„æƒ…ç»ªååº”', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'understand', text: 'æˆ‘ç†è§£å¤æ‚æƒ…ç»ªï¼ˆå¦‚åˆçˆ±åˆæ¨ï¼‰æ˜¯å¦‚ä½•äº§ç”Ÿçš„', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'understand', text: 'æˆ‘èƒ½åŒºåˆ†ç±»ä¼¼ä½†ä¸åŒçš„æƒ…ç»ªï¼ˆå¦‚æ„¤æ€’å’Œå¤±æœ›ï¼‰', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'understand', text: 'æˆ‘äº†è§£æƒ…ç»ªä¼šå¦‚ä½•éšæ—¶é—´å˜åŒ–', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'understand', text: 'æˆ‘èƒ½ç†è§£ä»–äººæƒ…ç»ªèƒŒåçš„æ·±å±‚åŸå› ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'understand', text: 'æˆ‘çŸ¥é“å“ªäº›å› ç´ ä¼šåŠ å‰§æˆ–ç¼“è§£ç‰¹å®šæƒ…ç»ª', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'understand', text: 'æˆ‘èƒ½ç”¨å‡†ç¡®çš„è¯æ±‡æè¿°ç»†å¾®çš„æƒ…ç»ªå·®å¼‚', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'understand', text: 'æˆ‘ç†è§£æ–‡åŒ–èƒŒæ™¯å¦‚ä½•å½±å“æƒ…ç»ªè¡¨è¾¾', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },

  // æƒ…ç»ªç®¡ç† Managing (10é¢˜)
  { dim: 'manage', text: 'å½“æ„Ÿåˆ°æ„¤æ€’æ—¶ï¼Œæˆ‘èƒ½å¤Ÿè®©è‡ªå·±å†·é™ä¸‹æ¥', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'manage', text: 'æˆ‘èƒ½æœ‰æ•ˆåœ°å®‰æ…°å¤„äºè´Ÿé¢æƒ…ç»ªä¸­çš„æœ‹å‹', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'manage', text: 'é¢å¯¹å‹åŠ›æ—¶ï¼Œæˆ‘èƒ½ä¿æŒæƒ…ç»ªç¨³å®š', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'manage', text: 'æˆ‘èƒ½è°ƒèŠ‚è‡ªå·±çš„æƒ…ç»ªä»¥é€‚åº”ä¸åŒåœºåˆ', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'manage', text: 'å½“æ„Ÿåˆ°ç„¦è™‘æ—¶ï¼Œæˆ‘æœ‰æœ‰æ•ˆçš„æ–¹æ³•è®©è‡ªå·±æ”¾æ¾', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'manage', text: 'æˆ‘èƒ½å¸®åŠ©ä»–äººä»è´Ÿé¢æƒ…ç»ªä¸­èµ°å‡ºæ¥', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'manage', text: 'é‡åˆ°æŒ«æŠ˜åï¼Œæˆ‘èƒ½è¾ƒå¿«æ¢å¤æƒ…ç»ª', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'manage', text: 'æˆ‘èƒ½æ§åˆ¶è‡ªå·±ä¸åœ¨æƒ…ç»ªæ¿€åŠ¨æ—¶åšå†³å®š', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'manage', text: 'æˆ‘èƒ½åœ¨å›¢é˜Ÿä¸­è¥é€ ç§¯æçš„æƒ…ç»ªæ°›å›´', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] },
  { dim: 'manage', text: 'æˆ‘èƒ½å°†è´Ÿé¢æƒ…ç»ªè½¬åŒ–ä¸ºå»ºè®¾æ€§çš„è¡ŒåŠ¨', options: ['éå¸¸ç¬¦åˆ', 'æ¯”è¾ƒç¬¦åˆ', 'ä¸€èˆ¬', 'ä¸å¤ªç¬¦åˆ', 'å®Œå…¨ä¸ç¬¦åˆ'] }
];

const dimInfo = {
  'perceive': { name: 'æƒ…ç»ªæ„ŸçŸ¥', icon: 'ğŸ‘ï¸', bg: '#dbeafe', color: '#3b82f6' },
  'facilitate': { name: 'æƒ…ç»ªè¿ç”¨', icon: 'âš¡', bg: '#d1fae5', color: '#10b981' },
  'understand': { name: 'æƒ…ç»ªç†è§£', icon: 'ğŸ’¡', bg: '#fef3c7', color: '#f59e0b' },
  'manage': { name: 'æƒ…ç»ªç®¡ç†', icon: 'ğŸ¯', bg: '#fce7f3', color: '#ec4899' }
};

const EQ_LEVELS = [
  { min: 160, level: 'å“è¶Š', desc: 'ä½ æ‹¥æœ‰éå¸¸å‡ºè‰²çš„æƒ…ç»ªæ™ºåŠ›ï¼Œèƒ½å¤Ÿæ•é”åœ°æ„ŸçŸ¥ã€ç†è§£å’Œç®¡ç†è‡ªå·±åŠä»–äººçš„æƒ…ç»ªã€‚ä½ åœ¨äººé™…å…³ç³»å’Œæƒ…ç»ªè°ƒèŠ‚æ–¹é¢æœ‰ç€å“è¶Šçš„èƒ½åŠ›ã€‚' },
  { min: 130, level: 'ä¼˜ç§€', desc: 'ä½ çš„æƒ…ç»ªæ™ºåŠ›æ°´å¹³è¾ƒé«˜ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹èƒ½å¤Ÿæœ‰æ•ˆåœ°è¯†åˆ«å’Œå¤„ç†æƒ…ç»ªã€‚ä½ æœ‰è‰¯å¥½çš„åŒç†å¿ƒå’Œæƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›ã€‚' },
  { min: 100, level: 'è‰¯å¥½', desc: 'ä½ å…·å¤‡åŸºæœ¬çš„æƒ…ç»ªæ™ºåŠ›ï¼Œèƒ½å¤Ÿå¤„ç†å¤§å¤šæ•°æ—¥å¸¸æƒ…ç»ªæƒ…å¢ƒã€‚é€šè¿‡æœ‰æ„è¯†çš„ç»ƒä¹ ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥æå‡æƒ…ç»ªç®¡ç†èƒ½åŠ›ã€‚' },
  { min: 70, level: 'ä¸€èˆ¬', desc: 'ä½ çš„æƒ…ç»ªæ™ºåŠ›æœ‰æå‡ç©ºé—´ã€‚å»ºè®®å¤šå…³æ³¨è‡ªå·±å’Œä»–äººçš„æƒ…ç»ªå˜åŒ–ï¼Œå­¦ä¹ æƒ…ç»ªç®¡ç†æŠ€å·§ï¼Œè¿™å°†æœ‰åŠ©äºæ”¹å–„äººé™…å…³ç³»ã€‚' },
  { min: 0, level: 'å¾…å‘å±•', desc: 'ä½ çš„æƒ…ç»ªæ™ºåŠ›è¿˜å¤„äºå‘å±•é˜¶æ®µã€‚ä¸ç”¨æ‹…å¿ƒï¼Œæƒ…ç»ªæ™ºåŠ›æ˜¯å¯ä»¥é€šè¿‡å­¦ä¹ å’Œç»ƒä¹ æ¥æå‡çš„ã€‚å»ºè®®ä»è®¤è¯†è‡ªå·±çš„æƒ…ç»ªå¼€å§‹ã€‚' }
];

let idx = 0;
let answers = new Array(40).fill(null);
const dims = questions.map(q => q.dim);

function render() {
  const q = questions[idx];
  const info = dimInfo[q.dim];
  document.getElementById('current').textContent = idx + 1;
  document.getElementById('qNum').textContent = idx + 1;
  document.getElementById('progressFill').style.width = ((idx + 1) / 40 * 100) + '%';
  document.getElementById('dimTag').textContent = info.name;
  document.getElementById('dimTag').style.background = info.bg;
  document.getElementById('dimTag').style.color = info.color;
  document.getElementById('qText').textContent = q.text;

  let optHtml = '';
  q.options.forEach((opt, i) => {
    const selected = answers[idx] === i ? 'selected' : '';
    optHtml += `<div class="opt ${selected}" onclick="select(${i})"><div class="opt-radio"></div><div class="opt-text">${opt}</div></div>`;
  });
  document.getElementById('options').innerHTML = optHtml;
  document.getElementById('prevBtn').disabled = idx === 0;
  document.getElementById('nextBtn').textContent = idx === 39 ? 'æŸ¥çœ‹ç»“æœ' : 'ä¸‹ä¸€é¢˜';
}

function select(v) { answers[idx] = v; render(); if (idx < 39) setTimeout(() => nextQ(), 250); }
function prevQ() { if (idx > 0) { idx--; render(); } }
function nextQ() {
  if (answers[idx] === null) { alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€‰é¡¹'); return; }
  if (idx < 39) { idx++; render(); } else showResult();
}

function exitTest() { if (confirm('ç¡®å®šé€€å‡ºï¼Ÿç­”æ¡ˆå°†ä¸ä¼šä¿å­˜ã€‚')) { goToHome(); } }
function goToHome() {
  const userSource = sessionStorage.getItem('user_source');
  if (userSource === 'platform') { window.location.href = '../platform.html'; }
  else { window.location.href = 'index.html'; }
}
function getHomeButtonHtml() {
  const userSource = sessionStorage.getItem('user_source');
  if (userSource === 'platform') { return '<button class="restart-btn" onclick="goToHome()" style="margin-left:8px">è¿”å›æµ‹è¯•ä¸­å¿ƒ</button>'; }
  else { return '<button class="restart-btn more-tests-btn" onclick="showMoreTests()" style="margin-left:8px">æ›´å¤šæµ‹è¯•</button>'; }
}
function showMoreTests() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `<div class="modal-content"><div class="modal-icon">ğŸ§‚</div><h3>è§£é”æ›´å¤šä¸“ä¸šæµ‹è¯„</h3><p>å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€æä¾›å¤šç§å¿ƒç†æµ‹è¯„å·¥å…·ï¼š</p><div class="modal-tests"><div class="modal-test-item">ğŸ’• äº²å¯†å…³ç³»å¿ƒç†æµ‹è¯„</div><div class="modal-test-item">ğŸ’¼ èŒä¸šæ€§æ ¼æµ‹è¯„</div><div class="modal-test-item">ğŸŒ¿ å‹åŠ›ä¸éŸ§æ€§æµ‹è¯„</div></div><p class="modal-tip">è´­ä¹°æµ‹è¯„åˆé›†ï¼Œè§£é”å…¨éƒ¨æµ‹è¯„å†…å®¹</p><div class="modal-buttons"><button class="modal-btn primary" onclick="contactAdvisor()">è”ç³»é¡¾é—®å’¨è¯¢</button><button class="modal-btn secondary" onclick="closeModal()">æš‚ä¸éœ€è¦</button></div></div>`;
  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add('show'), 10);
}
function contactAdvisor() { alert('è¯·æ·»åŠ é¡¾é—®å¾®ä¿¡å’¨è¯¢è´­ä¹°åˆé›†'); closeModal(); }
function closeModal() { const modal = document.querySelector('.modal-overlay'); if (modal) { modal.classList.remove('show'); setTimeout(() => modal.remove(), 300); } }

function calcScores() {
  const scores = { perceive: 0, facilitate: 0, understand: 0, manage: 0 };
  answers.forEach((v, i) => { scores[dims[i]] += (4 - v); }); // 0=éå¸¸ç¬¦åˆ=4åˆ†, 4=å®Œå…¨ä¸ç¬¦åˆ=0åˆ†
  return scores;
}

function getLevel(score, max) {
  const pct = score / max;
  if (pct >= 0.8) return { level: 'ä¼˜ç§€', color: '#059669', class: 'level-high' };
  if (pct >= 0.6) return { level: 'è‰¯å¥½', color: '#d97706', class: 'level-medium' };
  return { level: 'å¾…æå‡', color: '#dc2626', class: 'level-low' };
}

function getEQLevel(total) {
  for (const l of EQ_LEVELS) { if (total >= l.min) return l; }
  return EQ_LEVELS[EQ_LEVELS.length - 1];
}

function getDimAnalysis(dim, score) {
  const analyses = {
    perceive: {
      high: 'ä½ å…·æœ‰æ•é”çš„æƒ…ç»ªæ„ŸçŸ¥èƒ½åŠ›ï¼Œèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«è‡ªå·±å’Œä»–äººçš„æƒ…ç»ªçŠ¶æ€ï¼Œè¿™æ˜¯æƒ…ç»ªæ™ºåŠ›çš„é‡è¦åŸºç¡€ã€‚',
      medium: 'ä½ çš„æƒ…ç»ªæ„ŸçŸ¥èƒ½åŠ›å¤„äºä¸­ç­‰æ°´å¹³ï¼Œå»ºè®®å¤šç•™æ„è‡ªå·±å’Œä»–äººçš„æƒ…ç»ªå˜åŒ–ï¼Œæå‡å¯¹ç»†å¾®æƒ…ç»ªä¿¡å·çš„æ•æ„Ÿåº¦ã€‚',
      low: 'ä½ çš„æƒ…ç»ªæ„ŸçŸ¥èƒ½åŠ›æœ‰è¾ƒå¤§æå‡ç©ºé—´ï¼Œå»ºè®®é€šè¿‡å†¥æƒ³ã€æƒ…ç»ªæ—¥è®°ç­‰æ–¹å¼å¢å¼ºå¯¹æƒ…ç»ªçš„è§‰å¯Ÿã€‚'
    },
    facilitate: {
      high: 'ä½ å–„äºåˆ©ç”¨æƒ…ç»ªæ¥ä¿ƒè¿›æ€è€ƒå’Œè¡ŒåŠ¨ï¼Œèƒ½å¤Ÿå°†æƒ…ç»ªè½¬åŒ–ä¸ºå·¥ä½œå’Œç”Ÿæ´»çš„åŠ©åŠ›ã€‚',
      medium: 'ä½ åŸºæœ¬èƒ½å¤Ÿåˆ©ç”¨æƒ…ç»ªè¾…åŠ©æ€è€ƒï¼Œä½†è¿˜å¯ä»¥æ›´æœ‰æ„è¯†åœ°è¿ç”¨ç§¯ææƒ…ç»ªæ¥æå‡æ•ˆç‡å’Œåˆ›é€ åŠ›ã€‚',
      low: 'ä½ åœ¨åˆ©ç”¨æƒ…ç»ªä¿ƒè¿›æ€è€ƒæ–¹é¢è¿˜éœ€åŠ å¼ºï¼Œå»ºè®®å­¦ä¹ å¦‚ä½•å°†æƒ…ç»ªä½œä¸ºèµ„æºè€Œééšœç¢ã€‚'
    },
    understand: {
      high: 'ä½ å¯¹æƒ…ç»ªæœ‰æ·±å…¥çš„ç†è§£ï¼Œèƒ½å¤Ÿåˆ†ææƒ…ç»ªäº§ç”Ÿçš„åŸå› å’Œå˜åŒ–è§„å¾‹ï¼Œè¿™æœ‰åŠ©äºæ›´å¥½åœ°å¤„ç†å¤æ‚çš„æƒ…æ„Ÿæƒ…å¢ƒã€‚',
      medium: 'ä½ å¯¹æƒ…ç»ªæœ‰åŸºæœ¬çš„ç†è§£ï¼Œå»ºè®®æ·±å…¥å­¦ä¹ æƒ…ç»ªå¿ƒç†å­¦çŸ¥è¯†ï¼Œæå‡å¯¹æƒ…ç»ªå¤æ‚æ€§çš„è®¤è¯†ã€‚',
      low: 'ä½ å¯¹æƒ…ç»ªçš„ç†è§£è¿˜æ¯”è¾ƒè¡¨é¢ï¼Œå»ºè®®é€šè¿‡é˜…è¯»å’Œåæ€æ¥åŠ æ·±å¯¹æƒ…ç»ªè§„å¾‹çš„è®¤è¯†ã€‚'
    },
    manage: {
      high: 'ä½ å…·æœ‰å‡ºè‰²çš„æƒ…ç»ªç®¡ç†èƒ½åŠ›ï¼Œèƒ½å¤Ÿæœ‰æ•ˆè°ƒèŠ‚è‡ªå·±å’Œå½±å“ä»–äººçš„æƒ…ç»ªçŠ¶æ€ï¼Œä¿æŒæƒ…ç»ªç¨³å®šã€‚',
      medium: 'ä½ çš„æƒ…ç»ªç®¡ç†èƒ½åŠ›ä¸­ç­‰ï¼Œå¤§å¤šæ•°æ—¶å€™èƒ½å¤Ÿæ§åˆ¶æƒ…ç»ªï¼Œä½†åœ¨å‹åŠ›ä¸‹å¯èƒ½ä¼šæœ‰å›°éš¾ã€‚å»ºè®®å­¦ä¹ æ›´å¤šè°ƒèŠ‚æŠ€å·§ã€‚',
      low: 'ä½ çš„æƒ…ç»ªç®¡ç†èƒ½åŠ›éœ€è¦æå‡ï¼Œå»ºè®®å­¦ä¹ æ·±å‘¼å¸ã€æ­£å¿µç­‰æƒ…ç»ªè°ƒèŠ‚æŠ€æœ¯ï¼Œå¹¶åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ç»ƒä¹ ã€‚'
    }
  };
  const pct = score / 40;
  if (pct >= 0.7) return analyses[dim].high;
  if (pct >= 0.5) return analyses[dim].medium;
  return analyses[dim].low;
}

function showResult() {
  document.getElementById('testPage').classList.remove('active');
  document.getElementById('resultPage').classList.add('active');

  const scores = calcScores();
  const total = scores.perceive + scores.facilitate + scores.understand + scores.manage;
  const eqLevel = getEQLevel(total);

  const html = `
    <div class="card" style="text-align:center;">
      <div style="font-size:14px;color:var(--text-muted);margin-bottom:8px;">ä½ çš„æƒ…ç»ªæ™ºåŠ›åˆ†æ•°</div>
      <div class="eq-score">${total}</div>
      <div class="eq-level">${eqLevel.level}</div>
      <div class="eq-desc">${eqLevel.desc}</div>
      <div class="stat-grid">
        <div class="stat-card"><div class="stat-value">${scores.perceive}</div><div class="stat-label">æƒ…ç»ªæ„ŸçŸ¥</div></div>
        <div class="stat-card"><div class="stat-value">${scores.facilitate}</div><div class="stat-label">æƒ…ç»ªè¿ç”¨</div></div>
        <div class="stat-card"><div class="stat-value">${scores.understand}</div><div class="stat-label">æƒ…ç»ªç†è§£</div></div>
        <div class="stat-card"><div class="stat-value">${scores.manage}</div><div class="stat-label">æƒ…ç»ªç®¡ç†</div></div>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#dbeafe">ğŸ“Š</div>å››ç»´åº¦è¯¦ç»†åˆ†æ</div>
      <div class="chart-container"><canvas id="radarChart"></canvas></div>
      ${Object.keys(dimInfo).map(d => {
        const info = dimInfo[d];
        const score = scores[d];
        const lv = getLevel(score, 40);
        return `
          <div class="dim-item">
            <div class="dim-header">
              <div class="dim-name"><div class="dim-icon" style="background:${info.bg}">${info.icon}</div>${info.name}</div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span class="level-badge ${lv.class}">${lv.level}</span>
                <span class="dim-score">${score}/40</span>
              </div>
            </div>
            <div class="dim-bar"><div class="dim-bar-fill" style="width:${(score/40)*100}%;background:${info.color}"></div></div>
            <div class="dim-analysis">${getDimAnalysis(d, score)}</div>
          </div>
        `;
      }).join('')}
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#d1fae5">ğŸ’¡</div>æå‡å»ºè®®</div>
      <div class="tip-item"><div class="tip-num">1</div><div class="tip-text">æ¯å¤©èŠ±5åˆ†é’Ÿå†™æƒ…ç»ªæ—¥è®°ï¼Œè®°å½•å½“å¤©ç»å†çš„ä¸»è¦æƒ…ç»ªåŠå…¶è§¦å‘å› ç´ </div></div>
      <div class="tip-item"><div class="tip-num">2</div><div class="tip-text">ç»ƒä¹ æ­£å¿µå†¥æƒ³ï¼Œå¢å¼ºå¯¹å½“ä¸‹æƒ…ç»ªçŠ¶æ€çš„è§‰å¯Ÿèƒ½åŠ›</div></div>
      <div class="tip-item"><div class="tip-num">3</div><div class="tip-text">åœ¨æ„Ÿåˆ°å¼ºçƒˆæƒ…ç»ªæ—¶ï¼Œå°è¯•"æš‚åœ-å‘¼å¸-é€‰æ‹©"çš„ä¸‰æ­¥æ³•</div></div>
      <div class="tip-item"><div class="tip-num">4</div><div class="tip-text">é˜…è¯»æƒ…ç»ªæ™ºåŠ›ç›¸å…³ä¹¦ç±ï¼Œå¦‚ã€Šæƒ…å•†ã€‹ã€Šéæš´åŠ›æ²Ÿé€šã€‹ç­‰</div></div>
      <div class="tip-item"><div class="tip-num">5</div><div class="tip-text">ä¸»åŠ¨å¯»æ±‚åé¦ˆï¼Œäº†è§£è‡ªå·±çš„æƒ…ç»ªè¡¨è¾¾å¯¹ä»–äººçš„å½±å“</div></div>
    </div>

    <div class="card download-section">
      <button class="download-btn" onclick="downloadPDF()" id="dlBtn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>ä¸‹è½½PDFæŠ¥å‘Š</button>
      <button class="restart-btn" onclick="restart()">é‡æ–°æµ‹è¯•</button>
      ${getHomeButtonHtml()}
    </div>
  `;

  document.getElementById('resultContent').innerHTML = html;

  setTimeout(() => {
    new Chart(document.getElementById('radarChart'), {
      type: 'radar',
      data: {
        labels: ['æƒ…ç»ªæ„ŸçŸ¥', 'æƒ…ç»ªè¿ç”¨', 'æƒ…ç»ªç†è§£', 'æƒ…ç»ªç®¡ç†'],
        datasets: [{ data: [scores.perceive, scores.facilitate, scores.understand, scores.manage], backgroundColor: 'rgba(102, 126, 234, 0.2)', borderColor: 'rgba(102, 126, 234, 1)', borderWidth: 2, pointBackgroundColor: 'rgba(102, 126, 234, 1)' }]
      },
      options: { scales: { r: { beginAtZero: true, max: 40, ticks: { stepSize: 10 } } }, plugins: { legend: { display: false } } }
    });
  }, 100);
}

function restart() { if (confirm('ç¡®å®šè¦é‡æ–°æµ‹è¯•å—ï¼Ÿ')) location.reload(); }

async function downloadPDF() {
  const btn = document.getElementById('dlBtn');
  const loading = document.getElementById('loading');
  btn.disabled = true; btn.innerHTML = 'ç”Ÿæˆä¸­...'; loading.classList.add('show');
  try {
    const scores = calcScores();
    const total = scores.perceive + scores.facilitate + scores.understand + scores.manage;
    const eqLevel = getEQLevel(total);
    const date = new Date().toLocaleDateString('zh-CN');

    const pdfContainer = document.createElement('div');
    pdfContainer.style.cssText = 'position:absolute;left:-9999px;top:0;width:800px;background:#fff;padding:40px;font-family:"Noto Sans SC",sans-serif;';
    pdfContainer.innerHTML = `
      <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:50px 40px;margin:-40px -40px 30px -40px;text-align:center;color:#fff;">
        <div style="font-size:16px;margin-bottom:10px;opacity:0.9;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div style="font-size:32px;font-weight:700;margin-bottom:15px;">æƒ…ç»ªæ™ºåŠ›æµ‹è¯„æŠ¥å‘Š</div>
        <div style="font-size:14px;opacity:0.8;">æµ‹è¯„æ—¥æœŸï¼š${date}</div>
      </div>
      <div style="text-align:center;margin-bottom:25px;">
        <div style="font-size:14px;color:#64748b;margin-bottom:8px;">ä½ çš„æƒ…ç»ªæ™ºåŠ›åˆ†æ•°</div>
        <div style="font-size:56px;font-weight:700;color:#667eea;">${total}</div>
        <div style="display:inline-block;padding:8px 24px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:20px;font-weight:600;">${eqLevel.level}</div>
        <div style="color:#64748b;font-size:14px;line-height:1.8;margin-top:16px;max-width:600px;margin-left:auto;margin-right:auto;">${eqLevel.desc}</div>
      </div>
      <div style="display:flex;gap:15px;margin-bottom:25px;">
        ${Object.keys(dimInfo).map(d => `<div style="flex:1;background:#f8fafc;border-radius:12px;padding:20px;text-align:center;"><div style="font-size:28px;font-weight:700;color:#667eea;">${scores[d]}</div><div style="font-size:12px;color:#64748b;">${dimInfo[d].name}</div></div>`).join('')}
      </div>
      <div style="background:#f8fafc;border-radius:12px;padding:20px;text-align:center;color:#94a3b8;font-size:12px;">
        <div style="margin-bottom:8px;font-weight:500;">å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€ Â· Space Salt Lab</div>
        <div>æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­</div>
      </div>
    `;
    document.body.appendChild(pdfContainer);
    await document.fonts.ready;
    await new Promise(r => setTimeout(r, 300));
    const canvas = await html2canvas(pdfContainer, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
    document.body.removeChild(pdfContainer);
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    const imgData = canvas.toDataURL('image/jpeg', 0.95);
    const pdfW = 210, finalW = pdfW - 20;
    const ratio = canvas.width / canvas.height;
    const finalH = finalW / ratio;
    pdf.addImage(imgData, 'JPEG', 10, 10, finalW, finalH);
    pdf.save(`æƒ…ç»ªæ™ºåŠ›æµ‹è¯„æŠ¥å‘Š_${total}åˆ†_${date}.pdf`);
  } catch (e) { console.error(e); alert('PDFç”Ÿæˆå¤±è´¥'); }
  finally { btn.disabled = false; btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> ä¸‹è½½PDFæŠ¥å‘Š'; loading.classList.remove('show'); }
}

render();
</script>
</body>
</html>
