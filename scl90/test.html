<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¿ƒç†çŠ¶æ€è¯„ä¼° | å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --primary-light: #a5b4fc;
  --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #1e293b;
  --text-muted: #64748b;
  --border: #e2e8f0;
  --shadow: 0 4px 20px rgba(0,0,0,0.08);
  --radius: 16px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans SC', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
.page { display: none; min-height: 100vh; }
.page.active { display: block; }
#testPage { background: var(--bg); padding: 20px; }
.test-container { max-width: 700px; margin: 0 auto; }
.test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.back-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: all 0.2s; }
.back-btn:hover { background: white; color: var(--text); }
.progress-wrap { text-align: right; }
.progress-text { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
.progress-bar { width: 180px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--gradient); border-radius: 3px; transition: width 0.3s; }
.question-card { background: var(--card); border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); }
.dim-tag { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-bottom: 16px; }
.q-num { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.q-text { font-size: 20px; font-weight: 600; line-height: 1.5; margin-bottom: 32px; }
.options { display: flex; flex-direction: column; gap: 12px; }
.opt { display: flex; align-items: center; gap: 14px; padding: 16px 20px; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
.opt:hover { border-color: var(--primary-light); background: #fafaff; }
.opt.selected { border-color: var(--primary); background: linear-gradient(135deg, #ede9fe 0%, #e0e7ff 100%); }
.opt-radio { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
.opt.selected .opt-radio { border-color: var(--primary); background: var(--primary); }
.opt.selected .opt-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
.opt-text { font-size: 15px; font-weight: 500; }
.nav-btns { display: flex; gap: 12px; margin-top: 32px; }
.nav-btn { flex: 1; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s; }
.nav-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.nav-btn.secondary:hover { border-color: var(--primary-light); }
.nav-btn.primary { background: var(--primary); border: none; color: white; }
.nav-btn.primary:hover { background: var(--primary-dark); }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }

#resultPage { background: linear-gradient(180deg, #667eea 0%, #764ba2 40%, var(--bg) 40%); }
.result-container { max-width: 800px; margin: 0 auto; padding: 40px 20px 60px; }
.result-header { text-align: center; color: white; margin-bottom: 32px; padding-top: 20px; }
.result-header h1 { font-size: 26px; margin-bottom: 8px; }
.result-header p { opacity: 0.9; font-size: 14px; }
.card { background: var(--card); border-radius: var(--radius); padding: 32px; box-shadow: var(--shadow); margin-bottom: 20px; }
.section-title { font-size: 17px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
.section-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }

.status-card { text-align: center; padding: 24px; border-radius: 16px; margin-bottom: 20px; }
.status-card.stable { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); }
.status-card.attention { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
.status-card.risk { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); }
.status-label { font-size: 14px; margin-bottom: 8px; }
.status-value { font-size: 28px; font-weight: 700; }
.status-card.stable .status-value { color: #059669; }
.status-card.attention .status-value { color: #d97706; }
.status-card.risk .status-value { color: #dc2626; }

.chart-wrap { max-width: 400px; margin: 0 auto; }
.dim-item { padding: 16px; border: 1px solid var(--border); border-radius: 14px; margin-bottom: 12px; }
.dim-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.dim-name { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 14px; }
.dim-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
.dim-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
.dim-bar-fill { height: 100%; border-radius: 4px; }
.level-badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; }
.level-high { background: #d1fae5; color: #059669; }
.level-medium { background: #fef3c7; color: #d97706; }
.level-low { background: #fee2e2; color: #dc2626; }

.summary-text { font-size: 15px; color: var(--text-muted); line-height: 1.8; }
.tip-item { display: flex; gap: 12px; padding: 14px; background: #f8fafc; border-radius: 10px; margin-bottom: 10px; }
.tip-num { width: 24px; height: 24px; background: var(--gradient); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; flex-shrink: 0; }
.tip-text { font-size: 14px; color: var(--text-muted); line-height: 1.6; }

.warning-section { background: #fef2f2; border: 1px solid #fecaca; border-radius: 12px; padding: 16px; margin-top: 16px; }
.warning-section h4 { color: #dc2626; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
.warning-section p { font-size: 13px; color: #7f1d1d; line-height: 1.6; }

.action-btns { display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap; }
.restart-btn { flex: 1; min-width: 140px; padding: 14px 20px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; }
.restart-btn.primary { background: var(--gradient); border: none; color: white; }
.restart-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(102,126,234,0.3); }
.restart-btn.secondary { background: white; border: 2px solid var(--border); color: var(--text); }
.restart-btn.secondary:hover { border-color: var(--primary); }

.modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; transition: opacity 0.3s; }
.modal-overlay.show { opacity: 1; }
.modal-content { background: white; border-radius: 20px; padding: 32px; max-width: 400px; width: 90%; text-align: center; transform: scale(0.9); transition: transform 0.3s; }
.modal-overlay.show .modal-content { transform: scale(1); }
.modal-icon { font-size: 48px; margin-bottom: 16px; }
.modal-content h3 { font-size: 20px; margin-bottom: 12px; }
.modal-content p { color: var(--text-muted); font-size: 14px; margin-bottom: 20px; }
.modal-btn { width: 100%; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; margin-bottom: 10px; }
.modal-btn.primary { background: var(--gradient); border: none; color: white; }
.modal-btn.secondary { background: #f1f5f9; border: none; color: var(--text); }

.loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); display: none; align-items: center; justify-content: center; z-index: 2000; flex-direction: column; gap: 16px; }
.loading-overlay.show { display: flex; }
.loading-spinner { width: 48px; height: 48px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div id="testPage" class="page active">
  <div class="test-container">
    <div class="test-header">
      <button class="back-btn" onclick="if(confirm('ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ'))location.href='index.html'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        è¿”å›
      </button>
      <div class="progress-wrap">
        <div class="progress-text"><span id="current">1</span> / 45</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:2.2%"></div></div>
      </div>
    </div>
    <div class="question-card">
      <div class="dim-tag" id="dimTag" style="background:#dbeafe;color:#3b82f6">èº¯ä½“åŒ–</div>
      <div class="q-num">ç¬¬ <span id="qNum">1</span> é¢˜</div>
      <div class="q-text" id="qText"></div>
      <div class="options" id="options"></div>
      <div class="nav-btns">
        <button class="nav-btn secondary" id="prevBtn" onclick="prev()" disabled>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          ä¸Šä¸€é¢˜
        </button>
        <button class="nav-btn primary" id="nextBtn" onclick="next()" disabled>
          ä¸‹ä¸€é¢˜
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<div id="resultPage" class="page">
  <div class="result-container" id="resultContent"></div>
</div>

<div class="loading-overlay" id="loading">
  <div class="loading-spinner"></div>
  <div style="color:var(--text-muted)">æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...</div>
</div>

<script>
// 45é¢˜SCL-90ç²¾ç®€ç‰ˆï¼Œæ¯ä¸ªå› å­5é¢˜
const questions = [
  // èº¯ä½“åŒ– (5é¢˜)
  { dim: 'som', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°å¤´ç—›æˆ–å¤´éƒ¨ä¸é€‚ï¼Ÿ' },
  { dim: 'som', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°å¿ƒè·³åŠ é€Ÿæˆ–å¿ƒæ…Œï¼Ÿ' },
  { dim: 'som', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°èº«ä½“æŸäº›éƒ¨ä½éº»æœ¨æˆ–åˆºç—›ï¼Ÿ' },
  { dim: 'som', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°èƒ¸é—·æˆ–å‘¼å¸å›°éš¾ï¼Ÿ' },
  { dim: 'som', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°è‚Œè‚‰é…¸ç—›æˆ–èº«ä½“ç–²åŠ³ï¼Ÿ' },
  // å¼ºè¿«ç—‡çŠ¶ (5é¢˜)
  { dim: 'obs', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦åå¤æ£€æŸ¥å·²ç»åšå¥½çš„äº‹æƒ…ï¼Ÿ' },
  { dim: 'obs', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦éš¾ä»¥åšå‡ºå†³å®šï¼Ÿ' },
  { dim: 'obs', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æœ‰ä¸€äº›æ— æ³•æ‘†è„±çš„æƒ³æ³•ï¼Ÿ' },
  { dim: 'obs', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°åšäº‹å¿…é¡»åå¤æ ¸å¯¹ï¼Ÿ' },
  { dim: 'obs', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦å› ä¸ºç²—å¿ƒå¤§æ„è€Œçƒ¦æ¼ï¼Ÿ' },
  // äººé™…æ•æ„Ÿ (5é¢˜)
  { dim: 'int', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°åˆ«äººä¸ç†è§£ä½ ï¼Ÿ' },
  { dim: 'int', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°ä¸äººç›¸å¤„æ—¶ä¸è‡ªåœ¨ï¼Ÿ' },
  { dim: 'int', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°è‡ªå·±ä¸å¦‚åˆ«äººï¼Ÿ' },
  { dim: 'int', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦è¿‡åˆ†åœ¨æ„åˆ«äººå¯¹ä½ çš„çœ‹æ³•ï¼Ÿ' },
  { dim: 'int', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°åˆ«äººå¯¹ä½ ä¸å‹å–„ï¼Ÿ' },
  // æŠ‘éƒ (5é¢˜)
  { dim: 'dep', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°æƒ…ç»ªä½è½æˆ–æ²®ä¸§ï¼Ÿ' },
  { dim: 'dep', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦å¯¹äº‹æƒ…å¤±å»å…´è¶£ï¼Ÿ' },
  { dim: 'dep', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°å‰é€”æ²¡æœ‰å¸Œæœ›ï¼Ÿ' },
  { dim: 'dep', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°è‡ªå·±æ²¡æœ‰ä»·å€¼ï¼Ÿ' },
  { dim: 'dep', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æœ‰æƒ³å“­çš„æ„Ÿè§‰ï¼Ÿ' },
  // ç„¦è™‘ (5é¢˜)
  { dim: 'anx', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°ç´§å¼ æˆ–å¿ƒç¥ä¸å®ï¼Ÿ' },
  { dim: 'anx', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°åç«‹ä¸å®‰ï¼Ÿ' },
  { dim: 'anx', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°å®³æ€•æˆ–ææƒ§ï¼Ÿ' },
  { dim: 'anx', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦å®¹æ˜“å—åˆ°æƒŠå“ï¼Ÿ' },
  { dim: 'anx', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°è«åçš„æ‹…å¿ƒï¼Ÿ' },
  // æ•Œå¯¹ (5é¢˜)
  { dim: 'hos', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦å®¹æ˜“å‘è„¾æ°”æˆ–æ„Ÿåˆ°çƒ¦èºï¼Ÿ' },
  { dim: 'hos', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æœ‰æƒ³æ‰“äººæˆ–ä¼¤å®³ä»–äººçš„å†²åŠ¨ï¼Ÿ' },
  { dim: 'hos', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦ç»å¸¸ä¸äººäº‰åµï¼Ÿ' },
  { dim: 'hos', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°å®¹æ˜“è¢«æ¿€æ€’ï¼Ÿ' },
  { dim: 'hos', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æœ‰æƒ³æ‘”ä¸œè¥¿çš„å†²åŠ¨ï¼Ÿ' },
  // ææƒ§ (5é¢˜)
  { dim: 'pho', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦å®³æ€•åˆ°ç©ºæ—·çš„åœ°æ–¹ï¼Ÿ' },
  { dim: 'pho', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦å®³æ€•ä¹˜åå…¬å…±äº¤é€šï¼Ÿ' },
  { dim: 'pho', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦å®³æ€•ç‹¬å¤„ï¼Ÿ' },
  { dim: 'pho', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦å®³æ€•äººå¤šçš„åœºåˆï¼Ÿ' },
  { dim: 'pho', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æœ‰ç‰¹å®šçš„ææƒ§å¯¹è±¡ï¼Ÿ' },
  // åæ‰§ (5é¢˜)
  { dim: 'par', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°åˆ«äººåœ¨è®®è®ºä½ ï¼Ÿ' },
  { dim: 'par', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°åˆ«äººæƒ³å ä½ ä¾¿å®œï¼Ÿ' },
  { dim: 'par', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°ä¸èƒ½ä¿¡ä»»å¤§å¤šæ•°äººï¼Ÿ' },
  { dim: 'par', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°åˆ«äººåœ¨ç›‘è§†æˆ–è°ˆè®ºä½ ï¼Ÿ' },
  { dim: 'par', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°åˆ«äººå¯¹ä½ æœ‰æ•Œæ„ï¼Ÿ' },
  // ç°å®æ„Ÿç¨³å®šæ€§ (5é¢˜)
  { dim: 'psy', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°è‡ªå·±çš„æ€æƒ³ä¸å—æ§åˆ¶ï¼Ÿ' },
  { dim: 'psy', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°å­¤ç‹¬ï¼Ÿ' },
  { dim: 'psy', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°ä¸ä»–äººç–è¿œï¼Ÿ' },
  { dim: 'psy', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°è‡ªå·±ä¸çœŸå®ï¼Ÿ' },
  { dim: 'psy', text: 'æœ€è¿‘ä¸€å‘¨ï¼Œä½ æ˜¯å¦æ„Ÿåˆ°å‘¨å›´äº‹ç‰©ä¸çœŸå®ï¼Ÿ' }
];

const dimInfo = {
  'som': { name: 'èº¯ä½“åŒ–', icon: 'ğŸ©º', bg: '#dbeafe', color: '#3b82f6' },
  'obs': { name: 'å¼ºè¿«ç—‡çŠ¶', icon: 'ğŸ”„', bg: '#fef3c7', color: '#f59e0b' },
  'int': { name: 'äººé™…æ•æ„Ÿ', icon: 'ğŸ‘¥', bg: '#fce7f3', color: '#ec4899' },
  'dep': { name: 'æŠ‘éƒ', icon: 'ğŸ˜”', bg: '#e0e7ff', color: '#6366f1' },
  'anx': { name: 'ç„¦è™‘', icon: 'ğŸ˜°', bg: '#fee2e2', color: '#ef4444' },
  'hos': { name: 'æ•Œå¯¹', icon: 'ğŸ˜¤', bg: '#ffedd5', color: '#f97316' },
  'pho': { name: 'ææƒ§', icon: 'ğŸ˜¨', bg: '#d1fae5', color: '#10b981' },
  'par': { name: 'åæ‰§', icon: 'ğŸ¤”', bg: '#f3e8ff', color: '#a855f7' },
  'psy': { name: 'ç°å®æ„Ÿç¨³å®šæ€§', icon: 'ğŸŒ€', bg: '#cffafe', color: '#06b6d4' }
};

const optionLabels = ['æ²¡æœ‰', 'å¾ˆè½»', 'ä¸­ç­‰', 'åé‡', 'ä¸¥é‡'];

let idx = 0;
let answers = new Array(45).fill(null);
const dims = questions.map(q => q.dim);

function render() {
  const q = questions[idx];
  const info = dimInfo[q.dim];
  document.getElementById('dimTag').textContent = info.name;
  document.getElementById('dimTag').style.background = info.bg;
  document.getElementById('dimTag').style.color = info.color;
  document.getElementById('qNum').textContent = idx + 1;
  document.getElementById('current').textContent = idx + 1;
  document.getElementById('qText').textContent = q.text;
  document.getElementById('progressFill').style.width = ((idx + 1) / 45 * 100) + '%';

  const optDiv = document.getElementById('options');
  optDiv.innerHTML = '';
  optionLabels.forEach((label, i) => {
    const opt = document.createElement('div');
    opt.className = 'opt' + (answers[idx] === i ? ' selected' : '');
    opt.innerHTML = `<div class="opt-radio"></div><div class="opt-text">${label}</div>`;
    opt.onclick = () => selectOption(i);
    optDiv.appendChild(opt);
  });

  document.getElementById('prevBtn').disabled = idx === 0;
  document.getElementById('nextBtn').disabled = answers[idx] === null;
  document.getElementById('nextBtn').textContent = idx === 44 ? 'æŸ¥çœ‹ç»“æœ' : 'ä¸‹ä¸€é¢˜';
}

function selectOption(val) {
  answers[idx] = val;
  render();
}

function prev() { if (idx > 0) { idx--; render(); } }

function next() {
  if (answers[idx] === null) return;
  if (idx < 44) { idx++; render(); }
  else { showResult(); }
}

function getNavButtons() {
  const source = sessionStorage.getItem('user_source');
  if (source === 'platform') {
    return '<button class="restart-btn secondary" onclick="location.href=\'../platform.html\'">è¿”å›æµ‹è¯„ä¸­å¿ƒ</button>';
  } else {
    return '<button class="restart-btn secondary" onclick="showMoreTests()">æ›´å¤šæµ‹è¯•</button>';
  }
}

function showMoreTests() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `
    <div class="modal-content">
      <div class="modal-icon">ğŸ§‚</div>
      <h3>æ›´å¤šä¸“ä¸šæµ‹è¯„</h3>
      <p>è¯·åœ¨å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€è´­ä¹°å…¶ä»–æµ‹è¯•å“¦~</p>
      <div class="modal-buttons">
        <button class="modal-btn primary" onclick="closeModal()">çŸ¥é“äº†</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add('show'), 10);
}

function closeModal() {
  const modal = document.querySelector('.modal-overlay');
  if (modal) { modal.classList.remove('show'); setTimeout(() => modal.remove(), 300); }
}

function calcScores() {
  const scores = { som: 0, obs: 0, int: 0, dep: 0, anx: 0, hos: 0, pho: 0, par: 0, psy: 0 };
  answers.forEach((v, i) => { scores[dims[i]] += v; });
  return scores;
}

function getOverallStatus(total) {
  if (total <= 45) return { level: 'å¿ƒç†çŠ¶æ€ç¨³å®š', class: 'stable', color: '#059669', desc: 'ä½ å½“å‰çš„å¿ƒç†çŠ¶æ€æ•´ä½“ç¨³å®šï¼Œå„é¡¹æŒ‡æ ‡å‡åœ¨æ­£å¸¸èŒƒå›´å†…ã€‚è¿™è¡¨æ˜ä½ åœ¨è¿‘æœŸçš„ç”Ÿæ´»ä¸­èƒ½å¤Ÿè¾ƒå¥½åœ°åº”å¯¹æ—¥å¸¸å‹åŠ›ï¼Œæƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›è‰¯å¥½ã€‚ç»§ç»­ä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼ï¼Œç»´æŒè§„å¾‹çš„ä½œæ¯ã€é€‚å½“çš„è¿åŠ¨å’Œç¤¾äº¤æ´»åŠ¨ï¼Œè¿™å°†æœ‰åŠ©äºä½ æŒç»­ä¿æŒè‰¯å¥½çš„å¿ƒç†çŠ¶æ€ã€‚' };
  if (total <= 90) return { level: 'éœ€è¦å…³æ³¨', class: 'attention', color: '#d97706', desc: 'ä½ å½“å‰çš„å¿ƒç†çŠ¶æ€æ˜¾ç¤ºå‡ºä¸€äº›éœ€è¦å…³æ³¨çš„ä¿¡å·ã€‚è™½ç„¶æ•´ä½“å¤„äºå¯æ§èŒƒå›´ï¼Œä½†æŸäº›æ–¹é¢å¯èƒ½æ­£åœ¨ç»å†å‹åŠ›æˆ–å›°æ‰°ã€‚å»ºè®®ä½ å…³æ³¨é‚£äº›å¾—åˆ†è¾ƒé«˜çš„ç»´åº¦ï¼Œåˆ†æå¯èƒ½çš„å‹åŠ›æ¥æºï¼Œå¹¶é‡‡å–ç§¯æçš„è‡ªæˆ‘è°ƒèŠ‚æªæ–½ã€‚å¦‚æœè¿™äº›ç—‡çŠ¶æŒç»­å­˜åœ¨æˆ–åŠ é‡ï¼Œå»ºè®®å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚' };
  return { level: 'å»ºè®®å¯»æ±‚å¸®åŠ©', class: 'risk', color: '#dc2626', desc: 'ä½ å½“å‰çš„å¿ƒç†çŠ¶æ€æ˜¾ç¤ºå‡ºè¾ƒæ˜æ˜¾çš„å›°æ‰°ä¿¡å·ï¼Œå¤šä¸ªç»´åº¦çš„å¾—åˆ†åé«˜ã€‚è¿™å¯èƒ½æ„å‘³ç€ä½ æ­£åœ¨ç»å†è¾ƒå¤§çš„å¿ƒç†å‹åŠ›æˆ–æƒ…ç»ªå›°æ‰°ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ è®¤çœŸå¯¹å¾…è¿™äº›ä¿¡å·ï¼ŒåŠæ—¶å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢å¸ˆæˆ–åŒ»ç”Ÿçš„å¸®åŠ©ã€‚è¯·è®°ä½ï¼Œå¯»æ±‚å¸®åŠ©æ˜¯å‹‡æ•¢å’Œæ˜æ™ºçš„é€‰æ‹©ï¼Œä¸“ä¸šäººå£«å¯ä»¥æä¾›æœ‰æ•ˆçš„æ”¯æŒå’ŒæŒ‡å¯¼ã€‚' };
}

function getDimLevel(score) {
  if (score <= 5) return { level: 'æ­£å¸¸', class: 'level-high', color: '#059669' };
  if (score <= 10) return { level: 'è½»åº¦', class: 'level-medium', color: '#d97706' };
  if (score <= 15) return { level: 'ä¸­åº¦', class: 'level-medium', color: '#f97316' };
  return { level: 'åé«˜', class: 'level-low', color: '#dc2626' };
}

function getDimAnalysis(dim, score) {
  const analyses = {
    som: {
      normal: 'ä½ çš„èº¯ä½“åŒ–æ°´å¹³æ­£å¸¸ï¼Œèº«ä½“ä¸å¿ƒç†çš„åè°ƒæ€§è‰¯å¥½ã€‚ä½ èƒ½å¤ŸåŒºåˆ†èº«ä½“çš„æ­£å¸¸æ„Ÿå—å’Œå‹åŠ›ååº”ï¼Œä¸ä¼šè¿‡åº¦å…³æ³¨èº«ä½“ç—‡çŠ¶ã€‚ç»§ç»­ä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼å’Œé€‚åº¦è¿åŠ¨ã€‚',
      mild: 'ä½ å‡ºç°äº†ä¸€äº›è½»åº¦çš„èº¯ä½“åŒ–ç—‡çŠ¶ï¼Œå¦‚å¶å°”çš„å¤´ç—›ã€ç–²åŠ³æˆ–è‚Œè‚‰ç´§å¼ ã€‚è¿™å¯èƒ½æ˜¯è¿‘æœŸå‹åŠ›çš„èº«ä½“ååº”ã€‚å»ºè®®å…³æ³¨å‹åŠ›æ¥æºï¼Œé€‚å½“æ”¾æ¾ï¼Œä¿è¯å……è¶³ç¡çœ ã€‚',
      moderate: 'ä½ çš„èº¯ä½“åŒ–ç—‡çŠ¶è¾ƒä¸ºæ˜æ˜¾ï¼Œèº«ä½“ä¸é€‚å¯èƒ½å½±å“åˆ°æ—¥å¸¸ç”Ÿæ´»ã€‚å»ºè®®å…ˆæ’é™¤å™¨è´¨æ€§ç–¾ç—…ï¼ŒåŒæ—¶å­¦ä¹ å‹åŠ›ç®¡ç†æŠ€å·§ï¼Œå¦‚æ·±å‘¼å¸ã€æ¸è¿›å¼è‚Œè‚‰æ”¾æ¾ç­‰ã€‚',
      high: 'ä½ çš„èº¯ä½“åŒ–æ°´å¹³è¾ƒé«˜ï¼Œèº«ä½“ç—‡çŠ¶æ˜æ˜¾ä¸”é¢‘ç¹ã€‚è¿™å¯èƒ½æ˜¯é•¿æœŸå‹åŠ›æˆ–æƒ…ç»ªé—®é¢˜çš„èº¯ä½“è¡¨ç°ã€‚å»ºè®®åŠæ—¶å°±åŒ»æ£€æŸ¥ï¼ŒåŒæ—¶è€ƒè™‘å¯»æ±‚å¿ƒç†å’¨è¯¢å¸®åŠ©ã€‚'
    },
    obs: {
      normal: 'ä½ çš„å¼ºè¿«ç—‡çŠ¶æ°´å¹³æ­£å¸¸ï¼Œæ€ç»´å’Œè¡Œä¸ºéƒ½å¾ˆçµæ´»ã€‚ä½ èƒ½å¤Ÿåšå‡ºå†³å®šå¹¶æ¥å—ä¸å®Œç¾ï¼Œä¸ä¼šè¢«é‡å¤æ€§çš„æƒ³æ³•æˆ–è¡Œä¸ºæ‰€å›°æ‰°ã€‚',
      mild: 'ä½ å‡ºç°äº†ä¸€äº›è½»åº¦çš„å¼ºè¿«å€¾å‘ï¼Œå¦‚å¶å°”åå¤æ£€æŸ¥æˆ–éš¾ä»¥å†³å®šã€‚è¿™åœ¨å‹åŠ›ä¸‹æ˜¯å¸¸è§çš„ï¼Œä¸å¿…è¿‡äºæ‹…å¿ƒã€‚å°è¯•æ¥çº³ä¸ç¡®å®šæ€§ï¼Œå‡å°‘ä¸å¿…è¦çš„æ£€æŸ¥è¡Œä¸ºã€‚',
      moderate: 'ä½ çš„å¼ºè¿«ç—‡çŠ¶è¾ƒä¸ºæ˜æ˜¾ï¼Œå¯èƒ½ç»å¸¸è¢«æŸäº›æƒ³æ³•å›°æ‰°æˆ–éœ€è¦åå¤ç¡®è®¤äº‹æƒ…ã€‚å»ºè®®å­¦ä¹ æ¥çº³ä¸å®Œç¾ï¼Œé€æ­¥å‡å°‘å¼ºè¿«è¡Œä¸ºï¼Œå¿…è¦æ—¶å¯å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚',
      high: 'ä½ çš„å¼ºè¿«ç—‡çŠ¶æ°´å¹³è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¸¥é‡å½±å“æ—¥å¸¸ç”Ÿæ´»æ•ˆç‡å’Œæƒ…ç»ªçŠ¶æ€ã€‚å¼ºçƒˆå»ºè®®å¯»æ±‚ä¸“ä¸šå¿ƒç†å¸®åŠ©ï¼Œè®¤çŸ¥è¡Œä¸ºç–—æ³•å¯¹å¼ºè¿«ç—‡çŠ¶æœ‰è‰¯å¥½æ•ˆæœã€‚'
    },
    int: {
      normal: 'ä½ çš„äººé™…æ•æ„Ÿåº¦æ­£å¸¸ï¼Œèƒ½å¤Ÿèˆ’é€‚åœ°ä¸ä»–äººç›¸å¤„ã€‚ä½ æœ‰å¥åº·çš„è‡ªæˆ‘è¯„ä»·ï¼Œä¸ä¼šè¿‡åº¦åœ¨æ„ä»–äººçš„çœ‹æ³•ï¼Œäººé™…å…³ç³»å’Œè°ã€‚',
      mild: 'ä½ å‡ºç°äº†ä¸€äº›è½»åº¦çš„äººé™…æ•æ„Ÿï¼Œå¯èƒ½å¶å°”ä¼šåœ¨æ„åˆ«äººçš„è¯„ä»·æˆ–æ„Ÿåˆ°ä¸è‡ªåœ¨ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œå°è¯•å»ºç«‹æ›´ç§¯æçš„è‡ªæˆ‘è®¤çŸ¥ï¼Œå…³æ³¨è‡ªå·±çš„ä¼˜ç‚¹ã€‚',
      moderate: 'ä½ çš„äººé™…æ•æ„Ÿåº¦è¾ƒé«˜ï¼Œå¯èƒ½ç»å¸¸æ‹…å¿ƒåˆ«äººçš„çœ‹æ³•æˆ–æ„Ÿåˆ°è‡ªå‘ã€‚å»ºè®®åŸ¹å…»è‡ªæˆ‘æ¥çº³ï¼Œå­¦ä¹ assertiveæ²Ÿé€šæŠ€å·§ï¼Œé€æ­¥å»ºç«‹è‡ªä¿¡ã€‚',
      high: 'ä½ çš„äººé™…æ•æ„Ÿæ°´å¹³è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¸¥é‡å½±å“ç¤¾äº¤å’Œè‡ªæˆ‘è¯„ä»·ã€‚å»ºè®®å¯»æ±‚å¿ƒç†å’¨è¯¢ï¼Œæ¢ç´¢äººé™…æ•æ„Ÿçš„æ ¹æºï¼Œå»ºç«‹æ›´å¥åº·çš„è‡ªæˆ‘æ¦‚å¿µå’Œäººé™…æ¨¡å¼ã€‚'
    },
    dep: {
      normal: 'ä½ çš„æƒ…ç»ªçŠ¶æ€è‰¯å¥½ï¼Œèƒ½å¤Ÿæ„Ÿå—ç”Ÿæ´»ä¸­çš„å¿«ä¹å’Œæ„ä¹‰ã€‚å³ä½¿é‡åˆ°å›°éš¾ï¼Œä½ ä¹Ÿèƒ½ä¿æŒç›¸å¯¹ç§¯æçš„å¿ƒæ€ã€‚ç»§ç»­ä¿æŒä¸ä»–äººçš„è¿æ¥å’Œæœ‰æ„ä¹‰çš„æ´»åŠ¨ã€‚',
      mild: 'ä½ å‡ºç°äº†ä¸€äº›è½»åº¦çš„æŠ‘éƒæƒ…ç»ªï¼Œå¦‚å¶å°”æ„Ÿåˆ°ä½è½æˆ–å¯¹äº‹ç‰©å…´è¶£ä¸‹é™ã€‚è¿™å¯èƒ½æ˜¯æš‚æ—¶çš„ååº”ï¼Œä¿æŒè§„å¾‹ä½œæ¯ã€é€‚åº¦è¿åŠ¨å’Œç¤¾äº¤æ´»åŠ¨ä¼šæœ‰å¸®åŠ©ã€‚',
      moderate: 'ä½ çš„æŠ‘éƒç—‡çŠ¶è¾ƒä¸ºæ˜æ˜¾ï¼Œæƒ…ç»ªä½è½å’Œå…´è¶£å‡é€€å¯èƒ½æŒç»­å­˜åœ¨ã€‚å»ºè®®ç§¯æå¯»æ±‚æ”¯æŒï¼Œä¸ä¿¡ä»»çš„äººäº¤æµï¼Œè€ƒè™‘ä¸“ä¸šå¿ƒç†å’¨è¯¢ã€‚',
      high: 'ä½ çš„æŠ‘éƒæ°´å¹³è¾ƒé«˜ï¼Œè¿™æ˜¯éœ€è¦è®¤çœŸå¯¹å¾…çš„ä¿¡å·ã€‚è¯·åŠ¡å¿…å¯»æ±‚ä¸“ä¸šå¸®åŠ©ï¼Œä¸å¿ƒç†å’¨è¯¢å¸ˆæˆ–ç²¾ç¥ç§‘åŒ»ç”Ÿäº¤æµã€‚è®°ä½ï¼ŒæŠ‘éƒæ˜¯å¯ä»¥æ²»ç–—çš„ï¼Œå¯»æ±‚å¸®åŠ©æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚'
    },
    anx: {
      normal: 'ä½ çš„ç„¦è™‘æ°´å¹³æ­£å¸¸ï¼Œèƒ½å¤Ÿè¾ƒå¥½åœ°åº”å¯¹æ—¥å¸¸å‹åŠ›å’Œä¸ç¡®å®šæ€§ã€‚ä½ ä¸ä¼šè¿‡åº¦æ‹…å¿ƒæœªæ¥çš„äº‹æƒ…ï¼Œèƒ½å¤Ÿæ´»åœ¨å½“ä¸‹ã€‚',
      mild: 'ä½ å‡ºç°äº†ä¸€äº›è½»åº¦ç„¦è™‘ï¼Œå¦‚å¶å°”æ„Ÿåˆ°ç´§å¼ æˆ–æ‹…å¿ƒã€‚è¿™åœ¨é¢å¯¹å‹åŠ›æ—¶æ˜¯æ­£å¸¸çš„ã€‚å­¦ä¹ ä¸€äº›æ”¾æ¾æŠ€å·§ï¼Œå¦‚æ·±å‘¼å¸æˆ–æ­£å¿µå†¥æƒ³ï¼Œä¼šæœ‰å¸®åŠ©ã€‚',
      moderate: 'ä½ çš„ç„¦è™‘ç—‡çŠ¶è¾ƒä¸ºæ˜æ˜¾ï¼Œå¯èƒ½ç»å¸¸æ„Ÿåˆ°ç´§å¼ ä¸å®‰æˆ–éš¾ä»¥æ”¾æ¾ã€‚å»ºè®®è¯†åˆ«ç„¦è™‘è§¦å‘å› ç´ ï¼Œå­¦ä¹ ç³»ç»Ÿçš„æ”¾æ¾æ–¹æ³•ï¼Œè€ƒè™‘å¯»æ±‚ä¸“ä¸šæŒ‡å¯¼ã€‚',
      high: 'ä½ çš„ç„¦è™‘æ°´å¹³è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¸¥é‡å½±å“ç”Ÿæ´»è´¨é‡ã€‚å»ºè®®å°½å¿«å¯»æ±‚ä¸“ä¸šå¸®åŠ©ï¼Œè®¤çŸ¥è¡Œä¸ºç–—æ³•å¯¹ç„¦è™‘æœ‰å¾ˆå¥½çš„æ•ˆæœã€‚åŒæ—¶ç¡®ä¿åŸºæœ¬çš„è‡ªæˆ‘ç…§é¡¾ã€‚'
    },
    hos: {
      normal: 'ä½ çš„æƒ…ç»ªæ§åˆ¶è‰¯å¥½ï¼Œèƒ½å¤Ÿé€‚å½“è¡¨è¾¾å’Œç®¡ç†æ„¤æ€’æƒ…ç»ªã€‚ä½ ä¸ä¼šè½»æ˜“è¢«æ¿€æ€’ï¼Œèƒ½å¤Ÿä»¥å»ºè®¾æ€§çš„æ–¹å¼å¤„ç†å†²çªã€‚',
      mild: 'ä½ å‡ºç°äº†ä¸€äº›è½»åº¦çš„æ•Œå¯¹æƒ…ç»ªï¼Œå¦‚å¶å°”æ„Ÿåˆ°çƒ¦èºæˆ–å®¹æ˜“å‘è„¾æ°”ã€‚è¿™å¯èƒ½ä¸è¿‘æœŸå‹åŠ›æœ‰å…³ã€‚å­¦ä¹ æƒ…ç»ªè¯†åˆ«å’Œè¡¨è¾¾æŠ€å·§ä¼šæœ‰å¸®åŠ©ã€‚',
      moderate: 'ä½ çš„æ•Œå¯¹æƒ…ç»ªè¾ƒä¸ºæ˜æ˜¾ï¼Œå¯èƒ½ç»å¸¸æ„Ÿåˆ°æ„¤æ€’æˆ–ä¸äººå†²çªã€‚å»ºè®®æ¢ç´¢æ„¤æ€’èƒŒåçš„éœ€æ±‚ï¼Œå­¦ä¹ æ„¤æ€’ç®¡ç†æŠ€å·§ï¼Œå¿…è¦æ—¶å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚',
      high: 'ä½ çš„æ•Œå¯¹æƒ…ç»ªæ°´å¹³è¾ƒé«˜ï¼Œè¿™å¯èƒ½å½±å“äººé™…å…³ç³»å’Œç”Ÿæ´»è´¨é‡ã€‚å¼ºçƒˆå»ºè®®å¯»æ±‚ä¸“ä¸šå¸®åŠ©ï¼Œå­¦ä¹ å¥åº·çš„æƒ…ç»ªè°ƒèŠ‚æ–¹å¼ã€‚å¦‚æœ‰ä¼¤å®³è‡ªå·±æˆ–ä»–äººçš„å†²åŠ¨ï¼Œè¯·ç«‹å³å¯»æ±‚å¸®åŠ©ã€‚'
    },
    pho: {
      normal: 'ä½ çš„ææƒ§æ°´å¹³æ­£å¸¸ï¼Œèƒ½å¤Ÿé¢å¯¹æ—¥å¸¸ç”Ÿæ´»ä¸­çš„å„ç§æƒ…å¢ƒã€‚ä½ ä¸ä¼šè¢«ä¸åˆç†çš„ææƒ§æ‰€é™åˆ¶ï¼Œç”Ÿæ´»è‡ªç”±åº¦è¾ƒé«˜ã€‚',
      mild: 'ä½ å‡ºç°äº†ä¸€äº›è½»åº¦ææƒ§ï¼Œå¯èƒ½å¯¹æŸäº›æƒ…å¢ƒæ„Ÿåˆ°ä¸é€‚ã€‚è¿™æ˜¯ç›¸å¯¹å¸¸è§çš„ï¼Œé€æ­¥æš´éœ²å’Œæ”¾æ¾ç»ƒä¹ å¯ä»¥å¸®åŠ©å‡è½»ææƒ§ã€‚',
      moderate: 'ä½ çš„ææƒ§ç—‡çŠ¶è¾ƒä¸ºæ˜æ˜¾ï¼Œå¯èƒ½å›é¿æŸäº›åœºæ‰€æˆ–æƒ…å¢ƒã€‚å»ºè®®å­¦ä¹ ç³»ç»Ÿè„±æ•æŠ€æœ¯ï¼Œé€æ­¥é¢å¯¹ææƒ§ï¼Œå¿…è¦æ—¶å¯»æ±‚ä¸“ä¸šæŒ‡å¯¼ã€‚',
      high: 'ä½ çš„ææƒ§æ°´å¹³è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¸¥é‡é™åˆ¶æ—¥å¸¸æ´»åŠ¨ã€‚å»ºè®®å¯»æ±‚ä¸“ä¸šå¿ƒç†å¸®åŠ©ï¼Œæš´éœ²ç–—æ³•å¯¹ææƒ§ç—‡æœ‰è‰¯å¥½æ•ˆæœã€‚ä¸è¦è®©ææƒ§æ§åˆ¶ä½ çš„ç”Ÿæ´»ã€‚'
    },
    par: {
      normal: 'ä½ çš„ä¿¡ä»»æ„Ÿæ­£å¸¸ï¼Œèƒ½å¤Ÿä¸ä»–äººå»ºç«‹å¥åº·çš„å…³ç³»ã€‚ä½ ä¸ä¼šè¿‡åº¦æ€€ç–‘ä»–äººçš„åŠ¨æœºï¼Œäººé™…äº¤å¾€è½»æ¾è‡ªåœ¨ã€‚',
      mild: 'ä½ å‡ºç°äº†ä¸€äº›è½»åº¦çš„åæ‰§å€¾å‘ï¼Œå¯èƒ½å¶å°”ä¼šæ€€ç–‘ä»–äººçš„æ„å›¾ã€‚è¿™å¯èƒ½ä¸è¿‡å»çš„ç»å†æœ‰å…³ã€‚å°è¯•åŸ¹å…»æ›´å¼€æ”¾çš„å¿ƒæ€ï¼Œç»™äºˆä»–äººä¿¡ä»»çš„æœºä¼šã€‚',
      moderate: 'ä½ çš„åæ‰§ç—‡çŠ¶è¾ƒä¸ºæ˜æ˜¾ï¼Œå¯èƒ½ç»å¸¸æ„Ÿåˆ°è¢«é’ˆå¯¹æˆ–ä¸ä¿¡ä»»ä»–äººã€‚å»ºè®®åæ€è¿™äº›æƒ³æ³•çš„åˆç†æ€§ï¼Œå°è¯•ä»ä¸åŒè§’åº¦çœ‹é—®é¢˜ï¼Œè€ƒè™‘å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚',
      high: 'ä½ çš„åæ‰§æ°´å¹³è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¸¥é‡å½±å“äººé™…å…³ç³»å’Œç”Ÿæ´»è´¨é‡ã€‚å»ºè®®å°½å¿«å¯»æ±‚ä¸“ä¸šå¿ƒç†å¸®åŠ©ï¼Œæ¢ç´¢åæ‰§èƒŒåçš„åŸå› ï¼Œå»ºç«‹æ›´å¥åº·çš„è®¤çŸ¥æ¨¡å¼ã€‚'
    },
    psy: {
      normal: 'ä½ çš„ç°å®æ„Ÿç¨³å®šï¼Œèƒ½å¤Ÿæ¸…æ™°åœ°æ„ŸçŸ¥è‡ªå·±å’Œå‘¨å›´ç¯å¢ƒã€‚ä½ ä¸ä»–äººä¿æŒè‰¯å¥½çš„è¿æ¥ï¼Œä¸ä¼šæ„Ÿåˆ°ç–ç¦»æˆ–ä¸çœŸå®ã€‚',
      mild: 'ä½ å‡ºç°äº†ä¸€äº›è½»åº¦çš„ç°å®æ„Ÿå˜åŒ–ï¼Œå¯èƒ½å¶å°”æ„Ÿåˆ°å­¤ç‹¬æˆ–ä¸ä»–äººç–è¿œã€‚è¿™åœ¨å‹åŠ›ä¸‹æ˜¯å¯èƒ½å‘ç”Ÿçš„ï¼Œå¢åŠ ç¤¾äº¤æ´»åŠ¨å’Œè‡ªæˆ‘å…³æ€€ä¼šæœ‰å¸®åŠ©ã€‚',
      moderate: 'ä½ çš„ç°å®æ„Ÿç¨³å®šæ€§æœ‰æ‰€ä¸‹é™ï¼Œå¯èƒ½ç»å¸¸æ„Ÿåˆ°å­¤ç‹¬æˆ–ä¸ç°å®è„±èŠ‚ã€‚å»ºè®®å¢å¼ºä¸ä»–äººçš„è¿æ¥ï¼Œå»ºç«‹æ”¯æŒç³»ç»Ÿï¼Œè€ƒè™‘å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚',
      high: 'ä½ çš„ç°å®æ„Ÿç¨³å®šæ€§è¾ƒä½ï¼Œè¿™æ˜¯éœ€è¦è®¤çœŸå¯¹å¾…çš„ä¿¡å·ã€‚è¯·å°½å¿«å¯»æ±‚ä¸“ä¸šå¿ƒç†æˆ–ç²¾ç¥ç§‘å¸®åŠ©ï¼Œç¡®ä¿ä½ å¾—åˆ°é€‚å½“çš„æ”¯æŒå’Œæ²»ç–—ã€‚'
    }
  };

  const dimAnalysis = analyses[dim];
  if (score <= 5) return dimAnalysis.normal;
  if (score <= 10) return dimAnalysis.mild;
  if (score <= 15) return dimAnalysis.moderate;
  return dimAnalysis.high;
}

function showResult() {
  document.getElementById('testPage').classList.remove('active');
  document.getElementById('resultPage').classList.add('active');

  const scores = calcScores();
  const total = Object.values(scores).reduce((a, b) => a + b, 0);
  const status = getOverallStatus(total);

  // æ‰¾å‡ºéœ€è¦å…³æ³¨çš„ç»´åº¦
  const concerns = Object.entries(scores)
    .filter(([dim, score]) => score > 10)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 2);

  document.getElementById('resultContent').innerHTML = `
    <div class="result-header">
      <h1>å¿ƒç†çŠ¶æ€è¯„ä¼°æŠ¥å‘Š</h1>
      <p>åŸºäºSCL-90ä¸“ä¸šé‡è¡¨ Â· å®‡å®™è®¤çŸ¥ç›ç©¶æ‰€</p>
    </div>

    <div class="card">
      <div class="status-card ${status.class}">
        <div class="status-label">å½“å‰å¿ƒç†çŠ¶æ€</div>
        <div class="status-value">${status.level}</div>
      </div>
      <div class="summary-text">${status.desc}</div>
      ${total > 90 ? `
        <div class="warning-section">
          <h4>âš ï¸ é‡è¦æç¤º</h4>
          <p>ä½ çš„è¯„ä¼°ç»“æœæ˜¾ç¤ºå¤šä¸ªç»´åº¦å­˜åœ¨è¾ƒé«˜å›°æ‰°ã€‚è¿™ä¸æ˜¯è¯Šæ–­ï¼Œä½†å»ºè®®ä½ è®¤çœŸå¯¹å¾…è¿™äº›ä¿¡å·ï¼ŒåŠæ—¶å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢å¸ˆæˆ–ç²¾ç¥ç§‘åŒ»ç”Ÿçš„å¸®åŠ©ã€‚å¦‚æœ‰è‡ªä¼¤æˆ–ä¼¤å®³ä»–äººçš„æƒ³æ³•ï¼Œè¯·ç«‹å³æ‹¨æ‰“å¿ƒç†æ´åŠ©çƒ­çº¿æˆ–å‰å¾€åŒ»é™¢ã€‚</p>
        </div>
      ` : ''}
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#dbeafe">ğŸ“Š</div>å¿ƒç†çŠ¶æ€é›·è¾¾å›¾</div>
      <div class="chart-wrap"><canvas id="radarChart"></canvas></div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#fef3c7">ğŸ“‹</div>9ç»´åº¦è¯¦ç»†åˆ†æ</div>
      ${Object.entries(dimInfo).map(([dim, info]) => {
        const score = scores[dim];
        const level = getDimLevel(score);
        return `
          <div class="dim-item">
            <div class="dim-header">
              <div class="dim-name"><div class="dim-icon" style="background:${info.bg}">${info.icon}</div>${info.name}</div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span class="level-badge ${level.class}">${level.level}</span>
                <span style="font-weight:600;color:var(--primary);">${score}/20</span>
              </div>
            </div>
            <div class="dim-bar"><div class="dim-bar-fill" style="width:${(score/20)*100}%;background:${level.color}"></div></div>
            <div style="font-size:13px;color:var(--text-muted);line-height:1.7;margin-top:8px;">${getDimAnalysis(dim, score)}</div>
          </div>
        `;
      }).join('')}
    </div>

    ${concerns.length > 0 ? `
    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#fee2e2">âš ï¸</div>éœ€è¦ç‰¹åˆ«å…³æ³¨çš„ç»´åº¦</div>
      <div class="summary-text">
        æ ¹æ®ä½ çš„è¯„ä¼°ç»“æœï¼Œä»¥ä¸‹ç»´åº¦éœ€è¦ç‰¹åˆ«å…³æ³¨ï¼š
        <ul style="margin-top:12px;padding-left:20px;">
          ${concerns.map(([dim, score]) => `<li><strong>${dimInfo[dim].name}</strong>ï¼ˆå¾—åˆ† ${score}/20ï¼‰ï¼šå»ºè®®é‡ç‚¹å…³æ³¨å¹¶é‡‡å–ç›¸åº”æªæ–½</li>`).join('')}
        </ul>
      </div>
    </div>
    ` : ''}

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#d1fae5">ğŸ’¡</div>è‡ªæˆ‘è°ƒæ•´å»ºè®®</div>
      <div class="tip-item"><div class="tip-num">1</div><div class="tip-text">ä¿æŒè§„å¾‹çš„ä½œæ¯æ—¶é—´ï¼Œç¡®ä¿å……è¶³çš„ç¡çœ ï¼ˆ7-8å°æ—¶ï¼‰ï¼Œè¿™æ˜¯å¿ƒç†å¥åº·çš„åŸºç¡€</div></div>
      <div class="tip-item"><div class="tip-num">2</div><div class="tip-text">æ¯å¤©è¿›è¡Œé€‚åº¦çš„èº«ä½“æ´»åŠ¨ï¼Œè¿åŠ¨å¯ä»¥æœ‰æ•ˆç¼“è§£å‹åŠ›å’Œæ”¹å–„æƒ…ç»ª</div></div>
      <div class="tip-item"><div class="tip-num">3</div><div class="tip-text">ç»´æŒå¥åº·çš„ç¤¾äº¤å…³ç³»ï¼Œä¸ä¿¡ä»»çš„äººåˆ†äº«ä½ çš„æ„Ÿå—å’Œå›°æ‰°</div></div>
      <div class="tip-item"><div class="tip-num">4</div><div class="tip-text">å­¦ä¹ æ”¾æ¾æŠ€å·§ï¼Œå¦‚æ·±å‘¼å¸ã€æ­£å¿µå†¥æƒ³æˆ–æ¸è¿›å¼è‚Œè‚‰æ”¾æ¾</div></div>
      <div class="tip-item"><div class="tip-num">5</div><div class="tip-text">å¦‚æœç—‡çŠ¶æŒç»­æˆ–åŠ é‡ï¼Œä¸è¦çŠ¹è±«ï¼ŒåŠæ—¶å¯»æ±‚ä¸“ä¸šå¿ƒç†å¸®åŠ©</div></div>
    </div>

    <div class="card">
      <div class="section-title"><div class="section-icon" style="background:#e0e7ff">ğŸ“</div>ä¸“ä¸šæ”¯æŒèµ„æº</div>
      <div class="summary-text">
        <p>å¦‚æœä½ æ­£åœ¨ç»å†ä¸¥é‡çš„å¿ƒç†å›°æ‰°ï¼Œä»¥ä¸‹èµ„æºå¯ä»¥æä¾›å¸®åŠ©ï¼š</p>
        <ul style="margin-top:12px;padding-left:20px;line-height:2;">
          <li>å…¨å›½å¿ƒç†æ´åŠ©çƒ­çº¿ï¼š400-161-9995</li>
          <li>åŒ—äº¬å¿ƒç†å±æœºç ”ç©¶ä¸å¹²é¢„ä¸­å¿ƒï¼š010-82951332</li>
          <li>ç”Ÿå‘½çƒ­çº¿ï¼š400-821-1215</li>
          <li>æˆ–å‰å¾€å½“åœ°ç²¾ç¥å«ç”Ÿä¸­å¿ƒã€ä¸‰ç”²åŒ»é™¢å¿ƒç†ç§‘å°±è¯Š</li>
        </ul>
      </div>
      <div class="warning-section" style="margin-top:16px;background:#fef3c7;border-color:#fde68a;">
        <h4 style="color:#92400e;">ğŸ“‹ é‡è¦å£°æ˜</h4>
        <p style="color:#78350f;">æœ¬æµ‹è¯„ç»“æœä»…ä¾›è‡ªæˆ‘äº†è§£å‚è€ƒï¼Œä¸æ„æˆä»»ä½•å¿ƒç†è¯Šæ–­æˆ–åŒ»å­¦å»ºè®®ã€‚å¦‚æœ‰ä¸¥é‡å¿ƒç†å›°æ‰°æˆ–å±æœºçŠ¶å†µï¼Œè¯·åŠæ—¶å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚</p>
      </div>
    </div>

    <div class="action-btns">
      <button class="restart-btn primary" onclick="downloadPDF()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
        ä¸‹è½½PDFæŠ¥å‘Š
      </button>
      ${getNavButtons()}
    </div>
  `;

  // ç»˜åˆ¶é›·è¾¾å›¾
  const ctx = document.getElementById('radarChart').getContext('2d');
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: Object.values(dimInfo).map(d => d.name),
      datasets: [{
        label: 'å¾—åˆ†',
        data: Object.keys(dimInfo).map(d => scores[d]),
        backgroundColor: 'rgba(99, 102, 241, 0.2)',
        borderColor: '#6366f1',
        borderWidth: 2,
        pointBackgroundColor: '#6366f1'
      }]
    },
    options: {
      scales: {
        r: {
          beginAtZero: true,
          max: 20,
          ticks: { stepSize: 5 }
        }
      },
      plugins: { legend: { display: false } }
    }
  });
}

async function downloadPDF() {
  const btn = event.target.closest('button');
  const loading = document.getElementById('loading');
  btn.disabled = true;
  btn.innerHTML = 'ç”Ÿæˆä¸­...';
  loading.classList.add('show');

  try {
    const { jsPDF } = window.jspdf;
    const content = document.getElementById('resultContent');
    const canvas = await html2canvas(content, { scale: 2, useCORS: true, logging: false });
    const imgData = canvas.toDataURL('image/jpeg', 0.95);

    const pdf = new jsPDF('p', 'mm', 'a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    const imgWidth = pdfWidth - 20;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    let heightLeft = imgHeight;
    let position = 10;

    pdf.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
    heightLeft -= (pdfHeight - 20);

    while (heightLeft > 0) {
      position = heightLeft - imgHeight + 10;
      pdf.addPage();
      pdf.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
      heightLeft -= (pdfHeight - 20);
    }

    const date = new Date().toLocaleDateString('zh-CN').replace(/\//g, '-');
    pdf.save(`å¿ƒç†çŠ¶æ€è¯„ä¼°æŠ¥å‘Š_${date}.pdf`);
  } catch (e) {
    console.error(e);
    alert('PDFç”Ÿæˆå¤±è´¥');
  } finally {
    btn.disabled = false;
    btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> ä¸‹è½½PDFæŠ¥å‘Š';
    loading.classList.remove('show');
  }
}

render();
</script>
</body>
</html>
